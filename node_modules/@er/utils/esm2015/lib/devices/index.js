/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { from, of, throwError as observableThrowError } from 'rxjs';
import { catchError, map } from 'rxjs/operators';
export class DevicesUtils {
    /**
     * @return {?}
     */
    static getMediaDevices() {
        if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
            console.error('Can\'t enumerate devices, method not supported.');
        }
        return from(navigator.mediaDevices.enumerateDevices())
            .pipe(map((devices) => {
            /** @type {?} */
            const mediaDevices = [];
            for (const deviceI of devices) {
                console.log(deviceI);
                /** @type {?} */
                const device = {};
                for (const key in deviceI) {
                    if (key) {
                        device[key] = deviceI[key];
                    }
                }
                if (!device.deviceId) {
                    device.deviceId = ((/** @type {?} */ (device))).id;
                }
                if (!device.label) {
                    device.label = 'device (no-permission)';
                }
                mediaDevices.push(device);
            }
            return mediaDevices;
        }));
    }
    /**
     * @return {?}
     */
    static getVideoDevices() {
        /** @type {?} */
        const videos = DevicesUtils.getMediaDevices().pipe(map(devices => devices.filter(device => device.kind === 'videoinput')));
        return videos;
    }
    /**
     * @return {?}
     */
    static getAudioDevices() {
        /** @type {?} */
        const audios = DevicesUtils.getMediaDevices().pipe(map(devices => devices.filter(device => device.kind === 'audioinput')));
        return audios;
    }
    /**
     * @return {?}
     */
    static playBeepSound() {
        /** @type {?} */
        const snd = new Audio('data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=');
        snd.play();
    }
    /**
     * @param {?} constrains
     * @param {?} deviceId
     * @return {?}
     */
    static getMediaStream(constrains, deviceId) {
        if (!navigator.mediaDevices) {
            observableThrowError('Can\'t get user media, this is not supported.');
        }
        /** @type {?} */
        const video = deviceId === undefined
            ? { facingMode: { exact: 'environment' } }
            : { deviceId: { exact: deviceId } };
        constrains.video = video;
        return from(navigator.mediaDevices.getUserMedia(constrains))
            .pipe(map((stream) => stream), catchError(err => observableThrowError(err)));
    }
    /**
     * @param {?} mediaStream
     * @return {?}
     */
    static stopMedia(mediaStream) {
        if (mediaStream && mediaStream.getTracks) {
            mediaStream.getTracks()
                .forEach((track) => track.stop());
        }
    }
    /**
     * @param {?} videoEle
     * @param {?} canvasEle
     * @return {?}
     */
    static takeImage(videoEle, canvasEle) {
        /** @type {?} */
        const dimensions = {};
        if (videoEle.videoWidth) {
            dimensions['width'] = videoEle.videoWidth;
            dimensions['height'] = videoEle.videoHeight;
        }
        canvasEle.width = dimensions['width'];
        canvasEle.height = dimensions['height'];
        canvasEle.getContext('2d').drawImage(videoEle, 0, 0);
        /** @type {?} */
        const mimeType = 'image/jpeg';
        /** @type {?} */
        const dataUrl = canvasEle.toDataURL(mimeType);
        return of({ dataUrl, mimeType });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZXIvdXRpbHMvIiwic291cmNlcyI6WyJsaWIvZGV2aWNlcy9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLElBQUksRUFBYyxFQUFFLEVBQUUsVUFBVSxJQUFJLG9CQUFvQixFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQzlFLE9BQU8sRUFBQyxVQUFVLEVBQUUsR0FBRyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFFL0MsTUFBTSxPQUFPLFlBQVk7Ozs7SUFFdkIsTUFBTSxDQUFDLGVBQWU7UUFFcEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLGdCQUFnQixFQUFFO1lBQ3ZFLE9BQU8sQ0FBQyxLQUFLLENBQUMsaURBQWlELENBQUMsQ0FBQztTQUNsRTtRQUVELE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQzthQUNuRCxJQUFJLENBQ0gsR0FBRyxDQUFDLENBQUMsT0FBMEIsRUFBRSxFQUFFOztrQkFDM0IsWUFBWSxHQUFHLEVBQUU7WUFDdkIsS0FBSyxNQUFNLE9BQU8sSUFBSSxPQUFPLEVBQUU7Z0JBQzdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7O3NCQUNmLE1BQU0sR0FBUSxFQUFFO2dCQUN0QixLQUFLLE1BQU0sR0FBRyxJQUFJLE9BQU8sRUFBRTtvQkFDekIsSUFBSSxHQUFHLEVBQUU7d0JBQ1AsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztxQkFDNUI7aUJBQ0Y7Z0JBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUU7b0JBQ3BCLE1BQU0sQ0FBQyxRQUFRLEdBQUcsQ0FBQyxtQkFBSyxNQUFNLEVBQUEsQ0FBQyxDQUFDLEVBQUUsQ0FBQztpQkFDcEM7Z0JBQ0QsSUFBSSxDQUFDLE1B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QyxFQUFFLENBQUMsQ0FBQyxDQUFDOztjQUUvQyxRQUFRLEdBQUcsWUFBWTs7Y0FDdkIsT0FBTyxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO1FBRTdDLE9BQU8sRUFBRSxDQUFDLEVBQUMsT0FBTyxFQUFFLFFBQVEsRUFBQyxDQUFDLENBQUM7SUFDakMsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtmcm9tLCBPYnNlcnZhYmxlLCBvZiwgdGhyb3dFcnJvciBhcyBvYnNlcnZhYmxlVGhyb3dFcnJvcn0gZnJvbSAncnhqcyc7XG5pbXBvcnQge2NhdGNoRXJyb3IsIG1hcH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5leHBvcnQgY2xhc3MgRGV2aWNlc1V0aWxzIHtcblxuICBzdGF0aWMgZ2V0TWVkaWFEZXZpY2VzKCk6IE9ic2VydmFibGU8TWVkaWFEZXZpY2VJbmZvW10+IHtcblxuICAgIGlmICghbmF2aWdhdG9yLm1lZGlhRGV2aWNlcyB8fCAhbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdDYW5cXCd0IGVudW1lcmF0ZSBkZXZpY2VzLCBtZXRob2Qgbm90IHN1cHBvcnRlZC4nKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnJvbShuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMoKSlcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKGRldmljZXM6IE1lZGlhRGV2aWNlSW5mb1tdKSA9PiB7XG4gICAgICAgICAgY29uc3QgbWVkaWFEZXZpY2VzID0gW107XG4gICAgICAgICAgZm9yIChjb25zdCBkZXZpY2VJIG9mIGRldmljZXMpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGRldmljZUkpO1xuICAgICAgICAgICAgY29uc3QgZGV2aWNlOiBhbnkgPSB7fTtcbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIGRldmljZUkpIHtcbiAgICAgICAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgICAgIGRldmljZVtrZXldID0gZGV2aWNlSVtrZXldO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWRldmljZS5kZXZpY2VJZCkge1xuICAgICAgICAgICAgICBkZXZpY2UuZGV2aWNlSWQgPSAoPGFueT5kZXZpY2UpLmlkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFkZXZpY2UubGFiZWwpIHtcbiAgICAgICAgICAgICAgZGV2aWNlLmxhYmVsID0gJ2RldmljZSAobm8tcGVybWlzc2lvbiknO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbWVkaWFEZXZpY2VzLnB1c2goZGV2aWNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG1lZGlhRGV2aWNlcztcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cblxuICBzdGF0aWMgZ2V0VmlkZW9EZXZpY2VzKCk6IE9ic2VydmFibGU8TWVkaWFEZXZpY2VJbmZvW10+IHtcbiAgICBjb25zdCB2aWRlb3MgPSAgRGV2aWNlc1V0aWxzLmdldE1lZGlhRGV2aWNlcygpLnBpcGUoXG4gICAgICBtYXAoZGV2aWNlcyA9PiBkZXZpY2VzLmZpbHRlcihkZXZpY2UgPT4gZGV2aWNlLmtpbmQgPT09ICd2aWRlb2lucHV0JykpXG4gICAgKTtcbiAgICByZXR1cm4gdmlkZW9zO1xuICB9XG5cbiAgc3RhdGljIGdldEF1ZGlvRGV2aWNlcygpOiBPYnNlcnZhYmxlPE1lZGlhRGV2aWNlSW5mb1tdPiB7XG4gICAgY29uc3QgYXVkaW9zID0gIERldmljZXNVdGlscy5nZXRNZWRpYURldmljZXMoKS5waXBlKFxuICAgICAgbWFwKGRldmljZXMgPT4gZGV2aWNlcy5maWx0ZXIoZGV2aWNlID0+IGRldmljZS5raW5kID09PSAnYXVkaW9pbnB1dCcpKVxuICAgICk7XG4gICAgcmV0dXJuIGF1ZGlvcztcbiAgfVxuXG4gIHN0YXRpYyBwbGF5QmVlcFNvdW5kKCkge1xuICAgIGNvbnN0IHNuZCA9IG5ldyBBdWRpbygnZGF0YTphdWRpby93YXY7YmFzZTY0LC8vdVFSQUFBQVdNU0x3VUlZQUFzWWtYZ29Rd0FFYVlMV2ZrV2dBSTB3V3MvSXRBQUFHRGdZdEFnQXlOK1FXYUFBaWh3TVdtNEc4UVFSRGlNY0NCY0gzQ2MrQ0R2Lzd4QTRUdmg5UnoveThRQURCd01XZ1FBWkcvSUxOQUFSUTRHTFRjRGVJSUloeEdPQkF1RDdoT2ZCQjMvOTRnY0ozdytvNS81ZUlBSUFBQVZ3V2dRQVZRMk9SYUlRd0VNQUppRGc5NUc0blFMN21RVldJNkd3UmNmc1pBY3NLa0p2eGd4RWp6RlVnZkhvU1E5UXE3S053cUh3dUIxM01BNGExcS9EbUJySGdQY21qaUdvaC8vRXdDNW5HUEVtUzRSY2ZrVktPaEpmK1dPZ294SmNsRnoza2duLy9kQkEreWExR2h1ck5uOHpiLy85Tk51dE51aHozMWYvLy8vOXZ0Ly8veitJZEFFQUFBSzRMUUlBS29iSEl0RUlZQ0dBRXhCd2U4amNUb0Y5eklLckVkRFlJdVAyTWdPV0ZTRTM0d1lpUjVpcVFQajBKSWVvVmRsRzRWRDRYQTY3bUFjTmExZmh6QTFqd0h1VFJ4RFVRLy9pWUJjempIaVRKY0l1UHlLbEhRa3YvTEhRVVlrdVNpNTd5UVQvL3VnZ2ZaTmFqUTNWbXorWnQvLyttbTNXbTNRNTc2di8vLy8rMzIvLy81L0VPZ0FBQURWZ2hRQUFBQUEvL3VRWkFVQUIxV0kwUFp1Z0FBQUFBb1F3QUFBRWszblJkMnFBQUFBQUNpRGdBQUFBQUFBQkNxRUVRUkxDZ3dwQkdNbEprSXo4aktoR3ZqNGs2anpSbnFhc05LSWVvaDVnSTdCSmFDMUExQW9OQmpKZ2J5QXBWUzRJRGxaZ0RVNVdVQXhFS0RObW1BTEh6WnAwRmt6MUZNVG1HRmwxRk1FeW9kSWF2Y0NBVUhEV3JLQUlBNGFhMm9DZ0lMRUJ1cFpnSHZBaEVCY1o2am9RQnhTNzZBZ2NjckZsY3pCdktMQzBRSTJjQm9DRnZmVERBbzdlb09RSW5xRFBCdHZyREVaQk5ZTjV4d053eFFSZnc4WlE1d1FWTHZPOE9ZVSttSHZGTGxEaDA1TWRnN0JUNllyUlBwQ0J6bk1CMnIvL3hLSmp5eU9oK2NJbXIyLzRkb3Njd0Q2bmVaanVaUjRBZ0FBQllBQUFBQnkxeGNkUXR4WUJZWVpkaWZrVURnenpYYVhuOThaMG9pOUlMVTVtQmpGQU5tUndsVkozLzZqWURBbXhhaURHMy82eGpRUUNDS2tSYi82a2cvd1cra1NKNS8vckxvYmtMU2lLbXFQLzBpa0p1RGFTYVNmLzZKaUxZTEVZblcvK2tYZzFXUlZKTC85RW1RMVlaSXN2LzZRend5NXFrNy8rdEVVMG5rbHMzL3pJVU1QS05YLzZ5WkxmK2tGZ0FmZ0d5TEZBVXdZLy91UVpBVUFCY2Q1VWlOUFZYQUFBQXBBQUFBQUUwVlpRS3c5SVNBQUFDZ0FBQUFBVlFJeWdJRWxWckZrQlMrSmhpK0VBdXUrbEtBa1lVRUlzbUVBRW9NZURtQ0VUTXZmU0hUR2tGNVJXSDdrei9FU0hXUEFxL2tjQ1JocUJ0TWRva1BkTTd2aWw3Ukc5OEEyc2M3ek82WnZUZE03cG1PVUFaVG5KVytOWHhxbWQ0MWRxSjZtTFRYeHJQcG5WOGF2YUlmNVN2TDdwbmRQdlBwbmRKUjlLdXU4ZmVQdnVpdWhvcmdXanA3TWYvUFJqeGNGQ1BEa1czMXNyaW9DRXhpdnY5bGN3S0VhSHNmLzdvdzJGbDFULzlSa1hnRWhZRWxBb0NMRnRNQXJ4d2l2REpKK2JSMUhUS0pkbEVvVEVMQ0lxZ0V3VkdTUStoSW0wTmJLOFdYY1RFSTBVUG9hMk5iRzR5MkswMEpFV2JaYXZKWGtZYXFvOUNSSFM1NUZjWlRqS0VrM05Lb0NZVW5TUTByV3hyWmJGS2JLSWhPS1BaZTFjSkt6WlNhUXJJeVVMSERabVY1SzR4eVNzRFJLV09ydWFuR3RqTEpYRkVtd2FJYkRMWDBoSVBCVVFQVkZWa1FrRG9VTmZTb0RnUUdLUGVrb3hlR3pBNERVdm5uNGJ4emNacnRKeWlwS2ZQTnk1dys5bG5Yd2dxc2l5SE5lU1ZwZW13NGJXYjlwc1llcS8vdVFaQm9BQlF0NHlNVnhZQUlBQUFrUW9BQUFIdllwTDVtNkFBZ0FBQ1hEQUFBQUQ1OWpibFRpclFlOXVwRnNtWmJwTXVkeTdMejFYMURZc3hPT1NXcGZQcU5YMldxa3RLMERNdnVHd2xiTmo0NFRsZUxQUStHc2ZiK0dPV09LSm9JcldiM2NJTWVlT042bHoydW1UcU1YVjhNajMweVdQcGpvU2E5dWpLOFN5ZUpQNXk1bU9XMUQ2aHZMZXBldmVFQUVEbzBtZ0NSQ2xPRWdBTnYzQjlhNmZpa2dVU3UvRG1BTUFUckd4N25uZzVwNWlpbVBOWnNmUUxZQjJzRExJa3pSS1pPSEdBYVV5RGNwRkJTTEc5TUNRQUxnQUlnUXMyWXVuT3N6TFNBeVFZUFZDMllkR0dlSEQyZFRkSmsxcEFIR0FXRGpua2NMS0Z5bVMzUlFaVEluenlTb0J3TUcwUXVlQzNnTXNDRVl4VXFscmN4SzZrMUxRUWNzbXlZZVFQZEMyWWZ1R1BBU0NCa2NWTVFRcXBWSnNodWkxdGtYUUpRVjBPWEdBWk1YU09FRUJSaXJYYlZSUVc3dWdxN0lNN3JQV1NaeURsTTNJdU5Fa3h6Q09KMG55MlRoTmt5UmFpMWI2ZXYvLzNkek5Hek5iLy80dUF2SFQ1c1VSY1pDRmN1S0xoT0ZzOG1MQUFFQXQ0VVdBQUlBQkFBQUFBQjRxYkhvMHRJalZrVVUvL3VRWkF3QUJmU0Z6M1pxUUFBQUFBbmd3QUFBRTFIak1wMnFBQUFBQUNaRGdBQUFENVVrVEUxVWdaRVVFeHFZeW5OMXFadnFJT1JFRUZtQmNKUWt3ZHhpRnR3MHFFT2tHWWZSRGlmQnVpOU1RZzRRQUhBcVd0QVdIb0N4dTFZZjRWZldMUElNMm1IREZzYlFFVkd3eXFRb1Fjd25mSGVJa050OVlua2lhUzFvaXp5Y3FKcng0S09RamFoWnhXYmNaZ3p0ajJjNDluS21rSWQ0NFM3MWowYzhlVjl5REs2dVBSeng1WDE4ZUR2anZRNnlLbzlaU1M2bC8vOGVsZVBLL0xmLy9JSW5yT0YvRnZEb0FEWUFHQk1HYjdGdEVybTVNWE1sbVBBSlFWZ1d0YTdaeDJnbys4eEowVWlDYjhMSEhkZnRXeUxKRTBRSUFJc0krVWJYdTY3ZFpNam1nREdDR2wxSCt2cEY0TlNEY2tTSWtrN1ZkK3N4RWhCUU1SVThqLzEyVUlSaHpTYVVkUStyUVU1a0dlRnhtK2hiMW9oNnBXV212M3V2bVJlRGwwVW52dGFwVmFJem8xalpiZi9wRDZFbExxU1grclVtT1FOcEpGYS9yK3NhNGUvcEJsQUFCb0FBQUFBM0NVZ1NoTGRHSXhzWTdBVUFCUFJyZ0NBQmREdVE1R0M3RHFQUUNnYmJKVUFvUlNVaitOSUVpZzBZZnlXVWhvMVZCQkJBLy91UVpCNEFCWng1emZNYWtlQUFBQW13QUFBQUY1RjNQMHc5R3RBQUFDZkFBQUFBd0xoTURtQVlXTWdWRUcxVTBGSUdDQmdYQlhBdGZNSDEwMDAwRUVFRUVFQ1VCWWxuMDNUVFRkTkJEWm9wb3BZdnJUVGROYTMyNW1JbU5nM1RUUFY5cTNwbVkweG9PNmJ2M3IwMHkrSURHaWQvOWFhYVpUR011ajltcHU5TXBpbzFkWHJyNUhFUlRaU21xVTM2QTNDdW16Ti85Um9idi9YeDR2OWlqa1NSU05MUWhBV3VtYXA4MldSU0JVcVhTdFYvWWNTK1hWTG5TUytXTERyb3FBckZrTUVzQVMrZVdtclV6ck8wb0VtRTQwUmxNWjUrT0RJa0F5S0FHVXdaM21WS21jYW1jSm5NVzI2TVJQZ1V3NmorTGtoeUhHVkdZalNVVUtOcHVKVVFvT0lBeUR2RXlHOFM1eWZLNmRoWmMwVHgxS0kvZ3ZpS0w2cXZ2RnMxK2JXdGF6NTh1VU5ucnlxNmt0NVJ6T0NrUFdsVnFWWDJhL0VFQlVkVTFLclhMZjQwR29paUZYSy8vL3Fwb2lEWHJPZ3FEUjM4SkIwYnc3U29MK1pCOW8xUkNrUWpRMkNCWVpLZC8rVkp4WlJSWmxxU2tLaXdzMFdGeFV5Q3dzS2lNeTdoVVZGaElhQ3JOUXNLa1RJc0xpdndLS2lnc2o4WFlsd3QvV0tpMk40ZC8vdVFSQ1NBQWpVUk5JSHBNWkJHWWlhUVBTWXlBQUFCTEFBQUFBQUFBQ1dBQUFBQXBVRi9NZyswYW9oU0lSb2JCQXNNbE8vL0trNHNvb3N5MUpTRlJZV2FMQzRxWkJZV0ZSR1pkd3FLaXdrTkJWbW9XRlNKa1dGeFg0RkZSUVdSK0xzUzRXL3JGUmIvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9WRUZIQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQVUyOTFibVJpYjNrdVpHVUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBTWpBd05HaDBkSEE2THk5M2QzY3VjMjkxYm1SaWIza3VaR1VBQUFBQUFBQUFBQ1U9Jyk7XG4gICAgc25kLnBsYXkoKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRNZWRpYVN0cmVhbShjb25zdHJhaW5zOiBNZWRpYVN0cmVhbUNvbnN0cmFpbnRzLCBkZXZpY2VJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxNZWRpYVN0cmVhbT4ge1xuXG4gICAgaWYgKCFuYXZpZ2F0b3IubWVkaWFEZXZpY2VzKSB7XG4gICAgICBvYnNlcnZhYmxlVGhyb3dFcnJvcignQ2FuXFwndCBnZXQgdXNlciBtZWRpYSwgdGhpcyBpcyBub3Qgc3VwcG9ydGVkLicpO1xuICAgIH1cblxuICAgIGNvbnN0IHZpZGVvID0gZGV2aWNlSWQgPT09IHVuZGVmaW5lZFxuICAgICAgPyB7ZmFjaW5nTW9kZToge2V4YWN0OiAnZW52aXJvbm1lbnQnfX1cbiAgICAgIDoge2RldmljZUlkOiB7ZXhhY3Q6IGRldmljZUlkfX07XG5cbiAgICBjb25zdHJhaW5zLnZpZGVvID0gdmlkZW87XG5cbiAgICByZXR1cm4gZnJvbShuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShjb25zdHJhaW5zKSlcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKHN0cmVhbTogTWVkaWFTdHJlYW0pID0+IHN0cmVhbSksXG4gICAgICAgIGNhdGNoRXJyb3IoZXJyID0+IG9ic2VydmFibGVUaHJvd0Vycm9yKGVycikpXG4gICAgICApO1xuICB9XG5cbiAgc3RhdGljIHN0b3BNZWRpYShtZWRpYVN0cmVhbTogTWVkaWFTdHJlYW0pIHtcbiAgICBpZiAobWVkaWFTdHJlYW0gJiYgbWVkaWFTdHJlYW0uZ2V0VHJhY2tzKSB7XG4gICAgICBtZWRpYVN0cmVhbS5nZXRUcmFja3MoKVxuICAgICAgICAuZm9yRWFjaCgodHJhY2s6IE1lZGlhU3RyZWFtVHJhY2spID0+IHRyYWNrLnN0b3AoKSk7XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIHRha2VJbWFnZSh2aWRlb0VsZTogSFRNTFZpZGVvRWxlbWVudCwgY2FudmFzRWxlOiBIVE1MQ2FudmFzRWxlbWVudCk6IE9ic2VydmFibGU8YW55PiB7XG5cbiAgICBjb25zdCBkaW1lbnNpb25zID0ge307XG5cbiAgICBpZiAodmlkZW9FbGUudmlkZW9XaWR0aCkge1xuICAgICAgZGltZW5zaW9uc1snd2lkdGgnXSA9IHZpZGVvRWxlLnZpZGVvV2lkdGg7XG4gICAgICBkaW1lbnNpb25zWydoZWlnaHQnXSA9IHZpZGVvRWxlLnZpZGVvSGVpZ2h0O1xuICAgIH1cblxuICAgIGNhbnZhc0VsZS53aWR0aCA9IGRpbWVuc2lvbnNbJ3dpZHRoJ107XG4gICAgY2FudmFzRWxlLmhlaWdodCA9IGRpbWVuc2lvbnNbJ2hlaWdodCddO1xuXG4gICAgY2FudmFzRWxlLmdldENvbnRleHQoJzJkJykuZHJhd0ltYWdlKHZpZGVvRWxlLCAwLCAwKTtcblxuICAgIGNvbnN0IG1pbWVUeXBlID0gJ2ltYWdlL2pwZWcnO1xuICAgIGNvbnN0IGRhdGFVcmwgPSBjYW52YXNFbGUudG9EYXRhVVJMKG1pbWVUeXBlKTtcblxuICAgIHJldHVybiBvZih7ZGF0YVVybCwgbWltZVR5cGV9KTtcbiAgfVxufVxuIl19