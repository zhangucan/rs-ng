/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { AggInterval, AggIntervalProps, AggMethods, AggMethodsProps, DEFAULT_ES_QUERY_CONDITION, DEFAULT_QUERY_CONDITION, ES_QUERY_OPERATORS, Order } from '@er/types';
import * as esb from 'elastic-builder';
import { RequestBodySearch } from 'elastic-builder';
import { CommonsUtils } from '../comm';
import { DialogUtils } from '../dialog';
export class EsUtils {
    /**
     * @param {?} obj
     * @return {?}
     */
    static parseEsbObject(obj) {
        if (!obj) {
            return obj;
        }
        if (CommonsUtils.isArray(obj)) {
            return obj.forEach(o => EsUtils.parseEsbObject(o));
        }
        else {
            if (CommonsUtils.isFunction(obj['toJSON'])) {
                return obj['toJSON']();
            }
            else {
                return obj;
            }
        }
    }
    /**
     * @param {?} key
     * @param {?} aggMethods
     * @return {?}
     */
    static getFieldAggs(key, aggMethods) {
        if (aggMethods) {
            /** @type {?} */
            let aggs = {};
            aggMethods.forEach(method => {
                switch (method) {
                    case AggMethodsProps.avg.key:
                        aggs = CommonsUtils.merge(aggs, esb.avgAggregation(`${key}-${method}`, key).toJSON());
                        break;
                    case AggMethodsProps.distinct.key:
                        aggs = CommonsUtils.merge(aggs, esb.cardinalityAggregation(`${key}-${method}`, key).toJSON());
                        break;
                    case AggMethodsProps.max.key:
                        aggs = CommonsUtils.merge(aggs, esb.maxAggregation(`${key}-${method}`, key).toJSON());
                        break;
                    case AggMethodsProps.min.key:
                        aggs = CommonsUtils.merge(aggs, esb.minAggregation(`${key}-${method}`, key).toJSON());
                        break;
                    case AggMethodsProps.sum.key:
                        aggs = CommonsUtils.merge(aggs, esb.sumAggregation(`${key}-${method}`, key).toJSON());
                        break;
                    case AggMethodsProps.count.key:
                        aggs = CommonsUtils.merge(aggs, esb.valueCountAggregation(`${key}-${method}`, key).toJSON());
                        break;
                    default:
                        aggs = CommonsUtils.merge(aggs, esb.valueCountAggregation(`${key}-${method}`, key).toJSON());
                }
            });
            return aggs;
        }
        else {
            return undefined;
        }
    }
    /**
     * @param {?} query
     * @return {?}
     */
    static resolveQuery(query) {
        /** @type {?} */
        let must = [];
        /** @type {?} */
        let should = [];
        /** @type {?} */
        let not = [];
        if (query) {
            if (CommonsUtils.isArray(query)) {
                must = must.concat(query);
            }
            else if (CommonsUtils.isJson(query)) {
                if (query.hasOwnProperty('$and')) {
                    /** @type {?} */
                    const and = query['$and'];
                    if (CommonsUtils.isArray(and)) {
                        must = must.concat(and);
                    }
                    else {
                        must.push(and);
                    }
                }
                if (query.hasOwnProperty('$or')) {
                    /** @type {?} */
                    const or = query['$or'];
                    if (CommonsUtils.isArray(or)) {
                        should = should.concat(or);
                    }
                    else {
                        should.push(or);
                    }
                }
                if (query.hasOwnProperty('$not')) {
                    /** @type {?} */
                    const but = query['$not'];
                    if (CommonsUtils.isArray(but)) {
                        not = not.concat(but);
                    }
                    else {
                        not.push(but);
                    }
                }
            }
            else {
                must.push(query);
            }
        }
        return {
            must: CommonsUtils.compact(must),
            should: CommonsUtils.compact(should),
            not: CommonsUtils.compact(not)
        };
    }
    /**
     * @param {?} options
     * @return {?}
     */
    static resolveSearchFields(options) {
        /** @type {?} */
        const searchFields = CommonsUtils.getArrayValue(options.searchFields);
        if (CommonsUtils.isEmpty(searchFields)) {
            DialogUtils.error('数据错误', '没有定义查询字段');
            throw new Error('not found search fields');
        }
        /** @type {?} */
        const qs = [];
        searchFields.filter(field => !!field).forEach(field => {
            if (options.withPy) {
                if (options.withWildcard) {
                    qs.push(esb.wildcardQuery(`${field}.py`, `*${options.queryValue}*`));
                }
                else {
                    qs.push(esb.prefixQuery(`${field}.py`, options.queryValue));
                }
            }
            if (options.withZh) {
                qs.push(esb.wildcardQuery(`${field}.zh`, `*${options.queryValue}*`));
            }
            if (options.withTerm) {
                qs.push(esb.termQuery(field, options.queryValue));
            }
            if (options.withPrefix) {
                qs.push(esb.prefixQuery(field, options.queryValue));
            }
            if (options.withWildcard) {
                qs.push(esb.wildcardQuery(field, `*${options.queryValue}*`));
            }
            if (qs.length === 0) {
                qs.push(esb.matchQuery(field, options.queryValue));
            }
        });
        return qs;
    }
    /**
     * @param {?} options
     * @return {?}
     */
    static buildQueryBody(options) {
        /** @type {?} */
        const query = esb.requestBodySearch();
        /** @type {?} */
        const boolQuery = esb.boolQuery();
        /** @type {?} */
        const queries = EsUtils.resolveQuery(options.query);
        if (options.queryValue) {
            /** @type {?} */
            const qs = EsUtils.resolveSearchFields(options);
            if (qs.length === 1) {
                queries.must.push(qs[0]);
            }
            else {
                queries.should = queries.should.concat(qs);
            }
        }
        if (queries.must.length > 0) {
            boolQuery.must(queries.must);
        }
        if (queries.should.length > 0) {
            boolQuery.should(queries.should).minimumShouldMatch(1);
        }
        if (queries.not.length > 0) {
            boolQuery.mustNot(queries.not);
        }
        query.query(boolQuery);
        if (!CommonsUtils.isEmpty(options.filter)) {
            boolQuery.filter(options.filter);
        }
        if (!(options.returnFields && options.returnFields.length === 0)) {
            /** @type {?} */
            const returnFields = options.returnFields || options.searchFields;
            query.source(returnFields);
        }
        if (options.sort) {
            /** @type {?} */
            const sorts = EsUtils.resolveSort(options.sort);
            /** @type {?} */
            const esSorts = [];
            Object.keys(sorts).forEach(key => {
                esSorts.push(esb.sort(key, sorts[key] || Order.ASC).unmappedType('string'));
            });
            query.sorts(esSorts);
        }
        if (options.aggProps) {
            /** @type {?} */
            const aggs = EsUtils.parseAggProps(options.aggProps);
            if (aggs.length > 0) {
                ((/** @type {?} */ (query))).aggs(aggs);
                ((/** @type {?} */ (query))).size(options.size || 0);
            }
        }
        if (options.from) {
            query.from(options.from);
        }
        if (options.size) {
            query.size(options.size);
        }
        return query;
    }
    /**
     * @param {?} aggProps
     * @return {?}
     */
    static parseAggProps(aggProps) {
        /** @type {?} */
        const props = CommonsUtils.getArrayValue(aggProps);
        /** @type {?} */
        const aggs = [];
        /** @type {?} */
        let agg;
        props.forEach(item => {
            /** @type {?} */
            let aggProp = item;
            if (CommonsUtils.isString(aggProp)) {
                aggProp = { field: item };
            }
            /** @type {?} */
            const aggName = aggProp.name || `${aggProp.field}-${aggProp.method || 'terms'}`;
            if (aggProp.aggs) {
                aggProp.method = AggMethods.CUSTOMER;
            }
            switch (aggProp.method) {
                case AggMethods.AVG:
                    agg = esb.avgAggregation(aggName, aggProp.field).missing('0');
                    break;
                case AggMethods.MIN:
                    agg = esb.minAggregation(aggName, aggProp.field);
                    break;
                case AggMethods.MAX:
                    agg = esb.maxAggregation(aggName, aggProp.field);
                    break;
                case AggMethods.SUM:
                    agg = esb.sumAggregation(aggName, aggProp.field).missing('0');
                    break;
                case AggMethods.DISTINCT:
                    agg = esb.cardinalityAggregation(aggName, aggProp.field);
                    break;
                case AggMethods.HISTOGRAM:
                    agg = esb.histogramAggregation(aggName, aggProp.field);
                    if (aggProp.format) {
                        ((/** @type {?} */ (agg))).interval(aggProp.interval);
                    }
                    ((/** @type {?} */ (agg))).minDocCount(aggProp.minCount || 1);
                    if (aggProp.format) {
                        ((/** @type {?} */ (agg))).format(aggProp.format);
                    }
                    if (aggProp.missing) {
                        ((/** @type {?} */ (agg))).missing(aggProp.missing);
                    }
                    break;
                case AggMethods.DATE_HISTOGRAM:
                    agg = esb.dateHistogramAggregation(aggName, aggProp.field);
                    if (aggProp.interval) {
                        ((/** @type {?} */ (agg))).interval(aggProp.interval);
                    }
                    /** @type {?} */
                    const interval = aggProp.interval || AggInterval.DAY;
                    /** @type {?} */
                    const intervalProp = AggIntervalProps[interval];
                    ((/** @type {?} */ (agg))).interval(interval);
                    ((/** @type {?} */ (agg))).minDocCount(aggProp.minCount || 1);
                    /** @type {?} */
                    const format = aggProp.format || (intervalProp && intervalProp.format);
                    if (format) {
                        ((/** @type {?} */ (agg))).format(format);
                    }
                    if (aggProp.missing) {
                        ((/** @type {?} */ (agg))).missing(aggProp.missing);
                    }
                    break;
                case AggMethods.CUSTOMER:
                    agg = CommonsUtils.getValue(aggProp.aggs, aggProp);
                    break;
                case AggMethods.COUNT:
                    agg = esb.valueCountAggregation(aggName, aggProp.field);
                    break;
                default:
                    agg = esb.termsAggregation(aggName, aggProp.field).size(aggProp.size || 10);
                    break;
            }
            aggs.push(agg);
        });
        return aggs;
    }
    /**
     * @param {?} body
     * @param {?=} options
     * @return {?}
     */
    static resolveRequestBody(body, options) {
        if (!body || typeof body === 'string') {
            return body || {};
        }
        if (body instanceof RequestBodySearch) {
            return CommonsUtils.merge({}, body.toJSON() || {}, options.payload || {}, options.body || options.params || {});
        }
        /** @type {?} */
        const _body = Object.assign({}, body);
        if (!CommonsUtils.isEmpty(_body.sort)) {
            /** @type {?} */
            const sorts = EsUtils.resolveSort(_body.sort);
            /** @type {?} */
            const esSorts = [];
            Object.keys(sorts).forEach(key => {
                esSorts.push({ [key]: { order: sorts[key] || Order.ASC, 'unmapped_type': 'string' } });
            });
            _body.sort = esSorts;
        }
        if (_body.size && _body.page) {
            _body.from = _body.page * _body.size;
        }
        if (_body.from && _body.to) {
            _body.size = _body.to - _body.from;
        }
        delete _body.to;
        delete _body.page;
        if (!CommonsUtils.isEmpty(_body.query) ||
            !CommonsUtils.isEmpty(_body.filter)) {
            /** @type {?} */
            let esQuery = {};
            if (!CommonsUtils.isEmpty(_body.query)) {
                if (CommonsUtils.isArray(_body.query)) {
                    _body.query['$and'] = _body.query;
                }
                else {
                    _body.query = EsUtils.parseEsbObject(_body.query);
                }
                /** @type {?} */
                const queryBody = _body.query;
                if (Object.keys(queryBody).length > 0) {
                    Object.keys(queryBody).forEach(key => {
                        if (key === '$and') {
                            /** @type {?} */
                            const must = EsUtils.queryResolver(queryBody, '$and');
                            if (must) {
                                esQuery['must'] = must;
                            }
                        }
                        else if (key === '$or') {
                            /** @type {?} */
                            const should = EsUtils.queryResolver(queryBody, '$or');
                            if (should) {
                                esQuery['should'] = should;
                            }
                        }
                        else if (key === '$not') {
                            /** @type {?} */
                            const must_not = EsUtils.queryResolver(queryBody, '$not');
                            if (must_not) {
                                esQuery['must_not'] = must_not;
                            }
                        }
                        else if (queryBody[key]) {
                            if (esQuery['must']) {
                                esQuery['must'].push({ [key]: queryBody[key] });
                            }
                            else {
                                esQuery['must'] = [{ [key]: queryBody[key] }];
                            }
                        }
                    });
                    esQuery = Object.assign({}, esQuery);
                }
                if (esQuery['should'] && !esQuery['minimum_should_match']) {
                    esQuery['minimum_should_match'] = 1;
                }
            }
            if (!CommonsUtils.isEmpty(_body.filter)) {
                /** @type {?} */
                const filterBody = Object.assign({}, _body.filter);
                esQuery['filter'] = [];
                if (Object.keys(filterBody).length > 0) {
                    Object.keys(filterBody).forEach(key => {
                        if (filterBody[key]) {
                            esQuery['filter'].push({ [key]: filterBody[key] });
                        }
                    });
                }
                if (esQuery['filter'].length === 0) {
                    delete esQuery['filter'];
                }
            }
            if (Object.keys(esQuery).length > 0) {
                _body.query = { bool: esQuery };
            }
        }
        if (!CommonsUtils.isEmpty(_body.aggs)) {
            /** @type {?} */
            const aggs = EsUtils.parseAggProps(_body.aggs);
            if (aggs.length > 0) {
                _body.aggs = esb.requestBodySearch().aggs(aggs).toJSON()['aggs'];
            }
        }
        Object.keys(_body).forEach(k => {
            if (CommonsUtils.isEmpty(_body[k])) {
                delete _body[k];
            }
        });
        return _body;
    }
    /**
     * @param {?} sort
     * @return {?}
     */
    static resolveSort(sort) {
        /** @type {?} */
        let sorts = {};
        if (CommonsUtils.isString(sort)) {
            sorts[(/** @type {?} */ (sort))] = Order.ASC;
        }
        else if (CommonsUtils.isArray(sort)) {
            ((/** @type {?} */ (sort))).forEach(s => {
                if (CommonsUtils.isString(s)) {
                    if (!sorts[s]) {
                        sorts[s] = Order.ASC;
                    }
                }
                else {
                    sorts = Object.assign({}, sorts, (/** @type {?} */ (s)));
                }
            });
        }
        else {
            sorts = (/** @type {?} */ (sort));
        }
        return sorts;
    }
    /**
     * @param {?} qs
     * @return {?}
     */
    static getMsearchBody(qs) {
        /** @type {?} */
        const body = qs.map(q => JSON.stringify(q));
        return body.join('\n') + '\n';
    }
    /**
     * @param {?} ruleSet
     * @return {?}
     */
    static buildQueryRuleSet(ruleSet) {
        ruleSet = (!ruleSet) ? {} : ruleSet;
        return (function parse(data) {
            if (!data['condition']) {
                data['condition'] = DEFAULT_ES_QUERY_CONDITION || DEFAULT_QUERY_CONDITION;
            }
            if (['AND', 'OR'].indexOf(data['condition'].toUpperCase()) === -1) {
                throw new Error('不识别的ElasticSearch bool query 关系(AND,OR) "{0}"'
                    .replace('{0}', data['condition']));
            }
            if (!data['rules']) {
                return {};
            }
            /** @type {?} */
            const parts = {};
            parts['add'] = function (k, v) {
                if (this.hasOwnProperty(k)) {
                    this[k].push(v);
                }
                else {
                    this[k] = [v];
                }
            };
            data['rules'].forEach(function (rule) {
                /** @type {?} */
                const get_value = (aRule) => {
                    if (aRule.data && aRule.data.transform) {
                        return aRule.data.transform.call(this, aRule.value);
                    }
                    else {
                        return aRule.value;
                    }
                };
                /** @type {?} */
                const make_query = (aRule) => {
                    /** @type {?} */
                    const operator = ES_QUERY_OPERATORS[aRule.operator];
                    if (operator === undefined) {
                        throw new Error('不识别的查询操作符 "{0}"'
                            .replace('{0}', aRule.operator));
                    }
                    /** @type {?} */
                    let part = {};
                    if (operator.inputs !== 0) {
                        /** @type {?} */
                        const keyVal = {};
                        /** @type {?} */
                        const valueMapper = operator.getValue;
                        if (valueMapper) {
                            keyVal[aRule.field] = valueMapper(get_value(aRule));
                        }
                        else {
                            keyVal[aRule.field] = get_value(aRule);
                        }
                        part[operator.operator] = keyVal;
                    }
                    if (aRule.operator === 'is_null') {
                        part = { exists: { field: aRule.field } };
                    }
                    if (data['condition'] === 'NOT') {
                        return { 'bool': { 'must_not': [part] } };
                    }
                    else {
                        return part;
                    }
                };
                /** @type {?} */
                let clause;
                if (data['condition'] === 'AND') {
                    clause = 'must';
                }
                if (data['condition'] === 'NOT') {
                    clause = 'must_not';
                }
                if (data['condition'] === 'OR') {
                    clause = 'should';
                }
                if (rule['rules'] && rule['rules'].length > 0) {
                    parts['add'](clause, parse(rule));
                }
                else {
                    parts['add'](clause, make_query(rule));
                }
            });
            delete parts['add'];
            return { 'bool': parts };
        }(ruleSet));
    }
    /**
     * @param {?} aggs
     * @return {?}
     */
    static resolveAggs(aggs) {
        /** @type {?} */
        const resolved = {};
        Object.keys(aggs).forEach(key => {
            /** @type {?} */
            const agg = aggs[key];
            resolved[key] = {};
            Object.keys(agg).forEach(k => {
                if (k === 'buckets') {
                    resolved[key] = EsUtils.resolveBuckets(agg[k]);
                }
                else if (k === 'value') {
                    resolved[key] = agg[k];
                }
                else {
                    // console.debug('esUtils', 'discard agg key:' + k);
                    // resolved[key][k] = agg[key];
                }
            });
        });
        return resolved;
    }
    /**
     * @param {?} buckets
     * @return {?}
     */
    static resolveBuckets(buckets) {
        /** @type {?} */
        const resolved = buckets.map(bucket => EsUtils.resolveBucket(bucket));
        return resolved;
    }
    /**
     * @param {?} bucket
     * @return {?}
     */
    static resolveBucket(bucket) {
        /** @type {?} */
        let resolved = {};
        Object.keys(bucket).forEach(key => {
            if (key === 'key') {
                resolved['label'] = bucket['key'];
            }
            else if (key === 'doc_count') {
                resolved['value'] = bucket['doc_count'];
            }
            else {
                if (CommonsUtils.isJson(bucket[key])) {
                    resolved = Object.assign({}, resolved, EsUtils.resolveAggs({ [key]: bucket[key] }));
                }
                else {
                    resolved[key] = bucket[key];
                }
            }
        });
        return resolved;
    }
    /**
     * @private
     * @param {?} queryBody
     * @param {?} key
     * @return {?}
     */
    static queryResolver(queryBody, key) {
        if (queryBody[key]) {
            /** @type {?} */
            let _qs = queryBody[key].filter(q => !CommonsUtils.isEmpty(q));
            if (_qs.length > 0) {
                _qs = _qs.map(q => EsUtils.parseEsbObject(q));
            }
            return (_qs.length > 0) ? _qs : undefined;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZXIvdXRpbHMvIiwic291cmNlcyI6WyJsaWIvZXMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCxXQUFXLEVBQ1gsZ0JBQWdCLEVBQ2hCLFVBQVUsRUFDVixlQUFlLEVBSWYsMEJBQTBCLEVBQzFCLHVCQUF1QixFQUN2QixrQkFBa0IsRUFDbEIsS0FBSyxFQUlOLE1BQU0sV0FBVyxDQUFDO0FBQ25CLE9BQU8sS0FBSyxHQUFHLE1BQU0saUJBQWlCLENBQUM7QUFDdkMsT0FBTyxFQUFxRSxpQkFBaUIsRUFBTyxNQUFNLGlCQUFpQixDQUFDO0FBQzVILE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxTQUFTLENBQUM7QUFDckMsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUV0QyxNQUFNLE9BQU8sT0FBTzs7Ozs7SUFFbEIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxHQUFHO1FBQ3ZCLElBQUksQ0FBQyxHQUFHLEVBQUU7WUFDUixPQUFPLEdBQUcsQ0FBQztTQUNaO1FBQ0QsSUFBSSxZQUFZLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQzdCLE9BQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNwRDthQUFNO1lBQ0wsSUFBSSxZQUFZLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFO2dCQUMxQyxPQUFPLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO2FBQ3hCO2lCQUFNO2dCQUNMLE9BQU8sR0FBRyxDQUFDO2FBQ1o7U0FDRjtJQUNILENBQUM7Ozs7OztJQUVELE1BQU0sQ0FBQyxZQUFZLENBQUMsR0FBRyxFQUFFLFVBQVU7UUFDakMsSUFBSSxVQUFVLEVBQUU7O2dCQUNWLElBQUksR0FBRyxF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QUFJLFlBQVksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7b0JBQ3BDLFFBQVEscUJBQ0gsUUFBUSxFQUNSLE9BQU8sQ0FBQyxXQUFXLENBQUMsRUFBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBQyxDQUFDLENBQzdDLENBQUM7aUJBQ0g7cUJBQU07b0JBQ0wsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztpQkFDN0I7YUFDRjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQzs7Ozs7OztJQUVPLE1BQU0sQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLEdBQUc7UUFDekMsSUFBSSxTQUFTLENBQUMsR0FBRyxDQUFDLEVBQUU7O2dCQUNkLEdBQUcsR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlELElBQUksR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQ2xCLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQy9DO1lBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1NBQzNDO0lBQ0gsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWdnSW50ZXJ2YWwsXG4gIEFnZ0ludGVydmFsUHJvcHMsXG4gIEFnZ01ldGhvZHMsXG4gIEFnZ01ldGhvZHNQcm9wcyxcbiAgQWdnUHJvcHMsXG4gIEFwaURhdGFQcm9wcyxcbiAgQXBpUGF5bG9hZCxcbiAgREVGQVVMVF9FU19RVUVSWV9DT05ESVRJT04sXG4gIERFRkFVTFRfUVVFUllfQ09ORElUSU9OLFxuICBFU19RVUVSWV9PUEVSQVRPUlMsXG4gIE9yZGVyLFxuICBRdWVyeU9wZXJhdG9yLFxuICBRdWVyeVJ1bGUsXG4gIFF1ZXJ5UnVsZVNldFxufSBmcm9tICdAZXIvdHlwZXMnO1xuaW1wb3J0ICogYXMgZXNiIGZyb20gJ2VsYXN0aWMtYnVpbGRlcic7XG5pbXBvcnQge0FnZ3JlZ2F0aW9uLCBEYXRlSGlzdG9ncmFtQWdncmVnYXRpb24sIEhpc3RvZ3JhbUFnZ3JlZ2F0aW9uLCBRdWVyeSwgUmVxdWVzdEJvZHlTZWFyY2gsIFNvcnR9IGZyb20gJ2VsYXN0aWMtYnVpbGRlcic7XG5pbXBvcnQge0NvbW1vbnNVdGlsc30gZnJvbSAnLi4vY29tbSc7XG5pbXBvcnQge0RpYWxvZ1V0aWxzfSBmcm9tICcuLi9kaWFsb2cnO1xuXG5leHBvcnQgY2xhc3MgRXNVdGlscyB7XG5cbiAgc3RhdGljIHBhcnNlRXNiT2JqZWN0KG9iaikge1xuICAgIGlmICghb2JqKSB7XG4gICAgICByZXR1cm4gb2JqO1xuICAgIH1cbiAgICBpZiAoQ29tbW9uc1V0aWxzLmlzQXJyYXkob2JqKSkge1xuICAgICAgcmV0dXJuIG9iai5mb3JFYWNoKG8gPT4gRXNVdGlscy5wYXJzZUVzYk9iamVjdChvKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChDb21tb25zVXRpbHMuaXNGdW5jdGlvbihvYmpbJ3RvSlNPTiddKSkge1xuICAgICAgICByZXR1cm4gb2JqWyd0b0pTT04nXSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzdGF0aWMgZ2V0RmllbGRBZ2dzKGtleSwgYWdnTWV0aG9kcykge1xuICAgIGlmIChhZ2dNZXRob2RzKSB7XG4gICAgICBsZXQgYWdncyA9IHt9O1xuICAgICAgYWdnTWV0aG9kcy5mb3JFYWNoKG1ldGhvZCA9PiB7XG4gICAgICAgIHN3aXRjaCAobWV0aG9kKSB7XG4gICAgICAgICAgY2FzZSBBZ2dNZXRob2RzUHJvcHMuYXZnLmtleTpcbiAgICAgICAgICAgIGFnZ3MgPSBDb21tb25zVXRpbHMubWVyZ2UoYWdncywgZXNiLmF2Z0FnZ3JlZ2F0aW9uKGAke2tleX0tJHttZXRob2R9YCwga2V5KS50b0pTT04oKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEFnZ01ldGhvZHNQcm9wcy5kaXN0aW5jdC5rZXk6XG4gICAgICAgICAgICBhZ2dzID0gQ29tbW9uc1V0aWxzLm1lcmdlKGFnZ3MsIGVzYi5jYXJkaW5hbGl0eUFnZ3JlZ2F0aW9uKGAke2tleX0tJHttZXRob2R9YCwga2V5KS50b0pTT04oKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEFnZ01ldGhvZHNQcm9wcy5tYXgua2V5OlxuICAgICAgICAgICAgYWdncyA9IENvbW1vbnNVdGlscy5tZXJnZShhZ2dzLCBlc2IubWF4QWdncmVnYXRpb24oYCR7a2V5fS0ke21ldGhvZH1gLCBrZXkpLnRvSlNPTigpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgQWdnTWV0aG9kc1Byb3BzLm1pbi5rZXk6XG4gICAgICAgICAgICBhZ2dzID0gQ29tbW9uc1V0aWxzLm1lcmdlKGFnZ3MsIGVzYi5taW5BZ2dyZWdhdGlvbihgJHtrZXl9LSR7bWV0aG9kfWAsIGtleSkudG9KU09OKCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBBZ2dNZXRob2RzUHJvcHMuc3VtLmtleTpcbiAgICAgICAgICAgIGFnZ3MgPSBDb21tb25zVXRpbHMubWVyZ2UoYWdncywgZXNiLnN1bUFnZ3JlZ2F0aW9uKGAke2tleX0tJHttZXRob2R9YCwga2V5KS50b0pTT04oKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEFnZ01ldGhvZHNQcm9wcy5jb3VudC5rZXk6XG4gICAgICAgICAgICBhZ2dzID0gQ29tbW9uc1V0aWxzLm1lcmdlKGFnZ3MsIGVzYi52YWx1ZUNvdW50QWdncmVnYXRpb24oYCR7a2V5fS0ke21ldGhvZH1gLCBrZXkpLnRvSlNPTigpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBhZ2dzID0gQ29tbW9uc1V0aWxzLm1lcmdlKGFnZ3MsIGVzYi52YWx1ZUNvdW50QWdncmVnYXRpb24oYCR7a2V5fS0ke21ldGhvZH1gLCBrZXkpLnRvSlNPTigpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gYWdncztcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgcmVzb2x2ZVF1ZXJ5KHF1ZXJ5KToge1xuICAgIG11c3Q6IFF1ZXJ5W10sXG4gICAgc2hvdWxkOiBRdWVyeVtdLFxuICAgIG5vdDogUXVlcnlbXVxuICB9IHtcbiAgICBsZXQgbXVzdCA9IFtdO1xuICAgIGxldCBzaG91bGQgPSBbXTtcbiAgICBsZXQgbm90ID0gW107XG4gICAgaWYgKHF1ZXJ5KSB7XG4gICAgICBpZiAoQ29tbW9uc1V0aWxzLmlzQXJyYXkocXVlcnkpKSB7XG4gICAgICAgIG11c3QgPSBtdXN0LmNvbmNhdChxdWVyeSk7XG4gICAgICB9IGVsc2UgaWYgKENvbW1vbnNVdGlscy5pc0pzb24ocXVlcnkpKSB7XG4gICAgICAgIGlmIChxdWVyeS5oYXNPd25Qcm9wZXJ0eSgnJGFuZCcpKSB7XG4gICAgICAgICAgY29uc3QgYW5kID0gcXVlcnlbJyRhbmQnXTtcbiAgICAgICAgICBpZiAoQ29tbW9uc1V0aWxzLmlzQXJyYXkoYW5kKSkge1xuICAgICAgICAgICAgbXVzdCA9IG11c3QuY29uY2F0KGFuZCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG11c3QucHVzaChhbmQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocXVlcnkuaGFzT3duUHJvcGVydHkoJyRvcicpKSB7XG4gICAgICAgICAgY29uc3Qgb3IgPSBxdWVyeVsnJG9yJ107XG4gICAgICAgICAgaWYgKENvbW1vbnNVdGlscy5pc0FycmF5KG9yKSkge1xuICAgICAgICAgICAgc2hvdWxkID0gc2hvdWxkLmNvbmNhdChvcik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNob3VsZC5wdXNoKG9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHF1ZXJ5Lmhhc093blByb3BlcnR5KCckbm90JykpIHtcbiAgICAgICAgICBjb25zdCBidXQgPSBxdWVyeVsnJG5vdCddO1xuICAgICAgICAgIGlmIChDb21tb25zVXRpbHMuaXNBcnJheShidXQpKSB7XG4gICAgICAgICAgICBub3QgPSBub3QuY29uY2F0KGJ1dCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5vdC5wdXNoKGJ1dCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtdXN0LnB1c2gocXVlcnkpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgbXVzdDogQ29tbW9uc1V0aWxzLmNvbXBhY3QobXVzdCksXG4gICAgICBzaG91bGQ6IENvbW1vbnNVdGlscy5jb21wYWN0KHNob3VsZCksXG4gICAgICBub3Q6IENvbW1vbnNVdGlscy5jb21wYWN0KG5vdClcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIHJlc29sdmVTZWFyY2hGaWVsZHMob3B0aW9ucykge1xuICAgIGNvbnN0IHNlYXJjaEZpZWxkcyA9IENvbW1vbnNVdGlscy5nZXRBcnJheVZhbHVlKG9wdGlvbnMuc2VhcmNoRmllbGRzKTtcblxuICAgIGlmIChDb21tb25zVXRpbHMuaXNFbXB0eShzZWFyY2hGaWVsZHMpKSB7XG4gICAgICBEaWFsb2dVdGlscy5lcnJvcign5pWw5o2u6ZSZ6K+vJywgJ+ayoeacieWumuS5ieafpeivouWtl+autScpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdub3QgZm91bmQgc2VhcmNoIGZpZWxkcycpO1xuICAgIH1cbiAgICBjb25zdCBxcyA9IFtdO1xuICAgIHNlYXJjaEZpZWxkcy5maWx0ZXIoZmllbGQgPT4gISFmaWVsZCkuZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgICBpZiAob3B0aW9ucy53aXRoUHkpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMud2l0aFdpbGRjYXJkKSB7XG4gICAgICAgICAgcXMucHVzaChlc2Iud2lsZGNhcmRRdWVyeShgJHtmaWVsZH0ucHlgLCBgKiR7b3B0aW9ucy5xdWVyeVZhbHVlfSpgKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcXMucHVzaChlc2IucHJlZml4UXVlcnkoYCR7ZmllbGR9LnB5YCwgb3B0aW9ucy5xdWVyeVZhbHVlKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLndpdGhaaCkge1xuICAgICAgICBxcy5wdXNoKGVzYi53aWxkY2FyZFF1ZXJ5KGAke2ZpZWxkfS56aGAsIGAqJHtvcHRpb25zLnF1ZXJ5VmFsdWV9KmApKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLndpdGhUZXJtKSB7XG4gICAgICAgIHFzLnB1c2goZXNiLnRlcm1RdWVyeShmaWVsZCwgb3B0aW9ucy5xdWVyeVZhbHVlKSk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy53aXRoUHJlZml4KSB7XG4gICAgICAgIHFzLnB1c2goZXNiLnByZWZpeFF1ZXJ5KGZpZWxkLCBvcHRpb25zLnF1ZXJ5VmFsdWUpKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLndpdGhXaWxkY2FyZCkge1xuICAgICAgICBxcy5wdXNoKGVzYi53aWxkY2FyZFF1ZXJ5KGZpZWxkLCBgKiR7b3B0aW9ucy5xdWVyeVZhbHVlfSpgKSk7XG4gICAgICB9XG4gICAgICBpZiAocXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHFzLnB1c2goZXNiLm1hdGNoUXVlcnkoZmllbGQsIG9wdGlvbnMucXVlcnlWYWx1ZSkpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBxcztcbiAgfVxuXG4gIHN0YXRpYyBidWlsZFF1ZXJ5Qm9keShvcHRpb25zOiBBcGlEYXRhUHJvcHMpOiBSZXF1ZXN0Qm9keVNlYXJjaCB7XG5cbiAgICBjb25zdCBxdWVyeTogUmVxdWVzdEJvZHlTZWFyY2ggPSBlc2IucmVxdWVzdEJvZHlTZWFyY2goKTtcblxuICAgIGNvbnN0IGJvb2xRdWVyeSA9IGVzYi5ib29sUXVlcnkoKTtcblxuICAgIGNvbnN0IHF1ZXJpZXMgPSBFc1V0aWxzLnJlc29sdmVRdWVyeShvcHRpb25zLnF1ZXJ5KTtcblxuICAgIGlmIChvcHRpb25zLnF1ZXJ5VmFsdWUpIHtcbiAgICAgIGNvbnN0IHFzID0gRXNVdGlscy5yZXNvbHZlU2VhcmNoRmllbGRzKG9wdGlvbnMpO1xuICAgICAgaWYgKHFzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBxdWVyaWVzLm11c3QucHVzaChxc1swXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBxdWVyaWVzLnNob3VsZCA9IHF1ZXJpZXMuc2hvdWxkLmNvbmNhdChxcyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHF1ZXJpZXMubXVzdC5sZW5ndGggPiAwKSB7XG4gICAgICBib29sUXVlcnkubXVzdChxdWVyaWVzLm11c3QpO1xuICAgIH1cblxuICAgIGlmIChxdWVyaWVzLnNob3VsZC5sZW5ndGggPiAwKSB7XG4gICAgICBib29sUXVlcnkuc2hvdWxkKHF1ZXJpZXMuc2hvdWxkKS5taW5pbXVtU2hvdWxkTWF0Y2goMSk7XG4gICAgfVxuXG4gICAgaWYgKHF1ZXJpZXMubm90Lmxlbmd0aCA+IDApIHtcbiAgICAgIGJvb2xRdWVyeS5tdXN0Tm90KHF1ZXJpZXMubm90KTtcbiAgICB9XG5cbiAgICBxdWVyeS5xdWVyeShib29sUXVlcnkpO1xuXG4gICAgaWYgKCFDb21tb25zVXRpbHMuaXNFbXB0eShvcHRpb25zLmZpbHRlcikpIHtcbiAgICAgIGJvb2xRdWVyeS5maWx0ZXIob3B0aW9ucy5maWx0ZXIpO1xuICAgIH1cblxuICAgIGlmICghKG9wdGlvbnMucmV0dXJuRmllbGRzICYmIG9wdGlvbnMucmV0dXJuRmllbGRzLmxlbmd0aCA9PT0gMCkpIHtcbiAgICAgIGNvbnN0IHJldHVybkZpZWxkcyA9IG9wdGlvbnMucmV0dXJuRmllbGRzIHx8IG9wdGlvbnMuc2VhcmNoRmllbGRzO1xuICAgICAgcXVlcnkuc291cmNlKHJldHVybkZpZWxkcyk7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuc29ydCkge1xuICAgICAgY29uc3Qgc29ydHMgPSBFc1V0aWxzLnJlc29sdmVTb3J0KG9wdGlvbnMuc29ydCk7XG4gICAgICBjb25zdCBlc1NvcnRzOiBTb3J0W10gPSBbXTtcbiAgICAgIE9iamVjdC5rZXlzKHNvcnRzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgIGVzU29ydHMucHVzaChlc2Iuc29ydChrZXksIHNvcnRzW2tleV0gfHwgT3JkZXIuQVNDKS51bm1hcHBlZFR5cGUoJ3N0cmluZycpKTtcbiAgICAgIH0pO1xuICAgICAgcXVlcnkuc29ydHMoZXNTb3J0cyk7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuYWdnUHJvcHMpIHtcbiAgICAgIGNvbnN0IGFnZ3MgPSBFc1V0aWxzLnBhcnNlQWdnUHJvcHMob3B0aW9ucy5hZ2dQcm9wcyk7XG4gICAgICBpZiAoYWdncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICg8UmVxdWVzdEJvZHlTZWFyY2g+cXVlcnkpLmFnZ3MoYWdncyk7XG4gICAgICAgICg8UmVxdWVzdEJvZHlTZWFyY2g+cXVlcnkpLnNpemUob3B0aW9ucy5zaXplIHx8IDApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChvcHRpb25zLmZyb20pIHtcbiAgICAgIHF1ZXJ5LmZyb20ob3B0aW9ucy5mcm9tKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5zaXplKSB7XG4gICAgICBxdWVyeS5zaXplKG9wdGlvbnMuc2l6ZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHF1ZXJ5O1xuICB9XG5cbiAgc3RhdGljIHBhcnNlQWdnUHJvcHMoYWdnUHJvcHMpIHtcbiAgICBjb25zdCBwcm9wcyA9IENvbW1vbnNVdGlscy5nZXRBcnJheVZhbHVlKGFnZ1Byb3BzKTtcbiAgICBjb25zdCBhZ2dzID0gW107XG4gICAgbGV0IGFnZzogQWdncmVnYXRpb247XG4gICAgcHJvcHMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIGxldCBhZ2dQcm9wOiBBZ2dQcm9wcyA9IGl0ZW07XG4gICAgICBpZiAoQ29tbW9uc1V0aWxzLmlzU3RyaW5nKGFnZ1Byb3ApKSB7XG4gICAgICAgIGFnZ1Byb3AgPSB7ZmllbGQ6IGl0ZW19O1xuICAgICAgfVxuICAgICAgY29uc3QgYWdnTmFtZSA9IGFnZ1Byb3AubmFtZSB8fCBgJHthZ2dQcm9wLmZpZWxkfS0ke2FnZ1Byb3AubWV0aG9kIHx8ICd0ZXJtcyd9YDtcbiAgICAgIGlmIChhZ2dQcm9wLmFnZ3MpIHtcbiAgICAgICAgYWdnUHJvcC5tZXRob2QgPSBBZ2dNZXRob2RzLkNVU1RPTUVSO1xuICAgICAgfVxuICAgICAgc3dpdGNoIChhZ2dQcm9wLm1ldGhvZCkge1xuICAgICAgICBjYXNlIEFnZ01ldGhvZHMuQVZHOlxuICAgICAgICAgIGFnZyA9IGVzYi5hdmdBZ2dyZWdhdGlvbihhZ2dOYW1lLCBhZ2dQcm9wLmZpZWxkKS5taXNzaW5nKCcwJyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQWdnTWV0aG9kcy5NSU46XG4gICAgICAgICAgYWdnID0gZXNiLm1pbkFnZ3JlZ2F0aW9uKGFnZ05hbWUsIGFnZ1Byb3AuZmllbGQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEFnZ01ldGhvZHMuTUFYOlxuICAgICAgICAgIGFnZyA9IGVzYi5tYXhBZ2dyZWdhdGlvbihhZ2dOYW1lLCBhZ2dQcm9wLmZpZWxkKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBZ2dNZXRob2RzLlNVTTpcbiAgICAgICAgICBhZ2cgPSBlc2Iuc3VtQWdncmVnYXRpb24oYWdnTmFtZSwgYWdnUHJvcC5maWVsZCkubWlzc2luZygnMCcpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEFnZ01ldGhvZHMuRElTVElOQ1Q6XG4gICAgICAgICAgYWdnID0gZXNiLmNhcmRpbmFsaXR5QWdncmVnYXRpb24oYWdnTmFtZSwgYWdnUHJvcC5maWVsZCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQWdnTWV0aG9kcy5ISVNUT0dSQU06XG4gICAgICAgICAgYWdnID0gZXNiLmhpc3RvZ3JhbUFnZ3JlZ2F0aW9uKGFnZ05hbWUsIGFnZ1Byb3AuZmllbGQpO1xuICAgICAgICAgIGlmIChhZ2dQcm9wLmZvcm1hdCkge1xuICAgICAgICAgICAgKDxIaXN0b2dyYW1BZ2dyZWdhdGlvbj5hZ2cpLmludGVydmFsKGFnZ1Byb3AuaW50ZXJ2YWwpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAoPEhpc3RvZ3JhbUFnZ3JlZ2F0aW9uPmFnZykubWluRG9jQ291bnQoYWdnUHJvcC5taW5Db3VudCB8fCAxKTtcbiAgICAgICAgICBpZiAoYWdnUHJvcC5mb3JtYXQpIHtcbiAgICAgICAgICAgICg8SGlzdG9ncmFtQWdncmVnYXRpb24+YWdnKS5mb3JtYXQoYWdnUHJvcC5mb3JtYXQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoYWdnUHJvcC5taXNzaW5nKSB7XG4gICAgICAgICAgICAoPEhpc3RvZ3JhbUFnZ3JlZ2F0aW9uPmFnZykubWlzc2luZyhhZ2dQcm9wLm1pc3NpbmcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBZ2dNZXRob2RzLkRBVEVfSElTVE9HUkFNOlxuICAgICAgICAgIGFnZyA9IGVzYi5kYXRlSGlzdG9ncmFtQWdncmVnYXRpb24oYWdnTmFtZSwgYWdnUHJvcC5maWVsZCk7XG4gICAgICAgICAgaWYgKGFnZ1Byb3AuaW50ZXJ2YWwpIHtcbiAgICAgICAgICAgICg8RGF0ZUhpc3RvZ3JhbUFnZ3JlZ2F0aW9uPmFnZykuaW50ZXJ2YWwoYWdnUHJvcC5pbnRlcnZhbCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGludGVydmFsID0gYWdnUHJvcC5pbnRlcnZhbCB8fCBBZ2dJbnRlcnZhbC5EQVk7XG4gICAgICAgICAgY29uc3QgaW50ZXJ2YWxQcm9wID0gQWdnSW50ZXJ2YWxQcm9wc1tpbnRlcnZhbF07XG4gICAgICAgICAgKDxIaXN0b2dyYW1BZ2dyZWdhdGlvbj5hZ2cpLmludGVydmFsKGludGVydmFsKTtcbiAgICAgICAgICAoPEhpc3RvZ3JhbUFnZ3JlZ2F0aW9uPmFnZykubWluRG9jQ291bnQoYWdnUHJvcC5taW5Db3VudCB8fCAxKTtcbiAgICAgICAgICBjb25zdCBmb3JtYXQgPSBhZ2dQcm9wLmZvcm1hdCB8fCAoaW50ZXJ2YWxQcm9wICYmIGludGVydmFsUHJvcC5mb3JtYXQpO1xuICAgICAgICAgIGlmIChmb3JtYXQpIHtcbiAgICAgICAgICAgICg8SGlzdG9ncmFtQWdncmVnYXRpb24+YWdnKS5mb3JtYXQoZm9ybWF0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGFnZ1Byb3AubWlzc2luZykge1xuICAgICAgICAgICAgKDxIaXN0b2dyYW1BZ2dyZWdhdGlvbj5hZ2cpLm1pc3NpbmcoYWdnUHJvcC5taXNzaW5nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQWdnTWV0aG9kcy5DVVNUT01FUjpcbiAgICAgICAgICBhZ2cgPSBDb21tb25zVXRpbHMuZ2V0VmFsdWUoYWdnUHJvcC5hZ2dzLCBhZ2dQcm9wKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBZ2dNZXRob2RzLkNPVU5UOlxuICAgICAgICAgIGFnZyA9IGVzYi52YWx1ZUNvdW50QWdncmVnYXRpb24oYWdnTmFtZSwgYWdnUHJvcC5maWVsZCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgYWdnID0gZXNiLnRlcm1zQWdncmVnYXRpb24oYWdnTmFtZSwgYWdnUHJvcC5maWVsZCkuc2l6ZShhZ2dQcm9wLnNpemUgfHwgMTApO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgYWdncy5wdXNoKGFnZyk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGFnZ3M7XG4gIH1cblxuICBzdGF0aWMgcmVzb2x2ZVJlcXVlc3RCb2R5KGJvZHk6IEFwaVBheWxvYWQgfCBzdHJpbmcgfCBSZXF1ZXN0Qm9keVNlYXJjaCwgb3B0aW9ucz8pOiB7fSB7XG5cbiAgICBpZiAoIWJvZHkgfHwgdHlwZW9mIGJvZHkgPT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gYm9keSB8fCB7fTtcbiAgICB9XG5cbiAgICBpZiAoYm9keSBpbnN0YW5jZW9mIFJlcXVlc3RCb2R5U2VhcmNoKSB7XG4gICAgICByZXR1cm4gQ29tbW9uc1V0aWxzLm1lcmdlKHt9LCBib2R5LnRvSlNPTigpIHx8IHt9LCBvcHRpb25zLnBheWxvYWQgfHwge30sIG9wdGlvbnMuYm9keSB8fCBvcHRpb25zLnBhcmFtcyB8fCB7fSk7XG4gICAgfVxuXG4gICAgY29uc3QgX2JvZHkgPSB7Li4uYm9keX07XG4gICAgaWYgKCFDb21tb25zVXRpbHMuaXNFbXB0eShfYm9keS5zb3J0KSkge1xuICAgICAgY29uc3Qgc29ydHMgPSBFc1V0aWxzLnJlc29sdmVTb3J0KF9ib2R5LnNvcnQpO1xuICAgICAgY29uc3QgZXNTb3J0cyA9IFtdO1xuICAgICAgT2JqZWN0LmtleXMoc29ydHMpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgZXNTb3J0cy5wdXNoKHtba2V5XToge29yZGVyOiBzb3J0c1trZXldIHx8IE9yZGVyLkFTQywgJ3VubWFwcGVkX3R5cGUnOiAnc3RyaW5nJ319KTtcbiAgICAgIH0pO1xuICAgICAgX2JvZHkuc29ydCA9IGVzU29ydHM7XG4gICAgfVxuXG4gICAgaWYgKF9ib2R5LnNpemUgJiYgX2JvZHkucGFnZSkge1xuICAgICAgX2JvZHkuZnJvbSA9IF9ib2R5LnBhZ2UgKiBfYm9keS5zaXplO1xuICAgIH1cblxuICAgIGlmIChfYm9keS5mcm9tICYmIF9ib2R5LnRvKSB7XG4gICAgICBfYm9keS5zaXplID0gX2JvZHkudG8gLSBfYm9keS5mcm9tO1xuICAgIH1cblxuICAgIGRlbGV0ZSBfYm9keS50bztcbiAgICBkZWxldGUgX2JvZHkucGFnZTtcblxuICAgIGlmICghQ29tbW9uc1V0aWxzLmlzRW1wdHkoX2JvZHkucXVlcnkpIHx8XG4gICAgICAhQ29tbW9uc1V0aWxzLmlzRW1wdHkoX2JvZHkuZmlsdGVyKSkge1xuXG4gICAgICBsZXQgZXNRdWVyeSA9IHt9O1xuXG4gICAgICBpZiAoIUNvbW1vbnNVdGlscy5pc0VtcHR5KF9ib2R5LnF1ZXJ5KSkge1xuICAgICAgICBpZiAoQ29tbW9uc1V0aWxzLmlzQXJyYXkoX2JvZHkucXVlcnkpKSB7XG4gICAgICAgICAgX2JvZHkucXVlcnlbJyRhbmQnXSA9IF9ib2R5LnF1ZXJ5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIF9ib2R5LnF1ZXJ5ID0gRXNVdGlscy5wYXJzZUVzYk9iamVjdChfYm9keS5xdWVyeSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcXVlcnlCb2R5ID0gX2JvZHkucXVlcnk7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhxdWVyeUJvZHkpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBPYmplY3Qua2V5cyhxdWVyeUJvZHkpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgIGlmIChrZXkgPT09ICckYW5kJykge1xuICAgICAgICAgICAgICBjb25zdCBtdXN0ID0gRXNVdGlscy5xdWVyeVJlc29sdmVyKHF1ZXJ5Qm9keSwgJyRhbmQnKTtcbiAgICAgICAgICAgICAgaWYgKG11c3QpIHtcbiAgICAgICAgICAgICAgICBlc1F1ZXJ5WydtdXN0J10gPSBtdXN0O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJyRvcicpIHtcbiAgICAgICAgICAgICAgY29uc3Qgc2hvdWxkID0gRXNVdGlscy5xdWVyeVJlc29sdmVyKHF1ZXJ5Qm9keSwgJyRvcicpO1xuICAgICAgICAgICAgICBpZiAoc2hvdWxkKSB7XG4gICAgICAgICAgICAgICAgZXNRdWVyeVsnc2hvdWxkJ10gPSBzaG91bGQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnJG5vdCcpIHtcbiAgICAgICAgICAgICAgY29uc3QgbXVzdF9ub3QgPSBFc1V0aWxzLnF1ZXJ5UmVzb2x2ZXIocXVlcnlCb2R5LCAnJG5vdCcpO1xuICAgICAgICAgICAgICBpZiAobXVzdF9ub3QpIHtcbiAgICAgICAgICAgICAgICBlc1F1ZXJ5WydtdXN0X25vdCddID0gbXVzdF9ub3Q7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAocXVlcnlCb2R5W2tleV0pIHtcbiAgICAgICAgICAgICAgaWYgKGVzUXVlcnlbJ211c3QnXSkge1xuICAgICAgICAgICAgICAgIGVzUXVlcnlbJ211c3QnXS5wdXNoKHtba2V5XTogcXVlcnlCb2R5W2tleV19KTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlc1F1ZXJ5WydtdXN0J10gPSBbe1trZXldOiBxdWVyeUJvZHlba2V5XX1dO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZXNRdWVyeSA9IHsuLi5lc1F1ZXJ5fTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXNRdWVyeVsnc2hvdWxkJ10gJiYgIWVzUXVlcnlbJ21pbmltdW1fc2hvdWxkX21hdGNoJ10pIHtcbiAgICAgICAgICBlc1F1ZXJ5WydtaW5pbXVtX3Nob3VsZF9tYXRjaCddID0gMTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoIUNvbW1vbnNVdGlscy5pc0VtcHR5KF9ib2R5LmZpbHRlcikpIHtcbiAgICAgICAgY29uc3QgZmlsdGVyQm9keSA9IHsuLi5fYm9keS5maWx0ZXJ9O1xuICAgICAgICBlc1F1ZXJ5WydmaWx0ZXInXSA9IFtdO1xuICAgICAgICBpZiAoT2JqZWN0LmtleXMoZmlsdGVyQm9keSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgIE9iamVjdC5rZXlzKGZpbHRlckJvZHkpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgIGlmIChmaWx0ZXJCb2R5W2tleV0pIHtcbiAgICAgICAgICAgICAgZXNRdWVyeVsnZmlsdGVyJ10ucHVzaCh7W2tleV06IGZpbHRlckJvZHlba2V5XX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlc1F1ZXJ5WydmaWx0ZXInXS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBkZWxldGUgZXNRdWVyeVsnZmlsdGVyJ107XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKE9iamVjdC5rZXlzKGVzUXVlcnkpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgX2JvZHkucXVlcnkgPSB7Ym9vbDogZXNRdWVyeX07XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCFDb21tb25zVXRpbHMuaXNFbXB0eShfYm9keS5hZ2dzKSkge1xuICAgICAgY29uc3QgYWdncyA9IEVzVXRpbHMucGFyc2VBZ2dQcm9wcyhfYm9keS5hZ2dzKTtcbiAgICAgIGlmIChhZ2dzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgX2JvZHkuYWdncyA9IGVzYi5yZXF1ZXN0Qm9keVNlYXJjaCgpLmFnZ3MoYWdncykudG9KU09OKClbJ2FnZ3MnXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBPYmplY3Qua2V5cyhfYm9keSkuZm9yRWFjaChrID0+IHtcbiAgICAgIGlmIChDb21tb25zVXRpbHMuaXNFbXB0eShfYm9keVtrXSkpIHtcbiAgICAgICAgZGVsZXRlIF9ib2R5W2tdO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBfYm9keTtcbiAgfVxuXG4gIHN0YXRpYyByZXNvbHZlU29ydChzb3J0KToge30ge1xuICAgIGxldCBzb3J0cyA9IHt9O1xuICAgIGlmIChDb21tb25zVXRpbHMuaXNTdHJpbmcoc29ydCkpIHtcbiAgICAgIHNvcnRzWzxzdHJpbmc+c29ydF0gPSBPcmRlci5BU0M7XG4gICAgfSBlbHNlIGlmIChDb21tb25zVXRpbHMuaXNBcnJheShzb3J0KSkge1xuICAgICAgKDxhbnlbXT5zb3J0KS5mb3JFYWNoKHMgPT4ge1xuICAgICAgICBpZiAoQ29tbW9uc1V0aWxzLmlzU3RyaW5nKHMpKSB7XG4gICAgICAgICAgaWYgKCFzb3J0c1tzXSkge1xuICAgICAgICAgICAgc29ydHNbc10gPSBPcmRlci5BU0M7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNvcnRzID0ge1xuICAgICAgICAgICAgLi4uc29ydHMsXG4gICAgICAgICAgICAuLi48e30+c1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzb3J0cyA9IDx7fT5zb3J0O1xuICAgIH1cbiAgICByZXR1cm4gc29ydHM7XG4gIH1cblxuICBzdGF0aWMgZ2V0TXNlYXJjaEJvZHkocXM6IHt9W10pOiBzdHJpbmcge1xuICAgIGNvbnN0IGJvZHkgPSBxcy5tYXAocSA9PiBKU09OLnN0cmluZ2lmeShxKSk7XG4gICAgcmV0dXJuIGJvZHkuam9pbignXFxuJykgKyAnXFxuJztcbiAgfVxuXG4gIHN0YXRpYyBidWlsZFF1ZXJ5UnVsZVNldChydWxlU2V0OiBRdWVyeVJ1bGVTZXQpIHtcbiAgICBydWxlU2V0ID0gKCFydWxlU2V0KSA/IHt9IDogcnVsZVNldDtcblxuICAgIHJldHVybiAoZnVuY3Rpb24gcGFyc2UoZGF0YTogUXVlcnlSdWxlIHwgUXVlcnlSdWxlU2V0KSB7XG4gICAgICBpZiAoIWRhdGFbJ2NvbmRpdGlvbiddKSB7XG4gICAgICAgIGRhdGFbJ2NvbmRpdGlvbiddID0gREVGQVVMVF9FU19RVUVSWV9DT05ESVRJT04gfHwgREVGQVVMVF9RVUVSWV9DT05ESVRJT047XG4gICAgICB9XG5cbiAgICAgIGlmIChbJ0FORCcsICdPUiddLmluZGV4T2YoZGF0YVsnY29uZGl0aW9uJ10udG9VcHBlckNhc2UoKSkgPT09IC0xKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAn5LiN6K+G5Yir55qERWxhc3RpY1NlYXJjaCBib29sIHF1ZXJ5IOWFs+ezuyhBTkQsT1IpIFwiezB9XCInXG4gICAgICAgICAgICAucmVwbGFjZSgnezB9JywgZGF0YVsnY29uZGl0aW9uJ10pXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmICghZGF0YVsncnVsZXMnXSkge1xuICAgICAgICByZXR1cm4ge307XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHBhcnRzID0ge307XG4gICAgICBwYXJ0c1snYWRkJ10gPSBmdW5jdGlvbiAoaywgdikge1xuICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShrKSkge1xuICAgICAgICAgIHRoaXNba10ucHVzaCh2KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzW2tdID0gW3ZdO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBkYXRhWydydWxlcyddLmZvckVhY2goZnVuY3Rpb24gKHJ1bGU6IFF1ZXJ5UnVsZSB8IFF1ZXJ5UnVsZVNldCkge1xuXG4gICAgICAgIGNvbnN0IGdldF92YWx1ZSA9IChhUnVsZSkgPT4ge1xuICAgICAgICAgIGlmIChhUnVsZS5kYXRhICYmIGFSdWxlLmRhdGEudHJhbnNmb3JtKSB7XG4gICAgICAgICAgICByZXR1cm4gYVJ1bGUuZGF0YS50cmFuc2Zvcm0uY2FsbCh0aGlzLCBhUnVsZS52YWx1ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBhUnVsZS52YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgbWFrZV9xdWVyeSA9IChhUnVsZSkgPT4ge1xuXG4gICAgICAgICAgY29uc3Qgb3BlcmF0b3I6IFF1ZXJ5T3BlcmF0b3IgPSBFU19RVUVSWV9PUEVSQVRPUlNbYVJ1bGUub3BlcmF0b3JdO1xuXG4gICAgICAgICAgaWYgKG9wZXJhdG9yID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgJ+S4jeivhuWIq+eahOafpeivouaTjeS9nOespiBcInswfVwiJ1xuICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7MH0nLCBhUnVsZS5vcGVyYXRvcilcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbGV0IHBhcnQgPSB7fTtcblxuICAgICAgICAgIGlmIChvcGVyYXRvci5pbnB1dHMgIT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGtleVZhbCA9IHt9O1xuICAgICAgICAgICAgY29uc3QgdmFsdWVNYXBwZXIgPSBvcGVyYXRvci5nZXRWYWx1ZTtcbiAgICAgICAgICAgIGlmICh2YWx1ZU1hcHBlcikge1xuICAgICAgICAgICAgICBrZXlWYWxbYVJ1bGUuZmllbGRdID0gdmFsdWVNYXBwZXIoZ2V0X3ZhbHVlKGFSdWxlKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBrZXlWYWxbYVJ1bGUuZmllbGRdID0gZ2V0X3ZhbHVlKGFSdWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBhcnRbb3BlcmF0b3Iub3BlcmF0b3JdID0ga2V5VmFsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChhUnVsZS5vcGVyYXRvciA9PT0gJ2lzX251bGwnKSB7XG4gICAgICAgICAgICBwYXJ0ID0ge2V4aXN0czoge2ZpZWxkOiBhUnVsZS5maWVsZH19O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChkYXRhWydjb25kaXRpb24nXSA9PT0gJ05PVCcpIHtcbiAgICAgICAgICAgIHJldHVybiB7J2Jvb2wnOiB7J211c3Rfbm90JzogW3BhcnRdfX07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJ0O1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgY2xhdXNlO1xuXG4gICAgICAgIGlmIChkYXRhWydjb25kaXRpb24nXSA9PT0gJ0FORCcpIHtcbiAgICAgICAgICBjbGF1c2UgPSAnbXVzdCc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGFbJ2NvbmRpdGlvbiddID09PSAnTk9UJykge1xuICAgICAgICAgIGNsYXVzZSA9ICdtdXN0X25vdCc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGFbJ2NvbmRpdGlvbiddID09PSAnT1InKSB7XG4gICAgICAgICAgY2xhdXNlID0gJ3Nob3VsZCc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocnVsZVsncnVsZXMnXSAmJiBydWxlWydydWxlcyddLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBwYXJ0c1snYWRkJ10oY2xhdXNlLCBwYXJzZShydWxlKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcGFydHNbJ2FkZCddKGNsYXVzZSwgbWFrZV9xdWVyeShydWxlKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBkZWxldGUgcGFydHNbJ2FkZCddO1xuICAgICAgcmV0dXJuIHsnYm9vbCc6IHBhcnRzfTtcbiAgICB9KHJ1bGVTZXQpKTtcbiAgfVxuXG4gIHN0YXRpYyByZXNvbHZlQWdncyhhZ2dzKSB7XG4gICAgY29uc3QgcmVzb2x2ZWQgPSB7fTtcbiAgICBPYmplY3Qua2V5cyhhZ2dzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBjb25zdCBhZ2cgPSBhZ2dzW2tleV07XG4gICAgICByZXNvbHZlZFtrZXldID0ge307XG4gICAgICBPYmplY3Qua2V5cyhhZ2cpLmZvckVhY2goayA9PiB7XG4gICAgICAgIGlmIChrID09PSAnYnVja2V0cycpIHtcbiAgICAgICAgICByZXNvbHZlZFtrZXldID0gRXNVdGlscy5yZXNvbHZlQnVja2V0cyhhZ2dba10pO1xuICAgICAgICB9IGVsc2UgaWYgKGsgPT09ICd2YWx1ZScpIHtcbiAgICAgICAgICByZXNvbHZlZFtrZXldID0gYWdnW2tdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGNvbnNvbGUuZGVidWcoJ2VzVXRpbHMnLCAnZGlzY2FyZCBhZ2cga2V5OicgKyBrKTtcbiAgICAgICAgICAvLyByZXNvbHZlZFtrZXldW2tdID0gYWdnW2tleV07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiByZXNvbHZlZDtcbiAgfVxuXG4gIHN0YXRpYyByZXNvbHZlQnVja2V0cyhidWNrZXRzKSB7XG4gICAgY29uc3QgcmVzb2x2ZWQgPSBidWNrZXRzLm1hcChidWNrZXQgPT4gRXNVdGlscy5yZXNvbHZlQnVja2V0KGJ1Y2tldCkpO1xuICAgIHJldHVybiByZXNvbHZlZDtcbiAgfVxuXG4gIHN0YXRpYyByZXNvbHZlQnVja2V0KGJ1Y2tldCkge1xuICAgIGxldCByZXNvbHZlZCA9IHt9O1xuICAgIE9iamVjdC5rZXlzKGJ1Y2tldCkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgaWYgKGtleSA9PT0gJ2tleScpIHtcbiAgICAgICAgcmVzb2x2ZWRbJ2xhYmVsJ10gPSBidWNrZXRbJ2tleSddO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdkb2NfY291bnQnKSB7XG4gICAgICAgIHJlc29sdmVkWyd2YWx1ZSddID0gYnVja2V0Wydkb2NfY291bnQnXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChDb21tb25zVXRpbHMuaXNKc29uKGJ1Y2tldFtrZXldKSkge1xuICAgICAgICAgIHJlc29sdmVkID0ge1xuICAgICAgICAgICAgLi4ucmVzb2x2ZWQsXG4gICAgICAgICAgICAuLi5Fc1V0aWxzLnJlc29sdmVBZ2dzKHtba2V5XTogYnVja2V0W2tleV19KVxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZWRba2V5XSA9IGJ1Y2tldFtrZXldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc29sdmVkO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgcXVlcnlSZXNvbHZlcihxdWVyeUJvZHksIGtleSkge1xuICAgIGlmIChxdWVyeUJvZHlba2V5XSkge1xuICAgICAgbGV0IF9xcyA9IHF1ZXJ5Qm9keVtrZXldLmZpbHRlcihxID0+ICFDb21tb25zVXRpbHMuaXNFbXB0eShxKSk7XG4gICAgICBpZiAoX3FzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgX3FzID0gX3FzLm1hcChxID0+IEVzVXRpbHMucGFyc2VFc2JPYmplY3QocSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChfcXMubGVuZ3RoID4gMCkgPyBfcXMgOiB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG59XG5cblxuIl19