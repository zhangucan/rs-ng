/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Devices } from '@er/types';
import { RegUtils } from '../regex';
/** @type {?} */
const bowser = require('bowser');
/**
 * @record
 */
export function BrowserSupport() { }
if (false) {
    /** @type {?|undefined} */
    BrowserSupport.prototype.version;
    /** @type {?|undefined} */
    BrowserSupport.prototype.features;
}
export class BrowserOsUtils {
    /**
     * @return {?}
     */
    static isMobile() {
        /** @type {?} */
        const result = [
            Devices.DEVICES.ANDROID,
            Devices.DEVICES.IPHONE,
            Devices.DEVICES.I_POD,
            Devices.DEVICES.BLACKBERRY,
            Devices.DEVICES.FIREFOX_OS,
            Devices.DEVICES.WINDOWS_PHONE,
            Devices.DEVICES.VITA
        ].some((item) => {
            return BrowserOsUtils.device_info.device === item;
        });
        return result;
    }
    /**
     * @return {?}
     */
    static isTablet() {
        /** @type {?} */
        const result = [
            Devices.DEVICES.I_PAD,
            Devices.DEVICES.FIREFOX_OS
        ].some((item) => {
            return BrowserOsUtils.device_info.device === item;
        });
        return result;
    }
    /**
     * @return {?}
     */
    static isDesktop() {
        /** @type {?} */
        const result = [
            Devices.DEVICES.PS4,
            Devices.DEVICES.CHROME_BOOK,
            Devices.DEVICES.UNKNOWN
        ].some((item) => {
            return BrowserOsUtils.device_info.device === item;
        });
        return result;
    }
    /**
     * @return {?}
     */
    static getDeviceInfo() {
        if (BrowserOsUtils.device_info) {
            return BrowserOsUtils.device_info;
        }
        if (window && window.navigator) {
            BrowserOsUtils.ua = window.navigator.userAgent;
        }
        BrowserOsUtils.userAgent = BrowserOsUtils.ua;
        /** @type {?} */
        const mappings = [
            { const: 'OS', prop: 'os' },
            { const: 'BROWSERS', prop: 'browser' },
            { const: 'DEVICES', prop: 'device' },
            { const: 'OS_VERSIONS', prop: 'os_version' }
        ];
        mappings.forEach((mapping) => {
            BrowserOsUtils[mapping.prop] = Object.keys(Devices[mapping.const]).reduce((obj, item) => {
                obj[Devices[mapping.const][item]] = RegUtils.test(BrowserOsUtils.ua, Devices[`${mapping.const}_RE`][item]);
                return obj;
            }, {});
        });
        mappings.forEach((mapping) => {
            BrowserOsUtils[mapping.prop] = Object.keys(Devices[mapping.const])
                .map((key) => {
                return Devices[mapping.const][key];
            }).reduce((previousValue, currentValue) => {
                return (previousValue === Devices[mapping.const].UNKNOWN && BrowserOsUtils[mapping.prop][currentValue])
                    ? currentValue : previousValue;
            }, Devices[mapping.const].UNKNOWN);
        });
        BrowserOsUtils.browser_version = '0';
        if (BrowserOsUtils.browser !== Devices.BROWSERS.UNKNOWN) {
            /** @type {?} */
            const re = Devices.BROWSER_VERSIONS_RE[BrowserOsUtils.browser];
            /** @type {?} */
            const res = RegUtils.exec(BrowserOsUtils.ua, re);
            if (!!res) {
                BrowserOsUtils.browser_version = res[1];
            }
        }
        BrowserOsUtils.device_info = {
            userAgent: BrowserOsUtils.userAgent,
            os: BrowserOsUtils.os,
            browser: BrowserOsUtils.browser,
            device: BrowserOsUtils.device,
            os_version: BrowserOsUtils.os_version,
            browser_version: BrowserOsUtils.browser_version
        };
        return BrowserOsUtils.device_info;
    }
    /**
     * @return {?}
     */
    static checkBrowser() {
        if (BrowserOsUtils.isBrowserVersionValid()) {
            /** @type {?} */
            const features = BrowserOsUtils.isBrowserFeaturesValid();
            return {
                version: true,
                features
            };
        }
        return {
            version: false
        };
    }
    /**
     * @private
     * @return {?}
     */
    static isBrowserVersionValid() {
        /** @type {?} */
        const browser = bowser.getParser(window.navigator.userAgent);
        return browser.satisfies({
            windows: {
                'internet explorer': '>10'
            },
            macos: {
                safari: '>10.1'
            },
            chrome: '>20.1.1432',
            firefox: '>31',
            opera: '>22'
        });
    }
    /**
     * @private
     * @return {?}
     */
    static isBrowserFeaturesValid() {
        /** @type {?} */
        let supported = true;
        for (const feature in Modernizr) {
            if (Modernizr.hasOwnProperty(feature) &&
                typeof Modernizr[feature] === 'boolean' && Modernizr[feature] === false) {
                supported = false;
                break;
            }
        }
        return supported;
    }
}
BrowserOsUtils.ua = '';
BrowserOsUtils.userAgent = '';
BrowserOsUtils.os = '';
BrowserOsUtils.browser = '';
BrowserOsUtils.device = '';
BrowserOsUtils.os_version = '';
BrowserOsUtils.browser_version = '';
BrowserOsUtils.device_info = undefined;
if (false) {
    /** @type {?} */
    BrowserOsUtils.ua;
    /** @type {?} */
    BrowserOsUtils.userAgent;
    /** @type {?} */
    BrowserOsUtils.os;
    /** @type {?} */
    BrowserOsUtils.browser;
    /** @type {?} */
    BrowserOsUtils.device;
    /** @type {?} */
    BrowserOsUtils.os_version;
    /** @type {?} */
    BrowserOsUtils.browser_version;
    /** @type {?} */
    BrowserOsUtils.device_info;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZXIvdXRpbHMvIiwic291cmNlcyI6WyJsaWIvYnJvd3Nlci9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFhLE9BQU8sRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUM5QyxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sVUFBVSxDQUFDOztNQUk1QixNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQzs7OztBQUVoQyxvQ0FHQzs7O0lBRkMsaUNBQWtCOztJQUNsQixrQ0FBbUI7O0FBR3JCLE1BQU0sT0FBTyxjQUFjOzs7O0lBV3pCLE1BQU0sQ0FBQyxRQUFROztjQUNQLE1BQU0sR0FBRztZQUNiLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTztZQUN2QixPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU07WUFDdEIsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLO1lBQ3JCLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBVTtZQUMxQixPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVU7WUFDMUIsT0FBTyxDQUFDLE9BQU8sQ0FBQyxhQUFhO1lBQzdCLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSTtTQUNyQixDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ2QsT0FBTyxjQUFjLENBQUMsV0FBVyxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUM7UUFDcEQsQ0FBQyxDQUFDO1FBQ0YsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQzs7OztJQUVELE1BQU0sQ0FBQyxRQUFROztjQUNQLE1BQU0sR0FBRztZQUNiLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSztZQUNyQixPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVU7U0FDM0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUNkLE9BQU8sY0FBYyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDO1FBQ3BELENB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QUFtQixFQUFFLEtBQUs7YUFDM0I7WUFDRCxLQUFLLEVBQUU7Z0JBQ0wsTUFBTSxFQUFFLE9BQU87YUFDaEI7WUFDRCxNQUFNLEVBQUUsWUFBWTtZQUNwQixPQUFPLEVBQUUsS0FBSztZQUNkLEtBQUssRUFBRSxLQUFLO1NBQ2IsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs7Ozs7SUFFTyxNQUFNLENBQUMsc0JBQXNCOztZQUMvQixTQUFTLEdBQUcsSUFBSTtRQUNwQixLQUFLLE1BQU0sT0FBTyxJQUFJLFNBQVMsRUFBRTtZQUMvQixJQUFJLFNBQVMsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDO2dCQUNuQyxPQUFPLFNBQVMsQ0FBQyxPQUFPLENBQUMsS0FBSyxTQUFTLElBQUksU0FBUyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEtBQUssRUFBRTtnQkFDekUsU0FBUyxHQUFHLEtBQUssQ0FBQztnQkFDbEIsTUFBTTthQUNQO1NBQ0Y7UUFDRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDOztBQTVJTSxpQkFBRSxHQUFHLEVBQUUsQ0FBQztBQUNSLHdCQUFTLEdBQUcsRUFBRSxDQUFDO0FBQ2YsaUJBQUUsR0FBRyxFQUFFLENBQUM7QUFDUixzQkFBTyxHQUFHLEVBQUUsQ0FBQztBQUNiLHFCQUFNLEdBQUcsRUFBRSxDQUFDO0FBQ1oseUJBQVUsR0FBRyxFQUFFLENBQUM7QUFDaEIsOEJBQWUsR0FBRyxFQUFFLENBQUM7QUFDckIsMEJBQVcsR0FBZSxTQUFTLENBQUM7OztJQVAzQyxrQkFBZTs7SUFDZix5QkFBc0I7O0lBQ3RCLGtCQUFlOztJQUNmLHVCQUFvQjs7SUFDcEIsc0JBQW1COztJQUNuQiwwQkFBdUI7O0lBQ3ZCLCtCQUE0Qjs7SUFDNUIsMkJBQTJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtEZXZpY2VJbmZvLCBEZXZpY2VzfSBmcm9tICdAZXIvdHlwZXMnO1xuaW1wb3J0IHtSZWdVdGlsc30gZnJvbSAnLi4vcmVnZXgnO1xuXG5kZWNsYXJlIGNvbnN0IHJlcXVpcmU7XG5kZWNsYXJlIGNvbnN0IE1vZGVybml6cjtcbmNvbnN0IGJvd3NlciA9IHJlcXVpcmUoJ2Jvd3NlcicpO1xuXG5leHBvcnQgaW50ZXJmYWNlIEJyb3dzZXJTdXBwb3J0IHtcbiAgdmVyc2lvbj86IGJvb2xlYW47XG4gIGZlYXR1cmVzPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNsYXNzIEJyb3dzZXJPc1V0aWxzIHtcblxuICBzdGF0aWMgdWEgPSAnJztcbiAgc3RhdGljIHVzZXJBZ2VudCA9ICcnO1xuICBzdGF0aWMgb3MgPSAnJztcbiAgc3RhdGljIGJyb3dzZXIgPSAnJztcbiAgc3RhdGljIGRldmljZSA9ICcnO1xuICBzdGF0aWMgb3NfdmVyc2lvbiA9ICcnO1xuICBzdGF0aWMgYnJvd3Nlcl92ZXJzaW9uID0gJyc7XG4gIHN0YXRpYyBkZXZpY2VfaW5mbzogRGV2aWNlSW5mbyA9IHVuZGVmaW5lZDtcblxuICBzdGF0aWMgaXNNb2JpbGUoKTogYm9vbGVhbiB7XG4gICAgY29uc3QgcmVzdWx0ID0gW1xuICAgICAgRGV2aWNlcy5ERVZJQ0VTLkFORFJPSUQsXG4gICAgICBEZXZpY2VzLkRFVklDRVMuSVBIT05FLFxuICAgICAgRGV2aWNlcy5ERVZJQ0VTLklfUE9ELFxuICAgICAgRGV2aWNlcy5ERVZJQ0VTLkJMQUNLQkVSUlksXG4gICAgICBEZXZpY2VzLkRFVklDRVMuRklSRUZPWF9PUyxcbiAgICAgIERldmljZXMuREVWSUNFUy5XSU5ET1dTX1BIT05FLFxuICAgICAgRGV2aWNlcy5ERVZJQ0VTLlZJVEFcbiAgICBdLnNvbWUoKGl0ZW0pID0+IHtcbiAgICAgIHJldHVybiBCcm93c2VyT3NVdGlscy5kZXZpY2VfaW5mby5kZXZpY2UgPT09IGl0ZW07XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHN0YXRpYyBpc1RhYmxldCgpIHtcbiAgICBjb25zdCByZXN1bHQgPSBbXG4gICAgICBEZXZpY2VzLkRFVklDRVMuSV9QQUQsXG4gICAgICBEZXZpY2VzLkRFVklDRVMuRklSRUZPWF9PU1xuICAgIF0uc29tZSgoaXRlbSkgPT4ge1xuICAgICAgcmV0dXJuIEJyb3dzZXJPc1V0aWxzLmRldmljZV9pbmZvLmRldmljZSA9PT0gaXRlbTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgc3RhdGljIGlzRGVza3RvcCgpIHtcbiAgICBjb25zdCByZXN1bHQgPSBbXG4gICAgICBEZXZpY2VzLkRFVklDRVMuUFM0LFxuICAgICAgRGV2aWNlcy5ERVZJQ0VTLkNIUk9NRV9CT09LLFxuICAgICAgRGV2aWNlcy5ERVZJQ0VTLlVOS05PV05cbiAgICBdLnNvbWUoKGl0ZW0pID0+IHtcbiAgICAgIHJldHVybiBCcm93c2VyT3NVdGlscy5kZXZpY2VfaW5mby5kZXZpY2UgPT09IGl0ZW07XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHN0YXRpYyBnZXREZXZpY2VJbmZvKCkge1xuXG4gICAgaWYgKEJyb3dzZXJPc1V0aWxzLmRldmljZV9pbmZvKSB7XG4gICAgICByZXR1cm4gQnJvd3Nlck9zVXRpbHMuZGV2aWNlX2luZm87XG4gICAgfVxuXG4gICAgaWYgKHdpbmRvdyAmJiB3aW5kb3cubmF2aWdhdG9yKSB7XG4gICAgICBCcm93c2VyT3NVdGlscy51YSA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50O1xuICAgIH1cblxuICAgIEJyb3dzZXJPc1V0aWxzLnVzZXJBZ2VudCA9IEJyb3dzZXJPc1V0aWxzLnVhO1xuXG4gICAgY29uc3QgbWFwcGluZ3MgPSBbXG4gICAgICB7Y29uc3Q6ICdPUycsIHByb3A6ICdvcyd9LFxuICAgICAge2NvbnN0OiAnQlJPV1NFUlMnLCBwcm9wOiAnYnJvd3Nlcid9LFxuICAgICAge2NvbnN0OiAnREVWSUNFUycsIHByb3A6ICdkZXZpY2UnfSxcbiAgICAgIHtjb25zdDogJ09TX1ZFUlNJT05TJywgcHJvcDogJ29zX3ZlcnNpb24nfVxuICAgIF07XG5cbiAgICBtYXBwaW5ncy5mb3JFYWNoKChtYXBwaW5nKSA9PiB7XG4gICAgICBCcm93c2VyT3NVdGlsc1ttYXBwaW5nLnByb3BdID0gT2JqZWN0LmtleXMoRGV2aWNlc1ttYXBwaW5nLmNvbnN0XSkucmVkdWNlKChvYmo6IGFueSwgaXRlbTogYW55KSA9PiB7XG4gICAgICAgIG9ialtEZXZpY2VzW21hcHBpbmcuY29uc3RdW2l0ZW1dXSA9IFJlZ1V0aWxzLnRlc3QoQnJvd3Nlck9zVXRpbHMudWEsIERldmljZXNbYCR7bWFwcGluZy5jb25zdH1fUkVgXVtpdGVtXSk7XG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgICB9LCB7fSk7XG4gICAgfSk7XG5cbiAgICBtYXBwaW5ncy5mb3JFYWNoKChtYXBwaW5nKSA9PiB7XG4gICAgICBCcm93c2VyT3NVdGlsc1ttYXBwaW5nLnByb3BdID0gT2JqZWN0LmtleXMoRGV2aWNlc1ttYXBwaW5nLmNvbnN0XSlcbiAgICAgICAgLm1hcCgoa2V5KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIERldmljZXNbbWFwcGluZy5jb25zdF1ba2V5XTtcbiAgICAgICAgfSkucmVkdWNlKChwcmV2aW91c1ZhbHVlLCBjdXJyZW50VmFsdWUpID0+IHtcbiAgICAgICAgICByZXR1cm4gKHByZXZpb3VzVmFsdWUgPT09IERldmljZXNbbWFwcGluZy5jb25zdF0uVU5LTk9XTiAmJiBCcm93c2VyT3NVdGlsc1ttYXBwaW5nLnByb3BdW2N1cnJlbnRWYWx1ZV0pXG4gICAgICAgICAgICA/IGN1cnJlbnRWYWx1ZSA6IHByZXZpb3VzVmFsdWU7XG4gICAgICAgIH0sIERldmljZXNbbWFwcGluZy5jb25zdF0uVU5LTk9XTik7XG4gICAgfSk7XG5cbiAgICBCcm93c2VyT3NVdGlscy5icm93c2VyX3ZlcnNpb24gPSAnMCc7XG4gICAgaWYgKEJyb3dzZXJPc1V0aWxzLmJyb3dzZXIgIT09IERldmljZXMuQlJPV1NFUlMuVU5LTk9XTikge1xuICAgICAgY29uc3QgcmUgPSBEZXZpY2VzLkJST1dTRVJfVkVSU0lPTlNfUkVbQnJvd3Nlck9zVXRpbHMuYnJvd3Nlcl07XG4gICAgICBjb25zdCByZXMgPSBSZWdVdGlscy5leGVjKEJyb3dzZXJPc1V0aWxzLnVhLCByZSk7XG4gICAgICBpZiAoISFyZXMpIHtcbiAgICAgICAgQnJvd3Nlck9zVXRpbHMuYnJvd3Nlcl92ZXJzaW9uID0gcmVzWzFdO1xuICAgICAgfVxuICAgIH1cblxuICAgIEJyb3dzZXJPc1V0aWxzLmRldmljZV9pbmZvID0ge1xuICAgICAgdXNlckFnZW50OiBCcm93c2VyT3NVdGlscy51c2VyQWdlbnQsXG4gICAgICBvczogQnJvd3Nlck9zVXRpbHMub3MsXG4gICAgICBicm93c2VyOiBCcm93c2VyT3NVdGlscy5icm93c2VyLFxuICAgICAgZGV2aWNlOiBCcm93c2VyT3NVdGlscy5kZXZpY2UsXG4gICAgICBvc192ZXJzaW9uOiBCcm93c2VyT3NVdGlscy5vc192ZXJzaW9uLFxuICAgICAgYnJvd3Nlcl92ZXJzaW9uOiBCcm93c2VyT3NVdGlscy5icm93c2VyX3ZlcnNpb25cbiAgICB9O1xuXG4gICAgcmV0dXJuIEJyb3dzZXJPc1V0aWxzLmRldmljZV9pbmZvO1xuICB9XG5cbiAgc3RhdGljIGNoZWNrQnJvd3NlcigpOiBCcm93c2VyU3VwcG9ydCB7XG4gICAgaWYgKEJyb3dzZXJPc1V0aWxzLmlzQnJvd3NlclZlcnNpb25WYWxpZCgpKSB7XG4gICAgICBjb25zdCBmZWF0dXJlcyA9IEJyb3dzZXJPc1V0aWxzLmlzQnJvd3NlckZlYXR1cmVzVmFsaWQoKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZlcnNpb246IHRydWUsXG4gICAgICAgIGZlYXR1cmVzXG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgdmVyc2lvbjogZmFsc2VcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgaXNCcm93c2VyVmVyc2lvblZhbGlkKCkge1xuICAgIGNvbnN0IGJyb3dzZXIgPSBib3dzZXIuZ2V0UGFyc2VyKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTtcbiAgICByZXR1cm4gYnJvd3Nlci5zYXRpc2ZpZXMoe1xuICAgICAgd2luZG93czoge1xuICAgICAgICAnaW50ZXJuZXQgZXhwbG9yZXInOiAnPjEwJ1xuICAgICAgfSxcbiAgICAgIG1hY29zOiB7XG4gICAgICAgIHNhZmFyaTogJz4xMC4xJ1xuICAgICAgfSxcbiAgICAgIGNocm9tZTogJz4yMC4xLjE0MzInLFxuICAgICAgZmlyZWZveDogJz4zMScsXG4gICAgICBvcGVyYTogJz4yMidcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIGlzQnJvd3NlckZlYXR1cmVzVmFsaWQoKSB7XG4gICAgbGV0IHN1cHBvcnRlZCA9IHRydWU7XG4gICAgZm9yIChjb25zdCBmZWF0dXJlIGluIE1vZGVybml6cikge1xuICAgICAgaWYgKE1vZGVybml6ci5oYXNPd25Qcm9wZXJ0eShmZWF0dXJlKSAmJlxuICAgICAgICB0eXBlb2YgTW9kZXJuaXpyW2ZlYXR1cmVdID09PSAnYm9vbGVhbicgJiYgTW9kZXJuaXpyW2ZlYXR1cmVdID09PSBmYWxzZSkge1xuICAgICAgICBzdXBwb3J0ZWQgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzdXBwb3J0ZWQ7XG4gIH1cbn1cbiJdfQ==