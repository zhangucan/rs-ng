/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { AggInterval, AggIntervalProps, AggMethods, AggMethodsProps, DEFAULT_ES_QUERY_CONDITION, DEFAULT_QUERY_CONDITION, ES_QUERY_OPERATORS, Order } from '@er/types';
import * as esb from 'elastic-builder';
import { RequestBodySearch } from 'elastic-builder';
import { CommonsUtils } from '../comm';
import { DialogUtils } from '../dialog';
var EsUtils = /** @class */ (function () {
    function EsUtils() {
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    EsUtils.parseEsbObject = /**
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        if (!obj) {
            return obj;
        }
        if (CommonsUtils.isArray(obj)) {
            return obj.forEach(function (o) { return EsUtils.parseEsbObject(o); });
        }
        else {
            if (CommonsUtils.isFunction(obj['toJSON'])) {
                return obj['toJSON']();
            }
            else {
                return obj;
            }
        }
    };
    /**
     * @param {?} key
     * @param {?} aggMethods
     * @return {?}
     */
    EsUtils.getFieldAggs = /**
     * @param {?} key
     * @param {?} aggMethods
     * @return {?}
     */
    function (key, aggMethods) {
        if (aggMethods) {
            /** @type {?} */
            var aggs_1 = {};
            aggMethods.forEach(function (method) {
                switch (method) {
                    case AggMethodsProps.avg.key:
                        aggs_1 = CommonsUtils.merge(aggs_1, esb.avgAggregation(key + "-" + method, key).toJSON());
                        break;
                    case AggMethodsProps.distinct.key:
                        aggs_1 = CommonsUtils.merge(aggs_1, esb.cardinalityAggregation(key + "-" + method, key).toJSON());
                        break;
                    case AggMethodsProps.max.key:
                        aggs_1 = CommonsUtils.merge(aggs_1, esb.maxAggregation(key + "-" + method, key).toJSON());
                        break;
                    case AggMethodsProps.min.key:
                        aggs_1 = CommonsUtils.merge(aggs_1, esb.minAggregation(key + "-" + method, key).toJSON());
                        break;
                    case AggMethodsProps.sum.key:
                        aggs_1 = CommonsUtils.merge(aggs_1, esb.sumAggregation(key + "-" + method, key).toJSON());
                        break;
                    case AggMethodsProps.count.key:
                        aggs_1 = CommonsUtils.merge(aggs_1, esb.valueCountAggregation(key + "-" + method, key).toJSON());
                        break;
                    default:
                        aggs_1 = CommonsUtils.merge(aggs_1, esb.valueCountAggregation(key + "-" + method, key).toJSON());
                }
            });
            return aggs_1;
        }
        else {
            return undefined;
        }
    };
    /**
     * @param {?} query
     * @return {?}
     */
    EsUtils.resolveQuery = /**
     * @param {?} query
     * @return {?}
     */
    function (query) {
        /** @type {?} */
        var must = [];
        /** @type {?} */
        var should = [];
        /** @type {?} */
        var not = [];
        if (query) {
            if (CommonsUtils.isArray(query)) {
                must = must.concat(query);
            }
            else if (CommonsUtils.isJson(query)) {
                if (query.hasOwnProperty('$and')) {
                    /** @type {?} */
                    var and = query['$and'];
                    if (CommonsUtils.isArray(and)) {
                        must = must.concat(and);
                    }
                    else {
                        must.push(and);
                    }
                }
                if (query.hasOwnProperty('$or')) {
                    /** @type {?} */
                    var or = query['$or'];
                    if (CommonsUtils.isArray(or)) {
                        should = should.concat(or);
                    }
                    else {
                        should.push(or);
                    }
                }
                if (query.hasOwnProperty('$not')) {
                    /** @type {?} */
                    var but = query['$not'];
                    if (CommonsUtils.isArray(but)) {
                        not = not.concat(but);
                    }
                    else {
                        not.push(but);
                    }
                }
            }
            else {
                must.push(query);
            }
        }
        return {
            must: CommonsUtils.compact(must),
            should: CommonsUtils.compact(should),
            not: CommonsUtils.compact(not)
        };
    };
    /**
     * @param {?} options
     * @return {?}
     */
    EsUtils.resolveSearchFields = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var searchFields = CommonsUtils.getArrayValue(options.searchFields);
        if (CommonsUtils.isEmpty(searchFields)) {
            DialogUtils.error('数据错误', '没有定义查询字段');
            throw new Error('not found search fields');
        }
        /** @type {?} */
        var qs = [];
        searchFields.filter(function (field) { return !!field; }).forEach(function (field) {
            if (options.withPy) {
                if (options.withWildcard) {
                    qs.push(esb.wildcardQuery(field + ".py", "*" + options.queryValue + "*"));
                }
                else {
                    qs.push(esb.prefixQuery(field + ".py", options.queryValue));
                }
            }
            if (options.withZh) {
                qs.push(esb.wildcardQuery(field + ".zh", "*" + options.queryValue + "*"));
            }
            if (options.withTerm) {
                qs.push(esb.termQuery(field, options.queryValue));
            }
            if (options.withPrefix) {
                qs.push(esb.prefixQuery(field, options.queryValue));
            }
            if (options.withWildcard) {
                qs.push(esb.wildcardQuery(field, "*" + options.queryValue + "*"));
            }
            if (qs.length === 0) {
                qs.push(esb.matchQuery(field, options.queryValue));
            }
        });
        return qs;
    };
    /**
     * @param {?} options
     * @return {?}
     */
    EsUtils.buildQueryBody = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var query = esb.requestBodySearch();
        /** @type {?} */
        var boolQuery = esb.boolQuery();
        /** @type {?} */
        var queries = EsUtils.resolveQuery(options.query);
        if (options.queryValue) {
            /** @type {?} */
            var qs = EsUtils.resolveSearchFields(options);
            if (qs.length === 1) {
                queries.must.push(qs[0]);
            }
            else {
                queries.should = queries.should.concat(qs);
            }
        }
        if (queries.must.length > 0) {
            boolQuery.must(queries.must);
        }
        if (queries.should.length > 0) {
            boolQuery.should(queries.should).minimumShouldMatch(1);
        }
        if (queries.not.length > 0) {
            boolQuery.mustNot(queries.not);
        }
        query.query(boolQuery);
        if (!CommonsUtils.isEmpty(options.filter)) {
            boolQuery.filter(options.filter);
        }
        if (!(options.returnFields && options.returnFields.length === 0)) {
            /** @type {?} */
            var returnFields = options.returnFields || options.searchFields;
            query.source(returnFields);
        }
        if (options.sort) {
            /** @type {?} */
            var sorts_1 = EsUtils.resolveSort(options.sort);
            /** @type {?} */
            var esSorts_1 = [];
            Object.keys(sorts_1).forEach(function (key) {
                esSorts_1.push(esb.sort(key, sorts_1[key] || Order.ASC).unmappedType('string'));
            });
            query.sorts(esSorts_1);
        }
        if (options.aggProps) {
            /** @type {?} */
            var aggs = EsUtils.parseAggProps(options.aggProps);
            if (aggs.length > 0) {
                ((/** @type {?} */ (query))).aggs(aggs);
                ((/** @type {?} */ (query))).size(options.size || 0);
            }
        }
        if (options.from) {
            query.from(options.from);
        }
        if (options.size) {
            query.size(options.size);
        }
        return query;
    };
    /**
     * @param {?} aggProps
     * @return {?}
     */
    EsUtils.parseAggProps = /**
     * @param {?} aggProps
     * @return {?}
     */
    function (aggProps) {
        /** @type {?} */
        var props = CommonsUtils.getArrayValue(aggProps);
        /** @type {?} */
        var aggs = [];
        /** @type {?} */
        var agg;
        props.forEach(function (item) {
            /** @type {?} */
            var aggProp = item;
            if (CommonsUtils.isString(aggProp)) {
                aggProp = { field: item };
            }
            /** @type {?} */
            var aggName = aggProp.name || aggProp.field + "-" + (aggProp.method || 'terms');
            if (aggProp.aggs) {
                aggProp.method = AggMethods.CUSTOMER;
            }
            switch (aggProp.method) {
                case AggMethods.AVG:
                    agg = esb.avgAggregation(aggName, aggProp.field).missing('0');
                    break;
                case AggMethods.MIN:
                    agg = esb.minAggregation(aggName, aggProp.field);
                    break;
                case AggMethods.MAX:
                    agg = esb.maxAggregation(aggName, aggProp.field);
                    break;
                case AggMethods.SUM:
                    agg = esb.sumAggregation(aggName, aggProp.field).missing('0');
                    break;
                case AggMethods.DISTINCT:
                    agg = esb.cardinalityAggregation(aggName, aggProp.field);
                    break;
                case AggMethods.HISTOGRAM:
                    agg = esb.histogramAggregation(aggName, aggProp.field);
                    if (aggProp.format) {
                        ((/** @type {?} */ (agg))).interval(aggProp.interval);
                    }
                    ((/** @type {?} */ (agg))).minDocCount(aggProp.minCount || 1);
                    if (aggProp.format) {
                        ((/** @type {?} */ (agg))).format(aggProp.format);
                    }
                    if (aggProp.missing) {
                        ((/** @type {?} */ (agg))).missing(aggProp.missing);
                    }
                    break;
                case AggMethods.DATE_HISTOGRAM:
                    agg = esb.dateHistogramAggregation(aggName, aggProp.field);
                    if (aggProp.interval) {
                        ((/** @type {?} */ (agg))).interval(aggProp.interval);
                    }
                    /** @type {?} */
                    var interval = aggProp.interval || AggInterval.DAY;
                    /** @type {?} */
                    var intervalProp = AggIntervalProps[interval];
                    ((/** @type {?} */ (agg))).interval(interval);
                    ((/** @type {?} */ (agg))).minDocCount(aggProp.minCount || 1);
                    /** @type {?} */
                    var format = aggProp.format || (intervalProp && intervalProp.format);
                    if (format) {
                        ((/** @type {?} */ (agg))).format(format);
                    }
                    if (aggProp.missing) {
                        ((/** @type {?} */ (agg))).missing(aggProp.missing);
                    }
                    break;
                case AggMethods.CUSTOMER:
                    agg = CommonsUtils.getValue(aggProp.aggs, aggProp);
                    break;
                case AggMethods.COUNT:
                    agg = esb.valueCountAggregation(aggName, aggProp.field);
                    break;
                default:
                    agg = esb.termsAggregation(aggName, aggProp.field).size(aggProp.size || 10);
                    break;
            }
            aggs.push(agg);
        });
        return aggs;
    };
    /**
     * @param {?} body
     * @param {?=} options
     * @return {?}
     */
    EsUtils.resolveRequestBody = /**
     * @param {?} body
     * @param {?=} options
     * @return {?}
     */
    function (body, options) {
        if (!body || typeof body === 'string') {
            return body || {};
        }
        if (body instanceof RequestBodySearch) {
            return CommonsUtils.merge({}, body.toJSON() || {}, options.payload || {}, options.body || options.params || {});
        }
        /** @type {?} */
        var _body = tslib_1.__assign({}, body);
        if (!CommonsUtils.isEmpty(_body.sort)) {
            /** @type {?} */
            var sorts_2 = EsUtils.resolveSort(_body.sort);
            /** @type {?} */
            var esSorts_2 = [];
            Object.keys(sorts_2).forEach(function (key) {
                var _a;
                esSorts_2.push((_a = {}, _a[key] = { order: sorts_2[key] || Order.ASC, 'unmapped_type': 'string' }, _a));
            });
            _body.sort = esSorts_2;
        }
        if (_body.size && _body.page) {
            _body.from = _body.page * _body.size;
        }
        if (_body.from && _body.to) {
            _body.size = _body.to - _body.from;
        }
        delete _body.to;
        delete _body.page;
        if (!CommonsUtils.isEmpty(_body.query) ||
            !CommonsUtils.isEmpty(_body.filter)) {
            /** @type {?} */
            var esQuery_1 = {};
            if (!CommonsUtils.isEmpty(_body.query)) {
                if (CommonsUtils.isArray(_body.query)) {
                    _body.query['$and'] = _body.query;
                }
                else {
                    _body.query = EsUtils.parseEsbObject(_body.query);
                }
                /** @type {?} */
                var queryBody_1 = _body.query;
                if (Object.keys(queryBody_1).length > 0) {
                    Object.keys(queryBody_1).forEach(function (key) {
                        var _a, _b;
                        if (key === '$and') {
                            /** @type {?} */
                            var must = EsUtils.queryResolver(queryBody_1, '$and');
                            if (must) {
                                esQuery_1['must'] = must;
                            }
                        }
                        else if (key === '$or') {
                            /** @type {?} */
                            var should = EsUtils.queryResolver(queryBody_1, '$or');
                            if (should) {
                                esQuery_1['should'] = should;
                            }
                        }
                        else if (key === '$not') {
                            /** @type {?} */
                            var must_not = EsUtils.queryResolver(queryBody_1, '$not');
                            if (must_not) {
                                esQuery_1['must_not'] = must_not;
                            }
                        }
                        else if (queryBody_1[key]) {
                            if (esQuery_1['must']) {
                                esQuery_1['must'].push((_a = {}, _a[key] = queryBody_1[key], _a));
                            }
                            else {
                                esQuery_1['must'] = [(_b = {}, _b[key] = queryBody_1[key], _b)];
                            }
                        }
                    });
                    esQuery_1 = tslib_1.__assign({}, esQuery_1);
                }
                if (esQuery_1['should'] && !esQuery_1['minimum_should_match']) {
                    esQuery_1['minimum_should_match'] = 1;
                }
            }
            if (!CommonsUtils.isEmpty(_body.filter)) {
                /** @type {?} */
                var filterBody_1 = tslib_1.__assign({}, _body.filter);
                esQuery_1['filter'] = [];
                if (Object.keys(filterBody_1).length > 0) {
                    Object.keys(filterBody_1).forEach(function (key) {
                        var _a;
                        if (filterBody_1[key]) {
                            esQuery_1['filter'].push((_a = {}, _a[key] = filterBody_1[key], _a));
                        }
                    });
                }
                if (esQuery_1['filter'].length === 0) {
                    delete esQuery_1['filter'];
                }
            }
            if (Object.keys(esQuery_1).length > 0) {
                _body.query = { bool: esQuery_1 };
            }
        }
        if (!CommonsUtils.isEmpty(_body.aggs)) {
            /** @type {?} */
            var aggs = EsUtils.parseAggProps(_body.aggs);
            if (aggs.length > 0) {
                _body.aggs = esb.requestBodySearch().aggs(aggs).toJSON()['aggs'];
            }
        }
        Object.keys(_body).forEach(function (k) {
            if (CommonsUtils.isEmpty(_body[k])) {
                delete _body[k];
            }
        });
        return _body;
    };
    /**
     * @param {?} sort
     * @return {?}
     */
    EsUtils.resolveSort = /**
     * @param {?} sort
     * @return {?}
     */
    function (sort) {
        /** @type {?} */
        var sorts = {};
        if (CommonsUtils.isString(sort)) {
            sorts[(/** @type {?} */ (sort))] = Order.ASC;
        }
        else if (CommonsUtils.isArray(sort)) {
            ((/** @type {?} */ (sort))).forEach(function (s) {
                if (CommonsUtils.isString(s)) {
                    if (!sorts[s]) {
                        sorts[s] = Order.ASC;
                    }
                }
                else {
                    sorts = tslib_1.__assign({}, sorts, (/** @type {?} */ (s)));
                }
            });
        }
        else {
            sorts = (/** @type {?} */ (sort));
        }
        return sorts;
    };
    /**
     * @param {?} qs
     * @return {?}
     */
    EsUtils.getMsearchBody = /**
     * @param {?} qs
     * @return {?}
     */
    function (qs) {
        /** @type {?} */
        var body = qs.map(function (q) { return JSON.stringify(q); });
        return body.join('\n') + '\n';
    };
    /**
     * @param {?} ruleSet
     * @return {?}
     */
    EsUtils.buildQueryRuleSet = /**
     * @param {?} ruleSet
     * @return {?}
     */
    function (ruleSet) {
        ruleSet = (!ruleSet) ? {} : ruleSet;
        return (function parse(data) {
            if (!data['condition']) {
                data['condition'] = DEFAULT_ES_QUERY_CONDITION || DEFAULT_QUERY_CONDITION;
            }
            if (['AND', 'OR'].indexOf(data['condition'].toUpperCase()) === -1) {
                throw new Error('不识别的ElasticSearch bool query 关系(AND,OR) "{0}"'
                    .replace('{0}', data['condition']));
            }
            if (!data['rules']) {
                return {};
            }
            /** @type {?} */
            var parts = {};
            parts['add'] = function (k, v) {
                if (this.hasOwnProperty(k)) {
                    this[k].push(v);
                }
                else {
                    this[k] = [v];
                }
            };
            data['rules'].forEach(function (rule) {
                var _this = this;
                /** @type {?} */
                var get_value = function (aRule) {
                    if (aRule.data && aRule.data.transform) {
                        return aRule.data.transform.call(_this, aRule.value);
                    }
                    else {
                        return aRule.value;
                    }
                };
                /** @type {?} */
                var make_query = function (aRule) {
                    /** @type {?} */
                    var operator = ES_QUERY_OPERATORS[aRule.operator];
                    if (operator === undefined) {
                        throw new Error('不识别的查询操作符 "{0}"'
                            .replace('{0}', aRule.operator));
                    }
                    /** @type {?} */
                    var part = {};
                    if (operator.inputs !== 0) {
                        /** @type {?} */
                        var keyVal = {};
                        /** @type {?} */
                        var valueMapper = operator.getValue;
                        if (valueMapper) {
                            keyVal[aRule.field] = valueMapper(get_value(aRule));
                        }
                        else {
                            keyVal[aRule.field] = get_value(aRule);
                        }
                        part[operator.operator] = keyVal;
                    }
                    if (aRule.operator === 'is_null') {
                        part = { exists: { field: aRule.field } };
                    }
                    if (data['condition'] === 'NOT') {
                        return { 'bool': { 'must_not': [part] } };
                    }
                    else {
                        return part;
                    }
                };
                /** @type {?} */
                var clause;
                if (data['condition'] === 'AND') {
                    clause = 'must';
                }
                if (data['condition'] === 'NOT') {
                    clause = 'must_not';
                }
                if (data['condition'] === 'OR') {
                    clause = 'should';
                }
                if (rule['rules'] && rule['rules'].length > 0) {
                    parts['add'](clause, parse(rule));
                }
                else {
                    parts['add'](clause, make_query(rule));
                }
            });
            delete parts['add'];
            return { 'bool': parts };
        }(ruleSet));
    };
    /**
     * @param {?} aggs
     * @return {?}
     */
    EsUtils.resolveAggs = /**
     * @param {?} aggs
     * @return {?}
     */
    function (aggs) {
        /** @type {?} */
        var resolved = {};
        Object.keys(aggs).forEach(function (key) {
            /** @type {?} */
            var agg = aggs[key];
            resolved[key] = {};
            Object.keys(agg).forEach(function (k) {
                if (k === 'buckets') {
                    resolved[key] = EsUtils.resolveBuckets(agg[k]);
                }
                else if (k === 'value') {
                    resolved[key] = agg[k];
                }
                else {
                    // console.debug('esUtils', 'discard agg key:' + k);
                    // resolved[key][k] = agg[key];
                }
            });
        });
        return resolved;
    };
    /**
     * @param {?} buckets
     * @return {?}
     */
    EsUtils.resolveBuckets = /**
     * @param {?} buckets
     * @return {?}
     */
    function (buckets) {
        /** @type {?} */
        var resolved = buckets.map(function (bucket) { return EsUtils.resolveBucket(bucket); });
        return resolved;
    };
    /**
     * @param {?} bucket
     * @return {?}
     */
    EsUtils.resolveBucket = /**
     * @param {?} bucket
     * @return {?}
     */
    function (bucket) {
        /** @type {?} */
        var resolved = {};
        Object.keys(bucket).forEach(function (key) {
            var _a;
            if (key === 'key') {
                resolved['label'] = bucket['key'];
            }
            else if (key === 'doc_count') {
                resolved['value'] = bucket['doc_count'];
            }
            else {
                if (CommonsUtils.isJson(bucket[key])) {
                    resolved = tslib_1.__assign({}, resolved, EsUtils.resolveAggs((_a = {}, _a[key] = bucket[key], _a)));
                }
                else {
                    resolved[key] = bucket[key];
                }
            }
        });
        return resolved;
    };
    /**
     * @private
     * @param {?} queryBody
     * @param {?} key
     * @return {?}
     */
    EsUtils.queryResolver = /**
     * @private
     * @param {?} queryBody
     * @param {?} key
     * @return {?}
     */
    function (queryBody, key) {
        if (queryBody[key]) {
            /** @type {?} */
            var _qs = queryBody[key].filter(function (q) { return !CommonsUtils.isEmpty(q); });
            if (_qs.length > 0) {
                _qs = _qs.map(function (q) { return EsUtils.parseEsbObject(q); });
            }
            return (_qs.length > 0) ? _qs : undefined;
        }
    };
    return EsUtils;
}());
export { EsUtils };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZXIvdXRpbHMvIiwic291cmNlcyI6WyJsaWIvZXMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQ0wsV0FBVyxFQUNYLGdCQUFnQixFQUNoQixVQUFVLEVBQ1YsZUFBZSxFQUlmLDBCQUEwQixFQUMxQix1QkFBdUIsRUFDdkIsa0JBQWtCLEVBQ2xCLEtBQUssRUFJTixNQUFNLFdBQVcsQ0FBQztBQUNuQixPQUFPLEtBQUssR0FBRyxNQUFNLGlCQUFpQixDQUFDO0FBQ3ZDLE9BQU8sRUFBcUUsaUJBQWlCLEVBQU8sTUFBTSxpQkFBaUIsQ0FBQztBQUM1SCxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sU0FBUyxDQUFDO0FBQ3JDLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFFdEM7SUFBQTtJQW1qQkEsQ0FBQzs7Ozs7SUFqakJRLHNCQUFjOzs7O0lBQXJCLFVBQXNCLEdBQUc7UUFDdkIsSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUNSLE9BQU8sR0FBRyxDQUFDO1NBQ1o7UUFDRCxJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDN0IsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsRUFBekIsQ0FBeUIsQ0FBQyxDQUFDO1NBQ3BEO2FBQU07WUFDTCxJQUFJLFlBQVksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUU7Z0JBQzFDLE9BQU8sR0FBRyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7YUFDeEI7aUJBQU07Z0JBQ0wsT0FBTyxHQUFHLENBQUM7YUFDWjtTQUNGO0lBQ0gsQ0FBQzs7Ozs7O0lBRU0sb0JBQVk7Ozs7O0lBQW5CLFVBQW9CLEdBQUcsRUFBRSxVQUFVO1FBQ2pDLElBQUksVUFBVSxFQUFF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QUFDO2lCQUNIO3FCQUFNO29CQUNMLFFBQVEsQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7aUJBQzdCO2FBQ0Y7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7Ozs7Ozs7SUFFYyxxQkFBYTs7Ozs7O0lBQTVCLFVBQTZCLFNBQVMsRUFBRSxHQUFHO1FBQ3pDLElBQUksU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFOztnQkFDZCxHQUFHLEdBQUcsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBeEIsQ0FBd0IsQ0FBQztZQUM5RCxJQUFJLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUNsQixHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLEVBQXpCLENBQXlCLENBQUMsQ0FBQzthQUMvQztZQUNELE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztTQUMzQztJQUNILENBQUM7SUFDSCxjQUFDO0FBQUQsQ0FBQyxBQW5qQkQsSUFtakJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWdnSW50ZXJ2YWwsXG4gIEFnZ0ludGVydmFsUHJvcHMsXG4gIEFnZ01ldGhvZHMsXG4gIEFnZ01ldGhvZHNQcm9wcyxcbiAgQWdnUHJvcHMsXG4gIEFwaURhdGFQcm9wcyxcbiAgQXBpUGF5bG9hZCxcbiAgREVGQVVMVF9FU19RVUVSWV9DT05ESVRJT04sXG4gIERFRkFVTFRfUVVFUllfQ09ORElUSU9OLFxuICBFU19RVUVSWV9PUEVSQVRPUlMsXG4gIE9yZGVyLFxuICBRdWVyeU9wZXJhdG9yLFxuICBRdWVyeVJ1bGUsXG4gIFF1ZXJ5UnVsZVNldFxufSBmcm9tICdAZXIvdHlwZXMnO1xuaW1wb3J0ICogYXMgZXNiIGZyb20gJ2VsYXN0aWMtYnVpbGRlcic7XG5pbXBvcnQge0FnZ3JlZ2F0aW9uLCBEYXRlSGlzdG9ncmFtQWdncmVnYXRpb24sIEhpc3RvZ3JhbUFnZ3JlZ2F0aW9uLCBRdWVyeSwgUmVxdWVzdEJvZHlTZWFyY2gsIFNvcnR9IGZyb20gJ2VsYXN0aWMtYnVpbGRlcic7XG5pbXBvcnQge0NvbW1vbnNVdGlsc30gZnJvbSAnLi4vY29tbSc7XG5pbXBvcnQge0RpYWxvZ1V0aWxzfSBmcm9tICcuLi9kaWFsb2cnO1xuXG5leHBvcnQgY2xhc3MgRXNVdGlscyB7XG5cbiAgc3RhdGljIHBhcnNlRXNiT2JqZWN0KG9iaikge1xuICAgIGlmICghb2JqKSB7XG4gICAgICByZXR1cm4gb2JqO1xuICAgIH1cbiAgICBpZiAoQ29tbW9uc1V0aWxzLmlzQXJyYXkob2JqKSkge1xuICAgICAgcmV0dXJuIG9iai5mb3JFYWNoKG8gPT4gRXNVdGlscy5wYXJzZUVzYk9iamVjdChvKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChDb21tb25zVXRpbHMuaXNGdW5jdGlvbihvYmpbJ3RvSlNPTiddKSkge1xuICAgICAgICByZXR1cm4gb2JqWyd0b0pTT04nXSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzdGF0aWMgZ2V0RmllbGRBZ2dzKGtleSwgYWdnTWV0aG9kcykge1xuICAgIGlmIChhZ2dNZXRob2RzKSB7XG4gICAgICBsZXQgYWdncyA9IHt9O1xuICAgICAgYWdnTWV0aG9kcy5mb3JFYWNoKG1ldGhvZCA9PiB7XG4gICAgICAgIHN3aXRjaCAobWV0aG9kKSB7XG4gICAgICAgICAgY2FzZSBBZ2dNZXRob2RzUHJvcHMuYXZnLmtleTpcbiAgICAgICAgICAgIGFnZ3MgPSBDb21tb25zVXRpbHMubWVyZ2UoYWdncywgZXNiLmF2Z0FnZ3JlZ2F0aW9uKGAke2tleX0tJHttZXRob2R9YCwga2V5KS50b0pTT04oKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEFnZ01ldGhvZHNQcm9wcy5kaXN0aW5jdC5rZXk6XG4gICAgICAgICAgICBhZ2dzID0gQ29tbW9uc1V0aWxzLm1lcmdlKGFnZ3MsIGVzYi5jYXJkaW5hbGl0eUFnZ3JlZ2F0aW9uKGAke2tleX0tJHttZXRob2R9YCwga2V5KS50b0pTT04oKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEFnZ01ldGhvZHNQcm9wcy5tYXgua2V5OlxuICAgICAgICAgICAgYWdncyA9IENvbW1vbnNVdGlscy5tZXJnZShhZ2dzLCBlc2IubWF4QWdncmVnYXRpb24oYCR7a2V5fS0ke21ldGhvZH1gLCBrZXkpLnRvSlNPTigpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgQWdnTWV0aG9kc1Byb3BzLm1pbi5rZXk6XG4gICAgICAgICAgICBhZ2dzID0gQ29tbW9uc1V0aWxzLm1lcmdlKGFnZ3MsIGVzYi5taW5BZ2dyZWdhdGlvbihgJHtrZXl9LSR7bWV0aG9kfWAsIGtleSkudG9KU09OKCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBBZ2dNZXRob2RzUHJvcHMuc3VtLmtleTpcbiAgICAgICAgICAgIGFnZ3MgPSBDb21tb25zVXRpbHMubWVyZ2UoYWdncywgZXNiLnN1bUFnZ3JlZ2F0aW9uKGAke2tleX0tJHttZXRob2R9YCwga2V5KS50b0pTT04oKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEFnZ01ldGhvZHNQcm9wcy5jb3VudC5rZXk6XG4gICAgICAgICAgICBhZ2dzID0gQ29tbW9uc1V0aWxzLm1lcmdlKGFnZ3MsIGVzYi52YWx1ZUNvdW50QWdncmVnYXRpb24oYCR7a2V5fS0ke21ldGhvZH1gLCBrZXkpLnRvSlNPTigpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBhZ2dzID0gQ29tbW9uc1V0aWxzLm1lcmdlKGFnZ3MsIGVzYi52YWx1ZUNvdW50QWdncmVnYXRpb24oYCR7a2V5fS0ke21ldGhvZH1gLCBrZXkpLnRvSlNPTigpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gYWdncztcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgcmVzb2x2ZVF1ZXJ5KHF1ZXJ5KToge1xuICAgIG11c3Q6IFF1ZXJ5W10sXG4gICAgc2hvdWxkOiBRdWVyeVtdLFxuICAgIG5vdDogUXVlcnlbXVxuICB9IHtcbiAgICBsZXQgbXVzdCA9IFtdO1xuICAgIGxldCBzaG91bGQgPSBbXTtcbiAgICBsZXQgbm90ID0gW107XG4gICAgaWYgKHF1ZXJ5KSB7XG4gICAgICBpZiAoQ29tbW9uc1V0aWxzLmlzQXJyYXkocXVlcnkpKSB7XG4gICAgICAgIG11c3QgPSBtdXN0LmNvbmNhdChxdWVyeSk7XG4gICAgICB9IGVsc2UgaWYgKENvbW1vbnNVdGlscy5pc0pzb24ocXVlcnkpKSB7XG4gICAgICAgIGlmIChxdWVyeS5oYXNPd25Qcm9wZXJ0eSgnJGFuZCcpKSB7XG4gICAgICAgICAgY29uc3QgYW5kID0gcXVlcnlbJyRhbmQnXTtcbiAgICAgICAgICBpZiAoQ29tbW9uc1V0aWxzLmlzQXJyYXkoYW5kKSkge1xuICAgICAgICAgICAgbXVzdCA9IG11c3QuY29uY2F0KGFuZCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG11c3QucHVzaChhbmQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocXVlcnkuaGFzT3duUHJvcGVydHkoJyRvcicpKSB7XG4gICAgICAgICAgY29uc3Qgb3IgPSBxdWVyeVsnJG9yJ107XG4gICAgICAgICAgaWYgKENvbW1vbnNVdGlscy5pc0FycmF5KG9yKSkge1xuICAgICAgICAgICAgc2hvdWxkID0gc2hvdWxkLmNvbmNhdChvcik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNob3VsZC5wdXNoKG9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHF1ZXJ5Lmhhc093blByb3BlcnR5KCckbm90JykpIHtcbiAgICAgICAgICBjb25zdCBidXQgPSBxdWVyeVsnJG5vdCddO1xuICAgICAgICAgIGlmIChDb21tb25zVXRpbHMuaXNBcnJheShidXQpKSB7XG4gICAgICAgICAgICBub3QgPSBub3QuY29uY2F0KGJ1dCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5vdC5wdXNoKGJ1dCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtdXN0LnB1c2gocXVlcnkpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgbXVzdDogQ29tbW9uc1V0aWxzLmNvbXBhY3QobXVzdCksXG4gICAgICBzaG91bGQ6IENvbW1vbnNVdGlscy5jb21wYWN0KHNob3VsZCksXG4gICAgICBub3Q6IENvbW1vbnNVdGlscy5jb21wYWN0KG5vdClcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIHJlc29sdmVTZWFyY2hGaWVsZHMob3B0aW9ucykge1xuICAgIGNvbnN0IHNlYXJjaEZpZWxkcyA9IENvbW1vbnNVdGlscy5nZXRBcnJheVZhbHVlKG9wdGlvbnMuc2VhcmNoRmllbGRzKTtcblxuICAgIGlmIChDb21tb25zVXRpbHMuaXNFbXB0eShzZWFyY2hGaWVsZHMpKSB7XG4gICAgICBEaWFsb2dVdGlscy5lcnJvcign5pWw5o2u6ZSZ6K+vJywgJ+ayoeacieWumuS5ieafpeivouWtl+autScpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdub3QgZm91bmQgc2VhcmNoIGZpZWxkcycpO1xuICAgIH1cbiAgICBjb25zdCBxcyA9IFtdO1xuICAgIHNlYXJjaEZpZWxkcy5maWx0ZXIoZmllbGQgPT4gISFmaWVsZCkuZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgICBpZiAob3B0aW9ucy53aXRoUHkpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMud2l0aFdpbGRjYXJkKSB7XG4gICAgICAgICAgcXMucHVzaChlc2Iud2lsZGNhcmRRdWVyeShgJHtmaWVsZH0ucHlgLCBgKiR7b3B0aW9ucy5xdWVyeVZhbHVlfSpgKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcXMucHVzaChlc2IucHJlZml4UXVlcnkoYCR7ZmllbGR9LnB5YCwgb3B0aW9ucy5xdWVyeVZhbHVlKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLndpdGhaaCkge1xuICAgICAgICBxcy5wdXNoKGVzYi53aWxkY2FyZFF1ZXJ5KGAke2ZpZWxkfS56aGAsIGAqJHtvcHRpb25zLnF1ZXJ5VmFsdWV9KmApKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLndpdGhUZXJtKSB7XG4gICAgICAgIHFzLnB1c2goZXNiLnRlcm1RdWVyeShmaWVsZCwgb3B0aW9ucy5xdWVyeVZhbHVlKSk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy53aXRoUHJlZml4KSB7XG4gICAgICAgIHFzLnB1c2goZXNiLnByZWZpeFF1ZXJ5KGZpZWxkLCBvcHRpb25zLnF1ZXJ5VmFsdWUpKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLndpdGhXaWxkY2FyZCkge1xuICAgICAgICBxcy5wdXNoKGVzYi53aWxkY2FyZFF1ZXJ5KGZpZWxkLCBgKiR7b3B0aW9ucy5xdWVyeVZhbHVlfSpgKSk7XG4gICAgICB9XG4gICAgICBpZiAocXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHFzLnB1c2goZXNiLm1hdGNoUXVlcnkoZmllbGQsIG9wdGlvbnMucXVlcnlWYWx1ZSkpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBxcztcbiAgfVxuXG4gIHN0YXRpYyBidWlsZFF1ZXJ5Qm9keShvcHRpb25zOiBBcGlEYXRhUHJvcHMpOiBSZXF1ZXN0Qm9keVNlYXJjaCB7XG5cbiAgICBjb25zdCBxdWVyeTogUmVxdWVzdEJvZHlTZWFyY2ggPSBlc2IucmVxdWVzdEJvZHlTZWFyY2goKTtcblxuICAgIGNvbnN0IGJvb2xRdWVyeSA9IGVzYi5ib29sUXVlcnkoKTtcblxuICAgIGNvbnN0IHF1ZXJpZXMgPSBFc1V0aWxzLnJlc29sdmVRdWVyeShvcHRpb25zLnF1ZXJ5KTtcblxuICAgIGlmIChvcHRpb25zLnF1ZXJ5VmFsdWUpIHtcbiAgICAgIGNvbnN0IHFzID0gRXNVdGlscy5yZXNvbHZlU2VhcmNoRmllbGRzKG9wdGlvbnMpO1xuICAgICAgaWYgKHFzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBxdWVyaWVzLm11c3QucHVzaChxc1swXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBxdWVyaWVzLnNob3VsZCA9IHF1ZXJpZXMuc2hvdWxkLmNvbmNhdChxcyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHF1ZXJpZXMubXVzdC5sZW5ndGggPiAwKSB7XG4gICAgICBib29sUXVlcnkubXVzdChxdWVyaWVzLm11c3QpO1xuICAgIH1cblxuICAgIGlmIChxdWVyaWVzLnNob3VsZC5sZW5ndGggPiAwKSB7XG4gICAgICBib29sUXVlcnkuc2hvdWxkKHF1ZXJpZXMuc2hvdWxkKS5taW5pbXVtU2hvdWxkTWF0Y2goMSk7XG4gICAgfVxuXG4gICAgaWYgKHF1ZXJpZXMubm90Lmxlbmd0aCA+IDApIHtcbiAgICAgIGJvb2xRdWVyeS5tdXN0Tm90KHF1ZXJpZXMubm90KTtcbiAgICB9XG5cbiAgICBxdWVyeS5xdWVyeShib29sUXVlcnkpO1xuXG4gICAgaWYgKCFDb21tb25zVXRpbHMuaXNFbXB0eShvcHRpb25zLmZpbHRlcikpIHtcbiAgICAgIGJvb2xRdWVyeS5maWx0ZXIob3B0aW9ucy5maWx0ZXIpO1xuICAgIH1cblxuICAgIGlmICghKG9wdGlvbnMucmV0dXJuRmllbGRzICYmIG9wdGlvbnMucmV0dXJuRmllbGRzLmxlbmd0aCA9PT0gMCkpIHtcbiAgICAgIGNvbnN0IHJldHVybkZpZWxkcyA9IG9wdGlvbnMucmV0dXJuRmllbGRzIHx8IG9wdGlvbnMuc2VhcmNoRmllbGRzO1xuICAgICAgcXVlcnkuc291cmNlKHJldHVybkZpZWxkcyk7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuc29ydCkge1xuICAgICAgY29uc3Qgc29ydHMgPSBFc1V0aWxzLnJlc29sdmVTb3J0KG9wdGlvbnMuc29ydCk7XG4gICAgICBjb25zdCBlc1NvcnRzOiBTb3J0W10gPSBbXTtcbiAgICAgIE9iamVjdC5rZXlzKHNvcnRzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgIGVzU29ydHMucHVzaChlc2Iuc29ydChrZXksIHNvcnRzW2tleV0gfHwgT3JkZXIuQVNDKS51bm1hcHBlZFR5cGUoJ3N0cmluZycpKTtcbiAgICAgIH0pO1xuICAgICAgcXVlcnkuc29ydHMoZXNTb3J0cyk7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuYWdnUHJvcHMpIHtcbiAgICAgIGNvbnN0IGFnZ3MgPSBFc1V0aWxzLnBhcnNlQWdnUHJvcHMob3B0aW9ucy5hZ2dQcm9wcyk7XG4gICAgICBpZiAoYWdncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICg8UmVxdWVzdEJvZHlTZWFyY2g+cXVlcnkpLmFnZ3MoYWdncyk7XG4gICAgICAgICg8UmVxdWVzdEJvZHlTZWFyY2g+cXVlcnkpLnNpemUob3B0aW9ucy5zaXplIHx8IDApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChvcHRpb25zLmZyb20pIHtcbiAgICAgIHF1ZXJ5LmZyb20ob3B0aW9ucy5mcm9tKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5zaXplKSB7XG4gICAgICBxdWVyeS5zaXplKG9wdGlvbnMuc2l6ZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHF1ZXJ5O1xuICB9XG5cbiAgc3RhdGljIHBhcnNlQWdnUHJvcHMoYWdnUHJvcHMpIHtcbiAgICBjb25zdCBwcm9wcyA9IENvbW1vbnNVdGlscy5nZXRBcnJheVZhbHVlKGFnZ1Byb3BzKTtcbiAgICBjb25zdCBhZ2dzID0gW107XG4gICAgbGV0IGFnZzogQWdncmVnYXRpb247XG4gICAgcHJvcHMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIGxldCBhZ2dQcm9wOiBBZ2dQcm9wcyA9IGl0ZW07XG4gICAgICBpZiAoQ29tbW9uc1V0aWxzLmlzU3RyaW5nKGFnZ1Byb3ApKSB7XG4gICAgICAgIGFnZ1Byb3AgPSB7ZmllbGQ6IGl0ZW19O1xuICAgICAgfVxuICAgICAgY29uc3QgYWdnTmFtZSA9IGFnZ1Byb3AubmFtZSB8fCBgJHthZ2dQcm9wLmZpZWxkfS0ke2FnZ1Byb3AubWV0aG9kIHx8ICd0ZXJtcyd9YDtcbiAgICAgIGlmIChhZ2dQcm9wLmFnZ3MpIHtcbiAgICAgICAgYWdnUHJvcC5tZXRob2QgPSBBZ2dNZXRob2RzLkNVU1RPTUVSO1xuICAgICAgfVxuICAgICAgc3dpdGNoIChhZ2dQcm9wLm1ldGhvZCkge1xuICAgICAgICBjYXNlIEFnZ01ldGhvZHMuQVZHOlxuICAgICAgICAgIGFnZyA9IGVzYi5hdmdBZ2dyZWdhdGlvbihhZ2dOYW1lLCBhZ2dQcm9wLmZpZWxkKS5taXNzaW5nKCcwJyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQWdnTWV0aG9kcy5NSU46XG4gICAgICAgICAgYWdnID0gZXNiLm1pbkFnZ3JlZ2F0aW9uKGFnZ05hbWUsIGFnZ1Byb3AuZmllbGQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEFnZ01ldGhvZHMuTUFYOlxuICAgICAgICAgIGFnZyA9IGVzYi5tYXhBZ2dyZWdhdGlvbihhZ2dOYW1lLCBhZ2dQcm9wLmZpZWxkKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBZ2dNZXRob2RzLlNVTTpcbiAgICAgICAgICBhZ2cgPSBlc2Iuc3VtQWdncmVnYXRpb24oYWdnTmFtZSwgYWdnUHJvcC5maWVsZCkubWlzc2luZygnMCcpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEFnZ01ldGhvZHMuRElTVElOQ1Q6XG4gICAgICAgICAgYWdnID0gZXNiLmNhcmRpbmFsaXR5QWdncmVnYXRpb24oYWdnTmFtZSwgYWdnUHJvcC5maWVsZCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQWdnTWV0aG9kcy5ISVNUT0dSQU06XG4gICAgICAgICAgYWdnID0gZXNiLmhpc3RvZ3JhbUFnZ3JlZ2F0aW9uKGFnZ05hbWUsIGFnZ1Byb3AuZmllbGQpO1xuICAgICAgICAgIGlmIChhZ2dQcm9wLmZvcm1hdCkge1xuICAgICAgICAgICAgKDxIaXN0b2dyYW1BZ2dyZWdhdGlvbj5hZ2cpLmludGVydmFsKGFnZ1Byb3AuaW50ZXJ2YWwpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAoPEhpc3RvZ3JhbUFnZ3JlZ2F0aW9uPmFnZykubWluRG9jQ291bnQoYWdnUHJvcC5taW5Db3VudCB8fCAxKTtcbiAgICAgICAgICBpZiAoYWdnUHJvcC5mb3JtYXQpIHtcbiAgICAgICAgICAgICg8SGlzdG9ncmFtQWdncmVnYXRpb24+YWdnKS5mb3JtYXQoYWdnUHJvcC5mb3JtYXQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoYWdnUHJvcC5taXNzaW5nKSB7XG4gICAgICAgICAgICAoPEhpc3RvZ3JhbUFnZ3JlZ2F0aW9uPmFnZykubWlzc2luZyhhZ2dQcm9wLm1pc3NpbmcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBZ2dNZXRob2RzLkRBVEVfSElTVE9HUkFNOlxuICAgICAgICAgIGFnZyA9IGVzYi5kYXRlSGlzdG9ncmFtQWdncmVnYXRpb24oYWdnTmFtZSwgYWdnUHJvcC5maWVsZCk7XG4gICAgICAgICAgaWYgKGFnZ1Byb3AuaW50ZXJ2YWwpIHtcbiAgICAgICAgICAgICg8RGF0ZUhpc3RvZ3JhbUFnZ3JlZ2F0aW9uPmFnZykuaW50ZXJ2YWwoYWdnUHJvcC5pbnRlcnZhbCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGludGVydmFsID0gYWdnUHJvcC5pbnRlcnZhbCB8fCBBZ2dJbnRlcnZhbC5EQVk7XG4gICAgICAgICAgY29uc3QgaW50ZXJ2YWxQcm9wID0gQWdnSW50ZXJ2YWxQcm9wc1tpbnRlcnZhbF07XG4gICAgICAgICAgKDxIaXN0b2dyYW1BZ2dyZWdhdGlvbj5hZ2cpLmludGVydmFsKGludGVydmFsKTtcbiAgICAgICAgICAoPEhpc3RvZ3JhbUFnZ3JlZ2F0aW9uPmFnZykubWluRG9jQ291bnQoYWdnUHJvcC5taW5Db3VudCB8fCAxKTtcbiAgICAgICAgICBjb25zdCBmb3JtYXQgPSBhZ2dQcm9wLmZvcm1hdCB8fCAoaW50ZXJ2YWxQcm9wICYmIGludGVydmFsUHJvcC5mb3JtYXQpO1xuICAgICAgICAgIGlmIChmb3JtYXQpIHtcbiAgICAgICAgICAgICg8SGlzdG9ncmFtQWdncmVnYXRpb24+YWdnKS5mb3JtYXQoZm9ybWF0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGFnZ1Byb3AubWlzc2luZykge1xuICAgICAgICAgICAgKDxIaXN0b2dyYW1BZ2dyZWdhdGlvbj5hZ2cpLm1pc3NpbmcoYWdnUHJvcC5taXNzaW5nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQWdnTWV0aG9kcy5DVVNUT01FUjpcbiAgICAgICAgICBhZ2cgPSBDb21tb25zVXRpbHMuZ2V0VmFsdWUoYWdnUHJvcC5hZ2dzLCBhZ2dQcm9wKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBZ2dNZXRob2RzLkNPVU5UOlxuICAgICAgICAgIGFnZyA9IGVzYi52YWx1ZUNvdW50QWdncmVnYXRpb24oYWdnTmFtZSwgYWdnUHJvcC5maWVsZCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgYWdnID0gZXNiLnRlcm1zQWdncmVnYXRpb24oYWdnTmFtZSwgYWdnUHJvcC5maWVsZCkuc2l6ZShhZ2dQcm9wLnNpemUgfHwgMTApO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgYWdncy5wdXNoKGFnZyk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGFnZ3M7XG4gIH1cblxuICBzdGF0aWMgcmVzb2x2ZVJlcXVlc3RCb2R5KGJvZHk6IEFwaVBheWxvYWQgfCBzdHJpbmcgfCBSZXF1ZXN0Qm9keVNlYXJjaCwgb3B0aW9ucz8pOiB7fSB7XG5cbiAgICBpZiAoIWJvZHkgfHwgdHlwZW9mIGJvZHkgPT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gYm9keSB8fCB7fTtcbiAgICB9XG5cbiAgICBpZiAoYm9keSBpbnN0YW5jZW9mIFJlcXVlc3RCb2R5U2VhcmNoKSB7XG4gICAgICByZXR1cm4gQ29tbW9uc1V0aWxzLm1lcmdlKHt9LCBib2R5LnRvSlNPTigpIHx8IHt9LCBvcHRpb25zLnBheWxvYWQgfHwge30sIG9wdGlvbnMuYm9keSB8fCBvcHRpb25zLnBhcmFtcyB8fCB7fSk7XG4gICAgfVxuXG4gICAgY29uc3QgX2JvZHkgPSB7Li4uYm9keX07XG4gICAgaWYgKCFDb21tb25zVXRpbHMuaXNFbXB0eShfYm9keS5zb3J0KSkge1xuICAgICAgY29uc3Qgc29ydHMgPSBFc1V0aWxzLnJlc29sdmVTb3J0KF9ib2R5LnNvcnQpO1xuICAgICAgY29uc3QgZXNTb3J0cyA9IFtdO1xuICAgICAgT2JqZWN0LmtleXMoc29ydHMpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgZXNTb3J0cy5wdXNoKHtba2V5XToge29yZGVyOiBzb3J0c1trZXldIHx8IE9yZGVyLkFTQywgJ3VubWFwcGVkX3R5cGUnOiAnc3RyaW5nJ319KTtcbiAgICAgIH0pO1xuICAgICAgX2JvZHkuc29ydCA9IGVzU29ydHM7XG4gICAgfVxuXG4gICAgaWYgKF9ib2R5LnNpemUgJiYgX2JvZHkucGFnZSkge1xuICAgICAgX2JvZHkuZnJvbSA9IF9ib2R5LnBhZ2UgKiBfYm9keS5zaXplO1xuICAgIH1cblxuICAgIGlmIChfYm9keS5mcm9tICYmIF9ib2R5LnRvKSB7XG4gICAgICBfYm9keS5zaXplID0gX2JvZHkudG8gLSBfYm9keS5mcm9tO1xuICAgIH1cblxuICAgIGRlbGV0ZSBfYm9keS50bztcbiAgICBkZWxldGUgX2JvZHkucGFnZTtcblxuICAgIGlmICghQ29tbW9uc1V0aWxzLmlzRW1wdHkoX2JvZHkucXVlcnkpIHx8XG4gICAgICAhQ29tbW9uc1V0aWxzLmlzRW1wdHkoX2JvZHkuZmlsdGVyKSkge1xuXG4gICAgICBsZXQgZXNRdWVyeSA9IHt9O1xuXG4gICAgICBpZiAoIUNvbW1vbnNVdGlscy5pc0VtcHR5KF9ib2R5LnF1ZXJ5KSkge1xuICAgICAgICBpZiAoQ29tbW9uc1V0aWxzLmlzQXJyYXkoX2JvZHkucXVlcnkpKSB7XG4gICAgICAgICAgX2JvZHkucXVlcnlbJyRhbmQnXSA9IF9ib2R5LnF1ZXJ5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIF9ib2R5LnF1ZXJ5ID0gRXNVdGlscy5wYXJzZUVzYk9iamVjdChfYm9keS5xdWVyeSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcXVlcnlCb2R5ID0gX2JvZHkucXVlcnk7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhxdWVyeUJvZHkpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBPYmplY3Qua2V5cyhxdWVyeUJvZHkpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgIGlmIChrZXkgPT09ICckYW5kJykge1xuICAgICAgICAgICAgICBjb25zdCBtdXN0ID0gRXNVdGlscy5xdWVyeVJlc29sdmVyKHF1ZXJ5Qm9keSwgJyRhbmQnKTtcbiAgICAgICAgICAgICAgaWYgKG11c3QpIHtcbiAgICAgICAgICAgICAgICBlc1F1ZXJ5WydtdXN0J10gPSBtdXN0O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJyRvcicpIHtcbiAgICAgICAgICAgICAgY29uc3Qgc2hvdWxkID0gRXNVdGlscy5xdWVyeVJlc29sdmVyKHF1ZXJ5Qm9keSwgJyRvcicpO1xuICAgICAgICAgICAgICBpZiAoc2hvdWxkKSB7XG4gICAgICAgICAgICAgICAgZXNRdWVyeVsnc2hvdWxkJ10gPSBzaG91bGQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnJG5vdCcpIHtcbiAgICAgICAgICAgICAgY29uc3QgbXVzdF9ub3QgPSBFc1V0aWxzLnF1ZXJ5UmVzb2x2ZXIocXVlcnlCb2R5LCAnJG5vdCcpO1xuICAgICAgICAgICAgICBpZiAobXVzdF9ub3QpIHtcbiAgICAgICAgICAgICAgICBlc1F1ZXJ5WydtdXN0X25vdCddID0gbXVzdF9ub3Q7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAocXVlcnlCb2R5W2tleV0pIHtcbiAgICAgICAgICAgICAgaWYgKGVzUXVlcnlbJ211c3QnXSkge1xuICAgICAgICAgICAgICAgIGVzUXVlcnlbJ211c3QnXS5wdXNoKHtba2V5XTogcXVlcnlCb2R5W2tleV19KTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlc1F1ZXJ5WydtdXN0J10gPSBbe1trZXldOiBxdWVyeUJvZHlba2V5XX1dO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZXNRdWVyeSA9IHsuLi5lc1F1ZXJ5fTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXNRdWVyeVsnc2hvdWxkJ10gJiYgIWVzUXVlcnlbJ21pbmltdW1fc2hvdWxkX21hdGNoJ10pIHtcbiAgICAgICAgICBlc1F1ZXJ5WydtaW5pbXVtX3Nob3VsZF9tYXRjaCddID0gMTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoIUNvbW1vbnNVdGlscy5pc0VtcHR5KF9ib2R5LmZpbHRlcikpIHtcbiAgICAgICAgY29uc3QgZmlsdGVyQm9keSA9IHsuLi5fYm9keS5maWx0ZXJ9O1xuICAgICAgICBlc1F1ZXJ5WydmaWx0ZXInXSA9IFtdO1xuICAgICAgICBpZiAoT2JqZWN0LmtleXMoZmlsdGVyQm9keSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgIE9iamVjdC5rZXlzKGZpbHRlckJvZHkpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgIGlmIChmaWx0ZXJCb2R5W2tleV0pIHtcbiAgICAgICAgICAgICAgZXNRdWVyeVsnZmlsdGVyJ10ucHVzaCh7W2tleV06IGZpbHRlckJvZHlba2V5XX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlc1F1ZXJ5WydmaWx0ZXInXS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBkZWxldGUgZXNRdWVyeVsnZmlsdGVyJ107XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKE9iamVjdC5rZXlzKGVzUXVlcnkpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgX2JvZHkucXVlcnkgPSB7Ym9vbDogZXNRdWVyeX07XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCFDb21tb25zVXRpbHMuaXNFbXB0eShfYm9keS5hZ2dzKSkge1xuICAgICAgY29uc3QgYWdncyA9IEVzVXRpbHMucGFyc2VBZ2dQcm9wcyhfYm9keS5hZ2dzKTtcbiAgICAgIGlmIChhZ2dzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgX2JvZHkuYWdncyA9IGVzYi5yZXF1ZXN0Qm9keVNlYXJjaCgpLmFnZ3MoYWdncykudG9KU09OKClbJ2FnZ3MnXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBPYmplY3Qua2V5cyhfYm9keSkuZm9yRWFjaChrID0+IHtcbiAgICAgIGlmIChDb21tb25zVXRpbHMuaXNFbXB0eShfYm9keVtrXSkpIHtcbiAgICAgICAgZGVsZXRlIF9ib2R5W2tdO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBfYm9keTtcbiAgfVxuXG4gIHN0YXRpYyByZXNvbHZlU29ydChzb3J0KToge30ge1xuICAgIGxldCBzb3J0cyA9IHt9O1xuICAgIGlmIChDb21tb25zVXRpbHMuaXNTdHJpbmcoc29ydCkpIHtcbiAgICAgIHNvcnRzWzxzdHJpbmc+c29ydF0gPSBPcmRlci5BU0M7XG4gICAgfSBlbHNlIGlmIChDb21tb25zVXRpbHMuaXNBcnJheShzb3J0KSkge1xuICAgICAgKDxhbnlbXT5zb3J0KS5mb3JFYWNoKHMgPT4ge1xuICAgICAgICBpZiAoQ29tbW9uc1V0aWxzLmlzU3RyaW5nKHMpKSB7XG4gICAgICAgICAgaWYgKCFzb3J0c1tzXSkge1xuICAgICAgICAgICAgc29ydHNbc10gPSBPcmRlci5BU0M7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNvcnRzID0ge1xuICAgICAgICAgICAgLi4uc29ydHMsXG4gICAgICAgICAgICAuLi48e30+c1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzb3J0cyA9IDx7fT5zb3J0O1xuICAgIH1cbiAgICByZXR1cm4gc29ydHM7XG4gIH1cblxuICBzdGF0aWMgZ2V0TXNlYXJjaEJvZHkocXM6IHt9W10pOiBzdHJpbmcge1xuICAgIGNvbnN0IGJvZHkgPSBxcy5tYXAocSA9PiBKU09OLnN0cmluZ2lmeShxKSk7XG4gICAgcmV0dXJuIGJvZHkuam9pbignXFxuJykgKyAnXFxuJztcbiAgfVxuXG4gIHN0YXRpYyBidWlsZFF1ZXJ5UnVsZVNldChydWxlU2V0OiBRdWVyeVJ1bGVTZXQpIHtcbiAgICBydWxlU2V0ID0gKCFydWxlU2V0KSA/IHt9IDogcnVsZVNldDtcblxuICAgIHJldHVybiAoZnVuY3Rpb24gcGFyc2UoZGF0YTogUXVlcnlSdWxlIHwgUXVlcnlSdWxlU2V0KSB7XG4gICAgICBpZiAoIWRhdGFbJ2NvbmRpdGlvbiddKSB7XG4gICAgICAgIGRhdGFbJ2NvbmRpdGlvbiddID0gREVGQVVMVF9FU19RVUVSWV9DT05ESVRJT04gfHwgREVGQVVMVF9RVUVSWV9DT05ESVRJT047XG4gICAgICB9XG5cbiAgICAgIGlmIChbJ0FORCcsICdPUiddLmluZGV4T2YoZGF0YVsnY29uZGl0aW9uJ10udG9VcHBlckNhc2UoKSkgPT09IC0xKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAn5LiN6K+G5Yir55qERWxhc3RpY1NlYXJjaCBib29sIHF1ZXJ5IOWFs+ezuyhBTkQsT1IpIFwiezB9XCInXG4gICAgICAgICAgICAucmVwbGFjZSgnezB9JywgZGF0YVsnY29uZGl0aW9uJ10pXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmICghZGF0YVsncnVsZXMnXSkge1xuICAgICAgICByZXR1cm4ge307XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHBhcnRzID0ge307XG4gICAgICBwYXJ0c1snYWRkJ10gPSBmdW5jdGlvbiAoaywgdikge1xuICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShrKSkge1xuICAgICAgICAgIHRoaXNba10ucHVzaCh2KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzW2tdID0gW3ZdO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBkYXRhWydydWxlcyddLmZvckVhY2goZnVuY3Rpb24gKHJ1bGU6IFF1ZXJ5UnVsZSB8IFF1ZXJ5UnVsZVNldCkge1xuXG4gICAgICAgIGNvbnN0IGdldF92YWx1ZSA9IChhUnVsZSkgPT4ge1xuICAgICAgICAgIGlmIChhUnVsZS5kYXRhICYmIGFSdWxlLmRhdGEudHJhbnNmb3JtKSB7XG4gICAgICAgICAgICByZXR1cm4gYVJ1bGUuZGF0YS50cmFuc2Zvcm0uY2FsbCh0aGlzLCBhUnVsZS52YWx1ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBhUnVsZS52YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgbWFrZV9xdWVyeSA9IChhUnVsZSkgPT4ge1xuXG4gICAgICAgICAgY29uc3Qgb3BlcmF0b3I6IFF1ZXJ5T3BlcmF0b3IgPSBFU19RVUVSWV9PUEVSQVRPUlNbYVJ1bGUub3BlcmF0b3JdO1xuXG4gICAgICAgICAgaWYgKG9wZXJhdG9yID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgJ+S4jeivhuWIq+eahOafpeivouaTjeS9nOespiBcInswfVwiJ1xuICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7MH0nLCBhUnVsZS5vcGVyYXRvcilcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbGV0IHBhcnQgPSB7fTtcblxuICAgICAgICAgIGlmIChvcGVyYXRvci5pbnB1dHMgIT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGtleVZhbCA9IHt9O1xuICAgICAgICAgICAgY29uc3QgdmFsdWVNYXBwZXIgPSBvcGVyYXRvci5nZXRWYWx1ZTtcbiAgICAgICAgICAgIGlmICh2YWx1ZU1hcHBlcikge1xuICAgICAgICAgICAgICBrZXlWYWxbYVJ1bGUuZmllbGRdID0gdmFsdWVNYXBwZXIoZ2V0X3ZhbHVlKGFSdWxlKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBrZXlWYWxbYVJ1bGUuZmllbGRdID0gZ2V0X3ZhbHVlKGFSdWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBhcnRbb3BlcmF0b3Iub3BlcmF0b3JdID0ga2V5VmFsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChhUnVsZS5vcGVyYXRvciA9PT0gJ2lzX251bGwnKSB7XG4gICAgICAgICAgICBwYXJ0ID0ge2V4aXN0czoge2ZpZWxkOiBhUnVsZS5maWVsZH19O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChkYXRhWydjb25kaXRpb24nXSA9PT0gJ05PVCcpIHtcbiAgICAgICAgICAgIHJldHVybiB7J2Jvb2wnOiB7J211c3Rfbm90JzogW3BhcnRdfX07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJ0O1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgY2xhdXNlO1xuXG4gICAgICAgIGlmIChkYXRhWydjb25kaXRpb24nXSA9PT0gJ0FORCcpIHtcbiAgICAgICAgICBjbGF1c2UgPSAnbXVzdCc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGFbJ2NvbmRpdGlvbiddID09PSAnTk9UJykge1xuICAgICAgICAgIGNsYXVzZSA9ICdtdXN0X25vdCc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGFbJ2NvbmRpdGlvbiddID09PSAnT1InKSB7XG4gICAgICAgICAgY2xhdXNlID0gJ3Nob3VsZCc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocnVsZVsncnVsZXMnXSAmJiBydWxlWydydWxlcyddLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBwYXJ0c1snYWRkJ10oY2xhdXNlLCBwYXJzZShydWxlKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcGFydHNbJ2FkZCddKGNsYXVzZSwgbWFrZV9xdWVyeShydWxlKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBkZWxldGUgcGFydHNbJ2FkZCddO1xuICAgICAgcmV0dXJuIHsnYm9vbCc6IHBhcnRzfTtcbiAgICB9KHJ1bGVTZXQpKTtcbiAgfVxuXG4gIHN0YXRpYyByZXNvbHZlQWdncyhhZ2dzKSB7XG4gICAgY29uc3QgcmVzb2x2ZWQgPSB7fTtcbiAgICBPYmplY3Qua2V5cyhhZ2dzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBjb25zdCBhZ2cgPSBhZ2dzW2tleV07XG4gICAgICByZXNvbHZlZFtrZXldID0ge307XG4gICAgICBPYmplY3Qua2V5cyhhZ2cpLmZvckVhY2goayA9PiB7XG4gICAgICAgIGlmIChrID09PSAnYnVja2V0cycpIHtcbiAgICAgICAgICByZXNvbHZlZFtrZXldID0gRXNVdGlscy5yZXNvbHZlQnVja2V0cyhhZ2dba10pO1xuICAgICAgICB9IGVsc2UgaWYgKGsgPT09ICd2YWx1ZScpIHtcbiAgICAgICAgICByZXNvbHZlZFtrZXldID0gYWdnW2tdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGNvbnNvbGUuZGVidWcoJ2VzVXRpbHMnLCAnZGlzY2FyZCBhZ2cga2V5OicgKyBrKTtcbiAgICAgICAgICAvLyByZXNvbHZlZFtrZXldW2tdID0gYWdnW2tleV07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiByZXNvbHZlZDtcbiAgfVxuXG4gIHN0YXRpYyByZXNvbHZlQnVja2V0cyhidWNrZXRzKSB7XG4gICAgY29uc3QgcmVzb2x2ZWQgPSBidWNrZXRzLm1hcChidWNrZXQgPT4gRXNVdGlscy5yZXNvbHZlQnVja2V0KGJ1Y2tldCkpO1xuICAgIHJldHVybiByZXNvbHZlZDtcbiAgfVxuXG4gIHN0YXRpYyByZXNvbHZlQnVja2V0KGJ1Y2tldCkge1xuICAgIGxldCByZXNvbHZlZCA9IHt9O1xuICAgIE9iamVjdC5rZXlzKGJ1Y2tldCkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgaWYgKGtleSA9PT0gJ2tleScpIHtcbiAgICAgICAgcmVzb2x2ZWRbJ2xhYmVsJ10gPSBidWNrZXRbJ2tleSddO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdkb2NfY291bnQnKSB7XG4gICAgICAgIHJlc29sdmVkWyd2YWx1ZSddID0gYnVja2V0Wydkb2NfY291bnQnXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChDb21tb25zVXRpbHMuaXNKc29uKGJ1Y2tldFtrZXldKSkge1xuICAgICAgICAgIHJlc29sdmVkID0ge1xuICAgICAgICAgICAgLi4ucmVzb2x2ZWQsXG4gICAgICAgICAgICAuLi5Fc1V0aWxzLnJlc29sdmVBZ2dzKHtba2V5XTogYnVja2V0W2tleV19KVxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZWRba2V5XSA9IGJ1Y2tldFtrZXldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc29sdmVkO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgcXVlcnlSZXNvbHZlcihxdWVyeUJvZHksIGtleSkge1xuICAgIGlmIChxdWVyeUJvZHlba2V5XSkge1xuICAgICAgbGV0IF9xcyA9IHF1ZXJ5Qm9keVtrZXldLmZpbHRlcihxID0+ICFDb21tb25zVXRpbHMuaXNFbXB0eShxKSk7XG4gICAgICBpZiAoX3FzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgX3FzID0gX3FzLm1hcChxID0+IEVzVXRpbHMucGFyc2VFc2JPYmplY3QocSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChfcXMubGVuZ3RoID4gMCkgPyBfcXMgOiB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG59XG5cblxuIl19