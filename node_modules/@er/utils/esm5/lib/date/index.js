/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { StateNames } from '@er/types';
import * as momentNs from 'moment';
import { CommonsUtils } from '../comm';
import { StatesUtils } from '../states';
/** @type {?} */
var moment = momentNs;
var DateUtils = /** @class */ (function () {
    function DateUtils() {
    }
    /**
     * @param {?} data
     * @return {?}
     */
    DateUtils.getMoment = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (moment.isMoment(data)) {
            return data;
        }
        /** @type {?} */
        var date = DateUtils.toDate(data);
        if (date) {
            return moment(data);
        }
        return null;
    };
    /**
     * @param {?} v
     * @return {?}
     */
    DateUtils.isDate = /**
     * @param {?} v
     * @return {?}
     */
    function (v) {
        return !!DateUtils.toDate(v);
    };
    /**
     * @param {?} v
     * @return {?}
     */
    DateUtils.toDate = /**
     * @param {?} v
     * @return {?}
     */
    function (v) {
        if (CommonsUtils.isString(v)) {
            /** @type {?} */
            var date = Date.parse(v);
            if (!isNaN(date)) {
                return new Date(date);
            }
        }
        else {
            if (v && typeof v.getMonth === 'function') {
                return v;
            }
        }
        return undefined;
    };
    /**
     * @param {?=} date
     * @param {?=} format
     * @return {?}
     */
    DateUtils.getFormattedDate = /**
     * @param {?=} date
     * @param {?=} format
     * @return {?}
     */
    function (date, format) {
        if (format === void 0) { format = 'YYYY-MM-DD'; }
        return DateUtils.getFormattedDateTime(format, date);
    };
    /**
     * @param {?=} date
     * @param {?=} format
     * @return {?}
     */
    DateUtils.getFormattedTime = /**
     * @param {?=} date
     * @param {?=} format
     * @return {?}
     */
    function (date, format) {
        if (format === void 0) { format = 'HH:mm:ss'; }
        return DateUtils.getFormattedDateTime(format, date);
    };
    /**
     * @param {?=} format
     * @param {?=} date
     * @return {?}
     */
    DateUtils.getFormattedDateTime = /**
     * @param {?=} format
     * @param {?=} date
     * @return {?}
     */
    function (format, date) {
        if (format === void 0) { format = 'YYYY-MM-DD HH:mm:ss'; }
        if (!date) {
            date = DateUtils.getDate();
        }
        else {
            date = DateUtils.toDate(date);
        }
        /** @type {?} */
        var momentData = DateUtils.getMoment(date);
        if (momentData) {
            return momentData.format(format);
        }
        return '';
    };
    /**
     * @return {?}
     */
    DateUtils.getDate = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var date;
        /** @type {?} */
        var dateState = StatesUtils.getValue(StateNames.serverTime);
        if (dateState) {
            date = dateState.date;
        }
        else {
            date = new Date();
        }
        return date;
    };
    /**
     * @return {?}
     */
    DateUtils.getStamp = /**
     * @return {?}
     */
    function () {
        return DateUtils.getDate().getTime();
    };
    /**
     * @param {?} present
     * @param {?=} due
     * @return {?}
     */
    DateUtils.getDateByNow = /**
     * @param {?} present
     * @param {?=} due
     * @return {?}
     */
    function (present, due) {
        if (!present) {
            return { seconds: 0, message: '' };
        }
        if (!DateUtils.isDate(present)) {
            try {
                present = new Date(present);
            }
            catch (e) {
                present = null;
            }
        }
        if (!present) {
            return { seconds: 0, message: '' };
        }
        /** @type {?} */
        var _due = due;
        if (!_due) {
            _due = new Date();
        }
        if (!DateUtils.isDate(_due)) {
            _due = new Date(_due);
        }
        /** @type {?} */
        var seconds = Math.round(Math.abs((_due.getTime() - present.getTime()) / 1000));
        /** @type {?} */
        var minutes = Math.round(Math.abs(seconds / 60));
        /** @type {?} */
        var hours = Math.round(Math.abs(minutes / 60));
        /** @type {?} */
        var days = Math.round(Math.abs(hours / 24));
        /** @type {?} */
        var months = Math.round(Math.abs(days / 30.416));
        /** @type {?} */
        var years = Math.round(Math.abs(days / 365));
        /** @type {?} */
        var message = '';
        if (seconds <= 10) {
            message = (_due > present) ? '刚刚' : '马上';
        }
        else if (seconds <= 30) {
            message = '30秒';
        }
        else if (seconds <= 90) {
            message = '1分钟';
        }
        else if (minutes <= 45) {
            message = minutes + '分钟';
        }
        else if (minutes <= 90) {
            message = '1小时';
        }
        else if (hours <= 22) {
            message = hours + '小时';
        }
        else if (hours <= 36) {
            message = '1天';
        }
        else if (days <= 25) {
            message = days + '天';
        }
        else if (days <= 45) {
            message = '1个月';
        }
        else if (days <= 345) {
            message = months + '月';
        }
        else if (days <= 545) {
            message = '1年';
        }
        else { // (days > 545)
            message = years + '年';
        }
        if (seconds > 10) {
            message += (_due > present) ? '前' : '后';
        }
        return {
            seconds: seconds,
            message: message
        };
    };
    /**
     * @param {?} seconds
     * @return {?}
     */
    DateUtils.getUpdateSeconds = /**
     * @param {?} seconds
     * @return {?}
     */
    function (seconds) {
        /** @type {?} */
        var min = 60;
        /** @type {?} */
        var hr = min * 60;
        /** @type {?} */
        var day = hr * 24;
        if (seconds < min) { // less than 1 min, update every 2 secs
            return 2;
        }
        else if (seconds < hr) { // less than an hour, update every 30 secs
            return 30;
        }
        else if (seconds < day) { // less then a day, update every 5 mins
            return 300;
        }
        else { // update every hour
            return 3600;
        }
    };
    /**
     * @param {?=} date
     * @return {?}
     */
    DateUtils.getYear = /**
     * @param {?=} date
     * @return {?}
     */
    function (date) {
        return (date || DateUtils.getDate()).getFullYear();
    };
    /**
     * @param {?=} date
     * @return {?}
     */
    DateUtils.getMonth = /**
     * @param {?=} date
     * @return {?}
     */
    function (date) {
        return (date || DateUtils.getDate()).getMonth() + 1;
    };
    /**
     * @param {?=} date
     * @return {?}
     */
    DateUtils.getDay = /**
     * @param {?=} date
     * @return {?}
     */
    function (date) {
        return (date || DateUtils.getDate()).getDate();
    };
    /**
     * @return {?}
     */
    DateUtils.getYesterday = /**
     * @return {?}
     */
    function () {
        return DateUtils.getDay(new Date(DateUtils.getDate().getTime() - 24 * 60 * 60 * 1000));
    };
    /**
     * @return {?}
     */
    DateUtils.getTomorrow = /**
     * @return {?}
     */
    function () {
        return DateUtils.getDay(new Date(DateUtils.getDate().getTime() + 24 * 60 * 60 * 1000));
    };
    /**
     * @return {?}
     */
    DateUtils.getLastMonth = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var month = DateUtils.getMonth() - 1;
        return month < 1 ? 12 : month;
    };
    /**
     * @return {?}
     */
    DateUtils.getNextMonth = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var month = DateUtils.getMonth() + 1;
        return month > 12 ? 1 : month;
    };
    return DateUtils;
}());
export { DateUtils };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZXIvdXRpbHMvIiwic291cmNlcyI6WyJsaWIvZGF0ZS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUNyQyxPQUFPLEtBQUssUUFBUSxNQUFNLFFBQVEsQ0FBQztBQUNuQyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sU0FBUyxDQUFDO0FBQ3JDLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxXQUFXLENBQUM7O0lBRWhDLE1BQU0sR0FBRyxRQUFRO0FBRXZCO0lBQUE7SUE2S0EsQ0FBQzs7Ozs7SUEzS1EsbUJBQVM7Ozs7SUFBaEIsVUFBaUIsSUFBSTtRQUNuQixJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDekIsT0FBTyxJQUFJLENBQUM7U0FDYjs7WUFDSyxJQUFJLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDbkMsSUFBSSxJQUFJLEVBQUU7WUFDUixPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNyQjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7Ozs7SUFFTSxnQkFBTTs7OztJQUFiLFVBQWMsQ0FBQztRQUNiLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDL0IsQ0FBQzs7Ozs7SUFFTSxnQkFBTTs7OztJQUFiLFVBQWMsQ0FBQztRQUNiLElBQUksWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRTs7Z0JBQ3RCLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUMxQixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUNoQixPQUFPLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3ZCO1NBQ0Y7YUFBTTtZQUNMLElB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QUFRLEVBQUUsR0FBRyxDQUFDO1FBQ3RDLE9BQU8sS0FBSyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDaEMsQ0FBQztJQUNILGdCQUFDO0FBQUQsQ0FBQyxBQTdLRCxJQTZLQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7U3RhdGVOYW1lc30gZnJvbSAnQGVyL3R5cGVzJztcbmltcG9ydCAqIGFzIG1vbWVudE5zIGZyb20gJ21vbWVudCc7XG5pbXBvcnQge0NvbW1vbnNVdGlsc30gZnJvbSAnLi4vY29tbSc7XG5pbXBvcnQge1N0YXRlc1V0aWxzfSBmcm9tICcuLi9zdGF0ZXMnO1xuXG5jb25zdCBtb21lbnQgPSBtb21lbnROcztcblxuZXhwb3J0IGNsYXNzIERhdGVVdGlscyB7XG5cbiAgc3RhdGljIGdldE1vbWVudChkYXRhKTogbW9tZW50TnMuTW9tZW50IHtcbiAgICBpZiAobW9tZW50LmlzTW9tZW50KGRhdGEpKSB7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG4gICAgY29uc3QgZGF0ZSA9IERhdGVVdGlscy50b0RhdGUoZGF0YSk7XG4gICAgaWYgKGRhdGUpIHtcbiAgICAgIHJldHVybiBtb21lbnQoZGF0YSk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgc3RhdGljIGlzRGF0ZSh2KSB7XG4gICAgcmV0dXJuICEhRGF0ZVV0aWxzLnRvRGF0ZSh2KTtcbiAgfVxuXG4gIHN0YXRpYyB0b0RhdGUodikge1xuICAgIGlmIChDb21tb25zVXRpbHMuaXNTdHJpbmcodikpIHtcbiAgICAgIGNvbnN0IGRhdGUgPSBEYXRlLnBhcnNlKHYpO1xuICAgICAgaWYgKCFpc05hTihkYXRlKSkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh2ICYmIHR5cGVvZiB2LmdldE1vbnRoID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHJldHVybiB2O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgc3RhdGljIGdldEZvcm1hdHRlZERhdGUoZGF0ZT8sIGZvcm1hdCA9ICdZWVlZLU1NLUREJykge1xuICAgIHJldHVybiBEYXRlVXRpbHMuZ2V0Rm9ybWF0dGVkRGF0ZVRpbWUoZm9ybWF0LCBkYXRlKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRGb3JtYXR0ZWRUaW1lKGRhdGU/LCBmb3JtYXQgPSAnSEg6bW06c3MnKSB7XG4gICAgcmV0dXJuIERhdGVVdGlscy5nZXRGb3JtYXR0ZWREYXRlVGltZShmb3JtYXQsIGRhdGUpO1xuICB9XG5cbiAgc3RhdGljIGdldEZvcm1hdHRlZERhdGVUaW1lKGZvcm1hdCA9ICdZWVlZLU1NLUREIEhIOm1tOnNzJywgZGF0ZT8pIHtcbiAgICBpZiAoIWRhdGUpIHtcbiAgICAgIGRhdGUgPSBEYXRlVXRpbHMuZ2V0RGF0ZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkYXRlID0gRGF0ZVV0aWxzLnRvRGF0ZShkYXRlKTtcbiAgICB9XG4gICAgY29uc3QgbW9tZW50RGF0YSA9IERhdGVVdGlscy5nZXRNb21lbnQoZGF0ZSk7XG4gICAgaWYgKG1vbWVudERhdGEpIHtcbiAgICAgIHJldHVybiBtb21lbnREYXRhLmZvcm1hdChmb3JtYXQpO1xuICAgIH1cbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICBzdGF0aWMgZ2V0RGF0ZSgpIHtcbiAgICBsZXQgZGF0ZTtcbiAgICBjb25zdCBkYXRlU3RhdGUgPSBTdGF0ZXNVdGlscy5nZXRWYWx1ZShTdGF0ZU5hbWVzLnNlcnZlclRpbWUpO1xuICAgIGlmIChkYXRlU3RhdGUpIHtcbiAgICAgIGRhdGUgPSBkYXRlU3RhdGUuZGF0ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgfVxuICAgIHJldHVybiBkYXRlO1xuICB9XG5cbiAgc3RhdGljIGdldFN0YW1wKCkge1xuICAgIHJldHVybiBEYXRlVXRpbHMuZ2V0RGF0ZSgpLmdldFRpbWUoKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXREYXRlQnlOb3cocHJlc2VudCwgZHVlPyk6IHsgc2Vjb25kczogbnVtYmVyLCBtZXNzYWdlOiBzdHJpbmcgfSB7XG4gICAgaWYgKCFwcmVzZW50KSB7XG4gICAgICByZXR1cm4ge3NlY29uZHM6IDAsIG1lc3NhZ2U6ICcnfTtcbiAgICB9XG4gICAgaWYgKCFEYXRlVXRpbHMuaXNEYXRlKHByZXNlbnQpKSB7XG4gICAgICB0cnkge1xuICAgICAgICBwcmVzZW50ID0gbmV3IERhdGUocHJlc2VudCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHByZXNlbnQgPSBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIXByZXNlbnQpIHtcbiAgICAgIHJldHVybiB7c2Vjb25kczogMCwgbWVzc2FnZTogJyd9O1xuICAgIH1cbiAgICBsZXQgX2R1ZSA9IGR1ZTtcbiAgICBpZiAoIV9kdWUpIHtcbiAgICAgIF9kdWUgPSBuZXcgRGF0ZSgpO1xuICAgIH1cbiAgICBpZiAoIURhdGVVdGlscy5pc0RhdGUoX2R1ZSkpIHtcbiAgICAgIF9kdWUgPSBuZXcgRGF0ZShfZHVlKTtcbiAgICB9XG4gICAgY29uc3Qgc2Vjb25kcyA9IE1hdGgucm91bmQoTWF0aC5hYnMoKF9kdWUuZ2V0VGltZSgpIC0gcHJlc2VudC5nZXRUaW1lKCkpIC8gMTAwMCkpO1xuICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLnJvdW5kKE1hdGguYWJzKHNlY29uZHMgLyA2MCkpO1xuICAgIGNvbnN0IGhvdXJzID0gTWF0aC5yb3VuZChNYXRoLmFicyhtaW51dGVzIC8gNjApKTtcbiAgICBjb25zdCBkYXlzID0gTWF0aC5yb3VuZChNYXRoLmFicyhob3VycyAvIDI0KSk7XG4gICAgY29uc3QgbW9udGhzID0gTWF0aC5yb3VuZChNYXRoLmFicyhkYXlzIC8gMzAuNDE2KSk7XG4gICAgY29uc3QgeWVhcnMgPSBNYXRoLnJvdW5kKE1hdGguYWJzKGRheXMgLyAzNjUpKTtcbiAgICBsZXQgbWVzc2FnZSA9ICcnO1xuICAgIGlmIChzZWNvbmRzIDw9IDEwKSB7XG4gICAgICBtZXNzYWdlID0gKF9kdWUgPiBwcmVzZW50KSA/ICfliJrliJonIDogJ+mprOS4iic7XG4gICAgfSBlbHNlIGlmIChzZWNvbmRzIDw9IDMwKSB7XG4gICAgICBtZXNzYWdlID0gJzMw56eSJztcbiAgICB9IGVsc2UgaWYgKHNlY29uZHMgPD0gOTApIHtcbiAgICAgIG1lc3NhZ2UgPSAnMeWIhumSnyc7XG4gICAgfSBlbHNlIGlmIChtaW51dGVzIDw9IDQ1KSB7XG4gICAgICBtZXNzYWdlID0gbWludXRlcyArICfliIbpkp8nO1xuICAgIH0gZWxzZSBpZiAobWludXRlcyA8PSA5MCkge1xuICAgICAgbWVzc2FnZSA9ICcx5bCP5pe2JztcbiAgICB9IGVsc2UgaWYgKGhvdXJzIDw9IDIyKSB7XG4gICAgICBtZXNzYWdlID0gaG91cnMgKyAn5bCP5pe2JztcbiAgICB9IGVsc2UgaWYgKGhvdXJzIDw9IDM2KSB7XG4gICAgICBtZXNzYWdlID0gJzHlpKknO1xuICAgIH0gZWxzZSBpZiAoZGF5cyA8PSAyNSkge1xuICAgICAgbWVzc2FnZSA9IGRheXMgKyAn5aSpJztcbiAgICB9IGVsc2UgaWYgKGRheXMgPD0gNDUpIHtcbiAgICAgIG1lc3NhZ2UgPSAnMeS4quaciCc7XG4gICAgfSBlbHNlIGlmIChkYXlzIDw9IDM0NSkge1xuICAgICAgbWVzc2FnZSA9IG1vbnRocyArICfmnIgnO1xuICAgIH0gZWxzZSBpZiAoZGF5cyA8PSA1NDUpIHtcbiAgICAgIG1lc3NhZ2UgPSAnMeW5tCc7XG4gICAgfSBlbHNlIHsgLy8gKGRheXMgPiA1NDUpXG4gICAgICBtZXNzYWdlID0geWVhcnMgKyAn5bm0JztcbiAgICB9XG4gICAgaWYgKHNlY29uZHMgPiAxMCkge1xuICAgICAgbWVzc2FnZSArPSAoX2R1ZSA+IHByZXNlbnQpID8gJ+WJjScgOiAn5ZCOJztcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHNlY29uZHMsXG4gICAgICBtZXNzYWdlXG4gICAgfTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRVcGRhdGVTZWNvbmRzKHNlY29uZHM6IG51bWJlcikge1xuICAgIGNvbnN0IG1pbiA9IDYwO1xuICAgIGNvbnN0IGhyID0gbWluICogNjA7XG4gICAgY29uc3QgZGF5ID0gaHIgKiAyNDtcbiAgICBpZiAoc2Vjb25kcyA8IG1pbikgeyAvLyBsZXNzIHRoYW4gMSBtaW4sIHVwZGF0ZSBldmVyeSAyIHNlY3NcbiAgICAgIHJldHVybiAyO1xuICAgIH0gZWxzZSBpZiAoc2Vjb25kcyA8IGhyKSB7IC8vIGxlc3MgdGhhbiBhbiBob3VyLCB1cGRhdGUgZXZlcnkgMzAgc2Vjc1xuICAgICAgcmV0dXJuIDMwO1xuICAgIH0gZWxzZSBpZiAoc2Vjb25kcyA8IGRheSkgeyAvLyBsZXNzIHRoZW4gYSBkYXksIHVwZGF0ZSBldmVyeSA1IG1pbnNcbiAgICAgIHJldHVybiAzMDA7XG4gICAgfSBlbHNlIHsgLy8gdXBkYXRlIGV2ZXJ5IGhvdXJcbiAgICAgIHJldHVybiAzNjAwO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBnZXRZZWFyKGRhdGU/OiBEYXRlKSB7XG4gICAgcmV0dXJuIChkYXRlIHx8IERhdGVVdGlscy5nZXREYXRlKCkpLmdldEZ1bGxZZWFyKCk7XG4gIH1cblxuICBzdGF0aWMgZ2V0TW9udGgoZGF0ZT86IERhdGUpIHtcbiAgICByZXR1cm4gKGRhdGUgfHwgRGF0ZVV0aWxzLmdldERhdGUoKSkuZ2V0TW9udGgoKSArIDE7XG4gIH1cblxuICBzdGF0aWMgZ2V0RGF5KGRhdGU/OiBEYXRlKSB7XG4gICAgcmV0dXJuIChkYXRlIHx8IERhdGVVdGlscy5nZXREYXRlKCkpLmdldERhdGUoKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRZZXN0ZXJkYXkoKSB7XG4gICAgcmV0dXJuIERhdGVVdGlscy5nZXREYXkobmV3IERhdGUoRGF0ZVV0aWxzLmdldERhdGUoKS5nZXRUaW1lKCkgLSAyNCAqIDYwICogNjAgKiAxMDAwKSk7XG4gIH1cblxuICBzdGF0aWMgZ2V0VG9tb3Jyb3coKSB7XG4gICAgcmV0dXJuIERhdGVVdGlscy5nZXREYXkobmV3IERhdGUoRGF0ZVV0aWxzLmdldERhdGUoKS5nZXRUaW1lKCkgKyAyNCAqIDYwICogNjAgKiAxMDAwKSk7XG4gIH1cblxuICBzdGF0aWMgZ2V0TGFzdE1vbnRoKCkge1xuICAgIGNvbnN0IG1vbnRoID0gRGF0ZVV0aWxzLmdldE1vbnRoKCkgLSAxO1xuICAgIHJldHVybiBtb250aCA8IDEgPyAxMiA6IG1vbnRoO1xuICB9XG5cbiAgc3RhdGljIGdldE5leHRNb250aCgpIHtcbiAgICBjb25zdCBtb250aCA9IERhdGVVdGlscy5nZXRNb250aCgpICsgMTtcbiAgICByZXR1cm4gbW9udGggPiAxMiA/IDEgOiBtb250aDtcbiAgfVxufVxuIl19