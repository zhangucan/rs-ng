/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChartType } from '@er/types';
import { ColorUtils } from '../color';
import { CommonsUtils } from '../comm';
import { DataItemUtils } from '../data-item';
var ChartUtils = /** @class */ (function () {
    function ChartUtils() {
    }
    /**
     * @param {?} rawData
     * @param {?} chartOptions
     * @param {?=} dimensionsIndex
     * @return {?}
     */
    ChartUtils.buildChartData = /**
     * @param {?} rawData
     * @param {?} chartOptions
     * @param {?=} dimensionsIndex
     * @return {?}
     */
    function (rawData, chartOptions, dimensionsIndex) {
        if (dimensionsIndex === void 0) { dimensionsIndex = 0; }
        /** @type {?} */
        var type = chartOptions.type;
        /** @type {?} */
        var data = rawData;
        /** @type {?} */
        var dimension = chartOptions.dimension || {};
        if (dimension.dataSrcPath) {
            data = CommonsUtils.get(rawData, dimension.dataSrcPath);
        }
        /** @type {?} */
        var dataItemProps = dimension.dataItemProps || chartOptions.dataItemProps;
        /** @type {?} */
        var label = dimension.title || '';
        switch (type || ChartType.BAR) {
            case ChartType.BAR:
                data = ChartUtils.buildBarChart(data, dataItemProps, label, dimensionsIndex);
                break;
            case ChartType.LINE:
                data = ChartUtils.buildLineChart(data, dataItemProps, label, dimensionsIndex);
                break;
            case ChartType.PIE:
                data = ChartUtils.buildPieChart(data, dataItemProps, label, dimensionsIndex);
                break;
            case ChartType.AREA:
                data = ChartUtils.buildAreaChart(data, dataItemProps, label, dimensionsIndex);
                break;
            case ChartType.RADAR:
                data = ChartUtils.buildRadarChart(data, dataItemProps, label, dimensionsIndex);
                break;
            case ChartType.DOUGHNUT:
                data = ChartUtils.buildPieChart(data, dataItemProps, label, dimensionsIndex);
                break;
        }
        return data;
    };
    /**
     * @param {?} dataItems
     * @param {?} config
     * @param {?=} label
     * @param {?=} colorIndex
     * @return {?}
     */
    ChartUtils.buildBarChart = /**
     * @param {?} dataItems
     * @param {?} config
     * @param {?=} label
     * @param {?=} colorIndex
     * @return {?}
     */
    function (dataItems, config, label, colorIndex) {
        if (label === void 0) { label = ''; }
        if (colorIndex === void 0) { colorIndex = 0; }
        /** @type {?} */
        var _data = DataItemUtils.transItems(dataItems, config);
        /** @type {?} */
        var labels = [];
        /** @type {?} */
        var datasets = [];
        /** @type {?} */
        var data = [];
        /** @type {?} */
        var backgroundColor = [];
        /** @type {?} */
        var hoverBackgroundColor = [];
        /** @type {?} */
        var items = _data;
        items.forEach(function (item) {
            if (item['group']) {
                datasets.push({
                    label: items[''].label,
                    data: items[''].items,
                    backgroundColor: ColorUtils.getColor(items[''].label)
                });
                labels.push('');
            }
            else {
                /** @type {?} */
                var lb = item['key_as_string'] || item['label'];
                labels.push(lb);
                data.push(item['value']);
                backgroundColor.push(ColorUtils.getColor(lb, colorIndex));
                hoverBackgroundColor.push(ColorUtils.getColor(lb, colorIndex + 10));
            }
        });
        datasets.push({
            label: label,
            backgroundColor: backgroundColor,
            hoverBackgroundColor: hoverBackgroundColor,
            data: data
        });
        return {
            labels: labels,
            datasets: datasets
        };
    };
    /**
     * @param {?} dataItems
     * @param {?} config
     * @param {?=} label
     * @param {?=} colorIndex
     * @return {?}
     */
    ChartUtils.buildPieChart = /**
     * @param {?} dataItems
     * @param {?} config
     * @param {?=} label
     * @param {?=} colorIndex
     * @return {?}
     */
    function (dataItems, config, label, colorIndex) {
        if (label === void 0) { label = ''; }
        if (colorIndex === void 0) { colorIndex = 0; }
        /** @type {?} */
        var _data = DataItemUtils.transItems(dataItems, config);
        /** @type {?} */
        var labels = [];
        /** @type {?} */
        var datasets = [];
        /** @type {?} */
        var data = [];
        /** @type {?} */
        var backgroundColor = [];
        /** @type {?} */
        var hoverBackgroundColor = [];
        /** @type {?} */
        var items = _data;
        items.forEach(function (item) {
            if (item['group']) {
                datasets.push({
                    label: items[''].label,
                    data: items[''].items,
                    backgroundColor: ColorUtils.getColor(items[''].label)
                });
                labels.push('');
            }
            else {
                /** @type {?} */
                var lb = item['key_as_string'] || item['label'];
                labels.push(lb);
                data.push(item['value']);
                backgroundColor.push(ColorUtils.getColor(lb, colorIndex));
                hoverBackgroundColor.push(ColorUtils.getColor(lb, colorIndex + 10));
            }
        });
        datasets.push({
            label: label || '',
            backgroundColor: backgroundColor,
            hoverBackgroundColor: hoverBackgroundColor,
            data: data
        });
        return {
            labels: labels,
            datasets: datasets
        };
    };
    /**
     * @param {?} dataItems
     * @param {?} config
     * @param {?=} label
     * @param {?=} colorIndex
     * @return {?}
     */
    ChartUtils.buildAreaChart = /**
     * @param {?} dataItems
     * @param {?} config
     * @param {?=} label
     * @param {?=} colorIndex
     * @return {?}
     */
    function (dataItems, config, label, colorIndex) {
        if (label === void 0) { label = ''; }
        if (colorIndex === void 0) { colorIndex = 0; }
        /** @type {?} */
        var _data = DataItemUtils.transItems(dataItems, config);
        /** @type {?} */
        var labels = [];
        /** @type {?} */
        var datasets = [];
        /** @type {?} */
        var backgroundColor = [];
        /** @type {?} */
        var data = [];
        /** @type {?} */
        var items = _data;
        items.forEach(function (item) {
            if (item['group']) {
                datasets.push({
                    label: items[''].label,
                    data: items[''].items,
                    backgroundColor: ColorUtils.getColor(items[''].label)
                });
                labels.push('');
            }
            else {
                /** @type {?} */
                var lb = item['key_as_string'] || item['label'];
                labels.push(lb);
                data.push(item['value']);
                backgroundColor.push(ColorUtils.getColor(lb, colorIndex));
            }
        });
        datasets.push({
            label: label || '',
            data: data,
            backgroundColor: backgroundColor
        });
        return {
            labels: labels,
            datasets: datasets
        };
    };
    /**
     * @param {?} dataItems
     * @param {?} config
     * @param {?=} label
     * @param {?=} colorIndex
     * @return {?}
     */
    ChartUtils.buildLineChart = /**
     * @param {?} dataItems
     * @param {?} config
     * @param {?=} label
     * @param {?=} colorIndex
     * @return {?}
     */
    function (dataItems, config, label, colorIndex) {
        if (label === void 0) { label = ''; }
        if (colorIndex === void 0) { colorIndex = 0; }
        /** @type {?} */
        var _data = DataItemUtils.transItems(dataItems, config);
        /** @type {?} */
        var labels = [];
        /** @type {?} */
        var datasets = [];
        /** @type {?} */
        var data = [];
        /** @type {?} */
        var items = _data;
        items.forEach(function (item) {
            if (item['group']) {
                datasets.push({
                    label: items[''].label,
                    data: items[''].items,
                    backgroundColor: ColorUtils.getColor(items[''].label)
                });
                labels.push('');
            }
            else {
                /** @type {?} */
                var lb = item['key_as_string'] || item['label'];
                labels.push(lb);
                data.push(item['value']);
            }
        });
        datasets.push({
            label: label || '',
            data: data,
            fill: false,
            borderColor: ColorUtils.getColor(colorIndex)
        });
        return {
            labels: labels,
            datasets: datasets
        };
    };
    /**
     * @param {?} dataItems
     * @param {?} config
     * @param {?=} label
     * @param {?=} colorIndex
     * @return {?}
     */
    ChartUtils.buildRadarChart = /**
     * @param {?} dataItems
     * @param {?} config
     * @param {?=} label
     * @param {?=} colorIndex
     * @return {?}
     */
    function (dataItems, config, label, colorIndex) {
        if (label === void 0) { label = ''; }
        if (colorIndex === void 0) { colorIndex = 0; }
        /** @type {?} */
        var _data = DataItemUtils.transItems(dataItems, config);
        /** @type {?} */
        var labels = [];
        /** @type {?} */
        var datasets = [];
        /** @type {?} */
        var backgroundColor = [];
        /** @type {?} */
        var borderColor = [];
        /** @type {?} */
        var pointBackgroundColor = [];
        /** @type {?} */
        var pointHoverBorderColor = [];
        /** @type {?} */
        var data = [];
        /** @type {?} */
        var items = _data;
        items.forEach(function (item) {
            if (item['group']) {
                datasets.push({
                    label: items[''].label,
                    data: items[''].items,
                    backgroundColor: ColorUtils.getColor(items[''].label)
                });
                labels.push('');
            }
            else {
                /** @type {?} */
                var lb = item['key_as_string'] || item['label'];
                labels.push(lb);
                data.push(item['value']);
                backgroundColor.push(ColorUtils.getColor(lb, colorIndex));
                borderColor.push(ColorUtils.getColor(lb, colorIndex + 5));
                pointBackgroundColor.push(ColorUtils.getColor(lb, colorIndex + 5));
                pointHoverBorderColor.push(ColorUtils.getColor(lb, colorIndex + 5));
            }
        });
        datasets.push({
            label: label || '',
            data: data,
            backgroundColor: backgroundColor,
            borderColor: borderColor,
            pointBackgroundColor: pointBackgroundColor,
            pointHoverBorderColor: pointHoverBorderColor,
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff'
        });
        return {
            labels: labels,
            datasets: datasets
        };
    };
    return ChartUtils;
}());
export { ChartUtils };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZXIvdXRpbHMvIiwic291cmNlcyI6WyJsaWIvY2hhcnQvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBaUIsU0FBUyxFQUFnQixNQUFNLFdBQVcsQ0FBQztBQUNuRSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sVUFBVSxDQUFDO0FBQ3BDLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxTQUFTLENBQUM7QUFDckMsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLGNBQWMsQ0FBQztBQUUzQztJQUFBO0lBc05BLENBQUM7Ozs7Ozs7SUFwTlEseUJBQWM7Ozs7OztJQUFyQixVQUFzQixPQUFZLEVBQUUsWUFBaUYsRUFBRSxlQUEyQjtRQUEzQixnQ0FBQSxFQUFBLG1CQUEyQjs7WUFDMUksSUFBSSxHQUFHLFlBQVksQ0FBQyxJQUFJOztZQUMxQixJQUFJLEdBQUcsT0FBTzs7WUFDWixTQUFTLEdBQUcsWUFBWSxDQUFDLFNBQVMsSUFBSSxFQUFFO1FBQzlDLElBQUksU0FBUyxDQUFDLFdBQVcsRUFBRTtZQUN6QixJQUFJLEdBQUcsWUFBWSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ3pEOztZQUNLLGFBQWEsR0FBRyxTQUFTLENBQUMsYUFBYSxJQUFJLFlBQVksQ0FBQyxhQUFhOztZQUNyRSxLQUFLLEdBQUcsU0FBUyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ25DLFFBQVEsSUFBSSxJQUFJLFNBQVMsQ0FBQyxHQUFHLEVBQUU7WUFDN0IsS0FBSyxTQUFTLENBQUMsR0FBRztnQkFDaEIsSUFBSSxHQUFHLFVBQVUsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxLQUFLLEVBQUUsZUFBZSxDQUFDLENBQUM7Z0JBQzdFLE1BQU07WUFDUixLQUFLLFNBQVMsQ0FBQyxJQUFJO2dCQUNqQixJQUFJLEdBQUcsVUFBVSxD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Z0JBQWdCLEVBQUUsTUFBTTtZQUN4Qix5QkFBeUIsRUFBRSxNQUFNO1NBQ2xDLENBQUMsQ0FBQztRQUNILE9BQU87WUFDTCxNQUFNLFFBQUE7WUFDTixRQUFRLFVBQUE7U0FDVCxDQUFDO0lBQ0osQ0FBQztJQUNILGlCQUFDO0FBQUQsQ0FBQyxBQXRORCxJQXNOQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q2hhcnREaW1lbnNpb24sIENoYXJ0VHlwZSwgRGF0YUl0ZW1Qcm9wc30gZnJvbSAnQGVyL3R5cGVzJztcbmltcG9ydCB7Q29sb3JVdGlsc30gZnJvbSAnLi4vY29sb3InO1xuaW1wb3J0IHtDb21tb25zVXRpbHN9IGZyb20gJy4uL2NvbW0nO1xuaW1wb3J0IHtEYXRhSXRlbVV0aWxzfSBmcm9tICcuLi9kYXRhLWl0ZW0nO1xuXG5leHBvcnQgY2xhc3MgQ2hhcnRVdGlscyB7XG5cbiAgc3RhdGljIGJ1aWxkQ2hhcnREYXRhKHJhd0RhdGE6IGFueSwgY2hhcnRPcHRpb25zOiB7IHR5cGU6IENoYXJ0VHlwZSwgZGltZW5zaW9uPzogQ2hhcnREaW1lbnNpb24sIGRhdGFJdGVtUHJvcHM/OiB7fSB9LCBkaW1lbnNpb25zSW5kZXg6IG51bWJlciA9IDApIHtcbiAgICBjb25zdCB0eXBlID0gY2hhcnRPcHRpb25zLnR5cGU7XG4gICAgbGV0IGRhdGEgPSByYXdEYXRhO1xuICAgIGNvbnN0IGRpbWVuc2lvbiA9IGNoYXJ0T3B0aW9ucy5kaW1lbnNpb24gfHwge307XG4gICAgaWYgKGRpbWVuc2lvbi5kYXRhU3JjUGF0aCkge1xuICAgICAgZGF0YSA9IENvbW1vbnNVdGlscy5nZXQocmF3RGF0YSwgZGltZW5zaW9uLmRhdGFTcmNQYXRoKTtcbiAgICB9XG4gICAgY29uc3QgZGF0YUl0ZW1Qcm9wcyA9IGRpbWVuc2lvbi5kYXRhSXRlbVByb3BzIHx8IGNoYXJ0T3B0aW9ucy5kYXRhSXRlbVByb3BzO1xuICAgIGNvbnN0IGxhYmVsID0gZGltZW5zaW9uLnRpdGxlIHx8ICcnO1xuICAgIHN3aXRjaCAodHlwZSB8fCBDaGFydFR5cGUuQkFSKSB7XG4gICAgICBjYXNlIENoYXJ0VHlwZS5CQVI6XG4gICAgICAgIGRhdGEgPSBDaGFydFV0aWxzLmJ1aWxkQmFyQ2hhcnQoZGF0YSwgZGF0YUl0ZW1Qcm9wcywgbGFiZWwsIGRpbWVuc2lvbnNJbmRleCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBDaGFydFR5cGUuTElORTpcbiAgICAgICAgZGF0YSA9IENoYXJ0VXRpbHMuYnVpbGRMaW5lQ2hhcnQoZGF0YSwgZGF0YUl0ZW1Qcm9wcywgbGFiZWwsIGRpbWVuc2lvbnNJbmRleCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBDaGFydFR5cGUuUElFOlxuICAgICAgICBkYXRhID0gQ2hhcnRVdGlscy5idWlsZFBpZUNoYXJ0KGRhdGEsIGRhdGFJdGVtUHJvcHMsIGxhYmVsLCBkaW1lbnNpb25zSW5kZXgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQ2hhcnRUeXBlLkFSRUE6XG4gICAgICAgIGRhdGEgPSBDaGFydFV0aWxzLmJ1aWxkQXJlYUNoYXJ0KGRhdGEsIGRhdGFJdGVtUHJvcHMsIGxhYmVsLCBkaW1lbnNpb25zSW5kZXgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQ2hhcnRUeXBlLlJBREFSOlxuICAgICAgICBkYXRhID0gQ2hhcnRVdGlscy5idWlsZFJhZGFyQ2hhcnQoZGF0YSwgZGF0YUl0ZW1Qcm9wcywgbGFiZWwsIGRpbWVuc2lvbnNJbmRleCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBDaGFydFR5cGUuRE9VR0hOVVQ6XG4gICAgICAgIGRhdGEgPSBDaGFydFV0aWxzLmJ1aWxkUGllQ2hhcnQoZGF0YSwgZGF0YUl0ZW1Qcm9wcywgbGFiZWwsIGRpbWVuc2lvbnNJbmRleCk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIHN0YXRpYyBidWlsZEJhckNoYXJ0KGRhdGFJdGVtczoge31bXSwgY29uZmlnOiBEYXRhSXRlbVByb3BzLCBsYWJlbCA9ICcnLCBjb2xvckluZGV4ID0gMCkge1xuICAgIGNvbnN0IF9kYXRhID0gRGF0YUl0ZW1VdGlscy50cmFuc0l0ZW1zKGRhdGFJdGVtcywgY29uZmlnKTtcbiAgICBjb25zdCBsYWJlbHMgPSBbXTtcbiAgICBjb25zdCBkYXRhc2V0cyA9IFtdO1xuICAgIGNvbnN0IGRhdGEgPSBbXTtcbiAgICBjb25zdCBiYWNrZ3JvdW5kQ29sb3IgPSBbXTtcbiAgICBjb25zdCBob3ZlckJhY2tncm91bmRDb2xvciA9IFtdO1xuICAgIGNvbnN0IGl0ZW1zID0gX2RhdGE7XG4gICAgaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIGlmIChpdGVtWydncm91cCddKSB7XG4gICAgICAgIGRhdGFzZXRzLnB1c2goe1xuICAgICAgICAgIGxhYmVsOiBpdGVtc1snJ10ubGFiZWwsXG4gICAgICAgICAgZGF0YTogaXRlbXNbJyddLml0ZW1zLFxuICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogQ29sb3JVdGlscy5nZXRDb2xvcihpdGVtc1snJ10ubGFiZWwpXG4gICAgICAgIH0pO1xuICAgICAgICBsYWJlbHMucHVzaCgnJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBsYiA9IGl0ZW1bJ2tleV9hc19zdHJpbmcnXSB8fCBpdGVtWydsYWJlbCddO1xuICAgICAgICBsYWJlbHMucHVzaChsYik7XG4gICAgICAgIGRhdGEucHVzaChpdGVtWyd2YWx1ZSddKTtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yLnB1c2goQ29sb3JVdGlscy5nZXRDb2xvcihsYiwgY29sb3JJbmRleCkpO1xuICAgICAgICBob3ZlckJhY2tncm91bmRDb2xvci5wdXNoKENvbG9yVXRpbHMuZ2V0Q29sb3IobGIsIGNvbG9ySW5kZXggKyAxMCkpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGRhdGFzZXRzLnB1c2goe1xuICAgICAgbGFiZWw6IGxhYmVsLFxuICAgICAgYmFja2dyb3VuZENvbG9yLFxuICAgICAgaG92ZXJCYWNrZ3JvdW5kQ29sb3IsXG4gICAgICBkYXRhXG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxhYmVscyxcbiAgICAgIGRhdGFzZXRzXG4gICAgfTtcbiAgfVxuXG4gIHN0YXRpYyBidWlsZFBpZUNoYXJ0KGRhdGFJdGVtczoge31bXSwgY29uZmlnOiBEYXRhSXRlbVByb3BzLCBsYWJlbCA9ICcnLCBjb2xvckluZGV4ID0gMCkge1xuICAgIGNvbnN0IF9kYXRhID0gRGF0YUl0ZW1VdGlscy50cmFuc0l0ZW1zKGRhdGFJdGVtcywgY29uZmlnKTtcbiAgICBjb25zdCBsYWJlbHMgPSBbXTtcbiAgICBjb25zdCBkYXRhc2V0cyA9IFtdO1xuICAgIGNvbnN0IGRhdGEgPSBbXTtcbiAgICBjb25zdCBiYWNrZ3JvdW5kQ29sb3IgPSBbXTtcbiAgICBjb25zdCBob3ZlckJhY2tncm91bmRDb2xvciA9IFtdO1xuICAgIGNvbnN0IGl0ZW1zID0gX2RhdGE7XG4gICAgaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIGlmIChpdGVtWydncm91cCddKSB7XG4gICAgICAgIGRhdGFzZXRzLnB1c2goe1xuICAgICAgICAgIGxhYmVsOiBpdGVtc1snJ10ubGFiZWwsXG4gICAgICAgICAgZGF0YTogaXRlbXNbJyddLml0ZW1zLFxuICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogQ29sb3JVdGlscy5nZXRDb2xvcihpdGVtc1snJ10ubGFiZWwpXG4gICAgICAgIH0pO1xuICAgICAgICBsYWJlbHMucHVzaCgnJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBsYiA9IGl0ZW1bJ2tleV9hc19zdHJpbmcnXSB8fCBpdGVtWydsYWJlbCddO1xuICAgICAgICBsYWJlbHMucHVzaChsYik7XG4gICAgICAgIGRhdGEucHVzaChpdGVtWyd2YWx1ZSddKTtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yLnB1c2goQ29sb3JVdGlscy5nZXRDb2xvcihsYiwgY29sb3JJbmRleCkpO1xuICAgICAgICBob3ZlckJhY2tncm91bmRDb2xvci5wdXNoKENvbG9yVXRpbHMuZ2V0Q29sb3IobGIsIGNvbG9ySW5kZXggKyAxMCkpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGRhdGFzZXRzLnB1c2goe1xuICAgICAgbGFiZWw6IGxhYmVsIHx8ICcnLFxuICAgICAgYmFja2dyb3VuZENvbG9yLFxuICAgICAgaG92ZXJCYWNrZ3JvdW5kQ29sb3IsXG4gICAgICBkYXRhXG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxhYmVscyxcbiAgICAgIGRhdGFzZXRzXG4gICAgfTtcbiAgfVxuXG4gIHN0YXRpYyBidWlsZEFyZWFDaGFydChkYXRhSXRlbXM6IHt9W10sIGNvbmZpZzogRGF0YUl0ZW1Qcm9wcywgbGFiZWwgPSAnJywgY29sb3JJbmRleCA9IDApIHtcbiAgICBjb25zdCBfZGF0YSA9IERhdGFJdGVtVXRpbHMudHJhbnNJdGVtcyhkYXRhSXRlbXMsIGNvbmZpZyk7XG4gICAgY29uc3QgbGFiZWxzID0gW107XG4gICAgY29uc3QgZGF0YXNldHMgPSBbXTtcbiAgICBjb25zdCBiYWNrZ3JvdW5kQ29sb3IgPSBbXTtcbiAgICBjb25zdCBkYXRhID0gW107XG4gICAgY29uc3QgaXRlbXMgPSBfZGF0YTtcbiAgICBpdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgaWYgKGl0ZW1bJ2dyb3VwJ10pIHtcbiAgICAgICAgZGF0YXNldHMucHVzaCh7XG4gICAgICAgICAgbGFiZWw6IGl0ZW1zWycnXS5sYWJlbCxcbiAgICAgICAgICBkYXRhOiBpdGVtc1snJ10uaXRlbXMsXG4gICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBDb2xvclV0aWxzLmdldENvbG9yKGl0ZW1zWycnXS5sYWJlbClcbiAgICAgICAgfSk7XG4gICAgICAgIGxhYmVscy5wdXNoKCcnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGxiID0gaXRlbVsna2V5X2FzX3N0cmluZyddIHx8IGl0ZW1bJ2xhYmVsJ107XG4gICAgICAgIGxhYmVscy5wdXNoKGxiKTtcbiAgICAgICAgZGF0YS5wdXNoKGl0ZW1bJ3ZhbHVlJ10pO1xuICAgICAgICBiYWNrZ3JvdW5kQ29sb3IucHVzaChDb2xvclV0aWxzLmdldENvbG9yKGxiLCBjb2xvckluZGV4KSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgZGF0YXNldHMucHVzaCh7XG4gICAgICBsYWJlbDogbGFiZWwgfHwgJycsXG4gICAgICBkYXRhLFxuICAgICAgYmFja2dyb3VuZENvbG9yXG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxhYmVscyxcbiAgICAgIGRhdGFzZXRzXG4gICAgfTtcbiAgfVxuXG4gIHN0YXRpYyBidWlsZExpbmVDaGFydChkYXRhSXRlbXM6IHt9W10sIGNvbmZpZzogRGF0YUl0ZW1Qcm9wcywgbGFiZWwgPSAnJywgY29sb3JJbmRleCA9IDApIHtcbiAgICBjb25zdCBfZGF0YSA9IERhdGFJdGVtVXRpbHMudHJhbnNJdGVtcyhkYXRhSXRlbXMsIGNvbmZpZyk7XG4gICAgY29uc3QgbGFiZWxzID0gW107XG4gICAgY29uc3QgZGF0YXNldHMgPSBbXTtcbiAgICBjb25zdCBkYXRhID0gW107XG4gICAgY29uc3QgaXRlbXMgPSBfZGF0YTtcbiAgICBpdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgaWYgKGl0ZW1bJ2dyb3VwJ10pIHtcbiAgICAgICAgZGF0YXNldHMucHVzaCh7XG4gICAgICAgICAgbGFiZWw6IGl0ZW1zWycnXS5sYWJlbCxcbiAgICAgICAgICBkYXRhOiBpdGVtc1snJ10uaXRlbXMsXG4gICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBDb2xvclV0aWxzLmdldENvbG9yKGl0ZW1zWycnXS5sYWJlbClcbiAgICAgICAgfSk7XG4gICAgICAgIGxhYmVscy5wdXNoKCcnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGxiID0gaXRlbVsna2V5X2FzX3N0cmluZyddIHx8IGl0ZW1bJ2xhYmVsJ107XG4gICAgICAgIGxhYmVscy5wdXNoKGxiKTtcbiAgICAgICAgZGF0YS5wdXNoKGl0ZW1bJ3ZhbHVlJ10pO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGRhdGFzZXRzLnB1c2goe1xuICAgICAgbGFiZWw6IGxhYmVsIHx8ICcnLFxuICAgICAgZGF0YSxcbiAgICAgIGZpbGw6IGZhbHNlLFxuICAgICAgYm9yZGVyQ29sb3I6IENvbG9yVXRpbHMuZ2V0Q29sb3IoY29sb3JJbmRleClcbiAgICB9KTtcbiAgICByZXR1cm4ge1xuICAgICAgbGFiZWxzLFxuICAgICAgZGF0YXNldHNcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIGJ1aWxkUmFkYXJDaGFydChkYXRhSXRlbXM6IHt9W10sIGNvbmZpZzogRGF0YUl0ZW1Qcm9wcywgbGFiZWwgPSAnJywgY29sb3JJbmRleCA9IDApIHtcbiAgICBjb25zdCBfZGF0YSA9IERhdGFJdGVtVXRpbHMudHJhbnNJdGVtcyhkYXRhSXRlbXMsIGNvbmZpZyk7XG4gICAgY29uc3QgbGFiZWxzID0gW107XG4gICAgY29uc3QgZGF0YXNldHMgPSBbXTtcbiAgICBjb25zdCBiYWNrZ3JvdW5kQ29sb3IgPSBbXTtcbiAgICBjb25zdCBib3JkZXJDb2xvciA9IFtdO1xuICAgIGNvbnN0IHBvaW50QmFja2dyb3VuZENvbG9yID0gW107XG4gICAgY29uc3QgcG9pbnRIb3ZlckJvcmRlckNvbG9yID0gW107XG4gICAgY29uc3QgZGF0YSA9IFtdO1xuICAgIGNvbnN0IGl0ZW1zID0gX2RhdGE7XG4gICAgaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIGlmIChpdGVtWydncm91cCddKSB7XG4gICAgICAgIGRhdGFzZXRzLnB1c2goe1xuICAgICAgICAgIGxhYmVsOiBpdGVtc1snJ10ubGFiZWwsXG4gICAgICAgICAgZGF0YTogaXRlbXNbJyddLml0ZW1zLFxuICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogQ29sb3JVdGlscy5nZXRDb2xvcihpdGVtc1snJ10ubGFiZWwpXG4gICAgICAgIH0pO1xuICAgICAgICBsYWJlbHMucHVzaCgnJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBsYiA9IGl0ZW1bJ2tleV9hc19zdHJpbmcnXSB8fCBpdGVtWydsYWJlbCddO1xuICAgICAgICBsYWJlbHMucHVzaChsYik7XG4gICAgICAgIGRhdGEucHVzaChpdGVtWyd2YWx1ZSddKTtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yLnB1c2goQ29sb3JVdGlscy5nZXRDb2xvcihsYiwgY29sb3JJbmRleCkpO1xuICAgICAgICBib3JkZXJDb2xvci5wdXNoKENvbG9yVXRpbHMuZ2V0Q29sb3IobGIsIGNvbG9ySW5kZXggKyA1KSk7XG4gICAgICAgIHBvaW50QmFja2dyb3VuZENvbG9yLnB1c2goQ29sb3JVdGlscy5nZXRDb2xvcihsYiwgY29sb3JJbmRleCArIDUpKTtcbiAgICAgICAgcG9pbnRIb3ZlckJvcmRlckNvbG9yLnB1c2goQ29sb3JVdGlscy5nZXRDb2xvcihsYiwgY29sb3JJbmRleCArIDUpKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBkYXRhc2V0cy5wdXNoKHtcbiAgICAgIGxhYmVsOiBsYWJlbCB8fCAnJyxcbiAgICAgIGRhdGEsXG4gICAgICBiYWNrZ3JvdW5kQ29sb3IsXG4gICAgICBib3JkZXJDb2xvcixcbiAgICAgIHBvaW50QmFja2dyb3VuZENvbG9yLFxuICAgICAgcG9pbnRIb3ZlckJvcmRlckNvbG9yLFxuICAgICAgcG9pbnRCb3JkZXJDb2xvcjogJyNmZmYnLFxuICAgICAgcG9pbnRIb3ZlckJhY2tncm91bmRDb2xvcjogJyNmZmYnXG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxhYmVscyxcbiAgICAgIGRhdGFzZXRzXG4gICAgfTtcbiAgfVxufVxuIl19