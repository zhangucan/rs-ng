/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Devices } from '@er/types';
import { RegUtils } from '../regex';
/** @type {?} */
var bowser = require('bowser');
/**
 * @record
 */
export function BrowserSupport() { }
if (false) {
    /** @type {?|undefined} */
    BrowserSupport.prototype.version;
    /** @type {?|undefined} */
    BrowserSupport.prototype.features;
}
var BrowserOsUtils = /** @class */ (function () {
    function BrowserOsUtils() {
    }
    /**
     * @return {?}
     */
    BrowserOsUtils.isMobile = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = [
            Devices.DEVICES.ANDROID,
            Devices.DEVICES.IPHONE,
            Devices.DEVICES.I_POD,
            Devices.DEVICES.BLACKBERRY,
            Devices.DEVICES.FIREFOX_OS,
            Devices.DEVICES.WINDOWS_PHONE,
            Devices.DEVICES.VITA
        ].some(function (item) {
            return BrowserOsUtils.device_info.device === item;
        });
        return result;
    };
    /**
     * @return {?}
     */
    BrowserOsUtils.isTablet = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = [
            Devices.DEVICES.I_PAD,
            Devices.DEVICES.FIREFOX_OS
        ].some(function (item) {
            return BrowserOsUtils.device_info.device === item;
        });
        return result;
    };
    /**
     * @return {?}
     */
    BrowserOsUtils.isDesktop = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = [
            Devices.DEVICES.PS4,
            Devices.DEVICES.CHROME_BOOK,
            Devices.DEVICES.UNKNOWN
        ].some(function (item) {
            return BrowserOsUtils.device_info.device === item;
        });
        return result;
    };
    /**
     * @return {?}
     */
    BrowserOsUtils.getDeviceInfo = /**
     * @return {?}
     */
    function () {
        if (BrowserOsUtils.device_info) {
            return BrowserOsUtils.device_info;
        }
        if (window && window.navigator) {
            BrowserOsUtils.ua = window.navigator.userAgent;
        }
        BrowserOsUtils.userAgent = BrowserOsUtils.ua;
        /** @type {?} */
        var mappings = [
            { const: 'OS', prop: 'os' },
            { const: 'BROWSERS', prop: 'browser' },
            { const: 'DEVICES', prop: 'device' },
            { const: 'OS_VERSIONS', prop: 'os_version' }
        ];
        mappings.forEach(function (mapping) {
            BrowserOsUtils[mapping.prop] = Object.keys(Devices[mapping.const]).reduce(function (obj, item) {
                obj[Devices[mapping.const][item]] = RegUtils.test(BrowserOsUtils.ua, Devices[mapping.const + "_RE"][item]);
                return obj;
            }, {});
        });
        mappings.forEach(function (mapping) {
            BrowserOsUtils[mapping.prop] = Object.keys(Devices[mapping.const])
                .map(function (key) {
                return Devices[mapping.const][key];
            }).reduce(function (previousValue, currentValue) {
                return (previousValue === Devices[mapping.const].UNKNOWN && BrowserOsUtils[mapping.prop][currentValue])
                    ? currentValue : previousValue;
            }, Devices[mapping.const].UNKNOWN);
        });
        BrowserOsUtils.browser_version = '0';
        if (BrowserOsUtils.browser !== Devices.BROWSERS.UNKNOWN) {
            /** @type {?} */
            var re = Devices.BROWSER_VERSIONS_RE[BrowserOsUtils.browser];
            /** @type {?} */
            var res = RegUtils.exec(BrowserOsUtils.ua, re);
            if (!!res) {
                BrowserOsUtils.browser_version = res[1];
            }
        }
        BrowserOsUtils.device_info = {
            userAgent: BrowserOsUtils.userAgent,
            os: BrowserOsUtils.os,
            browser: BrowserOsUtils.browser,
            device: BrowserOsUtils.device,
            os_version: BrowserOsUtils.os_version,
            browser_version: BrowserOsUtils.browser_version
        };
        return BrowserOsUtils.device_info;
    };
    /**
     * @return {?}
     */
    BrowserOsUtils.checkBrowser = /**
     * @return {?}
     */
    function () {
        if (BrowserOsUtils.isBrowserVersionValid()) {
            /** @type {?} */
            var features = BrowserOsUtils.isBrowserFeaturesValid();
            return {
                version: true,
                features: features
            };
        }
        return {
            version: false
        };
    };
    /**
     * @private
     * @return {?}
     */
    BrowserOsUtils.isBrowserVersionValid = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var browser = bowser.getParser(window.navigator.userAgent);
        return browser.satisfies({
            windows: {
                'internet explorer': '>10'
            },
            macos: {
                safari: '>10.1'
            },
            chrome: '>20.1.1432',
            firefox: '>31',
            opera: '>22'
        });
    };
    /**
     * @private
     * @return {?}
     */
    BrowserOsUtils.isBrowserFeaturesValid = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var supported = true;
        for (var feature in Modernizr) {
            if (Modernizr.hasOwnProperty(feature) &&
                typeof Modernizr[feature] === 'boolean' && Modernizr[feature] === false) {
                supported = false;
                break;
            }
        }
        return supported;
    };
    BrowserOsUtils.ua = '';
    BrowserOsUtils.userAgent = '';
    BrowserOsUtils.os = '';
    BrowserOsUtils.browser = '';
    BrowserOsUtils.device = '';
    BrowserOsUtils.os_version = '';
    BrowserOsUtils.browser_version = '';
    BrowserOsUtils.device_info = undefined;
    return BrowserOsUtils;
}());
export { BrowserOsUtils };
if (false) {
    /** @type {?} */
    BrowserOsUtils.ua;
    /** @type {?} */
    BrowserOsUtils.userAgent;
    /** @type {?} */
    BrowserOsUtils.os;
    /** @type {?} */
    BrowserOsUtils.browser;
    /** @type {?} */
    BrowserOsUtils.device;
    /** @type {?} */
    BrowserOsUtils.os_version;
    /** @type {?} */
    BrowserOsUtils.browser_version;
    /** @type {?} */
    BrowserOsUtils.device_info;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZXIvdXRpbHMvIiwic291cmNlcyI6WyJsaWIvYnJvd3Nlci9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFhLE9BQU8sRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUM5QyxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sVUFBVSxDQUFDOztJQUk1QixNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQzs7OztBQUVoQyxvQ0FHQzs7O0lBRkMsaUNBQWtCOztJQUNsQixrQ0FBbUI7O0FBR3JCO0lBQUE7SUErSUEsQ0FBQzs7OztJQXBJUSx1QkFBUTs7O0lBQWY7O1lBQ1EsTUFBTSxHQUFHO1lBQ2IsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPO1lBQ3ZCLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTTtZQUN0QixPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUs7WUFDckIsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFVO1lBQzFCLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBVTtZQUMxQixPQUFPLENBQUMsT0FBTyxDQUFDLGFBQWE7WUFDN0IsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJO1NBQ3JCLENBQUMsSUFBSSxDQUFDLFVBQUMsSUFBSTtZQUNWLE9BQU8sY0FBYyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDO1FBQ3BELENBQUMsQ0FBQztRQUNGLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7Ozs7SUFFTSx1QkFBUTs7O0lBQWY7O1lBQ1EsTUFBTSxHQUFHO1lBQ2IsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLO1lBQ3JCLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBVTtTQUMzQixDQUFDLElBQUksQ0FBQyxVQUFDLElBQUk7WUFDVixPQUFPLGNBQWMsQ0FBQyxXQUFXLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQztRQUNwRCxDQUFDLENBQUM7UUFDRixPQUFPLE1BQU0s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QUFPLEVBQUUsS0FBSztZQUNkLEtBQUssRUFBRSxLQUFLO1NBQ2IsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs7Ozs7SUFFYyxxQ0FBc0I7Ozs7SUFBckM7O1lBQ00sU0FBUyxHQUFHLElBQUk7UUFDcEIsS0FBSyxJQUFNLE9BQU8sSUFBSSxTQUFTLEVBQUU7WUFDL0IsSUFBSSxTQUFTLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQztnQkFDbkMsT0FBTyxTQUFTLENBQUMsT0FBTyxDQUFDLEtBQUssU0FBUyxJQUFJLFNBQVMsQ0FBQyxPQUFPLENBQUMsS0FBSyxLQUFLLEVBQUU7Z0JBQ3pFLFNBQVMsR0FBRyxLQUFLLENBQUM7Z0JBQ2xCLE1BQU07YUFDUDtTQUNGO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQTVJTSxpQkFBRSxHQUFHLEVBQUUsQ0FBQztJQUNSLHdCQUFTLEdBQUcsRUFBRSxDQUFDO0lBQ2YsaUJBQUUsR0FBRyxFQUFFLENBQUM7SUFDUixzQkFBTyxHQUFHLEVBQUUsQ0FBQztJQUNiLHFCQUFNLEdBQUcsRUFBRSxDQUFDO0lBQ1oseUJBQVUsR0FBRyxFQUFFLENBQUM7SUFDaEIsOEJBQWUsR0FBRyxFQUFFLENBQUM7SUFDckIsMEJBQVcsR0FBZSxTQUFTLENBQUM7SUFzSTdDLHFCQUFDO0NBQUEsQUEvSUQsSUErSUM7U0EvSVksY0FBYzs7O0lBRXpCLGtCQUFlOztJQUNmLHlCQUFzQjs7SUFDdEIsa0JBQWU7O0lBQ2YsdUJBQW9COztJQUNwQixzQkFBbUI7O0lBQ25CLDBCQUF1Qjs7SUFDdkIsK0JBQTRCOztJQUM1QiwyQkFBMkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0RldmljZUluZm8sIERldmljZXN9IGZyb20gJ0Blci90eXBlcyc7XG5pbXBvcnQge1JlZ1V0aWxzfSBmcm9tICcuLi9yZWdleCc7XG5cbmRlY2xhcmUgY29uc3QgcmVxdWlyZTtcbmRlY2xhcmUgY29uc3QgTW9kZXJuaXpyO1xuY29uc3QgYm93c2VyID0gcmVxdWlyZSgnYm93c2VyJyk7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQnJvd3NlclN1cHBvcnQge1xuICB2ZXJzaW9uPzogYm9vbGVhbjtcbiAgZmVhdHVyZXM/OiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgQnJvd3Nlck9zVXRpbHMge1xuXG4gIHN0YXRpYyB1YSA9ICcnO1xuICBzdGF0aWMgdXNlckFnZW50ID0gJyc7XG4gIHN0YXRpYyBvcyA9ICcnO1xuICBzdGF0aWMgYnJvd3NlciA9ICcnO1xuICBzdGF0aWMgZGV2aWNlID0gJyc7XG4gIHN0YXRpYyBvc192ZXJzaW9uID0gJyc7XG4gIHN0YXRpYyBicm93c2VyX3ZlcnNpb24gPSAnJztcbiAgc3RhdGljIGRldmljZV9pbmZvOiBEZXZpY2VJbmZvID0gdW5kZWZpbmVkO1xuXG4gIHN0YXRpYyBpc01vYmlsZSgpOiBib29sZWFuIHtcbiAgICBjb25zdCByZXN1bHQgPSBbXG4gICAgICBEZXZpY2VzLkRFVklDRVMuQU5EUk9JRCxcbiAgICAgIERldmljZXMuREVWSUNFUy5JUEhPTkUsXG4gICAgICBEZXZpY2VzLkRFVklDRVMuSV9QT0QsXG4gICAgICBEZXZpY2VzLkRFVklDRVMuQkxBQ0tCRVJSWSxcbiAgICAgIERldmljZXMuREVWSUNFUy5GSVJFRk9YX09TLFxuICAgICAgRGV2aWNlcy5ERVZJQ0VTLldJTkRPV1NfUEhPTkUsXG4gICAgICBEZXZpY2VzLkRFVklDRVMuVklUQVxuICAgIF0uc29tZSgoaXRlbSkgPT4ge1xuICAgICAgcmV0dXJuIEJyb3dzZXJPc1V0aWxzLmRldmljZV9pbmZvLmRldmljZSA9PT0gaXRlbTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgc3RhdGljIGlzVGFibGV0KCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IFtcbiAgICAgIERldmljZXMuREVWSUNFUy5JX1BBRCxcbiAgICAgIERldmljZXMuREVWSUNFUy5GSVJFRk9YX09TXG4gICAgXS5zb21lKChpdGVtKSA9PiB7XG4gICAgICByZXR1cm4gQnJvd3Nlck9zVXRpbHMuZGV2aWNlX2luZm8uZGV2aWNlID09PSBpdGVtO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBzdGF0aWMgaXNEZXNrdG9wKCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IFtcbiAgICAgIERldmljZXMuREVWSUNFUy5QUzQsXG4gICAgICBEZXZpY2VzLkRFVklDRVMuQ0hST01FX0JPT0ssXG4gICAgICBEZXZpY2VzLkRFVklDRVMuVU5LTk9XTlxuICAgIF0uc29tZSgoaXRlbSkgPT4ge1xuICAgICAgcmV0dXJuIEJyb3dzZXJPc1V0aWxzLmRldmljZV9pbmZvLmRldmljZSA9PT0gaXRlbTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgc3RhdGljIGdldERldmljZUluZm8oKSB7XG5cbiAgICBpZiAoQnJvd3Nlck9zVXRpbHMuZGV2aWNlX2luZm8pIHtcbiAgICAgIHJldHVybiBCcm93c2VyT3NVdGlscy5kZXZpY2VfaW5mbztcbiAgICB9XG5cbiAgICBpZiAod2luZG93ICYmIHdpbmRvdy5uYXZpZ2F0b3IpIHtcbiAgICAgIEJyb3dzZXJPc1V0aWxzLnVhID0gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQ7XG4gICAgfVxuXG4gICAgQnJvd3Nlck9zVXRpbHMudXNlckFnZW50ID0gQnJvd3Nlck9zVXRpbHMudWE7XG5cbiAgICBjb25zdCBtYXBwaW5ncyA9IFtcbiAgICAgIHtjb25zdDogJ09TJywgcHJvcDogJ29zJ30sXG4gICAgICB7Y29uc3Q6ICdCUk9XU0VSUycsIHByb3A6ICdicm93c2VyJ30sXG4gICAgICB7Y29uc3Q6ICdERVZJQ0VTJywgcHJvcDogJ2RldmljZSd9LFxuICAgICAge2NvbnN0OiAnT1NfVkVSU0lPTlMnLCBwcm9wOiAnb3NfdmVyc2lvbid9XG4gICAgXTtcblxuICAgIG1hcHBpbmdzLmZvckVhY2goKG1hcHBpbmcpID0+IHtcbiAgICAgIEJyb3dzZXJPc1V0aWxzW21hcHBpbmcucHJvcF0gPSBPYmplY3Qua2V5cyhEZXZpY2VzW21hcHBpbmcuY29uc3RdKS5yZWR1Y2UoKG9iajogYW55LCBpdGVtOiBhbnkpID0+IHtcbiAgICAgICAgb2JqW0RldmljZXNbbWFwcGluZy5jb25zdF1baXRlbV1dID0gUmVnVXRpbHMudGVzdChCcm93c2VyT3NVdGlscy51YSwgRGV2aWNlc1tgJHttYXBwaW5nLmNvbnN0fV9SRWBdW2l0ZW1dKTtcbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgIH0sIHt9KTtcbiAgICB9KTtcblxuICAgIG1hcHBpbmdzLmZvckVhY2goKG1hcHBpbmcpID0+IHtcbiAgICAgIEJyb3dzZXJPc1V0aWxzW21hcHBpbmcucHJvcF0gPSBPYmplY3Qua2V5cyhEZXZpY2VzW21hcHBpbmcuY29uc3RdKVxuICAgICAgICAubWFwKChrZXkpID0+IHtcbiAgICAgICAgICByZXR1cm4gRGV2aWNlc1ttYXBwaW5nLmNvbnN0XVtrZXldO1xuICAgICAgICB9KS5yZWR1Y2UoKHByZXZpb3VzVmFsdWUsIGN1cnJlbnRWYWx1ZSkgPT4ge1xuICAgICAgICAgIHJldHVybiAocHJldmlvdXNWYWx1ZSA9PT0gRGV2aWNlc1ttYXBwaW5nLmNvbnN0XS5VTktOT1dOICYmIEJyb3dzZXJPc1V0aWxzW21hcHBpbmcucHJvcF1bY3VycmVudFZhbHVlXSlcbiAgICAgICAgICAgID8gY3VycmVudFZhbHVlIDogcHJldmlvdXNWYWx1ZTtcbiAgICAgICAgfSwgRGV2aWNlc1ttYXBwaW5nLmNvbnN0XS5VTktOT1dOKTtcbiAgICB9KTtcblxuICAgIEJyb3dzZXJPc1V0aWxzLmJyb3dzZXJfdmVyc2lvbiA9ICcwJztcbiAgICBpZiAoQnJvd3Nlck9zVXRpbHMuYnJvd3NlciAhPT0gRGV2aWNlcy5CUk9XU0VSUy5VTktOT1dOKSB7XG4gICAgICBjb25zdCByZSA9IERldmljZXMuQlJPV1NFUl9WRVJTSU9OU19SRVtCcm93c2VyT3NVdGlscy5icm93c2VyXTtcbiAgICAgIGNvbnN0IHJlcyA9IFJlZ1V0aWxzLmV4ZWMoQnJvd3Nlck9zVXRpbHMudWEsIHJlKTtcbiAgICAgIGlmICghIXJlcykge1xuICAgICAgICBCcm93c2VyT3NVdGlscy5icm93c2VyX3ZlcnNpb24gPSByZXNbMV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgQnJvd3Nlck9zVXRpbHMuZGV2aWNlX2luZm8gPSB7XG4gICAgICB1c2VyQWdlbnQ6IEJyb3dzZXJPc1V0aWxzLnVzZXJBZ2VudCxcbiAgICAgIG9zOiBCcm93c2VyT3NVdGlscy5vcyxcbiAgICAgIGJyb3dzZXI6IEJyb3dzZXJPc1V0aWxzLmJyb3dzZXIsXG4gICAgICBkZXZpY2U6IEJyb3dzZXJPc1V0aWxzLmRldmljZSxcbiAgICAgIG9zX3ZlcnNpb246IEJyb3dzZXJPc1V0aWxzLm9zX3ZlcnNpb24sXG4gICAgICBicm93c2VyX3ZlcnNpb246IEJyb3dzZXJPc1V0aWxzLmJyb3dzZXJfdmVyc2lvblxuICAgIH07XG5cbiAgICByZXR1cm4gQnJvd3Nlck9zVXRpbHMuZGV2aWNlX2luZm87XG4gIH1cblxuICBzdGF0aWMgY2hlY2tCcm93c2VyKCk6IEJyb3dzZXJTdXBwb3J0IHtcbiAgICBpZiAoQnJvd3Nlck9zVXRpbHMuaXNCcm93c2VyVmVyc2lvblZhbGlkKCkpIHtcbiAgICAgIGNvbnN0IGZlYXR1cmVzID0gQnJvd3Nlck9zVXRpbHMuaXNCcm93c2VyRmVhdHVyZXNWYWxpZCgpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmVyc2lvbjogdHJ1ZSxcbiAgICAgICAgZmVhdHVyZXNcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICB2ZXJzaW9uOiBmYWxzZVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBpc0Jyb3dzZXJWZXJzaW9uVmFsaWQoKSB7XG4gICAgY29uc3QgYnJvd3NlciA9IGJvd3Nlci5nZXRQYXJzZXIod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1xuICAgIHJldHVybiBicm93c2VyLnNhdGlzZmllcyh7XG4gICAgICB3aW5kb3dzOiB7XG4gICAgICAgICdpbnRlcm5ldCBleHBsb3Jlcic6ICc+MTAnXG4gICAgICB9LFxuICAgICAgbWFjb3M6IHtcbiAgICAgICAgc2FmYXJpOiAnPjEwLjEnXG4gICAgICB9LFxuICAgICAgY2hyb21lOiAnPjIwLjEuMTQzMicsXG4gICAgICBmaXJlZm94OiAnPjMxJyxcbiAgICAgIG9wZXJhOiAnPjIyJ1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgaXNCcm93c2VyRmVhdHVyZXNWYWxpZCgpIHtcbiAgICBsZXQgc3VwcG9ydGVkID0gdHJ1ZTtcbiAgICBmb3IgKGNvbnN0IGZlYXR1cmUgaW4gTW9kZXJuaXpyKSB7XG4gICAgICBpZiAoTW9kZXJuaXpyLmhhc093blByb3BlcnR5KGZlYXR1cmUpICYmXG4gICAgICAgIHR5cGVvZiBNb2Rlcm5penJbZmVhdHVyZV0gPT09ICdib29sZWFuJyAmJiBNb2Rlcm5penJbZmVhdHVyZV0gPT09IGZhbHNlKSB7XG4gICAgICAgIHN1cHBvcnRlZCA9IGZhbHNlO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN1cHBvcnRlZDtcbiAgfVxufVxuIl19