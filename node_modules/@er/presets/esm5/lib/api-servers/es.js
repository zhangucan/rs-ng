/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ApiServerType, HttpMethod, HttpRequestPayloadType } from '@er/types';
import { DateUtils, EsUtils } from '@er/utils';
import * as esb from 'elastic-builder';
/**
 * @record
 */
export function EsHttpResponse() { }
if (false) {
    /** @type {?|undefined} */
    EsHttpResponse.prototype._index;
    /** @type {?|undefined} */
    EsHttpResponse.prototype._type;
    /* Skipping unhandled member: [key: string]: any;*/
}
/** @type {?} */
var paramKeys = {
    sort: 'sort',
    from: 'from',
    size: 'size',
    order: 'order',
    page: 'page',
    to: 'to',
    q: 'q',
    query: 'query',
    filter: 'filter',
    globalFiler: 'globalFiler',
    fields: '_source'
};
/** @type {?} */
var responseResolver = function (response) {
    if (response) {
        if (response instanceof Array) {
            if (response.length === 1) {
                response = response[0];
            }
        }
        return { success: true, content: response };
    }
    else {
        return { success: false };
    }
};
var ɵ0 = responseResolver;
/** @type {?} */
var updateResponseResolver = function (response) {
    if (response && response.hasOwnProperty('_id')) {
        /** @type {?} */
        var id = response['_id'];
        delete response['_id'];
        return { success: true, content: tslib_1.__assign({ id: id }, response) };
    }
    else {
        return { failure: true, message: response };
    }
};
var ɵ1 = updateResponseResolver;
/** @type {?} */
var deleteResponseResolver = function (response) {
    return response && response.result === 'deleted'
        ? { success: true, content: response }
        : { failure: true, message: response };
};
var ɵ2 = deleteResponseResolver;
/** @type {?} */
var parseResponse = function (resp) {
    /** @type {?} */
    var response = {};
    response['success'] = resp.hasOwnProperty('hits') || resp.hasOwnProperty('aggregations');
    if (response['success']) {
        response['content'] = {
            total: resp['hits'].total,
            items: resp['hits'].hits.map(function (hit) {
                return tslib_1.__assign({ id: hit._id }, hit['_source']);
            })
        };
        if (resp.aggregations) {
            response['content']['aggs'] = resp.aggregations;
        }
        if (resp.highlight) {
            response['content']['highlight'] = resp.highlight;
        }
    }
    else {
        response['error'] = resp.error && resp.error.reason;
    }
    return response;
};
var ɵ3 = parseResponse;
/** @type {?} */
var getApiEntryWithType = function (apiEntry) {
    if (apiEntry.indexOf('/') === -1) {
        apiEntry = apiEntry + "/type";
    }
    return apiEntry;
};
var ɵ4 = getApiEntryWithType;
/** @type {?} */
var META_DATA_FILTER_PATH = 'filter_path=hits.hits.*,aggregations.*';
/** @type {?} */
export var EsServerApiRequestOptions = {
    serverType: ApiServerType.ES,
    paramsKeys: paramKeys,
    actions: {
        login: {
            uriResolver: 'user',
            method: HttpMethod.GET,
            onResponse: responseResolver,
            notifySuccess: true,
            successMessage: '登录成功'
        },
        logout: {
            uriResolver: 'logout',
            notifySuccess: false,
            onResponse: responseResolver,
            successMessage: '退出登录成功'
        },
        register: {
            uriResolver: 'user',
            method: HttpMethod.POST,
            notifySuccess: true,
            successMessage: '注册成功'
        },
        getById: {
            method: HttpMethod.POST,
            uriResolver: function (apiEntry) { return apiEntry + "/_search"; },
            payloadResolver: function (apiEntry, payload) {
                /** @type {?} */
                var query = esb.requestBodySearch().query(esb.boolQuery().must(esb.termQuery('_id', payload['id'])));
                if (payload.fields) {
                    query.source(payload.fields);
                }
                return (/** @type {?} */ (query.toJSON()));
            },
            onResponse: function (resp) {
                return {
                    success: true,
                    content: parseResponse(resp)['content']['items'][0]
                };
            }
        },
        getByIds: {
            method: HttpMethod.POST,
            uriResolver: function (apiEntry) { return apiEntry + "/_search"; },
            payloadResolver: function (apiEntry, payload) {
                /** @type {?} */
                var query = esb.requestBodySearch().query(esb.boolQuery().must(esb.termsQuery('_id', payload['id'])));
                if (payload.fields) {
                    query.source(payload.fields);
                }
                return (/** @type {?} */ (query.toJSON()));
            },
            onResponse: function (resp) {
                return {
                    success: true,
                    content: parseResponse(resp)['content']['items']
                };
            }
        },
        getByQuery: {
            method: HttpMethod.POST,
            payloadType: HttpRequestPayloadType.BODY,
            uriResolver: function (apiEntry) {
                if (apiEntry && apiEntry.toLowerCase().indexOf('_msearch') === -1) {
                    return apiEntry + "/_search";
                }
                else {
                    return apiEntry;
                }
            },
            payloadResolver: function (apiEntry, payload, options) {
                /** @type {?} */
                var body = EsUtils.resolveRequestBody(payload, options);
                if (!body['sort']) {
                    // body['sort'] = {'timestamp': Order.DESC};
                }
                return body;
            },
            onResponse: function (resp) {
                if (resp.responses) {
                    return {
                        success: true,
                        content: {
                            items: resp.responses.map(function (r) { return parseResponse(r); })
                        }
                    };
                }
                else {
                    return parseResponse(resp);
                }
            }
        },
        create: {
            method: HttpMethod.POST,
            uriResolver: function (apiEntry) { return getApiEntryWithType(apiEntry) + "?refresh"; },
            payloadResolver: function (apiEntry, payload) {
                delete payload.id;
                delete payload['_index'];
                delete payload['_type'];
                payload['_createdTime'] = DateUtils.getFormattedDateTime();
                return payload;
            },
            onResponse: updateResponseResolver,
            notifySuccess: false,
            alertSuccess: true,
            successMessage: '数据保存成功'
        },
        updateById: {
            method: HttpMethod.POST,
            payloadType: HttpRequestPayloadType.BODY,
            uriResolver: function (apiEntry, payload) { return getApiEntryWithType(apiEntry) + "/" + payload.id + "/_update?refresh"; },
            payloadResolver: function (apiEntry, payload) {
                return {
                    script: {
                        source: payload.script,
                        lang: 'painless',
                        params: payload.params
                    }
                };
            },
            onResponse: updateResponseResolver,
            notifySuccess: false,
            alertSuccess: true,
            successMessage: '数据更新成功'
        },
        patchById: {
            method: HttpMethod.POST,
            payloadType: HttpRequestPayloadType.BODY,
            uriResolver: function (apiEntry, payload) { return getApiEntryWithType(apiEntry) + "/" + payload.id + "/_update?refresh"; },
            payloadResolver: function (apiEntry, payload, options) {
                delete payload.id;
                delete payload['_index'];
                delete payload['_type'];
                payload['_modifiedTime'] = DateUtils.getFormattedDateTime();
                return {
                    doc: payload
                };
            },
            onResponse: updateResponseResolver,
            notifySuccess: false,
            alertSuccess: true,
            successMessage: '数据更新成功'
        },
        deleteById: {
            method: HttpMethod.DELETE,
            uriResolver: function (apiEntry, payload) { return getApiEntryWithType(apiEntry) + "/" + payload + "?refresh"; },
            payloadResolver: function () { return undefined; },
            onResponse: deleteResponseResolver,
            notifySuccess: false,
            alertSuccess: false,
            successMessage: '数据删除成功'
        },
        deleteByQuery: {
            method: HttpMethod.POST,
            uriResolver: function (apiEntry) { return apiEntry + "/_delete_by_query?refresh"; },
            payloadResolver: function (apiEntry, payload, options) { return EsUtils.resolveRequestBody(payload, options); },
            onResponse: deleteResponseResolver,
            notifySuccess: false,
            alertSuccess: true,
            successMessage: '批量数据删除成功'
        },
        batch: {
            method: HttpMethod.POST,
            uriResolver: function () { return "_bulk?refresh"; },
            onResponse: function (resp) {
                return tslib_1.__assign({}, resp, { success: !resp.hasOwnProperty('errors') });
            },
            notifySuccess: false,
            alertSuccess: true,
            successMessage: '批量操作成功'
        }
    }
};
export { ɵ0, ɵ1, ɵ2, ɵ3, ɵ4 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZXIvcHJlc2V0cy8iLCJzb3VyY2VzIjpbImxpYi9hcGktc2VydmVycy9lcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBK0MsYUFBYSxFQUFFLFVBQVUsRUFBRSxzQkFBc0IsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUMxSCxPQUFPLEVBQUMsU0FBUyxFQUFFLE9BQU8sRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUM3QyxPQUFPLEtBQUssR0FBRyxNQUFNLGlCQUFpQixDQUFDOzs7O0FBRXZDLG9DQUtDOzs7SUFKQyxnQ0FBZ0I7O0lBQ2hCLCtCQUFlOzs7O0lBS1gsU0FBUyxHQUFrQjtJQUMvQixJQUFJLEVBQUUsTUFBTTtJQUNaLElBQUksRUFBRSxNQUFNO0lBQ1osSUFBSSxFQUFFLE1BQU07SUFDWixLQUFLLEVBQUUsT0FBTztJQUNkLElBQUksRUFBRSxNQUFNO0lBQ1osRUFBRSxFQUFFLElBQUk7SUFDUixDQUFDLEVBQUUsR0FBRztJQUNOLEtBQUssRUFBRSxPQUFPO0lBQ2QsTUFBTSxFQUFFLFFBQVE7SUFDaEIsV0FBVyxFQUFFLGFBQWE7SUFDMUIsTUFBTSxFQUFFLFNBQVM7Q0FDbEI7O0lBRUssZ0JBQWdCLEdBQUcsVUFBQSxRQUFRO0lBQy9CLElBQUksUUFBUSxFQUFFO1FBQ1osSUFBSSxRQUFRLFlBQVksS0FBSyxFQUFFO1lBQzdCLElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQ3pCLFFBQVEsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDeEI7U0FDRjtRQUNELE9BQU8sRUFBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUMsQ0FBQztLQUMzQztTQUFNO1FBQ0wsT0FBTyxFQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUMsQ0FBQztLQUN6QjtBQUNILENBQUM7OztJQUVLLHNCQUFzQixHQUFHLFVBQUEsUUFBUTtJQUNy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T0FBbUIsSUFBSyxPQUFHLG1CQUFtQixDQUFDLFFBQVEsQ0FBQyxTQUFJLE9BQU8sYUFBVSxFQUFyRCxDQUFxRDtZQUM3RyxlQUFlLEVBQUUsY0FBTSxPQUFBLFNBQVMsRUFBVCxDQUFTO1lBQ2hDLFVBQVUsRUFBRSxzQkFBc0I7WUFDbEMsYUFBYSxFQUFFLEtBQUs7WUFDcEIsWUFBWSxFQUFFLEtBQUs7WUFDbkIsY0FBYyxFQUFFLFFBQVE7U0FDekI7UUFFRCxhQUFhLEVBQUU7WUFDYixNQUFNLEVBQUUsVUFBVSxDQUFDLElBQUk7WUFDdkIsV0FBVyxFQUFFLFVBQUMsUUFBZ0IsSUFBSyxPQUFHLFFBQVEsOEJBQTJCLEVBQXRDLENBQXNDO1lBQ3pFLGVBQWUsRUFBRSxVQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsT0FBUSxJQUFLLE9BQUEsT0FBTyxDQUFDLGtCQUFrQixDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsRUFBNUMsQ0FBNEM7WUFDOUYsVUFBVSxFQUFFLHNCQUFzQjtZQUNsQyxhQUFhLEVBQUUsS0FBSztZQUNwQixZQUFZLEVBQUUsSUFBSTtZQUNsQixjQUFjLEVBQUUsVUFBVTtTQUMzQjtRQUVELEtBQUssRUFBRTtZQUNMLE1BQU0sRUFBRSxVQUFVLENBQUMsSUFBSTtZQUN2QixXQUFXLEVBQUUsY0FBTSxPQUFBLGVBQWUsRUFBZixDQUFlO1lBQ2xDLFVBQVUsRUFBRSxVQUFDLElBQUk7Z0JBQ2YsNEJBQ0ssSUFBSSxJQUNQLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLElBQ3ZDO1lBQ0osQ0FBQztZQUNELGFBQWEsRUFBRSxLQUFLO1lBQ3BCLFlBQVksRUFBRSxJQUFJO1lBQ2xCLGNBQWMsRUFBRSxRQUFRO1NBQ3pCO0tBQ0Y7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7QXBpUGFyYW1zS2V5cywgQXBpUGF5bG9hZCwgQXBpUmVxdWVzdE9wdGlvbnMsIEFwaVNlcnZlclR5cGUsIEh0dHBNZXRob2QsIEh0dHBSZXF1ZXN0UGF5bG9hZFR5cGV9IGZyb20gJ0Blci90eXBlcyc7XG5pbXBvcnQge0RhdGVVdGlscywgRXNVdGlsc30gZnJvbSAnQGVyL3V0aWxzJztcbmltcG9ydCAqIGFzIGVzYiBmcm9tICdlbGFzdGljLWJ1aWxkZXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIEVzSHR0cFJlc3BvbnNlIHtcbiAgX2luZGV4Pzogc3RyaW5nO1xuICBfdHlwZT86IHN0cmluZztcblxuICBba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cbmNvbnN0IHBhcmFtS2V5czogQXBpUGFyYW1zS2V5cyA9IHtcbiAgc29ydDogJ3NvcnQnLFxuICBmcm9tOiAnZnJvbScsXG4gIHNpemU6ICdzaXplJyxcbiAgb3JkZXI6ICdvcmRlcicsXG4gIHBhZ2U6ICdwYWdlJyxcbiAgdG86ICd0bycsXG4gIHE6ICdxJyxcbiAgcXVlcnk6ICdxdWVyeScsXG4gIGZpbHRlcjogJ2ZpbHRlcicsXG4gIGdsb2JhbEZpbGVyOiAnZ2xvYmFsRmlsZXInLFxuICBmaWVsZHM6ICdfc291cmNlJ1xufTtcblxuY29uc3QgcmVzcG9uc2VSZXNvbHZlciA9IHJlc3BvbnNlID0+IHtcbiAgaWYgKHJlc3BvbnNlKSB7XG4gICAgaWYgKHJlc3BvbnNlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIGlmIChyZXNwb25zZS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgcmVzcG9uc2UgPSByZXNwb25zZVswXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtzdWNjZXNzOiB0cnVlLCBjb250ZW50OiByZXNwb25zZX07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHtzdWNjZXNzOiBmYWxzZX07XG4gIH1cbn07XG5cbmNvbnN0IHVwZGF0ZVJlc3BvbnNlUmVzb2x2ZXIgPSByZXNwb25zZSA9PiB7XG4gIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnX2lkJykpIHtcbiAgICBjb25zdCBpZCA9IHJlc3BvbnNlWydfaWQnXTtcbiAgICBkZWxldGUgcmVzcG9uc2VbJ19pZCddO1xuICAgIHJldHVybiB7c3VjY2VzczogdHJ1ZSwgY29udGVudDoge2lkLCAuLi5yZXNwb25zZX19O1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB7ZmFpbHVyZTogdHJ1ZSwgbWVzc2FnZTogcmVzcG9uc2V9O1xuICB9XG59O1xuXG5jb25zdCBkZWxldGVSZXNwb25zZVJlc29sdmVyID0gcmVzcG9uc2UgPT5cbiAgcmVzcG9uc2UgJiYgcmVzcG9uc2UucmVzdWx0ID09PSAnZGVsZXRlZCdcbiAgICA/IHtzdWNjZXNzOiB0cnVlLCBjb250ZW50OiByZXNwb25zZX1cbiAgICA6IHtmYWlsdXJlOiB0cnVlLCBtZXNzYWdlOiByZXNwb25zZX07XG5cbmNvbnN0IHBhcnNlUmVzcG9uc2UgPSAocmVzcCkgPT4ge1xuICBjb25zdCByZXNwb25zZSA9IHt9O1xuICByZXNwb25zZVsnc3VjY2VzcyddID0gcmVzcC5oYXNPd25Qcm9wZXJ0eSgnaGl0cycpIHx8IHJlc3AuaGFzT3duUHJvcGVydHkoJ2FnZ3JlZ2F0aW9ucycpO1xuICBpZiAocmVzcG9uc2VbJ3N1Y2Nlc3MnXSkge1xuICAgIHJlc3BvbnNlWydjb250ZW50J10gPSB7XG4gICAgICB0b3RhbDogcmVzcFsnaGl0cyddLnRvdGFsLFxuICAgICAgaXRlbXM6IHJlc3BbJ2hpdHMnXS5oaXRzLm1hcChoaXQgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlkOiBoaXQuX2lkLFxuICAgICAgICAgIC8vIF9pbmRleDogaGl0Ll9pbmRleCxcbiAgICAgICAgICAvLyBfdHlwZTogaGl0Ll90eXBlLFxuICAgICAgICAgIC4uLmhpdFsnX3NvdXJjZSddXG4gICAgICAgIH07XG4gICAgICB9KVxuICAgIH07XG4gICAgaWYgKHJlc3AuYWdncmVnYXRpb25zKSB7XG4gICAgICByZXNwb25zZVsnY29udGVudCddWydhZ2dzJ10gPSByZXNwLmFnZ3JlZ2F0aW9ucztcbiAgICB9XG4gICAgaWYgKHJlc3AuaGlnaGxpZ2h0KSB7XG4gICAgICByZXNwb25zZVsnY29udGVudCddWydoaWdobGlnaHQnXSA9IHJlc3AuaGlnaGxpZ2h0O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXNwb25zZVsnZXJyb3InXSA9IHJlc3AuZXJyb3IgJiYgcmVzcC5lcnJvci5yZWFzb247XG4gIH1cbiAgcmV0dXJuIHJlc3BvbnNlO1xufTtcblxuY29uc3QgZ2V0QXBpRW50cnlXaXRoVHlwZSA9IChhcGlFbnRyeSkgPT4ge1xuICBpZiAoYXBpRW50cnkuaW5kZXhPZignLycpID09PSAtMSkge1xuICAgIGFwaUVudHJ5ID0gYCR7YXBpRW50cnl9L3R5cGVgO1xuICB9XG4gIHJldHVybiBhcGlFbnRyeTtcbn07XG5cbmNvbnN0IE1FVEFfREFUQV9GSUxURVJfUEFUSCA9ICdmaWx0ZXJfcGF0aD1oaXRzLmhpdHMuKixhZ2dyZWdhdGlvbnMuKic7XG5cbmV4cG9ydCBjb25zdCBFc1NlcnZlckFwaVJlcXVlc3RPcHRpb25zOiBBcGlSZXF1ZXN0T3B0aW9ucyA9IHtcblxuICBzZXJ2ZXJUeXBlOiBBcGlTZXJ2ZXJUeXBlLkVTLFxuXG4gIHBhcmFtc0tleXM6IHBhcmFtS2V5cyxcblxuICBhY3Rpb25zOiB7XG5cbiAgICBsb2dpbjoge1xuICAgICAgdXJpUmVzb2x2ZXI6ICd1c2VyJyxcbiAgICAgIG1ldGhvZDogSHR0cE1ldGhvZC5HRVQsXG4gICAgICBvblJlc3BvbnNlOiByZXNwb25zZVJlc29sdmVyLFxuICAgICAgbm90aWZ5U3VjY2VzczogdHJ1ZSxcbiAgICAgIHN1Y2Nlc3NNZXNzYWdlOiAn55m75b2V5oiQ5YqfJ1xuICAgIH0sXG5cbiAgICBsb2dvdXQ6IHtcbiAgICAgIHVyaVJlc29sdmVyOiAnbG9nb3V0JyxcbiAgICAgIG5vdGlmeVN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgb25SZXNwb25zZTogcmVzcG9uc2VSZXNvbHZlcixcbiAgICAgIHN1Y2Nlc3NNZXNzYWdlOiAn6YCA5Ye655m75b2V5oiQ5YqfJ1xuICAgIH0sXG5cbiAgICByZWdpc3Rlcjoge1xuICAgICAgdXJpUmVzb2x2ZXI6ICd1c2VyJyxcbiAgICAgIG1ldGhvZDogSHR0cE1ldGhvZC5QT1NULFxuICAgICAgbm90aWZ5U3VjY2VzczogdHJ1ZSxcbiAgICAgIHN1Y2Nlc3NNZXNzYWdlOiAn5rOo5YaM5oiQ5YqfJ1xuICAgIH0sXG5cbiAgICBnZXRCeUlkOiB7XG4gICAgICBtZXRob2Q6IEh0dHBNZXRob2QuUE9TVCxcbiAgICAgIHVyaVJlc29sdmVyOiAoYXBpRW50cnk6IHN0cmluZykgPT4gYCR7YXBpRW50cnl9L19zZWFyY2hgLFxuICAgICAgcGF5bG9hZFJlc29sdmVyOiAoYXBpRW50cnksIHBheWxvYWQ6IEFwaVBheWxvYWQpID0+IHtcbiAgICAgICAgY29uc3QgcXVlcnkgPSBlc2IucmVxdWVzdEJvZHlTZWFyY2goKS5xdWVyeShcbiAgICAgICAgICBlc2IuYm9vbFF1ZXJ5KCkubXVzdChlc2IudGVybVF1ZXJ5KCdfaWQnLCBwYXlsb2FkWydpZCddKSlcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHBheWxvYWQuZmllbGRzKSB7XG4gICAgICAgICAgcXVlcnkuc291cmNlKHBheWxvYWQuZmllbGRzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcXVlcnkudG9KU09OKCkgYXMge307XG4gICAgICB9LFxuICAgICAgb25SZXNwb25zZTogKHJlc3ApID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIGNvbnRlbnQ6IHBhcnNlUmVzcG9uc2UocmVzcClbJ2NvbnRlbnQnXVsnaXRlbXMnXVswXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRCeUlkczoge1xuICAgICAgbWV0aG9kOiBIdHRwTWV0aG9kLlBPU1QsXG4gICAgICB1cmlSZXNvbHZlcjogKGFwaUVudHJ5OiBzdHJpbmcpID0+IGAke2FwaUVudHJ5fS9fc2VhcmNoYCxcbiAgICAgIHBheWxvYWRSZXNvbHZlcjogKGFwaUVudHJ5LCBwYXlsb2FkOiBBcGlQYXlsb2FkKSA9PiB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gZXNiLnJlcXVlc3RCb2R5U2VhcmNoKCkucXVlcnkoXG4gICAgICAgICAgZXNiLmJvb2xRdWVyeSgpLm11c3QoZXNiLnRlcm1zUXVlcnkoJ19pZCcsIHBheWxvYWRbJ2lkJ10pKVxuICAgICAgICApO1xuICAgICAgICBpZiAocGF5bG9hZC5maWVsZHMpIHtcbiAgICAgICAgICBxdWVyeS5zb3VyY2UocGF5bG9hZC5maWVsZHMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBxdWVyeS50b0pTT04oKSBhcyB7fTtcbiAgICAgIH0sXG4gICAgICBvblJlc3BvbnNlOiAocmVzcCkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgY29udGVudDogcGFyc2VSZXNwb25zZShyZXNwKVsnY29udGVudCddWydpdGVtcyddXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSxcblxuICAgIGdldEJ5UXVlcnk6IHtcbiAgICAgIG1ldGhvZDogSHR0cE1ldGhvZC5QT1NULFxuICAgICAgcGF5bG9hZFR5cGU6IEh0dHBSZXF1ZXN0UGF5bG9hZFR5cGUuQk9EWSxcbiAgICAgIHVyaVJlc29sdmVyOiAoYXBpRW50cnk6IHN0cmluZykgPT4ge1xuICAgICAgICBpZiAoYXBpRW50cnkgJiYgYXBpRW50cnkudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdfbXNlYXJjaCcpID09PSAtMSkge1xuICAgICAgICAgIHJldHVybiBgJHthcGlFbnRyeX0vX3NlYXJjaGA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGFwaUVudHJ5O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcGF5bG9hZFJlc29sdmVyOiAoYXBpRW50cnksIHBheWxvYWQsIG9wdGlvbnM/KSA9PiB7XG4gICAgICAgIGNvbnN0IGJvZHkgPSBFc1V0aWxzLnJlc29sdmVSZXF1ZXN0Qm9keShwYXlsb2FkLCBvcHRpb25zKTtcbiAgICAgICAgaWYgKCFib2R5Wydzb3J0J10pIHtcbiAgICAgICAgICAvLyBib2R5Wydzb3J0J10gPSB7J3RpbWVzdGFtcCc6IE9yZGVyLkRFU0N9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBib2R5O1xuICAgICAgfSxcbiAgICAgIG9uUmVzcG9uc2U6IHJlc3AgPT4ge1xuICAgICAgICBpZiAocmVzcC5yZXNwb25zZXMpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgaXRlbXM6IHJlc3AucmVzcG9uc2VzLm1hcChyID0+IHBhcnNlUmVzcG9uc2UocikpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gcGFyc2VSZXNwb25zZShyZXNwKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBjcmVhdGU6IHtcbiAgICAgIG1ldGhvZDogSHR0cE1ldGhvZC5QT1NULFxuICAgICAgdXJpUmVzb2x2ZXI6IGFwaUVudHJ5ID0+IGAke2dldEFwaUVudHJ5V2l0aFR5cGUoYXBpRW50cnkpfT9yZWZyZXNoYCxcbiAgICAgIHBheWxvYWRSZXNvbHZlcjogKGFwaUVudHJ5OiBzdHJpbmcsIHBheWxvYWQ6IEFwaVBheWxvYWQpID0+IHtcbiAgICAgICAgZGVsZXRlIHBheWxvYWQuaWQ7XG4gICAgICAgIGRlbGV0ZSBwYXlsb2FkWydfaW5kZXgnXTtcbiAgICAgICAgZGVsZXRlIHBheWxvYWRbJ190eXBlJ107XG4gICAgICAgIHBheWxvYWRbJ19jcmVhdGVkVGltZSddID0gRGF0ZVV0aWxzLmdldEZvcm1hdHRlZERhdGVUaW1lKCk7XG4gICAgICAgIHJldHVybiBwYXlsb2FkO1xuICAgICAgfSxcbiAgICAgIG9uUmVzcG9uc2U6IHVwZGF0ZVJlc3BvbnNlUmVzb2x2ZXIsXG4gICAgICBub3RpZnlTdWNjZXNzOiBmYWxzZSxcbiAgICAgIGFsZXJ0U3VjY2VzczogdHJ1ZSxcbiAgICAgIHN1Y2Nlc3NNZXNzYWdlOiAn5pWw5o2u5L+d5a2Y5oiQ5YqfJ1xuICAgIH0sXG5cbiAgICB1cGRhdGVCeUlkOiB7XG4gICAgICBtZXRob2Q6IEh0dHBNZXRob2QuUE9TVCxcbiAgICAgIHBheWxvYWRUeXBlOiBIdHRwUmVxdWVzdFBheWxvYWRUeXBlLkJPRFksXG4gICAgICB1cmlSZXNvbHZlcjogKGFwaUVudHJ5OiBzdHJpbmcsIHBheWxvYWQ6IEFwaVBheWxvYWQpID0+IGAke2dldEFwaUVudHJ5V2l0aFR5cGUoYXBpRW50cnkpfS8ke3BheWxvYWQuaWR9L191cGRhdGU/cmVmcmVzaGAsXG4gICAgICBwYXlsb2FkUmVzb2x2ZXI6IChhcGlFbnRyeTogc3RyaW5nLCBwYXlsb2FkOiBBcGlQYXlsb2FkKSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc2NyaXB0OiB7XG4gICAgICAgICAgICBzb3VyY2U6IHBheWxvYWQuc2NyaXB0LFxuICAgICAgICAgICAgbGFuZzogJ3BhaW5sZXNzJyxcbiAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXNcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9LFxuICAgICAgb25SZXNwb25zZTogdXBkYXRlUmVzcG9uc2VSZXNvbHZlcixcbiAgICAgIG5vdGlmeVN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgYWxlcnRTdWNjZXNzOiB0cnVlLFxuICAgICAgc3VjY2Vzc01lc3NhZ2U6ICfmlbDmja7mm7TmlrDmiJDlip8nXG4gICAgfSxcblxuICAgIHBhdGNoQnlJZDoge1xuICAgICAgbWV0aG9kOiBIdHRwTWV0aG9kLlBPU1QsXG4gICAgICBwYXlsb2FkVHlwZTogSHR0cFJlcXVlc3RQYXlsb2FkVHlwZS5CT0RZLFxuICAgICAgdXJpUmVzb2x2ZXI6IChhcGlFbnRyeTogc3RyaW5nLCBwYXlsb2FkOiBBcGlQYXlsb2FkKSA9PiBgJHtnZXRBcGlFbnRyeVdpdGhUeXBlKGFwaUVudHJ5KX0vJHtwYXlsb2FkLmlkfS9fdXBkYXRlP3JlZnJlc2hgLFxuICAgICAgcGF5bG9hZFJlc29sdmVyOiAoYXBpRW50cnk6IHN0cmluZywgcGF5bG9hZDogQXBpUGF5bG9hZCwgb3B0aW9ucz8pID0+IHtcbiAgICAgICAgZGVsZXRlIHBheWxvYWQuaWQ7XG4gICAgICAgIGRlbGV0ZSBwYXlsb2FkWydfaW5kZXgnXTtcbiAgICAgICAgZGVsZXRlIHBheWxvYWRbJ190eXBlJ107XG4gICAgICAgIHBheWxvYWRbJ19tb2RpZmllZFRpbWUnXSA9IERhdGVVdGlscy5nZXRGb3JtYXR0ZWREYXRlVGltZSgpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRvYzogcGF5bG9hZFxuICAgICAgICB9O1xuICAgICAgfSxcbiAgICAgIG9uUmVzcG9uc2U6IHVwZGF0ZVJlc3BvbnNlUmVzb2x2ZXIsXG4gICAgICBub3RpZnlTdWNjZXNzOiBmYWxzZSxcbiAgICAgIGFsZXJ0U3VjY2VzczogdHJ1ZSxcbiAgICAgIHN1Y2Nlc3NNZXNzYWdlOiAn5pWw5o2u5pu05paw5oiQ5YqfJ1xuICAgIH0sXG5cbiAgICBkZWxldGVCeUlkOiB7XG4gICAgICBtZXRob2Q6IEh0dHBNZXRob2QuREVMRVRFLFxuICAgICAgdXJpUmVzb2x2ZXI6IChhcGlFbnRyeTogc3RyaW5nLCBwYXlsb2FkOiBBcGlQYXlsb2FkKSA9PiBgJHtnZXRBcGlFbnRyeVdpdGhUeXBlKGFwaUVudHJ5KX0vJHtwYXlsb2FkfT9yZWZyZXNoYCxcbiAgICAgIHBheWxvYWRSZXNvbHZlcjogKCkgPT4gdW5kZWZpbmVkLFxuICAgICAgb25SZXNwb25zZTogZGVsZXRlUmVzcG9uc2VSZXNvbHZlcixcbiAgICAgIG5vdGlmeVN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgYWxlcnRTdWNjZXNzOiBmYWxzZSxcbiAgICAgIHN1Y2Nlc3NNZXNzYWdlOiAn5pWw5o2u5Yig6Zmk5oiQ5YqfJ1xuICAgIH0sXG5cbiAgICBkZWxldGVCeVF1ZXJ5OiB7XG4gICAgICBtZXRob2Q6IEh0dHBNZXRob2QuUE9TVCxcbiAgICAgIHVyaVJlc29sdmVyOiAoYXBpRW50cnk6IHN0cmluZykgPT4gYCR7YXBpRW50cnl9L19kZWxldGVfYnlfcXVlcnk/cmVmcmVzaGAsXG4gICAgICBwYXlsb2FkUmVzb2x2ZXI6IChhcGlFbnRyeSwgcGF5bG9hZCwgb3B0aW9ucz8pID0+IEVzVXRpbHMucmVzb2x2ZVJlcXVlc3RCb2R5KHBheWxvYWQsIG9wdGlvbnMpLFxuICAgICAgb25SZXNwb25zZTogZGVsZXRlUmVzcG9uc2VSZXNvbHZlcixcbiAgICAgIG5vdGlmeVN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgYWxlcnRTdWNjZXNzOiB0cnVlLFxuICAgICAgc3VjY2Vzc01lc3NhZ2U6ICfmibnph4/mlbDmja7liKDpmaTmiJDlip8nXG4gICAgfSxcblxuICAgIGJhdGNoOiB7XG4gICAgICBtZXRob2Q6IEh0dHBNZXRob2QuUE9TVCxcbiAgICAgIHVyaVJlc29sdmVyOiAoKSA9PiBgX2J1bGs/cmVmcmVzaGAsXG4gICAgICBvblJlc3BvbnNlOiAocmVzcCkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnJlc3AsXG4gICAgICAgICAgc3VjY2VzczogIXJlc3AuaGFzT3duUHJvcGVydHkoJ2Vycm9ycycpXG4gICAgICAgIH07XG4gICAgICB9LFxuICAgICAgbm90aWZ5U3VjY2VzczogZmFsc2UsXG4gICAgICBhbGVydFN1Y2Nlc3M6IHRydWUsXG4gICAgICBzdWNjZXNzTWVzc2FnZTogJ+aJuemHj+aTjeS9nOaIkOWKnydcbiAgICB9XG4gIH1cbn07XG4iXX0=