!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@er/core"),require("@angular/core"),require("ng2-img-max"),require("rxjs"),require("ng2-img-max/dist/src/ng2-img-max.service")):"function"==typeof define&&define.amd?define("@er/share",["exports","@er/core","@angular/core","ng2-img-max","rxjs","ng2-img-max/dist/src/ng2-img-max.service"],r):r((e.er=e.er||{},e.er.share={}),e.core,e.ng.core,e.ng2ImgMax,e.rxjs,e.i1)}(this,function(e,r,t,n,I,i){"use strict";var o=function(){function e(){}return e.decorators=[{type:t.Component,args:[{selector:"er-image-editor",template:""}]}],e}(),a=function(){function e(e){this.ng2ImgMaxService=e}return e.prototype.cropImage=function(n,i,o,a,c){var g=this;void 0===a&&(a=0),void 0===c&&(c=0);var s=new I.Subject;if("image/jpeg"!==n.type&&"image/png"!==n.type)return setTimeout(function(){s.error({croppedFile:n,reason:"File provided is neither of type jpg nor of type png.",error:"INVALID_EXTENSION"})},0),s.asObservable();var u=document.createElement("canvas"),p=u.getContext("2d"),f=new Image;return f.onload=function(){g.ng2ImgMaxService.getEXIFOrientedImage(f).then(function(e){window.URL.revokeObjectURL(f.src),u.width=i,u.height=o,p.drawImage(e,a,c,i,o,0,0,i,o);var r=p.getImageData(0,0,e.width,e.height),t=!0;("image/jpeg"===n.type||"image/png"===n.type&&!g.isImgUsingAlpha(r))&&(t=!1,(p=u.getContext("2d",{alpha:!1})).drawImage(e,a,c,i,o,0,0,i,o)),u.toBlob(function(e){var r=g.generateResultFile(e,n.name,n.type,(new Date).getTime());s.next(r)},t?"image/png":"image/jpeg")})},f.src=window.URL.createObjectURL(n),s.asObservable()},e.prototype.isImgUsingAlpha=function(e){for(var r=0;r<e.data.length;r+=4)if(255!==e.data[r+3])return!0;return!1},e.prototype.generateResultFile=function(e,r,t,n){var i=new Blob([e],{type:t});return this.blobToFile(i,r,n)},e.prototype.blobToFile=function(e,r,t){var n=e;return n.name=r,n.lastModified=t,n},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:n.Ng2ImgMaxService,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return n.Ng2ImgMaxService})]}]}]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e(t.inject(i.Ng2ImgMaxService))},token:e,providedIn:"root"}),e}(),c=function(){function e(e,r){this.ng2ImgMaxService=e,this.imgCropService=r}return e.prototype.resizeExactFill=function(p,f,m,d){var v=this,l=new I.Subject;if("image/jpeg"!==p.type&&"image/png"!==p.type)return setTimeout(function(){l.error({resizedFile:p,reason:"File provided is neither of type jpg nor of type png.",error:"INVALID_EXTENSION"})},0),l.asObservable();var t=new Image;return t.onload=function(){v.ng2ImgMaxService.getEXIFOrientedImage(t).then(function(g){window.URL.revokeObjectURL(t.src);var e=g.width/g.height,r=f/m,s=1e5,u=1e5;r<e?u=f:e<=r&&(s=m),v.ng2ImgMaxService.resize([p],u,s).subscribe(function(e){var t=0,n=0;if(1e5===u){var r=g.width/(g.height/m);t=(r-f)/2}else if(1e5===s){var i=g.height/(g.width/f);n=(i-m)/2}var o=new Image,a=document.createElement("canvas"),c=a.getContext("2d");o.onload=function(){a.width=f,a.height=m,d&&(c.fillStyle=d,c.fillRect(0,0,f,m)),c.drawImage(o,t,n,f,m,0,0,f,m);var e=c.getImageData(0,0,f,m),r=!0;("image/jpeg"===p.type||"image/png"===p.type&&!v.isImgUsingAlpha(e))&&(r=!1,c=a.getContext("2d",{alpha:!1}),d&&(c.fillStyle=d,c.fillRect(0,0,f,m)),c.drawImage(o,t,n,f,m,0,0,f,m)),a.toBlob(function(e){window.URL.revokeObjectURL(o.src);var r=v.generateResultFile(e,p.name,p.type,(new Date).getTime());l.next(r)},r?"image/png":"image/jpeg")},o.src=window.URL.createObjectURL(e)},function(e){l.error(e)})})},t.src=window.URL.createObjectURL(p),l.asObservable()},e.prototype.resizeExactCrop=function(t,g,s){var u=this,p=new I.Subject;if("image/jpeg"!==t.type&&"image/png"!==t.type)return setTimeout(function(){p.error({resizedFile:t,reason:"File provided is neither of type jpg nor of type png.",error:"INVALID_EXTENSION"})},0),p.asObservable();var f=new Image;return f.onload=function(){u.ng2ImgMaxService.getEXIFOrientedImage(f).then(function(n){window.URL.revokeObjectURL(f.src);var e=n.width/n.height,r=g/s,i=1e5,o=1e5,a=0,c=0;r<e?i=s:e<=r&&(o=g),u.ng2ImgMaxService.resize([t],o,i).subscribe(function(e){if(1e5===o){var r=n.width/(n.height/s);a=(r-g)/2}else if(1e5===i){var t=n.height/(n.width/g);c=(t-s)/2}u.imgCropService.cropImage(e,g,s,a,c).subscribe(function(e){p.next(e)},function(e){p.error(e)})},function(e){p.error(e)})})},f.src=window.URL.createObjectURL(t),p.asObservable()},e.prototype.isImgUsingAlpha=function(e){for(var r=0;r<e.data.length;r+=4)if(255!==e.data[r+3])return!0;return!1},e.prototype.generateResultFile=function(e,r,t,n){var i=new Blob([e],{type:t});return this.blobToFile(i,r,n)},e.prototype.blobToFile=function(e,r,t){var n=e;return n.name=r,n.lastModified=t,n},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:n.Ng2ImgMaxService,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return n.Ng2ImgMaxService})]}]},{type:a,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return a})]}]}]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e(t.inject(i.Ng2ImgMaxService),t.inject(a))},token:e,providedIn:"root"}),e}(),g=function(){function e(e,r,t){this.imgResizeExactService=e,this.ng2ImgMaxService=r,this.imgCropService=t}return e.prototype.compress=function(e,r,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.ng2ImgMaxService.compress(e,r,t,n)},e.prototype.resize=function(e,r,t,n){return void 0===n&&(n=!1),this.ng2ImgMaxService.resize(e,r,t,n)},e.prototype.crop=function(e,r,t,n,i){var o=this;void 0===n&&(n=0),void 0===i&&(i=0);var a=new I.Subject;return e.forEach(function(e){o.cropImage(e,r,t,n,i).subscribe(function(e){a.next(e)},function(e){a.error(e)})}),a.asObservable()},e.prototype.resizeExactCrop=function(e,r,t){var n=this,i=new I.Subject;return e.forEach(function(e){n.resizeExactCropImage(e,r,t).subscribe(function(e){i.next(e)},function(e){i.error(e)})}),i.asObservable()},e.prototype.resizeExactFill=function(e,r,t,n){var i=this,o=new I.Subject;return e.forEach(function(e){i.resizeExactFillImage(e,r,t,n).subscribe(function(e){o.next(e)},function(e){o.error(e)})}),o.asObservable()},e.prototype.resizeExactFillImage=function(e,r,t,n){return this.imgResizeExactService.resizeExactFill(e,r,t,n)},e.prototype.resizeExactCropImage=function(e,r,t){return this.imgResizeExactService.resizeExactCrop(e,r,t)},e.prototype.cropImage=function(e,r,t,n,i){return void 0===n&&(n=0),void 0===i&&(i=0),this.imgCropService.cropImage(e,r,t,n,i)},e.prototype.compressImage=function(e,r,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.ng2ImgMaxService.compressImage(e,r,t,n)},e.prototype.resizeImage=function(e,r,t,n){return void 0===n&&(n=!1),this.ng2ImgMaxService.resizeImage(e,r,t,n)},e.prototype.getEXIFOrientedImage=function(e){return this.ng2ImgMaxService.getEXIFOrientedImage(e)},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:c,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return c})]}]},{type:n.Ng2ImgMaxService,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return n.Ng2ImgMaxService})]}]},{type:a,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return a})]}]}]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e(t.inject(c),t.inject(i.Ng2ImgMaxService),t.inject(a))},token:e,providedIn:"root"}),e}(),s=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[r.ErCoreModule,n.Ng2ImgMaxModule],declarations:[o],providers:[{provide:c,useClass:c},{provide:a,useClass:a},{provide:g,useClass:g},{provide:n.Ng2ImgMaxService,useClass:n.Ng2ImgMaxService}],exports:[o]}]}],e}();e.ImageToolsService=g,e.ImgCropService=a,e.ImgResizeExactService=c,e.ErImageEditorModule=s,e.Éµa=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=er-share.umd.min.js.map