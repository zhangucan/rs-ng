/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { animate, state, style, transition, trigger } from '@angular/animations';
import { ChangeDetectionStrategy, Component, Input } from '@angular/core';
import { PngAdminWorkSpaceComponent } from '../../component';
import { WorkSpaceMainMenuComponent } from '../component';
var WorkSpaceSubMenuComponent = /** @class */ (function () {
    function WorkSpaceSubMenuComponent(ws, wsMenu) {
        this.ws = ws;
        this.wsMenu = wsMenu;
    }
    Object.defineProperty(WorkSpaceSubMenuComponent.prototype, "reset", {
        get: /**
         * @return {?}
         */
        function () {
            return this._reset;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._reset = val;
            if (this._reset && (this.ws.isHorizontal() || this.ws.isSlim())) {
                this.activeIndex = null;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WorkSpaceSubMenuComponent.prototype, "parentActive", {
        get: /**
         * @return {?}
         */
        function () {
            return this._parentActive;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._parentActive = val;
            if (!this._parentActive) {
                this.activeIndex = null;
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} event
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    WorkSpaceSubMenuComponent.prototype.itemClick = /**
     * @param {?} event
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    function (event, item, index) {
        var _this = this;
        if (this.root) {
            this.ws.menuHoverActive = !this.ws.menuHoverActive;
        }
        // avoid processing disabled items
        if (item.disabled) {
            event.preventDefault();
            return true;
        }
        // activate current item and deactivate active sibling if any
        this.activeIndex = (this.activeIndex === index) ? null : index;
        // execute command
        if (item.command) {
            item.command({ originalEvent: event, item: item, menu: this.wsMenu, ws: this.ws });
        }
        // prevent hash change
        if (item.items || (!item.url && !item.routerLink)) {
            setTimeout(function () {
                _this.ws.layoutMenuScrollerViewChild.moveBar();
            }, 450);
            event.preventDefault();
        }
        // hide menu
        if (!item.items) {
            if (this.ws.isHorizontal() || this.ws.isSlim()) {
                this.ws.resetMenu = true;
            }
            else {
                this.ws.resetMenu = false;
            }
            this.ws.overlayMenuActive = false;
            this.ws.staticMenuMobileActive = false;
            this.ws.menuHoverActive = !this.ws.menuHoverActive;
        }
    };
    /**
     * @param {?} index
     * @return {?}
     */
    WorkSpaceSubMenuComponent.prototype.onMouseEnter = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        if (this.root && this.ws.menuHoverActive && (this.ws.isHorizontal() || this.ws.isSlim())
            && !this.ws.isMobile() && !this.ws.isTablet()) {
            this.activeIndex = index;
        }
    };
    /**
     * @param {?} index
     * @return {?}
     */
    WorkSpaceSubMenuComponent.prototype.isActive = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        return this.activeIndex === index;
    };
    WorkSpaceSubMenuComponent.decorators = [
        { type: Component, args: [{
                    selector: '[png-ws-sub-menu]',
                    template: "<ng-template ngFor let-child let-i=\"index\" [ngForOf]=\"(root ? item : item.items)\">\n  <li [ngClass]=\"{'active-menuitem': isActive(i)}\" [class]=\"child.badgeStyleClass\"\n      *ngIf=\"child.visible === false ? false : true\">\n    <a [href]=\"child.url||'#'\" (click)=\"itemClick($event,child,i)\" (mouseenter)=\"onMouseEnter(i)\"\n       class=\"ripplelink\" *ngIf=\"!child.routerLink\"\n       [attr.tabindex]=\"!visible ? '-1' : null\" [attr.target]=\"child.target\">\n      <i [ngClass]=\"child.icon\"></i><span>{{child.label}}</span>\n      <i class=\"fa fa-fw fa-angle-down menuitem-toggle-icon\" *ngIf=\"child.items\"></i>\n      <span class=\"menuitem-badge\" *ngIf=\"child.badge\">{{child.badge}}</span>\n    </a>\n\n    <a (click)=\"itemClick($event,child,i)\" (mouseenter)=\"onMouseEnter(i)\" class=\"ripplelink\" *ngIf=\"child.routerLink\"\n       [routerLink]=\"child.routerLink\" routerLinkActive=\"active-menuitem-routerlink\"\n       [routerLinkActiveOptions]=\"{exact: true}\" [attr.tabindex]=\"!visible ? '-1' : null\" [attr.target]=\"child.target\">\n      <i [ngClass]=\"child.icon\"></i><span>{{child.label}}</span>\n      <i class=\"fa fa-fw fa-angle-down menuitem-toggle-icon\" *ngIf=\"child.items\"></i>\n      <span class=\"menuitem-badge\" *ngIf=\"child.badge\">{{child.badge}}</span>\n    </a>\n    <div class=\"layout-menu-tooltip\">\n      <div class=\"layout-menu-tooltip-arrow\"></div>\n      <div class=\"layout-menu-tooltip-text\">{{child.label}}</div>\n    </div>\n    <div class=\"submenu-arrow\" *ngIf=\"child.items\"></div>\n    <ul png-ws-sub-menu [item]=\"child\" *ngIf=\"child.items\" [visible]=\"isActive(i)\" [reset]=\"reset\"\n        [parentActive]=\"isActive(i)\"\n        [@children]=\"(ws.isSlim()||ws.isHorizontal())&&root ? isActive(i) ?\n                     'visible' : 'hidden' : isActive(i) ? 'visibleAnimated' : 'hiddenAnimated'\"></ul>\n  </li>\n</ng-template>",
                    animations: [
                        trigger('children', [
                            state('hiddenAnimated', style({
                                height: '0px'
                            })),
                            state('visibleAnimated', style({
                                height: '*'
                            })),
                            state('visible', style({
                                display: 'block'
                            })),
                            state('hidden', style({
                                display: 'none'
                            })),
                            transition('visibleAnimated => hiddenAnimated', animate('400ms cubic-bezier(0.86, 0, 0.07, 1)')),
                            transition('hiddenAnimated => visibleAnimated', animate('400ms cubic-bezier(0.86, 0, 0.07, 1)'))
                        ])
                    ],
                    changeDetection: ChangeDetectionStrategy.OnPush
                }] }
    ];
    /** @nocollapse */
    WorkSpaceSubMenuComponent.ctorParameters = function () { return [
        { type: PngAdminWorkSpaceComponent },
        { type: WorkSpaceMainMenuComponent }
    ]; };
    WorkSpaceSubMenuComponent.propDecorators = {
        item: [{ type: Input }],
        root: [{ type: Input }],
        visible: [{ type: Input }],
        reset: [{ type: Input }],
        parentActive: [{ type: Input }]
    };
    return WorkSpaceSubMenuComponent;
}());
export { WorkSpaceSubMenuComponent };
if (false) {
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype.item;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype.root;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype.visible;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype.activeIndex;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype._reset;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype._parentActive;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype.ws;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype.wsMenu;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL3ByaW1lbmcvIiwic291cmNlcyI6WyJsaWIvd29yay1zcGFjZS9tZW51L3N1Yi1tZW51L2NvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUMvRSxPQUFPLEVBQUMsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUV4RSxPQUFPLEVBQUMsMEJBQTBCLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUMzRCxPQUFPLEVBQUMsMEJBQTBCLEVBQUMsTUFBTSxjQUFjLENBQUM7QUFHeEQ7SUFpQ0UsbUNBQW1CLEVBQThCLEVBQVMsTUFBa0M7UUFBekUsT0FBRSxHQUFGLEVBQUUsQ0FBNEI7UUFBUyxXQUFNLEdBQU4sTUFBTSxDQUE0QjtJQUM1RixDQUFDO0lBSUQsc0JBQWEsNENBQUs7Ozs7UUFBbEI7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDckIsQ0FBQzs7Ozs7UUFFRCxVQUFVLEdBQVk7WUFDcEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUM7WUFFbEIsSUFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUU7Z0JBQy9ELElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO2FBQ3pCO1FBQ0gsQ0FBQzs7O09BUkE7SUFZRCxzQkFBYSxtREFBWTs7OztRQUF6QjtZQUNFLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQztRQUM1QixDQUFDOzs7OztRQUVELFVBQWlCLEdBQVk7WUFDM0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxHQUFHLENBQUM7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QUFFO3dCQUNWLE9BQU8sQ0FBQyxVQUFVLEVBQUU7NEJBQ2xCLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRSxLQUFLLENBQUM7Z0NBQzVCLE1BQU0sRUFBRSxLQUFLOzZCQUNkLENBQUMsQ0FBQzs0QkFDSCxLQUFLLENBQUMsaUJBQWlCLEVBQUUsS0FBSyxDQUFDO2dDQUM3QixNQUFNLEVBQUUsR0FBRzs2QkFDWixDQUFDLENBQUM7NEJBQ0gsS0FBSyxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUM7Z0NBQ3JCLE9BQU8sRUFBRSxPQUFPOzZCQUNqQixDQUFDLENBQUM7NEJBQ0gsS0FBSyxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUM7Z0NBQ3BCLE9BQU8sRUFBRSxNQUFNOzZCQUNoQixDQUFDLENBQUM7NEJBQ0gsVUFBVSxDQUFDLG1DQUFtQyxFQUFFLE9BQU8sQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDOzRCQUNoRyxVQUFVLENBQUMsbUNBQW1DLEVBQUUsT0FBTyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7eUJBQ2pHLENBQUM7cUJBQ0g7b0JBQ0QsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07aUJBQ2hEOzs7O2dCQTFCTywwQkFBMEI7Z0JBQzFCLDBCQUEwQjs7O3VCQTRCL0IsS0FBSzt1QkFFTCxLQUFLOzBCQUVMLEtBQUs7d0JBU0wsS0FBSzsrQkFjTCxLQUFLOztJQStEUixnQ0FBQztDQUFBLEFBbkhELElBbUhDO1NBNUZZLHlCQUF5Qjs7O0lBRXBDLHlDQUF3Qjs7SUFFeEIseUNBQXVCOztJQUV2Qiw0Q0FBMEI7O0lBRTFCLGdEQUFvQjs7SUFLcEIsMkNBQWdCOztJQWNoQixrREFBdUI7O0lBakJYLHVDQUFxQzs7SUFBRSwyQ0FBeUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2FuaW1hdGUsIHN0YXRlLCBzdHlsZSwgdHJhbnNpdGlvbiwgdHJpZ2dlcn0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQge0NoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIElucHV0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7TWVudUl0ZW19IGZyb20gJ3ByaW1lbmcvcHJpbWVuZyc7XG5pbXBvcnQge1BuZ0FkbWluV29ya1NwYWNlQ29tcG9uZW50fSBmcm9tICcuLi8uLi9jb21wb25lbnQnO1xuaW1wb3J0IHtXb3JrU3BhY2VNYWluTWVudUNvbXBvbmVudH0gZnJvbSAnLi4vY29tcG9uZW50JztcblxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdbcG5nLXdzLXN1Yi1tZW51XScsXG4gIHRlbXBsYXRlVXJsOiAndHBsLmh0bWwnLFxuICBhbmltYXRpb25zOiBbXG4gICAgdHJpZ2dlcignY2hpbGRyZW4nLCBbXG4gICAgICBzdGF0ZSgnaGlkZGVuQW5pbWF0ZWQnLCBzdHlsZSh7XG4gICAgICAgIGhlaWdodDogJzBweCdcbiAgICAgIH0pKSxcbiAgICAgIHN0YXRlKCd2aXNpYmxlQW5pbWF0ZWQnLCBzdHlsZSh7XG4gICAgICAgIGhlaWdodDogJyonXG4gICAgICB9KSksXG4gICAgICBzdGF0ZSgndmlzaWJsZScsIHN0eWxlKHtcbiAgICAgICAgZGlzcGxheTogJ2Jsb2NrJ1xuICAgICAgfSkpLFxuICAgICAgc3RhdGUoJ2hpZGRlbicsIHN0eWxlKHtcbiAgICAgICAgZGlzcGxheTogJ25vbmUnXG4gICAgICB9KSksXG4gICAgICB0cmFuc2l0aW9uKCd2aXNpYmxlQW5pbWF0ZWQgPT4gaGlkZGVuQW5pbWF0ZWQnLCBhbmltYXRlKCc0MDBtcyBjdWJpYy1iZXppZXIoMC44NiwgMCwgMC4wNywgMSknKSksXG4gICAgICB0cmFuc2l0aW9uKCdoaWRkZW5BbmltYXRlZCA9PiB2aXNpYmxlQW5pbWF0ZWQnLCBhbmltYXRlKCc0MDBtcyBjdWJpYy1iZXppZXIoMC44NiwgMCwgMC4wNywgMSknKSlcbiAgICBdKVxuICBdLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBXb3JrU3BhY2VTdWJNZW51Q29tcG9uZW50IHtcblxuICBASW5wdXQoKSBpdGVtOiBNZW51SXRlbTtcblxuICBASW5wdXQoKSByb290OiBib29sZWFuO1xuXG4gIEBJbnB1dCgpIHZpc2libGU6IGJvb2xlYW47XG5cbiAgYWN0aXZlSW5kZXg6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgd3M6IFBuZ0FkbWluV29ya1NwYWNlQ29tcG9uZW50LCBwdWJsaWMgd3NNZW51OiBXb3JrU3BhY2VNYWluTWVudUNvbXBvbmVudCkge1xuICB9XG5cbiAgX3Jlc2V0OiBib29sZWFuO1xuXG4gIEBJbnB1dCgpIGdldCByZXNldCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fcmVzZXQ7XG4gIH1cblxuICBzZXQgcmVzZXQodmFsOiBib29sZWFuKSB7XG4gICAgdGhpcy5fcmVzZXQgPSB2YWw7XG5cbiAgICBpZiAodGhpcy5fcmVzZXQgJiYgKHRoaXMud3MuaXNIb3Jpem9udGFsKCkgfHwgdGhpcy53cy5pc1NsaW0oKSkpIHtcbiAgICAgIHRoaXMuYWN0aXZlSW5kZXggPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIF9wYXJlbnRBY3RpdmU6IGJvb2xlYW47XG5cbiAgQElucHV0KCkgZ2V0IHBhcmVudEFjdGl2ZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fcGFyZW50QWN0aXZlO1xuICB9XG5cbiAgc2V0IHBhcmVudEFjdGl2ZSh2YWw6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9wYXJlbnRBY3RpdmUgPSB2YWw7XG5cbiAgICBpZiAoIXRoaXMuX3BhcmVudEFjdGl2ZSkge1xuICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgaXRlbUNsaWNrKGV2ZW50OiBFdmVudCwgaXRlbTogTWVudUl0ZW0sIGluZGV4OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5yb290KSB7XG4gICAgICB0aGlzLndzLm1lbnVIb3ZlckFjdGl2ZSA9ICF0aGlzLndzLm1lbnVIb3ZlckFjdGl2ZTtcbiAgICB9XG5cbiAgICAvLyBhdm9pZCBwcm9jZXNzaW5nIGRpc2FibGVkIGl0ZW1zXG4gICAgaWYgKGl0ZW0uZGlzYWJsZWQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBhY3RpdmF0ZSBjdXJyZW50IGl0ZW0gYW5kIGRlYWN0aXZhdGUgYWN0aXZlIHNpYmxpbmcgaWYgYW55XG4gICAgdGhpcy5hY3RpdmVJbmRleCA9ICh0aGlzLmFjdGl2ZUluZGV4ID09PSBpbmRleCkgPyBudWxsIDogaW5kZXg7XG5cbiAgICAvLyBleGVjdXRlIGNvbW1hbmRcbiAgICBpZiAoaXRlbS5jb21tYW5kKSB7XG4gICAgICBpdGVtLmNvbW1hbmQoe29yaWdpbmFsRXZlbnQ6IGV2ZW50LCBpdGVtOiBpdGVtLCBtZW51OiB0aGlzLndzTWVudSwgd3M6IHRoaXMud3N9KTtcbiAgICB9XG5cbiAgICAvLyBwcmV2ZW50IGhhc2ggY2hhbmdlXG4gICAgaWYgKGl0ZW0uaXRlbXMgfHwgKCFpdGVtLnVybCAmJiAhaXRlbS5yb3V0ZXJMaW5rKSkge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMud3MubGF5b3V0TWVudVNjcm9sbGVyVmlld0NoaWxkLm1vdmVCYXIoKTtcbiAgICAgIH0sIDQ1MCk7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cblxuICAgIC8vIGhpZGUgbWVudVxuICAgIGlmICghaXRlbS5pdGVtcykge1xuICAgICAgaWYgKHRoaXMud3MuaXNIb3Jpem9udGFsKCkgfHwgdGhpcy53cy5pc1NsaW0oKSkge1xuICAgICAgICB0aGlzLndzLnJlc2V0TWVudSA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLndzLnJlc2V0TWVudSA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLndzLm92ZXJsYXlNZW51QWN0aXZlID0gZmFsc2U7XG4gICAgICB0aGlzLndzLnN0YXRpY01lbnVNb2JpbGVBY3RpdmUgPSBmYWxzZTtcbiAgICAgIHRoaXMud3MubWVudUhvdmVyQWN0aXZlID0gIXRoaXMud3MubWVudUhvdmVyQWN0aXZlO1xuICAgIH1cbiAgfVxuXG4gIG9uTW91c2VFbnRlcihpbmRleDogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMucm9vdCAmJiB0aGlzLndzLm1lbnVIb3ZlckFjdGl2ZSAmJiAodGhpcy53cy5pc0hvcml6b250YWwoKSB8fCB0aGlzLndzLmlzU2xpbSgpKVxuICAgICAgJiYgIXRoaXMud3MuaXNNb2JpbGUoKSAmJiAhdGhpcy53cy5pc1RhYmxldCgpKSB7XG4gICAgICB0aGlzLmFjdGl2ZUluZGV4ID0gaW5kZXg7XG4gICAgfVxuICB9XG5cbiAgaXNBY3RpdmUoaW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmFjdGl2ZUluZGV4ID09PSBpbmRleDtcbiAgfVxufVxuIl19