/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, forwardRef, Output, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { DataAwareControlWrapperComponent, HTTP_TAG_STATE$ } from '@er/core';
import { CommonsUtils, DataItemUtils, PinyinUtil, RegUtils, StatesUtils, TreeUtils } from '@er/utils';
import { Tree } from 'primeng/tree';
import { DEFAULT_PNG_TREE_PROPS, PNG_TREE_NODE_KEYS } from './types';
export { PNG_TREE_NODE_KEYS } from './types';
var PngTreeComponent = /** @class */ (function (_super) {
    tslib_1.__extends(PngTreeComponent, _super);
    function PngTreeComponent(cd) {
        var _this = _super.call(this) || this;
        _this.cd = cd;
        _this.templateNames = {
            icon: 'icon',
            node: 'node'
        };
        _this.onEmptyNode = new EventEmitter();
        _this.onLazyLoad = new EventEmitter();
        _this.$defaultProps = DEFAULT_PNG_TREE_PROPS;
        _this.modelFormatter = _this.formatModel;
        _this.valueParser = _this.parseValue;
        return _this;
    }
    Object.defineProperty(PngTreeComponent.prototype, "selection", {
        get: /**
         * @return {?}
         */
        function () {
            return this._selection;
        },
        set: /**
         * @param {?} selection
         * @return {?}
         */
        function (selection) {
            this._selection = selection;
            this.value = selection;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PngTreeComponent.prototype.onPropsInit = /**
     * @return {?}
     */
    function () {
        this.filtered = false;
        this.loading$ = HTTP_TAG_STATE$(this.$props.$id);
        if (this.$props.$ext.dataItems) {
            this.data$.next(this.$props.$ext.dataItems);
        }
        StatesUtils.create(this.$props.$id, {
            component: this
        }, true);
    };
    /**
     * @return {?}
     */
    PngTreeComponent.prototype.load = /**
     * @return {?}
     */
    function () {
        this.apiDataProps = tslib_1.__assign({}, this.apiDataProps);
        this.cd.markForCheck();
    };
    /**
     * @param {?} model
     * @return {?}
     */
    PngTreeComponent.prototype.formatModel = /**
     * @param {?} model
     * @return {?}
     */
    function (model) {
        if (model) {
            this.selectedNodeValues = model;
        }
        return model;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    PngTreeComponent.prototype.parseValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        /** @type {?} */
        var selectedNodeValues;
        if (CommonsUtils.isArray(value)) {
            selectedNodeValues = CommonsUtils.flattenDeep(value).map(function (node) { return _this.getSelectedNodeValues(node); });
        }
        else if (CommonsUtils.isJson(value)) {
            selectedNodeValues = this.getSelectedNodeValues(value);
        }
        selectedNodeValues = CommonsUtils.flatten(selectedNodeValues);
        selectedNodeValues = CommonsUtils.unique(selectedNodeValues, this.$props.$ext.dataItemProps.idKey);
        selectedNodeValues = CommonsUtils.orderBy(selectedNodeValues, this.$props.$ext.dataItemProps.idKey, 'asc');
        if (this.$props && this.$props.$id) {
            StatesUtils.update(this.$props.$id, {
                selectedNodeValues: selectedNodeValues
            });
        }
        this.selectedNodeValues = selectedNodeValues;
        return selectedNodeValues;
    };
    /**
     * @return {?}
     */
    PngTreeComponent.prototype.expandAll = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.data$.value.forEach(function (node) {
            TreeUtils.expandNode(node, true, _this.$props.$ext);
        });
    };
    /**
     * @return {?}
     */
    PngTreeComponent.prototype.collapseAll = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.data$.value.forEach(function (node) {
            TreeUtils.expandNode(node, false, _this.$props.$ext);
        });
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngTreeComponent.prototype.filter = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var data = this.applyFilter(event.target.value);
        this.data$.next(data);
        this.filtered = true;
        this.expandAll();
        //  this.cd.detectChanges();
    };
    /**
     * @param {?} filterValue
     * @return {?}
     */
    PngTreeComponent.prototype.applyFilter = /**
     * @param {?} filterValue
     * @return {?}
     */
    function (filterValue) {
        var _this = this;
        if (!filterValue) {
            this.clearFilter();
            return this.unFilteredValue;
        }
        else {
            filterValue = filterValue.toLowerCase();
            return TreeUtils.filter(this.unFilteredValue, function (node) {
                /** @type {?} */
                var py = node['$py'];
                if (!py) {
                    py = PinyinUtil.getFirstLetter(node.label);
                    node['$py'] = py;
                }
                /** @type {?} */
                var idKey = _this.$props.$ext.dataItemProps && _this.$props.$ext.dataItemProps.idKey;
                /** @type {?} */
                var sVal = ((node.data && node.data[idKey]) || '') + '';
                /** @type {?} */
                var sLab = node.label || '';
                if (/^\w+$/.test(filterValue)) {
                    return sLab.startsWith(filterValue) || sVal.startsWith(filterValue) || py.startsWith(filterValue);
                }
                else {
                    return RegUtils.test(sVal, filterValue) || RegUtils.test(py, filterValue);
                }
            });
        }
    };
    /**
     * @return {?}
     */
    PngTreeComponent.prototype.clearFilter = /**
     * @return {?}
     */
    function () {
        this.filterValue = '';
        this.data$.next(tslib_1.__spread(this.unFilteredValue));
        this.filtered = false;
    };
    /**
     * @param {?} node
     * @return {?}
     */
    PngTreeComponent.prototype.getSelectedNodeValues = /**
     * @param {?} node
     * @return {?}
     */
    function (node) {
        /** @type {?} */
        var value = this.getSelectedNodeValue(node);
        return CommonsUtils.flattenDeep(value);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngTreeComponent.prototype.onNodeExpand = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.expandedNode = event.node;
        if (!event.node.children && this.$props.$ext.lazy) {
            this.onLazyLoad.emit(this.getEventContext(event));
        }
        else {
            this.resolveNode(event.node);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngTreeComponent.prototype.onNodeSelect = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.selectedNode = event.node && event.node[PNG_TREE_NODE_KEYS.dataKey] || event.node;
        if (this.$props && this.$props.$id) {
            StatesUtils.update(this.$props.$id, {
                selectedNode: this.selectedNode
            });
        }
        this.updateTouch();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngTreeComponent.prototype.onNodeUnSelect = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.updateTouch();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngTreeComponent.prototype.onTreeDataReady = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var treeNodes = this.createTreeNodes(event);
        this.initSelection(treeNodes);
        this.unFilteredValue = treeNodes;
        if (treeNodes.length > 0) {
            /** @type {?} */
            var level = this.$props.$ext.autoExpandLevel;
            /** @type {?} */
            var nodeId = void 0;
            if (this.expandedNode) {
                /** @type {?} */
                var node = this.expandedNode;
                nodeId = node['id'];
                while (node.parent) {
                    level++;
                    node = node.parent;
                }
            }
            TreeUtils.expandNode(treeNodes[0], true, this.$props.$ext, level, 1, nodeId);
        }
        else if (treeNodes.length === 0 || (treeNodes.length === 1 && !treeNodes['children'])) {
            this.onEmptyNode.emit();
        }
        if (this.$props.$ext.filter) {
            /** @type {?} */
            var filter = this.$props.$ext.filter;
            if (CommonsUtils.isString(filter)) {
                treeNodes = this.applyFilter((/** @type {?} */ (filter)));
            }
            else {
                treeNodes = filter['method'](treeNodes);
            }
        }
        this.data$.next(treeNodes);
    };
    /**
     * @param {?} treeNodes
     * @return {?}
     */
    PngTreeComponent.prototype.initSelection = /**
     * @param {?} treeNodes
     * @return {?}
     */
    function (treeNodes) {
        var _this = this;
        if (this._selection) {
            this.tree.selection = this._selection;
            this.tree.propagateUp((/** @type {?} */ (this._selection)), true);
            return;
        }
        if (this.selectedNodeValues && treeNodes) {
            this._selection = [];
            /** @type {?} */
            var values = CommonsUtils.getArrayValue(this.selectedNodeValues);
            for (var i = 0; i < values.length; i++) {
                /** @type {?} */
                var found = TreeUtils.findNode(treeNodes, values[i], this.$props.$ext);
                if (found) {
                    ((/** @type {?} */ (this._selection))).push(found);
                }
            }
            this.tree.selection = this._selection;
            ((/** @type {?} */ (this._selection))).forEach(function (node) {
                _this.tree.propagateUp(node, true);
            });
        }
    };
    /**
     * @return {?}
     */
    PngTreeComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.$props && this.$props.$id) {
            StatesUtils.deleteState(this.$props.$id);
        }
        _super.prototype.ngOnDestroy.call(this);
    };
    /**
     * @private
     * @param {?} node
     * @param {?=} nodes
     * @return {?}
     */
    PngTreeComponent.prototype.getSelectedNodeValue = /**
     * @private
     * @param {?} node
     * @param {?=} nodes
     * @return {?}
     */
    function (node, nodes) {
        if (CommonsUtils.isEmpty(node)) {
            return undefined;
        }
        if (node['isVirtual']) {
            return undefined;
        }
        nodes = nodes || [];
        /** @type {?} */
        var data = node[PNG_TREE_NODE_KEYS.dataKey];
        if (CommonsUtils.isEmpty(data)) {
            return undefined;
        }
        /** @type {?} */
        var val;
        if (this.$props.$ext.dataItemProps && this.$props.$ext.dataItemProps.valueKey) {
            val = DataItemUtils.getItemValue(data, this.$props.$ext.dataItemProps.valueKey);
        }
        else {
            val = {};
            val[this.$props.$ext.dataItemProps.idKey] = data[this.$props.$ext.dataItemProps.idKey];
            val[(/** @type {?} */ (this.$props.$ext.dataItemProps.labelKey))] = data[(/** @type {?} */ (this.$props.$ext.dataItemProps.labelKey))];
            if (this.$props.$ext.dataItemProps.typeKey) {
                val[this.$props.$ext.dataItemProps.typeKey] = data[this.$props.$ext.dataItemProps.typeKey];
            }
        }
        nodes.push(val);
        if (node[PNG_TREE_NODE_KEYS.parentKey]) {
            this.getSelectedNodeValue(node[PNG_TREE_NODE_KEYS.parentKey], nodes);
        }
        return nodes;
    };
    /**
     * @private
     * @param {?} nodes
     * @return {?}
     */
    PngTreeComponent.prototype.createTreeNodes = /**
     * @private
     * @param {?} nodes
     * @return {?}
     */
    function (nodes) {
        if (!nodes) {
            return [];
        }
        /** @type {?} */
        var treeNodes = tslib_1.__spread(nodes);
        if (this.$props.$ext.nodesFormat === 'plainArray') {
            treeNodes = TreeUtils.transNodes(treeNodes, {
                src: this.$props.$ext.dataItemProps,
                node: PNG_TREE_NODE_KEYS
            }, this.$props.$ext.root, this.$props.$ext.lazy);
        }
        if (treeNodes[0]) {
            TreeUtils.initNode(treeNodes[0], this.$props.$ext);
        }
        /** @type {?} */
        var rootNode = {};
        if (this.$props.$ext.virtualRoot) {
            if (CommonsUtils.isString(this.$props.$ext.virtualRoot)) {
                rootNode.label = (/** @type {?} */ (this.$props.$ext.virtualRoot));
            }
            else {
                rootNode = (/** @type {?} */ (this.$props.$ext.virtualRoot));
            }
            rootNode.children = treeNodes;
            rootNode['isVirtual'] = true;
            return [rootNode];
        }
        else {
            return treeNodes;
        }
    };
    /**
     * @private
     * @param {?} node
     * @return {?}
     */
    PngTreeComponent.prototype.resolveNode = /**
     * @private
     * @param {?} node
     * @return {?}
     */
    function (node) {
        var _this = this;
        if (node) {
            TreeUtils.initNode(node, this.$props.$ext);
            if (node.children) {
                node.children.forEach(function (child) { return TreeUtils.initNode(child, _this.$props.$ext); });
            }
        }
    };
    PngTreeComponent.decorators = [
        { type: Component, args: [{
                    selector: 'png-tree',
                    template: "<div class=\"ui-g ui-fluid\">\n\n  <div *ngIf=\"$props.$ext.hasSearchBox\" class=\"ui-g-12\">\n     <span class=\"inner-addon\">\n       <i class=\"fa fa-search text-primary left\"></i>\n       <input (keyup)=\"filter($event)\" [(ngModel)]=\"filterValue\" pInputText placeholder=\"\u8F93\u5165\u4EE3\u7801\u6216\u540D\u79F0\u9996\u5B57\u6BCD\" title=\"\u641C\u7D22\u8282\u70B9\"/>\n       <i (click)=\"clearFilter()\" *ngIf=\"filtered\" class=\"fa fa-trash text-muted right\" title=\"\u6E05\u9664\u641C\u7D22\u5185\u5BB9\"></i>\n     </span>\n  </div>\n\n  <p-card class=\"w-100\" erAnimate=\"slideInLeft\">\n    <span class=\"pull-right\">\n          <i class=\"fa fa-arrow-circle-up mr-1\" (click)=\"collapseAll()\" title=\"\u6536\u8D77\u5168\u90E8\"></i>\n          <i (click)=\"expandAll()\" class=\"fa fa-arrow-circle-down mr-1\" title=\"\u5C55\u5F00\u5168\u90E8\"></i>\n          <i (click)=\"load()\" class=\"fa fa-refresh\" title=\"\u5237\u65B0\u6811\"></i>\n      </span>\n    <p-tree #pngTree\n            erPropsBind\n            [props]=\"$props\"\n            [context]=\"ctx\"\n            [erApiData]=\"apiDataProps\"\n            [value]=\"data$|async\"\n            [(selection)]=\"selection\"\n            [loading]=\"loading$ | async\"\n            (onDataReady)=\"onTreeDataReady($event)\"\n            (onNodeExpand)=\"onNodeExpand($event)\"\n            (onNodeSelect)=\"onNodeSelect($event)\"\n            (onNodeUnselect)=\"onNodeUnSelect($event)\"\n    >\n      <ng-template pTemplate=\"default\" let-node>\n        <ng-container *ngTemplateOutlet=\"template(templateNames.node,defaultNodeTpl);\n                                  context:{$implicit: node,props:$props}\"></ng-container>\n      </ng-template>\n\n      <ng-container *ngIf=\"template(templateNames.icon)\">\n        <ng-template let-node pTemplate=\"picture\">\n          <ng-container *ngTemplateOutlet=\"template(templateNames.icon);\n                                  context:{$implicit: node,props:$props}\"></ng-container>\n        </ng-template>\n      </ng-container>\n\n      <ng-template #defaultNodeTpl let-node let-props=\"props\">\n        <!--<input type=\"radio\" name=\"tree_radio\" *ngIf=\"props.selectionMode === 'radio' && !node['children']\"/>-->\n        <span [innerHTML]=\"node['label']\" [ngClass]=\"{'ui-state-highlight':node.matched}\"></span>\n      </ng-template>\n\n    </p-tree>\n  </p-card>\n\n</div>\n",
                    providers: [{
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(function () { return PngTreeComponent; }),
                            multi: true
                        }],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    styles: ["/deep/ li:focus{outline:green solid 1px!important}/deep/ .ui-state-highlight{background-color:#9acd32!important;color:inherit!important;font-weight:700}/deep/ .ui-treenode-content-selected .ui-state-highlight{background-color:transparent!important;font-size:1.1em!important;font-weight:700;color:red!important}"]
                }] }
    ];
    /** @nocollapse */
    PngTreeComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    PngTreeComponent.propDecorators = {
        tree: [{ type: ViewChild, args: ['pngTree',] }],
        onEmptyNode: [{ type: Output }],
        onLazyLoad: [{ type: Output }]
    };
    return PngTreeComponent;
}(DataAwareControlWrapperComponent));
export { PngTreeComponent };
if (false) {
    /** @type {?} */
    PngTreeComponent.prototype.tree;
    /** @type {?} */
    PngTreeComponent.prototype.unFilteredValue;
    /** @type {?} */
    PngTreeComponent.prototype.loading$;
    /** @type {?} */
    PngTreeComponent.prototype.filtered;
    /** @type {?} */
    PngTreeComponent.prototype.filterValue;
    /** @type {?} */
    PngTreeComponent.prototype.expandedNode;
    /** @type {?} */
    PngTreeComponent.prototype.templateNames;
    /** @type {?} */
    PngTreeComponent.prototype.onEmptyNode;
    /** @type {?} */
    PngTreeComponent.prototype.onLazyLoad;
    /** @type {?} */
    PngTreeComponent.prototype.$defaultProps;
    /** @type {?} */
    PngTreeComponent.prototype.selectedNode;
    /** @type {?} */
    PngTreeComponent.prototype.selectedNodeValues;
    /** @type {?} */
    PngTreeComponent.prototype.modelFormatter;
    /** @type {?} */
    PngTreeComponent.prototype.valueParser;
    /**
     * @type {?}
     * @private
     */
    PngTreeComponent.prototype._selection;
    /**
     * @type {?}
     * @private
     */
    PngTreeComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL3ByaW1lbmcvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90cmVlL2NvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxZQUFZLEVBQ1osVUFBVSxFQUdWLE1BQU0sRUFDTixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDakQsT0FBTyxFQUFDLGdDQUFnQyxFQUFFLGVBQWUsRUFBQyxNQUFNLFVBQVUsQ0FBQztBQUMzRSxPQUFPLEVBQUMsWUFBWSxFQUFFLGFBQWEsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFFcEcsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLGNBQWMsQ0FBQztBQUVsQyxPQUFPLEVBQUMsc0JBQXNCLEVBQUUsa0JBQWtCLEVBQWlDLE1BQU0sU0FBUyxDQUFDO0FBR25HLE9BQU8sRUFBZSxrQkFBa0IsRUFBQyxNQUFNLFNBQVMsQ0FBQztBQUV6RDtJQVdzQyw0Q0FBOEM7SUFpQ2xGLDBCQUFvQixFQUFxQjtRQUF6QyxZQUNFLGlCQUFPLFNBQ1I7UUFGbUIsUUFBRSxHQUFGLEVBQUUsQ0FBbUI7UUFuQnpDLG1CQUFhLEdBQUc7WUFDZCxJQUFJLEVBQUUsTUFBTTtZQUNaLElBQUksRUFBRSxNQUFNO1NBQ2IsQ0FBQztRQUVRLGlCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUVqQyxnQkFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFMUMsbUJBQWEsR0FBRyxzQkFBc0IsQ0FBQztRQU12QyxvQkFBYyxHQUFHLEtBQUksQ0FBQyxXQUFXLENBQUM7UUFFbEMsaUJBQVcsR0FBRyxLQUFJLENBQUMs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SSxDQUFDLFFBQVEsRUFBRTtnQkFDakIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBQSxLQUFLLElBQUksT0FBQSxTQUFTLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxLQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUEzQyxDQUEyQyxDQUFDLENBQUM7YUFDN0U7U0FDRjtJQUNILENBQUM7O2dCQWhURixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLFVBQVU7b0JBQ3BCLGs0RUFBdUI7b0JBRXZCLFNBQVMsRUFBRSxDQUFDOzRCQUNWLE9BQU8sRUFBRSxpQkFBaUI7NEJBQzFCLFdBQVcsRUFBRSxVQUFVLENBQUMsY0FBTSxPQUFBLGdCQUFnQixFQUFoQixDQUFnQixDQUFDOzRCQUMvQyxLQUFLLEVBQUUsSUFBSTt5QkFDWixDQUFDO29CQUNGLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNOztpQkFDaEQ7Ozs7Z0JBOUJDLGlCQUFpQjs7O3VCQWlDaEIsU0FBUyxTQUFDLFNBQVM7OEJBaUJuQixNQUFNOzZCQUVOLE1BQU07O0lBa1JULHVCQUFDO0NBQUEsQUFsVEQsQ0FXc0MsZ0NBQWdDLEdBdVNyRTtTQXZTWSxnQkFBZ0I7OztJQUUzQixnQ0FBaUM7O0lBRWpDLDJDQUFvQzs7SUFFcEMsb0NBQThCOztJQUU5QixvQ0FBa0I7O0lBRWxCLHVDQUFvQjs7SUFFcEIsd0NBQXVCOztJQUV2Qix5Q0FHRTs7SUFFRix1Q0FBMkM7O0lBRTNDLHNDQUEwQzs7SUFFMUMseUNBQXVDOztJQUV2Qyx3Q0FBaUI7O0lBRWpCLDhDQUF5Qjs7SUFFekIsMENBQWtDOztJQUVsQyx1Q0FBOEI7Ozs7O0lBTTlCLHNDQUEwQzs7Ozs7SUFKOUIsOEJBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgZm9yd2FyZFJlZixcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgVmlld0NoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtOR19WQUxVRV9BQ0NFU1NPUn0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHtEYXRhQXdhcmVDb250cm9sV3JhcHBlckNvbXBvbmVudCwgSFRUUF9UQUdfU1RBVEUkfSBmcm9tICdAZXIvY29yZSc7XG5pbXBvcnQge0NvbW1vbnNVdGlscywgRGF0YUl0ZW1VdGlscywgUGlueWluVXRpbCwgUmVnVXRpbHMsIFN0YXRlc1V0aWxzLCBUcmVlVXRpbHN9IGZyb20gJ0Blci91dGlscyc7XG5pbXBvcnQge1RyZWVOb2RlfSBmcm9tICdwcmltZW5nL2FwaSc7XG5pbXBvcnQge1RyZWV9IGZyb20gJ3ByaW1lbmcvdHJlZSc7XG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtERUZBVUxUX1BOR19UUkVFX1BST1BTLCBQTkdfVFJFRV9OT0RFX0tFWVMsIFBuZ1RyZWVOb2RlUHJvcHMsIFBuZ1RyZWVQcm9wc30gZnJvbSAnLi90eXBlcyc7XG5cblxuZXhwb3J0IHtQbmdUcmVlUHJvcHMsIFBOR19UUkVFX05PREVfS0VZU30gZnJvbSAnLi90eXBlcyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BuZy10cmVlJyxcbiAgdGVtcGxhdGVVcmw6ICd0cGwuaHRtbCcsXG4gIHN0eWxlVXJsczogWydzdHlsZXMuc2NzcyddLFxuICBwcm92aWRlcnM6IFt7XG4gICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gUG5nVHJlZUNvbXBvbmVudCksXG4gICAgbXVsdGk6IHRydWVcbiAgfV0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIFBuZ1RyZWVDb21wb25lbnQgZXh0ZW5kcyBEYXRhQXdhcmVDb250cm9sV3JhcHBlckNvbXBvbmVudDxQbmdUcmVlUHJvcHM+IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuXG4gIEBWaWV3Q2hpbGQoJ3BuZ1RyZWUnKSB0cmVlOiBUcmVlO1xuXG4gIHVuRmlsdGVyZWRWYWx1ZTogUG5nVHJlZU5vZGVQcm9wc1tdO1xuXG4gIGxvYWRpbmckOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuXG4gIGZpbHRlcmVkOiBib29sZWFuO1xuXG4gIGZpbHRlclZhbHVlOiBzdHJpbmc7XG5cbiAgZXhwYW5kZWROb2RlOiBUcmVlTm9kZTtcblxuICB0ZW1wbGF0ZU5hbWVzID0ge1xuICAgIGljb246ICdpY29uJyxcbiAgICBub2RlOiAnbm9kZSdcbiAgfTtcblxuICBAT3V0cHV0KCkgb25FbXB0eU5vZGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQE91dHB1dCgpIG9uTGF6eUxvYWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgJGRlZmF1bHRQcm9wcyA9IERFRkFVTFRfUE5HX1RSRUVfUFJPUFM7XG5cbiAgc2VsZWN0ZWROb2RlOiB7fTtcblxuICBzZWxlY3RlZE5vZGVWYWx1ZXM6IHt9W107XG5cbiAgbW9kZWxGb3JtYXR0ZXIgPSB0aGlzLmZvcm1hdE1vZGVsO1xuXG4gIHZhbHVlUGFyc2VyID0gdGhpcy5wYXJzZVZhbHVlO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgX3NlbGVjdGlvbjogVHJlZU5vZGUgfCBUcmVlTm9kZVtdO1xuXG4gIGdldCBzZWxlY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlbGVjdGlvbjtcbiAgfVxuXG4gIHNldCBzZWxlY3Rpb24oc2VsZWN0aW9uKSB7XG4gICAgdGhpcy5fc2VsZWN0aW9uID0gc2VsZWN0aW9uO1xuICAgIHRoaXMudmFsdWUgPSBzZWxlY3Rpb247XG4gIH1cblxuICBvblByb3BzSW5pdCgpIHtcbiAgICB0aGlzLmZpbHRlcmVkID0gZmFsc2U7XG4gICAgdGhpcy5sb2FkaW5nJCA9IEhUVFBfVEFHX1NUQVRFJCh0aGlzLiRwcm9wcy4kaWQpO1xuICAgIGlmICh0aGlzLiRwcm9wcy4kZXh0LmRhdGFJdGVtcykge1xuICAgICAgdGhpcy5kYXRhJC5uZXh0KHRoaXMuJHByb3BzLiRleHQuZGF0YUl0ZW1zKTtcbiAgICB9XG4gICAgU3RhdGVzVXRpbHMuY3JlYXRlKHRoaXMuJHByb3BzLiRpZCwge1xuICAgICAgY29tcG9uZW50OiB0aGlzXG4gICAgfSwgdHJ1ZSk7XG4gIH1cblxuICBsb2FkKCkge1xuICAgIHRoaXMuYXBpRGF0YVByb3BzID0gey4uLnRoaXMuYXBpRGF0YVByb3BzfTtcbiAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgZm9ybWF0TW9kZWwobW9kZWwpIHtcbiAgICBpZiAobW9kZWwpIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWROb2RlVmFsdWVzID0gbW9kZWw7XG4gICAgfVxuICAgIHJldHVybiBtb2RlbDtcbiAgfVxuXG4gIHBhcnNlVmFsdWUodmFsdWUpIHtcbiAgICBsZXQgc2VsZWN0ZWROb2RlVmFsdWVzO1xuICAgIGlmIChDb21tb25zVXRpbHMuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgIHNlbGVjdGVkTm9kZVZhbHVlcyA9IENvbW1vbnNVdGlscy5mbGF0dGVuRGVlcCh2YWx1ZSkubWFwKG5vZGUgPT4gdGhpcy5nZXRTZWxlY3RlZE5vZGVWYWx1ZXMobm9kZSkpO1xuICAgIH0gZWxzZSBpZiAoQ29tbW9uc1V0aWxzLmlzSnNvbih2YWx1ZSkpIHtcbiAgICAgIHNlbGVjdGVkTm9kZVZhbHVlcyA9IHRoaXMuZ2V0U2VsZWN0ZWROb2RlVmFsdWVzKHZhbHVlKTtcbiAgICB9XG4gICAgc2VsZWN0ZWROb2RlVmFsdWVzID0gQ29tbW9uc1V0aWxzLmZsYXR0ZW4oc2VsZWN0ZWROb2RlVmFsdWVzKTtcbiAgICBzZWxlY3RlZE5vZGVWYWx1ZXMgPSBDb21tb25zVXRpbHMudW5pcXVlKHNlbGVjdGVkTm9kZVZhbHVlcywgdGhpcy4kcHJvcHMuJGV4dC5kYXRhSXRlbVByb3BzLmlkS2V5KTtcbiAgICBzZWxlY3RlZE5vZGVWYWx1ZXMgPSBDb21tb25zVXRpbHMub3JkZXJCeShzZWxlY3RlZE5vZGVWYWx1ZXMsIHRoaXMuJHByb3BzLiRleHQuZGF0YUl0ZW1Qcm9wcy5pZEtleSwgJ2FzYycpO1xuICAgIGlmICh0aGlzLiRwcm9wcyAmJiB0aGlzLiRwcm9wcy4kaWQpIHtcbiAgICAgIFN0YXRlc1V0aWxzLnVwZGF0ZSh0aGlzLiRwcm9wcy4kaWQsIHtcbiAgICAgICAgc2VsZWN0ZWROb2RlVmFsdWVzOiBzZWxlY3RlZE5vZGVWYWx1ZXNcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLnNlbGVjdGVkTm9kZVZhbHVlcyA9IHNlbGVjdGVkTm9kZVZhbHVlcztcbiAgICByZXR1cm4gc2VsZWN0ZWROb2RlVmFsdWVzO1xuICB9XG5cbiAgZXhwYW5kQWxsKCkge1xuICAgIHRoaXMuZGF0YSQudmFsdWUuZm9yRWFjaChub2RlID0+IHtcbiAgICAgIFRyZWVVdGlscy5leHBhbmROb2RlKG5vZGUsIHRydWUsIHRoaXMuJHByb3BzLiRleHQpO1xuICAgIH0pO1xuICB9XG5cbiAgY29sbGFwc2VBbGwoKSB7XG4gICAgdGhpcy5kYXRhJC52YWx1ZS5mb3JFYWNoKG5vZGUgPT4ge1xuICAgICAgVHJlZVV0aWxzLmV4cGFuZE5vZGUobm9kZSwgZmFsc2UsIHRoaXMuJHByb3BzLiRleHQpO1xuICAgIH0pO1xuICB9XG5cbiAgZmlsdGVyKGV2ZW50KSB7XG4gICAgY29uc3QgZGF0YSA9IHRoaXMuYXBwbHlGaWx0ZXIoZXZlbnQudGFyZ2V0LnZhbHVlKTtcbiAgICB0aGlzLmRhdGEkLm5leHQoZGF0YSk7XG4gICAgdGhpcy5maWx0ZXJlZCA9IHRydWU7XG4gICAgdGhpcy5leHBhbmRBbGwoKTtcbiAgICAvLyAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICBhcHBseUZpbHRlcihmaWx0ZXJWYWx1ZTogc3RyaW5nKToge31bXSB7XG4gICAgaWYgKCFmaWx0ZXJWYWx1ZSkge1xuICAgICAgdGhpcy5jbGVhckZpbHRlcigpO1xuICAgICAgcmV0dXJuIHRoaXMudW5GaWx0ZXJlZFZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBmaWx0ZXJWYWx1ZSA9IGZpbHRlclZhbHVlLnRvTG93ZXJDYXNlKCk7XG4gICAgICByZXR1cm4gVHJlZVV0aWxzLmZpbHRlcih0aGlzLnVuRmlsdGVyZWRWYWx1ZSwgKG5vZGUpID0+IHtcbiAgICAgICAgbGV0IHB5ID0gbm9kZVsnJHB5J107XG4gICAgICAgIGlmICghcHkpIHtcbiAgICAgICAgICBweSA9IFBpbnlpblV0aWwuZ2V0Rmlyc3RMZXR0ZXIobm9kZS5sYWJlbCk7XG4gICAgICAgICAgbm9kZVsnJHB5J10gPSBweTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpZEtleSA9IHRoaXMuJHByb3BzLiRleHQuZGF0YUl0ZW1Qcm9wcyAmJiB0aGlzLiRwcm9wcy4kZXh0LmRhdGFJdGVtUHJvcHMuaWRLZXk7XG4gICAgICAgIGNvbnN0IHNWYWwgPSAoKG5vZGUuZGF0YSAmJiBub2RlLmRhdGFbaWRLZXldKSB8fCAnJykgKyAnJztcbiAgICAgICAgY29uc3Qgc0xhYiA9IG5vZGUubGFiZWwgfHwgJyc7XG4gICAgICAgIGlmICgvXlxcdyskLy50ZXN0KGZpbHRlclZhbHVlKSkge1xuICAgICAgICAgIHJldHVybiBzTGFiLnN0YXJ0c1dpdGgoZmlsdGVyVmFsdWUpIHx8IHNWYWwuc3RhcnRzV2l0aChmaWx0ZXJWYWx1ZSkgfHwgcHkuc3RhcnRzV2l0aChmaWx0ZXJWYWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIFJlZ1V0aWxzLnRlc3Qoc1ZhbCwgZmlsdGVyVmFsdWUpIHx8IFJlZ1V0aWxzLnRlc3QocHksIGZpbHRlclZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgY2xlYXJGaWx0ZXIoKSB7XG4gICAgdGhpcy5maWx0ZXJWYWx1ZSA9ICcnO1xuICAgIHRoaXMuZGF0YSQubmV4dChbLi4udGhpcy51bkZpbHRlcmVkVmFsdWVdKTtcbiAgICB0aGlzLmZpbHRlcmVkID0gZmFsc2U7XG4gIH1cblxuICBnZXRTZWxlY3RlZE5vZGVWYWx1ZXMobm9kZSk6IHt9W10ge1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRTZWxlY3RlZE5vZGVWYWx1ZShub2RlKTtcbiAgICByZXR1cm4gQ29tbW9uc1V0aWxzLmZsYXR0ZW5EZWVwKHZhbHVlKTtcbiAgfVxuXG4gIG9uTm9kZUV4cGFuZChldmVudCkge1xuICAgIHRoaXMuZXhwYW5kZWROb2RlID0gZXZlbnQubm9kZTtcbiAgICBpZiAoIWV2ZW50Lm5vZGUuY2hpbGRyZW4gJiYgdGhpcy4kcHJvcHMuJGV4dC5sYXp5KSB7XG4gICAgICB0aGlzLm9uTGF6eUxvYWQuZW1pdCh0aGlzLmdldEV2ZW50Q29udGV4dChldmVudCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlc29sdmVOb2RlKGV2ZW50Lm5vZGUpO1xuICAgIH1cbiAgfVxuXG4gIG9uTm9kZVNlbGVjdChldmVudCkge1xuICAgIHRoaXMuc2VsZWN0ZWROb2RlID0gZXZlbnQubm9kZSAmJiBldmVudC5ub2RlW1BOR19UUkVFX05PREVfS0VZUy5kYXRhS2V5XSB8fCBldmVudC5ub2RlO1xuICAgIGlmICh0aGlzLiRwcm9wcyAmJiB0aGlzLiRwcm9wcy4kaWQpIHtcbiAgICAgIFN0YXRlc1V0aWxzLnVwZGF0ZSh0aGlzLiRwcm9wcy4kaWQsIHtcbiAgICAgICAgc2VsZWN0ZWROb2RlOiB0aGlzLnNlbGVjdGVkTm9kZVxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMudXBkYXRlVG91Y2goKTtcbiAgfVxuXG4gIG9uTm9kZVVuU2VsZWN0KGV2ZW50KSB7XG4gICAgdGhpcy51cGRhdGVUb3VjaCgpO1xuICB9XG5cbiAgb25UcmVlRGF0YVJlYWR5KGV2ZW50KSB7XG4gICAgbGV0IHRyZWVOb2RlcyA9IHRoaXMuY3JlYXRlVHJlZU5vZGVzKGV2ZW50KTtcbiAgICB0aGlzLmluaXRTZWxlY3Rpb24odHJlZU5vZGVzKTtcbiAgICB0aGlzLnVuRmlsdGVyZWRWYWx1ZSA9IHRyZWVOb2RlcztcbiAgICBpZiAodHJlZU5vZGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBsZXZlbCA9IHRoaXMuJHByb3BzLiRleHQuYXV0b0V4cGFuZExldmVsO1xuICAgICAgbGV0IG5vZGVJZDtcbiAgICAgIGlmICh0aGlzLmV4cGFuZGVkTm9kZSkge1xuICAgICAgICBsZXQgbm9kZSA9IHRoaXMuZXhwYW5kZWROb2RlO1xuICAgICAgICBub2RlSWQgPSBub2RlWydpZCddO1xuICAgICAgICB3aGlsZSAobm9kZS5wYXJlbnQpIHtcbiAgICAgICAgICBsZXZlbCsrO1xuICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgVHJlZVV0aWxzLmV4cGFuZE5vZGUodHJlZU5vZGVzWzBdLCB0cnVlLCB0aGlzLiRwcm9wcy4kZXh0LCBsZXZlbCwgMSwgbm9kZUlkKTtcbiAgICB9IGVsc2UgaWYgKHRyZWVOb2Rlcy5sZW5ndGggPT09IDAgfHwgKHRyZWVOb2Rlcy5sZW5ndGggPT09IDEgJiYgIXRyZWVOb2Rlc1snY2hpbGRyZW4nXSkpIHtcbiAgICAgIHRoaXMub25FbXB0eU5vZGUuZW1pdCgpO1xuICAgIH1cbiAgICBpZiAodGhpcy4kcHJvcHMuJGV4dC5maWx0ZXIpIHtcbiAgICAgIGNvbnN0IGZpbHRlciA9IHRoaXMuJHByb3BzLiRleHQuZmlsdGVyO1xuICAgICAgaWYgKENvbW1vbnNVdGlscy5pc1N0cmluZyhmaWx0ZXIpKSB7XG4gICAgICAgIHRyZWVOb2RlcyA9IHRoaXMuYXBwbHlGaWx0ZXIoPHN0cmluZz5maWx0ZXIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHJlZU5vZGVzID0gZmlsdGVyWydtZXRob2QnXSh0cmVlTm9kZXMpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmRhdGEkLm5leHQodHJlZU5vZGVzKTtcbiAgfVxuXG4gIGluaXRTZWxlY3Rpb24odHJlZU5vZGVzKSB7XG4gICAgaWYgKHRoaXMuX3NlbGVjdGlvbikge1xuICAgICAgdGhpcy50cmVlLnNlbGVjdGlvbiA9IHRoaXMuX3NlbGVjdGlvbjtcbiAgICAgIHRoaXMudHJlZS5wcm9wYWdhdGVVcCg8VHJlZU5vZGU+dGhpcy5fc2VsZWN0aW9uLCB0cnVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMuc2VsZWN0ZWROb2RlVmFsdWVzICYmIHRyZWVOb2Rlcykge1xuICAgICAgdGhpcy5fc2VsZWN0aW9uID0gW107XG4gICAgICBjb25zdCB2YWx1ZXMgPSBDb21tb25zVXRpbHMuZ2V0QXJyYXlWYWx1ZSh0aGlzLnNlbGVjdGVkTm9kZVZhbHVlcyk7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBmb3VuZCA9IFRyZWVVdGlscy5maW5kTm9kZSh0cmVlTm9kZXMsIHZhbHVlc1tpXSwgdGhpcy4kcHJvcHMuJGV4dCk7XG4gICAgICAgIGlmIChmb3VuZCkge1xuICAgICAgICAgICh0aGlzLl9zZWxlY3Rpb24gYXMgVHJlZU5vZGVbXSkucHVzaChmb3VuZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMudHJlZS5zZWxlY3Rpb24gPSB0aGlzLl9zZWxlY3Rpb247XG4gICAgICAodGhpcy5fc2VsZWN0aW9uIGFzIFRyZWVOb2RlW10pLmZvckVhY2gobm9kZSA9PiB7XG4gICAgICAgIHRoaXMudHJlZS5wcm9wYWdhdGVVcChub2RlLCB0cnVlKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLiRwcm9wcyAmJiB0aGlzLiRwcm9wcy4kaWQpIHtcbiAgICAgIFN0YXRlc1V0aWxzLmRlbGV0ZVN0YXRlKHRoaXMuJHByb3BzLiRpZCk7XG4gICAgfVxuICAgIHN1cGVyLm5nT25EZXN0cm95KCk7XG4gIH1cblxuICBwcml2YXRlIGdldFNlbGVjdGVkTm9kZVZhbHVlKG5vZGUsIG5vZGVzPzoge31bXSkge1xuICAgIGlmIChDb21tb25zVXRpbHMuaXNFbXB0eShub2RlKSkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgaWYgKG5vZGVbJ2lzVmlydHVhbCddKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBub2RlcyA9IG5vZGVzIHx8IFtdO1xuICAgIGNvbnN0IGRhdGEgPSBub2RlW1BOR19UUkVFX05PREVfS0VZUy5kYXRhS2V5XTtcbiAgICBpZiAoQ29tbW9uc1V0aWxzLmlzRW1wdHkoZGF0YSkpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGxldCB2YWw6IHt9O1xuICAgIGlmICh0aGlzLiRwcm9wcy4kZXh0LmRhdGFJdGVtUHJvcHMgJiYgdGhpcy4kcHJvcHMuJGV4dC5kYXRhSXRlbVByb3BzLnZhbHVlS2V5KSB7XG4gICAgICB2YWwgPSBEYXRhSXRlbVV0aWxzLmdldEl0ZW1WYWx1ZShkYXRhLCB0aGlzLiRwcm9wcy4kZXh0LmRhdGFJdGVtUHJvcHMudmFsdWVLZXkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YWwgPSB7fTtcbiAgICAgIHZhbFt0aGlzLiRwcm9wcy4kZXh0LmRhdGFJdGVtUHJvcHMuaWRLZXldID0gZGF0YVt0aGlzLiRwcm9wcy4kZXh0LmRhdGFJdGVtUHJvcHMuaWRLZXldO1xuICAgICAgdmFsWzxzdHJpbmc+dGhpcy4kcHJvcHMuJGV4dC5kYXRhSXRlbVByb3BzLmxhYmVsS2V5XSA9IGRhdGFbPHN0cmluZz50aGlzLiRwcm9wcy4kZXh0LmRhdGFJdGVtUHJvcHMubGFiZWxLZXldO1xuICAgICAgaWYgKHRoaXMuJHByb3BzLiRleHQuZGF0YUl0ZW1Qcm9wcy50eXBlS2V5KSB7XG4gICAgICAgIHZhbFt0aGlzLiRwcm9wcy4kZXh0LmRhdGFJdGVtUHJvcHMudHlwZUtleV0gPSBkYXRhW3RoaXMuJHByb3BzLiRleHQuZGF0YUl0ZW1Qcm9wcy50eXBlS2V5XTtcbiAgICAgIH1cbiAgICB9XG4gICAgbm9kZXMucHVzaCh2YWwpO1xuICAgIGlmIChub2RlW1BOR19UUkVFX05PREVfS0VZUy5wYXJlbnRLZXldKSB7XG4gICAgICB0aGlzLmdldFNlbGVjdGVkTm9kZVZhbHVlKG5vZGVbUE5HX1RSRUVfTk9ERV9LRVlTLnBhcmVudEtleV0sIG5vZGVzKTtcbiAgICB9XG4gICAgcmV0dXJuIG5vZGVzO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVUcmVlTm9kZXMobm9kZXM6IHt9W10pOiB7fVtdIHtcbiAgICBpZiAoIW5vZGVzKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIGxldCB0cmVlTm9kZXM6IHt9W10gPSBbLi4ubm9kZXNdO1xuICAgIGlmICh0aGlzLiRwcm9wcy4kZXh0Lm5vZGVzRm9ybWF0ID09PSAncGxhaW5BcnJheScpIHtcbiAgICAgIHRyZWVOb2RlcyA9IFRyZWVVdGlscy50cmFuc05vZGVzKHRyZWVOb2Rlcywge1xuICAgICAgICBzcmM6IHRoaXMuJHByb3BzLiRleHQuZGF0YUl0ZW1Qcm9wcyxcbiAgICAgICAgbm9kZTogUE5HX1RSRUVfTk9ERV9LRVlTXG4gICAgICB9LCB0aGlzLiRwcm9wcy4kZXh0LnJvb3QsIHRoaXMuJHByb3BzLiRleHQubGF6eSk7XG4gICAgfVxuICAgIGlmICh0cmVlTm9kZXNbMF0pIHtcbiAgICAgIFRyZWVVdGlscy5pbml0Tm9kZSh0cmVlTm9kZXNbMF0sIHRoaXMuJHByb3BzLiRleHQpO1xuICAgIH1cbiAgICBsZXQgcm9vdE5vZGU6IFRyZWVOb2RlID0ge307XG4gICAgaWYgKHRoaXMuJHByb3BzLiRleHQudmlydHVhbFJvb3QpIHtcbiAgICAgIGlmIChDb21tb25zVXRpbHMuaXNTdHJpbmcodGhpcy4kcHJvcHMuJGV4dC52aXJ0dWFsUm9vdCkpIHtcbiAgICAgICAgcm9vdE5vZGUubGFiZWwgPSA8c3RyaW5nPnRoaXMuJHByb3BzLiRleHQudmlydHVhbFJvb3Q7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByb290Tm9kZSA9IDxUcmVlTm9kZT50aGlzLiRwcm9wcy4kZXh0LnZpcnR1YWxSb290O1xuICAgICAgfVxuICAgICAgcm9vdE5vZGUuY2hpbGRyZW4gPSB0cmVlTm9kZXM7XG4gICAgICByb290Tm9kZVsnaXNWaXJ0dWFsJ10gPSB0cnVlO1xuICAgICAgcmV0dXJuIFtyb290Tm9kZV07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0cmVlTm9kZXM7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZXNvbHZlTm9kZShub2RlKSB7XG4gICAgaWYgKG5vZGUpIHtcbiAgICAgIFRyZWVVdGlscy5pbml0Tm9kZShub2RlLCB0aGlzLiRwcm9wcy4kZXh0KTtcbiAgICAgIGlmIChub2RlLmNoaWxkcmVuKSB7XG4gICAgICAgIG5vZGUuY2hpbGRyZW4uZm9yRWFjaChjaGlsZCA9PiBUcmVlVXRpbHMuaW5pdE5vZGUoY2hpbGQsIHRoaXMuJHByb3BzLiRleHQpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxufVxuIl19