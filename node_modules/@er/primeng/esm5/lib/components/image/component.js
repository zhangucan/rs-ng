/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { BaseComponent, HttpUtils } from '@er/core';
import { HttpResponseType } from '@er/types';
import { CommonsUtils, ConfigUtils, DialogUtils } from '@er/utils';
import { Lightbox } from 'primeng/primeng';
var PngImageComponent = /** @class */ (function (_super) {
    tslib_1.__extends(PngImageComponent, _super);
    function PngImageComponent(cd, sanitizer) {
        var _this = _super.call(this) || this;
        _this.cd = cd;
        _this.sanitizer = sanitizer;
        _this.imageViewStyle = { 'max-height': '300px', 'max-width': '500px', 'overflow': 'auto' };
        _this.showDescription = true;
        _this.descriptionChange = new EventEmitter();
        return _this;
    }
    Object.defineProperty(PngImageComponent.prototype, "description", {
        get: /**
         * @return {?}
         */
        function () {
            return this._description;
        },
        set: /**
         * @param {?} description
         * @return {?}
         */
        function (description) {
            this._description = description;
            this.descriptionChange.emit(description);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} changes
     * @return {?}
     */
    PngImageComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        var _this = this;
        if (changes.src) {
            if (CommonsUtils.isArray(this.src)) {
                if (this.src.length === 1) {
                    this.images = undefined;
                    this.image = this.src[0];
                    this.fullImage = this.src[0];
                }
                else {
                    this.images = [];
                    this.image = this.src[0];
                    this.fullImage = this.src[0];
                    ((/** @type {?} */ (this.src))).forEach(function (image) {
                        if (CommonsUtils.isString(image)) {
                            _this.images.push({ source: image });
                        }
                        else {
                            _this.images.push(image);
                        }
                    });
                }
            }
            else {
                this.images = undefined;
                this.image = this.src;
                this.fullImage = this.src;
            }
        }
        if (changes.fileId) {
            /** @type {?} */
            var fileId_1;
            if (!this.fileId) {
                this.images = undefined;
                this.image = null;
            }
            else {
                if (CommonsUtils.isArray(this.fileId)) {
                    if (this.fileId.length === 0) {
                        this.images = undefined;
                        this.image = null;
                        return;
                    }
                    else {
                        fileId_1 = this.fileId[0];
                    }
                }
                else {
                    fileId_1 = this.fileId;
                }
                HttpUtils.request({
                    uri: ConfigUtils.getConfig().api.servers['image'].uri + "/" + fileId_1 + (this.size ? '?' + this.size : ''),
                    observe: 'events',
                    responseType: HttpResponseType.BLOB
                }).subscribe(function (response) {
                    /** @type {?} */
                    var objectURL = _this.sanitizer.bypassSecurityTrustUrl((window.URL.createObjectURL(response.body)));
                    _this.images = undefined;
                    _this.image = objectURL;
                    _this.fullImage = ConfigUtils.getConfig().api.servers['image'].uri + "/" + fileId_1;
                    /** @type {?} */
                    var descriptions = response.headers.getAll('description');
                    if (descriptions && descriptions.length > 0) {
                        _this.description = descriptions[0];
                    }
                    _this.cd.detectChanges();
                });
            }
        }
    };
    /**
     * @return {?}
     */
    PngImageComponent.prototype.viewImage = /**
     * @return {?}
     */
    function () {
        if (this.images) {
            this.imageViewer.show();
            this.imageViewer.center();
        }
        else if (this.image) {
            DialogUtils.info('图片预览', this.imageViewTpl, (/** @type {?} */ ({})));
        }
    };
    PngImageComponent.decorators = [
        { type: Component, args: [{
                    selector: 'png-image',
                    template: "\n    <div [ngClass]=\"styleClass\" [ngStyle]=\"style\">\n      <img *ngIf=\"image\"\n           style=\"margin: 5px\"\n           [src]=\"image\"\n           [ngClass]=\"imageStyleClass\"\n           [ngStyle]=\"imageStyle\"\n           [title]=\"description || ''\"\n           (click)=\"viewImage()\"/>\n      <div *ngIf=\"showDescription\" [ngClass]=\"descriptionStyleClass\" [ngStyle]=\"descriptionStyle\">\n        {{description}}\n      </div>\n    </div>\n    <ng-template #imageView>\n      <img [src]=\"fullImage\" [ngStyle]=\"imageViewStyle\" [ngClass]=\"imageViewStyleClass\"/>\n    </ng-template>\n    <ng-template #imagesView>\n      <p-lightbox [images]=\"images\" [styleClass]=\"boxStyleClass\" [style]=\"boxStyle\"></p-lightbox>\n    </ng-template>\n  ",
                    changeDetection: ChangeDetectionStrategy.OnPush
                }] }
    ];
    /** @nocollapse */
    PngImageComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: DomSanitizer }
    ]; };
    PngImageComponent.propDecorators = {
        src: [{ type: Input }],
        styleClass: [{ type: Input }],
        style: [{ type: Input }],
        imageStyleClass: [{ type: Input }],
        imageStyle: [{ type: Input }],
        descriptionStyleClass: [{ type: Input }],
        descriptionStyle: [{ type: Input }],
        boxStyleClass: [{ type: Input }],
        boxStyle: [{ type: Input }],
        imageViewStyleClass: [{ type: Input }],
        imageViewStyle: [{ type: Input }],
        showDescription: [{ type: Input }],
        size: [{ type: Input }],
        fileId: [{ type: Input }],
        imageViewTpl: [{ type: ViewChild, args: ['imageView',] }],
        imageViewer: [{ type: ViewChild, args: ['imagesView',] }],
        descriptionChange: [{ type: Output }]
    };
    return PngImageComponent;
}(BaseComponent));
export { PngImageComponent };
if (false) {
    /** @type {?} */
    PngImageComponent.prototype.src;
    /** @type {?} */
    PngImageComponent.prototype.styleClass;
    /** @type {?} */
    PngImageComponent.prototype.style;
    /** @type {?} */
    PngImageComponent.prototype.imageStyleClass;
    /** @type {?} */
    PngImageComponent.prototype.imageStyle;
    /** @type {?} */
    PngImageComponent.prototype.descriptionStyleClass;
    /** @type {?} */
    PngImageComponent.prototype.descriptionStyle;
    /** @type {?} */
    PngImageComponent.prototype.boxStyleClass;
    /** @type {?} */
    PngImageComponent.prototype.boxStyle;
    /** @type {?} */
    PngImageComponent.prototype.imageViewStyleClass;
    /** @type {?} */
    PngImageComponent.prototype.imageViewStyle;
    /** @type {?} */
    PngImageComponent.prototype.showDescription;
    /** @type {?} */
    PngImageComponent.prototype.size;
    /** @type {?} */
    PngImageComponent.prototype.fileId;
    /** @type {?} */
    PngImageComponent.prototype.imageViewTpl;
    /** @type {?} */
    PngImageComponent.prototype.imageViewer;
    /** @type {?} */
    PngImageComponent.prototype.image;
    /** @type {?} */
    PngImageComponent.prototype.fullImage;
    /** @type {?} */
    PngImageComponent.prototype.images;
    /** @type {?} */
    PngImageComponent.prototype.descriptionChange;
    /** @type {?} */
    PngImageComponent.prototype._description;
    /**
     * @type {?}
     * @private
     */
    PngImageComponent.prototype.cd;
    /** @type {?} */
    PngImageComponent.prototype.sanitizer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL3ByaW1lbmcvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9pbWFnZS9jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEVBRU4sV0FBVyxFQUNYLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUFDLGFBQWEsRUFBRSxTQUFTLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFDbEQsT0FBTyxFQUFDLGdCQUFnQixFQUFrQixNQUFNLFdBQVcsQ0FBQztBQUM1RCxPQUFPLEVBQUMsWUFBWSxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFDakUsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBR3pDO0lBeUJ1Qyw2Q0FBYTtJQTRCbEQsMkJBQW9CLEVBQXFCLEVBQVMsU0FBdUI7UUFBekUsWUFDRSxpQkFBTyxTQUNSO1FBRm1CLFFBQUUsR0FBRixFQUFFLENBQW1CO1FBQVMsZUFBUyxHQUFULFNBQVMsQ0FBYztRQWpCaEUsb0JBQWMsR0FBUSxFQUFDLFlBQVksRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFDLENBQUM7UUFDeEYscUJBQWUsR0FBRyxJQUFJLENBQUM7UUFjdEIsdUJBQWlCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7SUFJakQsQ0FBQztJQUlELHNCQUFJLDBDQUFXOzs7O1FBQWY7WUFDRSxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUM7UUFDM0IsQ0FBQzs7Ozs7UUFFRCxVQUFnQixXQUFXO1lBQ3pCLElBQUksQ0FBQyxZQUFZLEdB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LGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2lCQUNoRDs7OztnQkF4Q0MsaUJBQWlCO2dCQVVYLFlBQVk7OztzQkFpQ2pCLEtBQUs7NkJBQ0wsS0FBSzt3QkFDTCxLQUFLO2tDQUNMLEtBQUs7NkJBQ0wsS0FBSzt3Q0FDTCxLQUFLO21DQUNMLEtBQUs7Z0NBQ0wsS0FBSzsyQkFDTCxLQUFLO3NDQUNMLEtBQUs7aUNBQ0wsS0FBSztrQ0FDTCxLQUFLO3VCQUVMLEtBQUs7eUJBQ0wsS0FBSzsrQkFFTCxTQUFTLFNBQUMsV0FBVzs4QkFFckIsU0FBUyxTQUFDLFlBQVk7b0NBT3RCLE1BQU07O0lBdUZULHdCQUFDO0NBQUEsQUExSUQsQ0F5QnVDLGFBQWEsR0FpSG5EO1NBakhZLGlCQUFpQjs7O0lBQzVCLGdDQUFrQjs7SUFDbEIsdUNBQXlCOztJQUN6QixrQ0FBb0I7O0lBQ3BCLDRDQUE4Qjs7SUFDOUIsdUNBQXlCOztJQUN6QixrREFBb0M7O0lBQ3BDLDZDQUErQjs7SUFDL0IsMENBQTRCOztJQUM1QixxQ0FBdUI7O0lBQ3ZCLGdEQUFrQzs7SUFDbEMsMkNBQWlHOztJQUNqRyw0Q0FBZ0M7O0lBRWhDLGlDQUFrQzs7SUFDbEMsbUNBQXdCOztJQUV4Qix5Q0FBdUQ7O0lBRXZELHdDQUErQzs7SUFFL0Msa0NBQVc7O0lBRVgsc0NBQWU7O0lBRWYsbUNBQWE7O0lBQ2IsOENBQWlEOztJQU1qRCx5Q0FBcUI7Ozs7O0lBSlQsK0JBQTZCOztJQUFFLHNDQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE91dHB1dCxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgVGVtcGxhdGVSZWYsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7RG9tU2FuaXRpemVyfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbmltcG9ydCB7QmFzZUNvbXBvbmVudCwgSHR0cFV0aWxzfSBmcm9tICdAZXIvY29yZSc7XG5pbXBvcnQge0h0dHBSZXNwb25zZVR5cGUsIFBvcHVwRGlhbG9nUHJvcH0gZnJvbSAnQGVyL3R5cGVzJztcbmltcG9ydCB7Q29tbW9uc1V0aWxzLCBDb25maWdVdGlscywgRGlhbG9nVXRpbHN9IGZyb20gJ0Blci91dGlscyc7XG5pbXBvcnQge0xpZ2h0Ym94fSBmcm9tICdwcmltZW5nL3ByaW1lbmcnO1xuXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BuZy1pbWFnZScsXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdiBbbmdDbGFzc109XCJzdHlsZUNsYXNzXCIgW25nU3R5bGVdPVwic3R5bGVcIj5cbiAgICAgIDxpbWcgKm5nSWY9XCJpbWFnZVwiXG4gICAgICAgICAgIHN0eWxlPVwibWFyZ2luOiA1cHhcIlxuICAgICAgICAgICBbc3JjXT1cImltYWdlXCJcbiAgICAgICAgICAgW25nQ2xhc3NdPVwiaW1hZ2VTdHlsZUNsYXNzXCJcbiAgICAgICAgICAgW25nU3R5bGVdPVwiaW1hZ2VTdHlsZVwiXG4gICAgICAgICAgIFt0aXRsZV09XCJkZXNjcmlwdGlvbiB8fCAnJ1wiXG4gICAgICAgICAgIChjbGljayk9XCJ2aWV3SW1hZ2UoKVwiLz5cbiAgICAgIDxkaXYgKm5nSWY9XCJzaG93RGVzY3JpcHRpb25cIiBbbmdDbGFzc109XCJkZXNjcmlwdGlvblN0eWxlQ2xhc3NcIiBbbmdTdHlsZV09XCJkZXNjcmlwdGlvblN0eWxlXCI+XG4gICAgICAgIHt7ZGVzY3JpcHRpb259fVxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPG5nLXRlbXBsYXRlICNpbWFnZVZpZXc+XG4gICAgICA8aW1nIFtzcmNdPVwiZnVsbEltYWdlXCIgW25nU3R5bGVdPVwiaW1hZ2VWaWV3U3R5bGVcIiBbbmdDbGFzc109XCJpbWFnZVZpZXdTdHlsZUNsYXNzXCIvPlxuICAgIDwvbmctdGVtcGxhdGU+XG4gICAgPG5nLXRlbXBsYXRlICNpbWFnZXNWaWV3PlxuICAgICAgPHAtbGlnaHRib3ggW2ltYWdlc109XCJpbWFnZXNcIiBbc3R5bGVDbGFzc109XCJib3hTdHlsZUNsYXNzXCIgW3N0eWxlXT1cImJveFN0eWxlXCI+PC9wLWxpZ2h0Ym94PlxuICAgIDwvbmctdGVtcGxhdGU+XG4gIGAsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuXG5leHBvcnQgY2xhc3MgUG5nSW1hZ2VDb21wb25lbnQgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgQElucHV0KCkgc3JjOiBhbnk7XG4gIEBJbnB1dCgpIHN0eWxlQ2xhc3M6IGFueTtcbiAgQElucHV0KCkgc3R5bGU6IGFueTtcbiAgQElucHV0KCkgaW1hZ2VTdHlsZUNsYXNzOiBhbnk7XG4gIEBJbnB1dCgpIGltYWdlU3R5bGU6IGFueTtcbiAgQElucHV0KCkgZGVzY3JpcHRpb25TdHlsZUNsYXNzOiBhbnk7XG4gIEBJbnB1dCgpIGRlc2NyaXB0aW9uU3R5bGU6IGFueTtcbiAgQElucHV0KCkgYm94U3R5bGVDbGFzczogYW55O1xuICBASW5wdXQoKSBib3hTdHlsZTogYW55O1xuICBASW5wdXQoKSBpbWFnZVZpZXdTdHlsZUNsYXNzOiBhbnk7XG4gIEBJbnB1dCgpIGltYWdlVmlld1N0eWxlOiBhbnkgPSB7J21heC1oZWlnaHQnOiAnMzAwcHgnLCAnbWF4LXdpZHRoJzogJzUwMHB4JywgJ292ZXJmbG93JzogJ2F1dG8nfTtcbiAgQElucHV0KCkgc2hvd0Rlc2NyaXB0aW9uID0gdHJ1ZTtcblxuICBASW5wdXQoKSBzaXplOiAnc21hbGwnIHwgJ21lZGl1bSc7XG4gIEBJbnB1dCgpIGZpbGVJZDogc3RyaW5nO1xuXG4gIEBWaWV3Q2hpbGQoJ2ltYWdlVmlldycpIGltYWdlVmlld1RwbDogVGVtcGxhdGVSZWY8YW55PjtcblxuICBAVmlld0NoaWxkKCdpbWFnZXNWaWV3JykgaW1hZ2VWaWV3ZXI6IExpZ2h0Ym94O1xuXG4gIGltYWdlOiBhbnk7XG5cbiAgZnVsbEltYWdlOiBhbnk7XG5cbiAgaW1hZ2VzOiB7fVtdO1xuICBAT3V0cHV0KCkgZGVzY3JpcHRpb25DaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsIHB1YmxpYyBzYW5pdGl6ZXI6IERvbVNhbml0aXplcikge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBfZGVzY3JpcHRpb246IHN0cmluZztcblxuICBnZXQgZGVzY3JpcHRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2Rlc2NyaXB0aW9uO1xuICB9XG5cbiAgc2V0IGRlc2NyaXB0aW9uKGRlc2NyaXB0aW9uKSB7XG4gICAgdGhpcy5fZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICB0aGlzLmRlc2NyaXB0aW9uQ2hhbmdlLmVtaXQoZGVzY3JpcHRpb24pO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGlmIChjaGFuZ2VzLnNyYykge1xuICAgICAgaWYgKENvbW1vbnNVdGlscy5pc0FycmF5KHRoaXMuc3JjKSkge1xuICAgICAgICBpZiAodGhpcy5zcmMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgdGhpcy5pbWFnZXMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgdGhpcy5pbWFnZSA9IHRoaXMuc3JjWzBdO1xuICAgICAgICAgIHRoaXMuZnVsbEltYWdlID0gdGhpcy5zcmNbMF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5pbWFnZXMgPSBbXTtcbiAgICAgICAgICB0aGlzLmltYWdlID0gdGhpcy5zcmNbMF07XG4gICAgICAgICAgdGhpcy5mdWxsSW1hZ2UgPSB0aGlzLnNyY1swXTtcbiAgICAgICAgICAoPGFueVtdPnRoaXMuc3JjKS5mb3JFYWNoKGltYWdlID0+IHtcbiAgICAgICAgICAgIGlmIChDb21tb25zVXRpbHMuaXNTdHJpbmcoaW1hZ2UpKSB7XG4gICAgICAgICAgICAgIHRoaXMuaW1hZ2VzLnB1c2goe3NvdXJjZTogaW1hZ2V9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMuaW1hZ2VzLnB1c2goaW1hZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmltYWdlcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pbWFnZSA9IHRoaXMuc3JjO1xuICAgICAgICB0aGlzLmZ1bGxJbWFnZSA9IHRoaXMuc3JjO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoY2hhbmdlcy5maWxlSWQpIHtcbiAgICAgIGxldCBmaWxlSWQ7XG4gICAgICBpZiAoIXRoaXMuZmlsZUlkKSB7XG4gICAgICAgIHRoaXMuaW1hZ2VzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmltYWdlID0gbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChDb21tb25zVXRpbHMuaXNBcnJheSh0aGlzLmZpbGVJZCkpIHtcbiAgICAgICAgICBpZiAodGhpcy5maWxlSWQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmltYWdlcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuaW1hZ2UgPSBudWxsO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmaWxlSWQgPSB0aGlzLmZpbGVJZFswXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZmlsZUlkID0gdGhpcy5maWxlSWQ7XG4gICAgICAgIH1cbiAgICAgICAgSHR0cFV0aWxzLnJlcXVlc3QoXG4gICAgICAgICAge1xuICAgICAgICAgICAgdXJpOiBgJHtDb25maWdVdGlscy5nZXRDb25maWcoKS5hcGkuc2VydmVyc1snaW1hZ2UnXS51cml9LyR7ZmlsZUlkfSR7dGhpcy5zaXplID8gJz8nICsgdGhpcy5zaXplIDogJyd9YCxcbiAgICAgICAgICAgIG9ic2VydmU6ICdldmVudHMnLFxuICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiBIdHRwUmVzcG9uc2VUeXBlLkJMT0JcbiAgICAgICAgICB9KS5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgICAgIGNvbnN0IG9iamVjdFVSTCA9IHRoaXMuc2FuaXRpemVyLmJ5cGFzc1NlY3VyaXR5VHJ1c3RVcmwoKHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKHJlc3BvbnNlLmJvZHkpKSk7XG4gICAgICAgICAgdGhpcy5pbWFnZXMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgdGhpcy5pbWFnZSA9IG9iamVjdFVSTDtcbiAgICAgICAgICB0aGlzLmZ1bGxJbWFnZSA9IGAke0NvbmZpZ1V0aWxzLmdldENvbmZpZygpLmFwaS5zZXJ2ZXJzWydpbWFnZSddLnVyaX0vJHtmaWxlSWR9YDtcbiAgICAgICAgICBjb25zdCBkZXNjcmlwdGlvbnMgPSByZXNwb25zZS5oZWFkZXJzLmdldEFsbCgnZGVzY3JpcHRpb24nKTtcbiAgICAgICAgICBpZiAoZGVzY3JpcHRpb25zICYmIGRlc2NyaXB0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb25zWzBdO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgdmlld0ltYWdlKCkge1xuICAgIGlmICh0aGlzLmltYWdlcykge1xuICAgICAgdGhpcy5pbWFnZVZpZXdlci5zaG93KCk7XG4gICAgICB0aGlzLmltYWdlVmlld2VyLmNlbnRlcigpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pbWFnZSkge1xuICAgICAgRGlhbG9nVXRpbHMuaW5mbygn5Zu+54mH6aKE6KeIJywgdGhpcy5pbWFnZVZpZXdUcGwsIDxQb3B1cERpYWxvZ1Byb3A+e30pO1xuICAgIH1cbiAgfVxufVxuIl19