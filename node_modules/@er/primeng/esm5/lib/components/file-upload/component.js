/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, forwardRef, Input, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { DomSanitizer } from '@angular/platform-browser';
import { ControlWrapperComponent, HttpUtils, LogUtils } from '@er/core';
import { ImageToolsService } from '@er/image-editor';
import { HttpMethod, NotifyLevel, StateNames } from '@er/types';
import { CommonsUtils, ConfigUtils, StatesUtils } from '@er/utils';
import { FileUpload } from 'primeng/primeng';
import { BehaviorSubject, Subject } from 'rxjs';
import { DEFAULT_PNG_FILE_UPLOAD_PROPS } from './type';
var PngFileUploadComponent = /** @class */ (function (_super) {
    tslib_1.__extends(PngFileUploadComponent, _super);
    function PngFileUploadComponent(imageToolsService, sanitizer, cd) {
        var _this = _super.call(this) || this;
        _this.imageToolsService = imageToolsService;
        _this.sanitizer = sanitizer;
        _this.cd = cd;
        _this.selectedFiles$ = new BehaviorSubject([]);
        _this.uploadedFiles = [];
        _this.$defaultProps = DEFAULT_PNG_FILE_UPLOAD_PROPS;
        _this.showUpload = true;
        _this.uploadProgress$ = new Subject();
        _this.processing$ = new Subject();
        _this.fileAttrs = {};
        return _this;
    }
    Object.defineProperty(PngFileUploadComponent.prototype, "uploadValue", {
        get: /**
         * @return {?}
         */
        function () {
            if (!this.value) {
                return this.value;
            }
            return CommonsUtils.getArrayValue(this.value);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} file
     * @return {?}
     */
    PngFileUploadComponent.prototype.fileIcon = /**
     * @param {?} file
     * @return {?}
     */
    function (file) {
        /** @type {?} */
        var ext = (this.fileUpload.getFileExtension(file) || '').toLowerCase();
        ext = ext.substring(1, 4);
        /** @type {?} */
        var exts = ['txt', 'doc', 'xls', '.pdf', '.zip'];
        /** @type {?} */
        var icon;
        switch (ext) {
            case 'txt':
                icon = 'text';
                break;
            case 'xls':
                icon = 'excel';
                break;
            case 'doc':
                icon = 'word';
                break;
            case 'zip':
                icon = 'zip';
                break;
            case 'pdf':
                icon = 'pdf';
                break;
            case 'mp3':
                icon = 'audio';
                break;
            case 'mp4':
                icon = 'video';
                break;
            default:
                icon = exts.indexOf(ext) >= 0 ? ext : undefined;
        }
        return icon ? "file-" + icon + "-o" : 'file-o';
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    PngFileUploadComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
    };
    /**
     * @param {?} model
     * @return {?}
     */
    PngFileUploadComponent.prototype.writeValue = /**
     * @param {?} model
     * @return {?}
     */
    function (model) {
        _super.prototype.writeValue.call(this, model);
        this.showUpload = !((model && this.$props && !this.$props.multiple));
        this.cd.detectChanges();
    };
    /**
     * @return {?}
     */
    PngFileUploadComponent.prototype.onPropsInit = /**
     * @return {?}
     */
    function () {
        _super.prototype.onPropsInit.call(this);
        if (!this.$props.url) {
            this.$props.url = "" + ConfigUtils.getConfig().api.servers.image.uri;
            LogUtils.debug(this, '文件上传路径', this.$props.url);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngFileUploadComponent.prototype.onSelect = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        /** @type {?} */
        var files = event.files;
        var _loop_1 = function (i) {
            /** @type {?} */
            var file = files[i];
            this_1.processing$.next(true);
            this_1.imageToolsService.resizeImage(file, this_1.$props.$ext.maxWidth, this_1.$props.$ext.maxHeight).subscribe(function (result) {
                _this.imageToolsService.compressImage(result, _this.$props.$ext.maxSize).subscribe(function (final) {
                    final['objectURL'] = _this.sanitizer.bypassSecurityTrustUrl((URL.createObjectURL(final)));
                    _this.selectedFiles$.next(_this.selectedFiles$.value.concat(final));
                    _this.processing$.next(false);
                    _this.fileUpload.files = _this.fileUpload.files.map(function (f) { return f.name === file.name ? final : f; });
                });
            });
        };
        var this_1 = this;
        for (var i = 0; i < files.length; i++) {
            _loop_1(i);
        }
    };
    /**
     * @param {?} event
     * @param {?} i
     * @return {?}
     */
    PngFileUploadComponent.prototype.delete = /**
     * @param {?} event
     * @param {?} i
     * @return {?}
     */
    function (event, i) {
        /** @type {?} */
        var files = this.selectedFiles$.value;
        files.splice(i, 1);
        this.selectedFiles$.next(files);
        this.fileUpload.remove(event, i);
    };
    /**
     * @param {?} fileId
     * @return {?}
     */
    PngFileUploadComponent.prototype.remove = /**
     * @param {?} fileId
     * @return {?}
     */
    function (fileId) {
        var _this = this;
        this.$subscriptions = HttpUtils.request({
            uri: ConfigUtils.getConfig().api.servers.image.uri + "/" + fileId,
            method: HttpMethod.DELETE
        }).subscribe(function (resp) {
            if (resp && resp.success) {
                if (_this.$props.multiple) {
                    _this.value = _this.value.filter(function (v) { return v !== fileId; });
                }
                else {
                    _this.value = undefined;
                }
                _this.showUpload = true;
                _this.cd.detectChanges();
            }
        });
    };
    /**
     * @param {?} event
     * @param {?} file
     * @return {?}
     */
    PngFileUploadComponent.prototype.setFileAttr = /**
     * @param {?} event
     * @param {?} file
     * @return {?}
     */
    function (event, file) {
        this.fileAttrs[file.name] = event.target.value;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngFileUploadComponent.prototype.onBeforeSend = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        /** @type {?} */
        var formData = event.formData;
        formData.append(this.$props.$ext.attrsName, "waterMark=" + this.$props.$ext.waterMark);
        formData.append(this.$props.$ext.attrsName, "smallSize=" + this.$props.$ext.smallSize);
        formData.append(this.$props.$ext.attrsName, "storeTo=" + this.$props.$ext.storeTo);
        if (!CommonsUtils.isEmpty(this.fileAttrs)) {
            Object.keys(this.fileAttrs).forEach(function (key) {
                formData.append(_this.$props.$ext.attrsName, key + "=" + _this.fileAttrs[key]);
            });
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngFileUploadComponent.prototype.onProgress = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.uploadProgress$.next(event.progress);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngFileUploadComponent.prototype.onUploadSuccess = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var e_1, _a;
        try {
            for (var _b = tslib_1.__values(event.files), _c = _b.next(); !_c.done; _c = _b.next()) {
                var file = _c.value;
                this.uploadedFiles.push(file);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        /** @type {?} */
        var response = JSON.parse(event.xhr.responseText);
        if (response.success) {
            StatesUtils.create(StateNames.notify, {
                message: '文件上传成功',
                title: '提示'
            });
            if (this.$props.multiple) {
                this.value = tslib_1.__spread(this.value || [], Object.keys(response.content).map(function (k) { return response.content[k]; }));
            }
            else {
                this.value = Object.keys(response.content).map(function (k) { return response.content[k]; })[0];
                this.showUpload = false;
            }
            this.fileAttrs = {};
            this.selectedFiles$.next([]);
            this.uploadProgress$.next(undefined);
            this.cd.detectChanges();
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngFileUploadComponent.prototype.onUploadFailed = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var response = JSON.parse(event.xhr.responseText);
        StatesUtils.create(StateNames.notify, {
            level: NotifyLevel.ERROR,
            message: response.message,
            title: '文件上传失败'
        });
        this.uploadProgress$.next(undefined);
    };
    PngFileUploadComponent.decorators = [
        { type: Component, args: [{
                    selector: 'png-file-upload',
                    template: "\n    <ng-container *ngIf=\"showUpload\">\n      <p-fileUpload\n        #fileUpload\n        erPropsBind\n        [props]=\"$props || {}\"\n        [context]=\"ctx\"\n        (onSelect)=\"onSelect($event)\"\n        (onUpload)=\"onUploadSuccess($event)\"\n        (onError)=\"onUploadFailed($event)\"\n        (onProgress)=\"onProgress($event)\"\n        (onBeforeSend)=\"onBeforeSend($event)\"\n      >\n        <ng-template pTemplate=\"toolbar\">\n          <div *ngIf=\"uploadProgress$|async as uploadProgress\">\n            <p-progressBar [value]=\"uploadProgress\"></p-progressBar>\n          </div>\n        </ng-template>\n        <ng-template pTemplate=\"file\"></ng-template>\n        <ng-template pTemplate=\"content\">\n          <span class=\"text-muted small\" *ngIf=\"!fileUpload.hasFiles()\">\u60A8\u4E5F\u53EF\u4EE5\u62D6\u52A8\u6587\u4EF6\u5230\u8FD9\u91CC</span>\n        </ng-template>\n      </p-fileUpload>\n      <div *ngIf=\"processing$|async\"><i class=\"fa fa-spin fa-gears\"></i>\u6B63\u5728\u5904\u7406\u56FE\u7247</div>\n      <div class=\"ui-fileupload-row\" *ngFor=\"let file of selectedFiles$|async; let i = index\">\n      <div>\n        <span class=\"badge badge-info\">{{i + 1}}</span>\n      </div>\n      <div>\n        <png-image *ngIf=\"fileUpload.isImage(file)\"\n                   [src]=\"file['objectURL']\" [imageStyle]=\"{width: $props.previewWidth + 'px'}\">\n        </png-image>\n        <span *ngIf=\"!fileUpload.isImage(file)\" class=\"fa fa-2x text-primary fa-{{fileIcon(file)}}\"></span>\n      </div>\n      <div>{{file.name}}</div>\n      <div>{{fileUpload.formatSize(file.size)}}<span class=\"text-danger\">(\u538B\u7F29\u540E)</span></div>\n      <div>\n        <input pInputText placeholder=\"\u56FE\u7247\u63CF\u8FF0\u4FE1\u606F\" size=\"50\" (change)=\"setFileAttr($event,file)\"/>\n      </div>\n      <div>\n        <button type=\"button\" icon=\"pi pi-times white\" pButton (click)=\"delete($event,i)\"></button>\n      </div>\n    </div>\n    </ng-container>\n\n    <div *ngIf=\"uploadValue && uploadValue.length>0\">\n      <div style=\"text-decoration: underline;font-weight: bold\">\u5DF2\u4E0A\u4F20\u6587\u4EF6\uFF1A</div>\n      <div class=\"ui-fileupload-row\" *ngFor=\"let fileId of uploadValue\">\n        <div>\n          <png-image [fileId]=\"fileId\" size=\"small\"\n                     styleClass=\"d-flex align-items-center\"\n                     imageStyleClass=\"mr-3\"\n                     [imageStyle]=\"{width:$props.previewWidth}\">\n          </png-image>\n        </div>\n        <div>\n          <button type=\"button\" icon=\"pi pi-times white\" pButton (click)=\"remove(fileId)\"></button>\n        </div>\n      </div>\n    </div>\n  ",
                    providers: [{
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(function () { return PngFileUploadComponent; }),
                            multi: true
                        }]
                }] }
    ];
    /** @nocollapse */
    PngFileUploadComponent.ctorParameters = function () { return [
        { type: ImageToolsService },
        { type: DomSanitizer },
        { type: ChangeDetectorRef }
    ]; };
    PngFileUploadComponent.propDecorators = {
        maxSize: [{ type: Input }],
        fileUpload: [{ type: ViewChild, args: ['fileUpload',] }]
    };
    return PngFileUploadComponent;
}(ControlWrapperComponent));
export { PngFileUploadComponent };
if (false) {
    /** @type {?} */
    PngFileUploadComponent.prototype.maxSize;
    /** @type {?} */
    PngFileUploadComponent.prototype.selectedFiles$;
    /** @type {?} */
    PngFileUploadComponent.prototype.uploadedFiles;
    /** @type {?} */
    PngFileUploadComponent.prototype.$defaultProps;
    /** @type {?} */
    PngFileUploadComponent.prototype.currentFile;
    /** @type {?} */
    PngFileUploadComponent.prototype.showUpload;
    /** @type {?} */
    PngFileUploadComponent.prototype.uploadProgress$;
    /** @type {?} */
    PngFileUploadComponent.prototype.processing$;
    /** @type {?} */
    PngFileUploadComponent.prototype.fileUpload;
    /** @type {?} */
    PngFileUploadComponent.prototype.fileAttrs;
    /**
     * @type {?}
     * @private
     */
    PngFileUploadComponent.prototype.imageToolsService;
    /** @type {?} */
    PngFileUploadComponent.prototype.sanitizer;
    /**
     * @type {?}
     * @private
     */
    PngFileUploadComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL3ByaW1lbmcvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9maWxlLXVwbG9hZC9jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUMsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQTRCLFNBQVMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNuSCxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqRCxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUFDLHVCQUF1QixFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFDdEUsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sa0JBQWtCLENBQUM7QUFDbkQsT0FBTyxFQUFDLFVBQVUsRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQzlELE9BQU8sRUFBQyxZQUFZLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUNqRSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFDLGVBQWUsRUFBRSxPQUFPLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFFOUMsT0FBTyxFQUFDLDZCQUE2QixFQUFxQixNQUFNLFFBQVEsQ0FBQztBQUl6RTtJQXNFNEMsa0RBQTJDO0lBc0JyRixnQ0FBb0IsaUJBQW9DLEVBQVMsU0FBdUIsRUFBVSxFQUFxQjtRQUF2SCxZQUNFLGlCQUFPLFNBQ1I7UUFGbUIsdUJBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUFTLGVBQVMsR0FBVCxTQUFTLENBQWM7UUFBVSxRQUFFLEdBQUYsRUFBRSxDQUFtQjtRQWxCdkgsb0JBQWMsR0FBNEIsSUFBSSxlQUFlLENBQUMsRUFBRSxDQUFD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UEQsQ0FzRTRDLHVCQUF1QixHQW1MbEU7U0FuTFksc0JBQXNCOzs7SUFFakMseUNBQXlCOztJQUV6QixnREFBa0U7O0lBRWxFLCtDQUEwQjs7SUFFMUIsK0NBQThDOztJQUU5Qyw2Q0FBa0I7O0lBRWxCLDRDQUFrQjs7SUFFbEIsaURBQWlEOztJQUVqRCw2Q0FBOEM7O0lBRTlDLDRDQUFnRDs7SUFFaEQsMkNBQTBDOzs7OztJQUU5QixtREFBNEM7O0lBQUUsMkNBQThCOzs7OztJQUFFLG9DQUE2QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgZm9yd2FyZFJlZiwgSW5wdXQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7TkdfVkFMVUVfQUNDRVNTT1J9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7RG9tU2FuaXRpemVyfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbmltcG9ydCB7Q29udHJvbFdyYXBwZXJDb21wb25lbnQsIEh0dHBVdGlscywgTG9nVXRpbHN9IGZyb20gJ0Blci9jb3JlJztcbmltcG9ydCB7SW1hZ2VUb29sc1NlcnZpY2V9IGZyb20gJ0Blci9pbWFnZS1lZGl0b3InO1xuaW1wb3J0IHtIdHRwTWV0aG9kLCBOb3RpZnlMZXZlbCwgU3RhdGVOYW1lc30gZnJvbSAnQGVyL3R5cGVzJztcbmltcG9ydCB7Q29tbW9uc1V0aWxzLCBDb25maWdVdGlscywgU3RhdGVzVXRpbHN9IGZyb20gJ0Blci91dGlscyc7XG5pbXBvcnQge0ZpbGVVcGxvYWR9IGZyb20gJ3ByaW1lbmcvcHJpbWVuZyc7XG5pbXBvcnQge0JlaGF2aW9yU3ViamVjdCwgU3ViamVjdH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7REVGQVVMVF9QTkdfRklMRV9VUExPQURfUFJPUFMsIFBuZ0ZpbGVVcGxvYWRQcm9wc30gZnJvbSAnLi90eXBlJztcblxuZXhwb3J0IHtQbmdGaWxlVXBsb2FkUHJvcHN9IGZyb20gJy4vdHlwZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BuZy1maWxlLXVwbG9hZCcsXG4gIHRlbXBsYXRlOiBgXG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInNob3dVcGxvYWRcIj5cbiAgICAgIDxwLWZpbGVVcGxvYWRcbiAgICAgICAgI2ZpbGVVcGxvYWRcbiAgICAgICAgZXJQcm9wc0JpbmRcbiAgICAgICAgW3Byb3BzXT1cIiRwcm9wcyB8fCB7fVwiXG4gICAgICAgIFtjb250ZXh0XT1cImN0eFwiXG4gICAgICAgIChvblNlbGVjdCk9XCJvblNlbGVjdCgkZXZlbnQpXCJcbiAgICAgICAgKG9uVXBsb2FkKT1cIm9uVXBsb2FkU3VjY2VzcygkZXZlbnQpXCJcbiAgICAgICAgKG9uRXJyb3IpPVwib25VcGxvYWRGYWlsZWQoJGV2ZW50KVwiXG4gICAgICAgIChvblByb2dyZXNzKT1cIm9uUHJvZ3Jlc3MoJGV2ZW50KVwiXG4gICAgICAgIChvbkJlZm9yZVNlbmQpPVwib25CZWZvcmVTZW5kKCRldmVudClcIlxuICAgICAgPlxuICAgICAgICA8bmctdGVtcGxhdGUgcFRlbXBsYXRlPVwidG9vbGJhclwiPlxuICAgICAgICAgIDxkaXYgKm5nSWY9XCJ1cGxvYWRQcm9ncmVzcyR8YXN5bmMgYXMgdXBsb2FkUHJvZ3Jlc3NcIj5cbiAgICAgICAgICAgIDxwLXByb2dyZXNzQmFyIFt2YWx1ZV09XCJ1cGxvYWRQcm9ncmVzc1wiPjwvcC1wcm9ncmVzc0Jhcj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgPG5nLXRlbXBsYXRlIHBUZW1wbGF0ZT1cImZpbGVcIj48L25nLXRlbXBsYXRlPlxuICAgICAgICA8bmctdGVtcGxhdGUgcFRlbXBsYXRlPVwiY29udGVudFwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGV4dC1tdXRlZCBzbWFsbFwiICpuZ0lmPVwiIWZpbGVVcGxvYWQuaGFzRmlsZXMoKVwiPuaCqOS5n+WPr+S7peaLluWKqOaWh+S7tuWIsOi/memHjDwvc3Bhbj5cbiAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgIDwvcC1maWxlVXBsb2FkPlxuICAgICAgPGRpdiAqbmdJZj1cInByb2Nlc3NpbmckfGFzeW5jXCI+PGkgY2xhc3M9XCJmYSBmYS1zcGluIGZhLWdlYXJzXCI+PC9pPuato+WcqOWkhOeQhuWbvueJhzwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cInVpLWZpbGV1cGxvYWQtcm93XCIgKm5nRm9yPVwibGV0IGZpbGUgb2Ygc2VsZWN0ZWRGaWxlcyR8YXN5bmM7IGxldCBpID0gaW5kZXhcIj5cbiAgICAgIDxkaXY+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwiYmFkZ2UgYmFkZ2UtaW5mb1wiPnt7aSArIDF9fTwvc3Bhbj5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdj5cbiAgICAgICAgPHBuZy1pbWFnZSAqbmdJZj1cImZpbGVVcGxvYWQuaXNJbWFnZShmaWxlKVwiXG4gICAgICAgICAgICAgICAgICAgW3NyY109XCJmaWxlWydvYmplY3RVUkwnXVwiIFtpbWFnZVN0eWxlXT1cInt3aWR0aDogJHByb3BzLnByZXZpZXdXaWR0aCArICdweCd9XCI+XG4gICAgICAgIDwvcG5nLWltYWdlPlxuICAgICAgICA8c3BhbiAqbmdJZj1cIiFmaWxlVXBsb2FkLmlzSW1hZ2UoZmlsZSlcIiBjbGFzcz1cImZhIGZhLTJ4IHRleHQtcHJpbWFyeSBmYS17e2ZpbGVJY29uKGZpbGUpfX1cIj48L3NwYW4+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXY+e3tmaWxlLm5hbWV9fTwvZGl2PlxuICAgICAgPGRpdj57e2ZpbGVVcGxvYWQuZm9ybWF0U2l6ZShmaWxlLnNpemUpfX08c3BhbiBjbGFzcz1cInRleHQtZGFuZ2VyXCI+KOWOi+e8qeWQjik8L3NwYW4+PC9kaXY+XG4gICAgICA8ZGl2PlxuICAgICAgICA8aW5wdXQgcElucHV0VGV4dCBwbGFjZWhvbGRlcj1cIuWbvueJh+aPj+i/sOS/oeaBr1wiIHNpemU9XCI1MFwiIChjaGFuZ2UpPVwic2V0RmlsZUF0dHIoJGV2ZW50LGZpbGUpXCIvPlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2PlxuICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBpY29uPVwicGkgcGktdGltZXMgd2hpdGVcIiBwQnV0dG9uIChjbGljayk9XCJkZWxldGUoJGV2ZW50LGkpXCI+PC9idXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8L25nLWNvbnRhaW5lcj5cblxuICAgIDxkaXYgKm5nSWY9XCJ1cGxvYWRWYWx1ZSAmJiB1cGxvYWRWYWx1ZS5sZW5ndGg+MFwiPlxuICAgICAgPGRpdiBzdHlsZT1cInRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lO2ZvbnQtd2VpZ2h0OiBib2xkXCI+5bey5LiK5Lyg5paH5Lu277yaPC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwidWktZmlsZXVwbG9hZC1yb3dcIiAqbmdGb3I9XCJsZXQgZmlsZUlkIG9mIHVwbG9hZFZhbHVlXCI+XG4gICAgICAgIDxkaXY+XG4gICAgICAgICAgPHBuZy1pbWFnZSBbZmlsZUlkXT1cImZpbGVJZFwiIHNpemU9XCJzbWFsbFwiXG4gICAgICAgICAgICAgICAgICAgICBzdHlsZUNsYXNzPVwiZC1mbGV4IGFsaWduLWl0ZW1zLWNlbnRlclwiXG4gICAgICAgICAgICAgICAgICAgICBpbWFnZVN0eWxlQ2xhc3M9XCJtci0zXCJcbiAgICAgICAgICAgICAgICAgICAgIFtpbWFnZVN0eWxlXT1cInt3aWR0aDokcHJvcHMucHJldmlld1dpZHRofVwiPlxuICAgICAgICAgIDwvcG5nLWltYWdlPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdj5cbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBpY29uPVwicGkgcGktdGltZXMgd2hpdGVcIiBwQnV0dG9uIChjbGljayk9XCJyZW1vdmUoZmlsZUlkKVwiPjwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICBgLFxuICBwcm92aWRlcnM6IFt7XG4gICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gUG5nRmlsZVVwbG9hZENvbXBvbmVudCksXG4gICAgbXVsdGk6IHRydWVcbiAgfV1cbn0pXG5cbmV4cG9ydCBjbGFzcyBQbmdGaWxlVXBsb2FkQ29tcG9uZW50IGV4dGVuZHMgQ29udHJvbFdyYXBwZXJDb21wb25lbnQ8UG5nRmlsZVVwbG9hZFByb3BzPiBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG5cbiAgQElucHV0KCkgbWF4U2l6ZTogbnVtYmVyO1xuXG4gIHNlbGVjdGVkRmlsZXMkOiBCZWhhdmlvclN1YmplY3Q8RmlsZVtdPiA9IG5ldyBCZWhhdmlvclN1YmplY3QoW10pO1xuXG4gIHVwbG9hZGVkRmlsZXM6IGFueVtdID0gW107XG5cbiAgJGRlZmF1bHRQcm9wcyA9IERFRkFVTFRfUE5HX0ZJTEVfVVBMT0FEX1BST1BTO1xuXG4gIGN1cnJlbnRGaWxlOiBGaWxlO1xuXG4gIHNob3dVcGxvYWQgPSB0cnVlO1xuXG4gIHVwbG9hZFByb2dyZXNzJDogU3ViamVjdDxudW1iZXI+ID0gbmV3IFN1YmplY3QoKTtcblxuICBwcm9jZXNzaW5nJDogU3ViamVjdDxib29sZWFuPiA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgQFZpZXdDaGlsZCgnZmlsZVVwbG9hZCcpIGZpbGVVcGxvYWQ6IEZpbGVVcGxvYWQ7XG5cbiAgZmlsZUF0dHJzOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge307XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBpbWFnZVRvb2xzU2VydmljZTogSW1hZ2VUb29sc1NlcnZpY2UsIHB1YmxpYyBzYW5pdGl6ZXI6IERvbVNhbml0aXplciwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgZ2V0IHVwbG9hZFZhbHVlKCkge1xuICAgIGlmICghdGhpcy52YWx1ZSkge1xuICAgICAgcmV0dXJuIHRoaXMudmFsdWU7XG4gICAgfVxuICAgIHJldHVybiBDb21tb25zVXRpbHMuZ2V0QXJyYXlWYWx1ZSh0aGlzLnZhbHVlKTtcbiAgfVxuXG4gIGZpbGVJY29uKGZpbGUpIHtcbiAgICBsZXQgZXh0ID0gKHRoaXMuZmlsZVVwbG9hZC5nZXRGaWxlRXh0ZW5zaW9uKGZpbGUpIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICAgIGV4dCA9IGV4dC5zdWJzdHJpbmcoMSwgNCk7XG4gICAgY29uc3QgZXh0cyA9IFsndHh0JywgJ2RvYycsICd4bHMnLCAnLnBkZicsICcuemlwJ107XG4gICAgbGV0IGljb247XG4gICAgc3dpdGNoIChleHQpIHtcbiAgICAgIGNhc2UgJ3R4dCc6XG4gICAgICAgIGljb24gPSAndGV4dCc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAneGxzJzpcbiAgICAgICAgaWNvbiA9ICdleGNlbCc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZG9jJzpcbiAgICAgICAgaWNvbiA9ICd3b3JkJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd6aXAnOlxuICAgICAgICBpY29uID0gJ3ppcCc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncGRmJzpcbiAgICAgICAgaWNvbiA9ICdwZGYnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ21wMyc6XG4gICAgICAgIGljb24gPSAnYXVkaW8nO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ21wNCc6XG4gICAgICAgIGljb24gPSAndmlkZW8nO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGljb24gPSBleHRzLmluZGV4T2YoZXh0KSA+PSAwID8gZXh0IDogdW5kZWZpbmVkO1xuICAgIH1cbiAgICByZXR1cm4gaWNvbiA/IGBmaWxlLSR7aWNvbn0tb2AgOiAnZmlsZS1vJztcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgfVxuXG4gIHdyaXRlVmFsdWUobW9kZWwpIHtcbiAgICBzdXBlci53cml0ZVZhbHVlKG1vZGVsKTtcbiAgICB0aGlzLnNob3dVcGxvYWQgPSAhKChtb2RlbCAmJiB0aGlzLiRwcm9wcyAmJiAhdGhpcy4kcHJvcHMubXVsdGlwbGUpKTtcbiAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIG9uUHJvcHNJbml0KCkge1xuICAgIHN1cGVyLm9uUHJvcHNJbml0KCk7XG4gICAgaWYgKCF0aGlzLiRwcm9wcy51cmwpIHtcbiAgICAgIHRoaXMuJHByb3BzLnVybCA9IGAke0NvbmZpZ1V0aWxzLmdldENvbmZpZygpLmFwaS5zZXJ2ZXJzLmltYWdlLnVyaX1gO1xuICAgICAgTG9nVXRpbHMuZGVidWcodGhpcywgJ+aWh+S7tuS4iuS8oOi3r+W+hCcsIHRoaXMuJHByb3BzLnVybCk7XG4gICAgfVxuICB9XG5cbiAgb25TZWxlY3QoZXZlbnQpIHtcbiAgICBjb25zdCBmaWxlcyA9IGV2ZW50LmZpbGVzO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGZpbGUgPSBmaWxlc1tpXTtcbiAgICAgIHRoaXMucHJvY2Vzc2luZyQubmV4dCh0cnVlKTtcbiAgICAgIHRoaXMuaW1hZ2VUb29sc1NlcnZpY2UucmVzaXplSW1hZ2UoZmlsZSwgdGhpcy4kcHJvcHMuJGV4dC5tYXhXaWR0aCwgdGhpcy4kcHJvcHMuJGV4dC5tYXhIZWlnaHQpLnN1YnNjcmliZShyZXN1bHQgPT4ge1xuICAgICAgICB0aGlzLmltYWdlVG9vbHNTZXJ2aWNlLmNvbXByZXNzSW1hZ2UocmVzdWx0LCB0aGlzLiRwcm9wcy4kZXh0Lm1heFNpemUpLnN1YnNjcmliZShmaW5hbCA9PiB7XG4gICAgICAgICAgZmluYWxbJ29iamVjdFVSTCddID0gdGhpcy5zYW5pdGl6ZXIuYnlwYXNzU2VjdXJpdHlUcnVzdFVybCgoVVJMLmNyZWF0ZU9iamVjdFVSTChmaW5hbCkpKTtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkRmlsZXMkLm5leHQodGhpcy5zZWxlY3RlZEZpbGVzJC52YWx1ZS5jb25jYXQoZmluYWwpKTtcbiAgICAgICAgICB0aGlzLnByb2Nlc3NpbmckLm5leHQoZmFsc2UpO1xuICAgICAgICAgIHRoaXMuZmlsZVVwbG9hZC5maWxlcyA9IHRoaXMuZmlsZVVwbG9hZC5maWxlcy5tYXAoZiA9PiBmLm5hbWUgPT09IGZpbGUubmFtZSA/IGZpbmFsIDogZik7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZGVsZXRlKGV2ZW50LCBpKSB7XG4gICAgY29uc3QgZmlsZXMgPSB0aGlzLnNlbGVjdGVkRmlsZXMkLnZhbHVlO1xuICAgIGZpbGVzLnNwbGljZShpLCAxKTtcbiAgICB0aGlzLnNlbGVjdGVkRmlsZXMkLm5leHQoZmlsZXMpO1xuICAgIHRoaXMuZmlsZVVwbG9hZC5yZW1vdmUoZXZlbnQsIGkpO1xuICB9XG5cbiAgcmVtb3ZlKGZpbGVJZCkge1xuICAgIHRoaXMuJHN1YnNjcmlwdGlvbnMgPSBIdHRwVXRpbHMucmVxdWVzdCh7XG4gICAgICAgIHVyaTogYCR7Q29uZmlnVXRpbHMuZ2V0Q29uZmlnKCkuYXBpLnNlcnZlcnMuaW1hZ2UudXJpfS8ke2ZpbGVJZH1gLFxuICAgICAgICBtZXRob2Q6IEh0dHBNZXRob2QuREVMRVRFXG4gICAgICB9XG4gICAgKS5zdWJzY3JpYmUocmVzcCA9PiB7XG4gICAgICBpZiAocmVzcCAmJiByZXNwLnN1Y2Nlc3MpIHtcbiAgICAgICAgaWYgKHRoaXMuJHByb3BzLm11bHRpcGxlKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMudmFsdWUuZmlsdGVyKHYgPT4gdiAhPT0gZmlsZUlkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2hvd1VwbG9hZCA9IHRydWU7XG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgc2V0RmlsZUF0dHIoZXZlbnQsIGZpbGUpIHtcbiAgICB0aGlzLmZpbGVBdHRyc1tmaWxlLm5hbWVdID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICB9XG5cbiAgb25CZWZvcmVTZW5kKGV2ZW50KSB7XG4gICAgY29uc3QgZm9ybURhdGEgPSBldmVudC5mb3JtRGF0YTtcbiAgICBmb3JtRGF0YS5hcHBlbmQodGhpcy4kcHJvcHMuJGV4dC5hdHRyc05hbWUsIGB3YXRlck1hcms9JHt0aGlzLiRwcm9wcy4kZXh0LndhdGVyTWFya31gKTtcbiAgICBmb3JtRGF0YS5hcHBlbmQodGhpcy4kcHJvcHMuJGV4dC5hdHRyc05hbWUsIGBzbWFsbFNpemU9JHt0aGlzLiRwcm9wcy4kZXh0LnNtYWxsU2l6ZX1gKTtcbiAgICBmb3JtRGF0YS5hcHBlbmQodGhpcy4kcHJvcHMuJGV4dC5hdHRyc05hbWUsIGBzdG9yZVRvPSR7dGhpcy4kcHJvcHMuJGV4dC5zdG9yZVRvfWApO1xuICAgIGlmICghQ29tbW9uc1V0aWxzLmlzRW1wdHkodGhpcy5maWxlQXR0cnMpKSB7XG4gICAgICBPYmplY3Qua2V5cyh0aGlzLmZpbGVBdHRycykuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQodGhpcy4kcHJvcHMuJGV4dC5hdHRyc05hbWUsIGAke2tleX09JHt0aGlzLmZpbGVBdHRyc1trZXldfWApO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgb25Qcm9ncmVzcyhldmVudCkge1xuICAgIHRoaXMudXBsb2FkUHJvZ3Jlc3MkLm5leHQoZXZlbnQucHJvZ3Jlc3MpO1xuICB9XG5cbiAgb25VcGxvYWRTdWNjZXNzKGV2ZW50KSB7XG4gICAgZm9yIChjb25zdCBmaWxlIG9mIGV2ZW50LmZpbGVzKSB7XG4gICAgICB0aGlzLnVwbG9hZGVkRmlsZXMucHVzaChmaWxlKTtcbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBKU09OLnBhcnNlKGV2ZW50Lnhoci5yZXNwb25zZVRleHQpO1xuICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICBTdGF0ZXNVdGlscy5jcmVhdGUoU3RhdGVOYW1lcy5ub3RpZnksIHtcbiAgICAgICAgbWVzc2FnZTogJ+aWh+S7tuS4iuS8oOaIkOWKnycsXG4gICAgICAgIHRpdGxlOiAn5o+Q56S6J1xuICAgICAgfSk7XG4gICAgICBpZiAodGhpcy4kcHJvcHMubXVsdGlwbGUpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IFtcbiAgICAgICAgICAuLi50aGlzLnZhbHVlIHx8IFtdLFxuICAgICAgICAgIC4uLk9iamVjdC5rZXlzKHJlc3BvbnNlLmNvbnRlbnQpLm1hcChrID0+IHJlc3BvbnNlLmNvbnRlbnRba10pXG4gICAgICAgIF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnZhbHVlID0gT2JqZWN0LmtleXMocmVzcG9uc2UuY29udGVudCkubWFwKGsgPT4gcmVzcG9uc2UuY29udGVudFtrXSlbMF07XG4gICAgICAgIHRoaXMuc2hvd1VwbG9hZCA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5maWxlQXR0cnMgPSB7fTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRGaWxlcyQubmV4dChbXSk7XG4gICAgICB0aGlzLnVwbG9hZFByb2dyZXNzJC5uZXh0KHVuZGVmaW5lZCk7XG4gICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG4gIH1cblxuICBvblVwbG9hZEZhaWxlZChldmVudCkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gSlNPTi5wYXJzZShldmVudC54aHIucmVzcG9uc2VUZXh0KTtcbiAgICBTdGF0ZXNVdGlscy5jcmVhdGUoU3RhdGVOYW1lcy5ub3RpZnksIHtcbiAgICAgIGxldmVsOiBOb3RpZnlMZXZlbC5FUlJPUixcbiAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlLm1lc3NhZ2UsXG4gICAgICB0aXRsZTogJ+aWh+S7tuS4iuS8oOWksei0pSdcbiAgICB9KTtcbiAgICB0aGlzLnVwbG9hZFByb2dyZXNzJC5uZXh0KHVuZGVmaW5lZCk7XG4gIH1cbn1cbiJdfQ==