/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, forwardRef, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { ActivatedRoute, Router } from '@angular/router';
import { DataAwareControlWrapperComponent } from '@er/core';
import { AggMethodsProps, DataType, Order, OverlayType } from '@er/types';
import { CommonsUtils, DataItemUtils, StatesUtils } from '@er/utils';
import * as esb from 'elastic-builder';
import { Menu, OverlayPanel } from 'primeng/primeng';
import { Table } from 'primeng/table';
import { BehaviorSubject } from 'rxjs';
import { filter, skip } from 'rxjs/operators';
import { defaultActionColumn, defaultAddButton, defaultAuditButton, defaultDeleteButton, defaultDownloadButton, defaultEditButton, defaultPngColumnProps, defaultPngTableProps, defaultRowIndexColumn, defaultViewButton } from '../../default';
import { PngTableUtils } from '../../util';
var PngTableComponent = /** @class */ (function (_super) {
    tslib_1.__extends(PngTableComponent, _super);
    function PngTableComponent(cd, router, activatedRoute) {
        var _this = _super.call(this) || this;
        _this.cd = cd;
        _this.router = router;
        _this.activatedRoute = activatedRoute;
        _this.OVERLAY_TYPE = OverlayType;
        _this.bodyData$ = new BehaviorSubject([]);
        _this.columns$ = new BehaviorSubject(undefined);
        _this.templateNames = {
            caption: 'caption',
            spanHeader: 'spanHeader',
            header: 'header',
            headerSummary: 'headerSummary',
            body: 'body',
            frozenRows: 'frozenRows',
            cell: 'cell',
            dataCell: 'dataCell',
            footer: 'footer',
            footerSummary: 'summary',
            colGroup: 'colgroup',
            rowExpansion: 'rowexpansion',
            paginatorLeft: 'paginatorLeft',
            paginatorRight: 'paginatorRight'
        };
        _this.$defaultProps = defaultPngTableProps;
        _this.eventQuery = [];
        _this.selectedRows = [];
        _this.switch = true;
        return _this;
    }
    Object.defineProperty(PngTableComponent.prototype, "apiEntry", {
        get: /**
         * @return {?}
         */
        function () {
            return this.$props.$ext.apiDataProps && this.$props.$ext.apiDataProps.apiEntry;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PngTableComponent.prototype, "$id", {
        get: /**
         * @return {?}
         */
        function () {
            return this.$props.$id;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PngTableComponent.prototype.onPropsInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.$props.entity) {
            if (!this.$props.caption || this.$props.caption['method']) {
                /** @type {?} */
                var caption = CommonsUtils.getValue(this.$props.caption, this.$props.entity.label);
                this.$props.caption = caption || "\u6D4F\u89C8" + (this.$props.entity.label || '');
            }
            if (!this.$props.$ext.apiDataProps) {
                this.$props.$ext.apiDataProps = {};
            }
            if (!this.$props.$ext.apiDataProps.apiEntry) {
                this.$props.$ext.apiDataProps.apiEntry = this.$props.entity.apiEntry || '';
            }
        }
        if (this.$props.columns) {
            this.resoleActionsColumn(this.$props);
            /** @type {?} */
            var order_1 = 0;
            this.$props.columns.forEach(function (column) {
                PngTableUtils.resolveColumnByDataField(column);
                CommonsUtils.defaults(column, defaultPngColumnProps);
                if (!column.order) {
                    column.order = ++order_1;
                }
                if (_this.$props.scrollable && _this.$props.scrollWidth && column.width && column.width.endsWith('%')) {
                    column.width = defaultPngColumnProps.width;
                }
                if (column.overlays) {
                    column.overlays = CommonsUtils.getArrayValue(column.overlays);
                }
                if (column.headerOverlays) {
                    column.headerOverlays = CommonsUtils.getArrayValue(column.headerOverlays);
                }
            });
        }
        if (this.$props.virtualScroll) {
            this.$props.alwaysShowPaginator = false;
            this.$props.paginator = false;
        }
        if (this.$props.scrollable) {
            CommonsUtils.set(this.$props, 'style.width', this.$props.scrollWidth);
        }
        /** @type {?} */
        var frozenColumns = this.$props.columns.filter(function (column) { return column.frozen; });
        if (frozenColumns.length > 0) {
            this.$props.frozenColumns = frozenColumns;
            if (!this.$props.$ext.rowHeight) {
                this.$props.$ext.rowHeight = '30px';
            }
            /** @type {?} */
            var frozenWidth_1 = 0;
            frozenColumns.forEach(function (column) {
                /** @type {?} */
                var width = 150;
                if (column.width) {
                    width = Number(column.width.substr(0, column.width.length - 2));
                }
                frozenWidth_1 += width || 150;
                column.styleClass = column.styleClass || '' + ' table-frozen-column';
            });
            this.$props.frozenWidth = frozenWidth_1 + "px";
        }
        this.updateColumns();
        this.apiDataProps = this.getApiDataProps();
        this.$subscriptions = StatesUtils.observe(this.$id)
            .pipe(filter(function (state) { return !!state; }), skip(1))
            .subscribe(function (state) {
            _this.table.first = 0;
            _this.load(state);
        });
        if (this.$props.$ext.dataItems) {
            this.data$.next({
                items: this.$props.$ext.dataItems,
                total: this.$props.$ext.dataItems.length
            });
        }
        StatesUtils.create(this.$id, {
            component: this
        }, true);
    };
    /**
     * @param {?=} event
     * @return {?}
     */
    PngTableComponent.prototype.updateColumns = /**
     * @param {?=} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        /** @type {?} */
        var columns;
        if (!event) {
            columns = this.$props.columns.filter(function (column) { return !column.frozen; }) || [];
        }
        else {
            columns = event.value;
        }
        columns.sort(function (a, b) { return a.order - b.order; });
        this.dataColumns = columns.filter(function (column) { return !column.isActionColumn || !(column.hidden && !column.fetch); });
        if (!event) {
            columns = columns.filter(function (column) { return !column.hidden; });
        }
        this.dataColumnNames = CommonsUtils.compact(this.dataColumns.map(function (column) { return column.key; }));
        if (this.$props.frozenColumns) {
            this.$props.frozenColumns.forEach(function (column) {
                if (column.key) {
                    _this.dataColumnNames.push(column.key);
                }
            });
        }
        this.columns$.next(columns);
        if (event) {
            this.load();
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngTableComponent.prototype.updateColAggKeys = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (event.column) {
            /** @type {?} */
            var column_1 = event.column;
            /** @type {?} */
            var aggProps_1 = [];
            if (event.methods && event.methods.length > 0) {
                event.methods.forEach(function (method) {
                    aggProps_1.push((/** @type {?} */ ({
                        name: column_1.key + "-" + method,
                        field: column_1.aggKey || column_1.key,
                        method: AggMethodsProps[method]['key']
                    })));
                });
            }
            column_1.aggProps = aggProps_1;
            StatesUtils.update(this.$id, {});
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngTableComponent.prototype.updateColFilters = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (event.column) {
            /** @type {?} */
            var column = event.column;
            column.filters = [];
            if (event.value) {
                column.filters.push(event.value);
            }
            StatesUtils.update(this.$id, {});
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngTableComponent.prototype.updateSimpleSearch = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (CommonsUtils.isEmpty(event)) {
            this.simpleQuery = undefined;
        }
        else {
            if (event.indexOf('"') === -1) {
                event = "\"" + event + "\"";
            }
            this.simpleQuery = [esb.simpleQueryStringQuery(event)];
        }
        this.load();
    };
    /**
     * @param {?} key
     * @return {?}
     */
    PngTableComponent.prototype.getColumnByKey = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        /** @type {?} */
        var columns = this.$props.columns.filter(function (column) { return column.key === key; });
        if (columns.length >= 1) {
            return columns[0];
        }
        else {
            return undefined;
        }
    };
    /**
     * @param {?} row
     * @return {?}
     */
    PngTableComponent.prototype.getRowStyleClass = /**
     * @param {?} row
     * @return {?}
     */
    function (row) {
        return CommonsUtils.getValue(this.$props.$ext.rowStyleClass, row);
    };
    /**
     * @param {?} row
     * @return {?}
     */
    PngTableComponent.prototype.getRowStyle = /**
     * @param {?} row
     * @return {?}
     */
    function (row) {
        /** @type {?} */
        var style = CommonsUtils.getValue(this.$props.$ext.rowStyle, row) || {};
        if (this.$props.$ext.rowHeight) {
            style['height'] = this.$props.$ext.rowHeight;
        }
        return style;
    };
    /**
     * @param {?} column
     * @return {?}
     */
    PngTableComponent.prototype.getHeaderStyleClass = /**
     * @param {?} column
     * @return {?}
     */
    function (column) {
        return CommonsUtils.getValue(column.headerStyleClass, column);
    };
    /**
     * @param {?} column
     * @return {?}
     */
    PngTableComponent.prototype.getHeaderStyle = /**
     * @param {?} column
     * @return {?}
     */
    function (column) {
        return CommonsUtils.getValue(column.headerStyle, column);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PngTableComponent.prototype.rowSelect = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.updateTouch();
        this.value = DataItemUtils.getItemValue(event, this.$props.$ext.dataItemProps && this.$props.$ext.dataItemProps.valueKey);
    };
    /**
     * @param {?=} state
     * @return {?}
     */
    PngTableComponent.prototype.load = /**
     * @param {?=} state
     * @return {?}
     */
    function (state) {
        this.apiDataProps = this.getApiDataProps(state);
        this.cd.markForCheck();
    };
    /**
     * @param {?} data
     * @return {?}
     */
    PngTableComponent.prototype.onDataReady = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        /** @type {?} */
        var dataPath = CommonsUtils.get(this.$props, '$ext.apiDataProps.dataPath');
        if (dataPath && dataPath !== '/') {
            this.bodyData$.next(data);
        }
        else {
            this.bodyData$.next(data.items || []);
        }
    };
    /**
     * @param {?} ctx
     * @return {?}
     */
    PngTableComponent.prototype.showOverlay = /**
     * @param {?} ctx
     * @return {?}
     */
    function (ctx) {
        if (ctx && ctx.content) {
            this.overlayContext = tslib_1.__assign({ dismissable: true, showCloseIcon: true }, ctx);
            this.overlayPanel.hide();
            this.overlayPanel.toggle(ctx.$event);
            this.cd.detectChanges();
        }
    };
    /**
     * @return {?}
     */
    PngTableComponent.prototype.hidePanel = /**
     * @return {?}
     */
    function () {
        this.overlayPanel.hide();
    };
    /**
     * @return {?}
     */
    PngTableComponent.prototype.resetQuery = /**
     * @return {?}
     */
    function () {
        this.simpleQuery = undefined;
        this.complexQuery = undefined;
    };
    /**
     * @return {?}
     */
    PngTableComponent.prototype.resetForeignQuery = /**
     * @return {?}
     */
    function () {
        this.eventQuery = [];
    };
    /**
     * @param {?} url
     * @param {?=} commands
     * @param {?=} params
     * @return {?}
     */
    PngTableComponent.prototype.navigate = /**
     * @param {?} url
     * @param {?=} commands
     * @param {?=} params
     * @return {?}
     */
    function (url, commands, params) {
        var _a;
        this.router.navigate([{ outlets: (_a = {}, _a[this.$props.$ext.routerOutlet] = tslib_1.__spread([url], commands), _a) }], {
            relativeTo: this.activatedRoute,
            skipLocationChange: false,
            queryParams: params
        });
    };
    /**
     * @return {?}
     */
    PngTableComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.$props && this.$props.$id) {
            StatesUtils.deleteState(this.$props.$id);
        }
        _super.prototype.ngOnDestroy.call(this);
    };
    /**
     * @param {?=} state
     * @return {?}
     */
    PngTableComponent.prototype.getTableQuery = /**
     * @param {?=} state
     * @return {?}
     */
    function (state) {
        var _a;
        if (state && (state.query || state.filter)) {
            this.eventQuery = tslib_1.__spread(CommonsUtils.getArrayValue(state['query'] || {}), CommonsUtils.getArrayValue(state['filter'] || {}));
        }
        /** @type {?} */
        var filters = tslib_1.__spread(this.getColumnsFilters(), this.eventQuery, this.simpleQuery || [], CommonsUtils.getArrayValue(this.complexQuery) || []);
        /** @type {?} */
        var gApiDataProps = CommonsUtils.copy(CommonsUtils.get(this.$props, '$ext.apiDataProps'));
        /** @type {?} */
        var apiFilter = gApiDataProps.filter || {};
        if (apiFilter['$and']) {
            apiFilter['$and'] = tslib_1.__spread(apiFilter['$and'], filters);
        }
        else if (apiFilter['$or']) {
            apiFilter['$and'] = filters;
        }
        else {
            apiFilter = CommonsUtils.getArrayValue(apiFilter)
                .concat(filters);
        }
        apiFilter = apiFilter.filter(function (f) { return !CommonsUtils.isEmpty(f); });
        /** @type {?} */
        var aggProps = gApiDataProps.aggProps || {};
        aggProps = CommonsUtils.getArrayValue(aggProps).concat(this.getColumnsAggs());
        aggProps = aggProps.filter(function (a) { return Object.keys(a).length > 0; });
        /** @type {?} */
        var sort = gApiDataProps.sort || [];
        /** @type {?} */
        var tableMetaData = this.table.createLazyLoadMetadata();
        sort = CommonsUtils.getArrayValue(sort);
        /** @type {?} */
        var tableSort = tableMetaData.sortField;
        if (tableSort) {
            /** @type {?} */
            var column = this.getColumnByKey(tableSort);
            /** @type {?} */
            var sortKey = (column && column.sortKey) || tableSort;
            sort.push((_a = {}, _a[sortKey] = tableMetaData.sortOrder === 1 ? Order.ASC : Order.DESC, _a));
        }
        delete gApiDataProps.filter;
        delete gApiDataProps.aggProps;
        return tslib_1.__assign({}, gApiDataProps, { filter: apiFilter, aggProps: aggProps,
            sort: sort });
    };
    /**
     * @private
     * @return {?}
     */
    PngTableComponent.prototype.getColumnsFilters = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var filters = [];
        /** @type {?} */
        var columns = (this.columns$.value || []).concat(this.$props.frozenColumns || []);
        columns
            .filter(function (column) { return column.filters; })
            .forEach(function (column) {
            return column.filters.filter(function (f) { return f; })
                .forEach(function (f) {
                /** @type {?} */
                var query;
                switch (column.filterDataType || column.dataType || (column.dataField && column.dataField.dataType) || DataType.STRING) {
                    case DataType.NUMBER:
                    case DataType.DATE:
                        if (CommonsUtils.isArray(f)) {
                            query = esb.rangeQuery(column.filterKey || column.key).gte(f[0]).lte(f[1]);
                        }
                        else {
                            query = esb.rangeQuery(column.filterKey || column.key).gte(f).lte(f);
                        }
                        break;
                    default:
                        query = esb.matchQuery(column.filterKey || column.key, f);
                }
                filters.push(query);
            });
        });
        return filters;
    };
    /**
     * @private
     * @return {?}
     */
    PngTableComponent.prototype.getColumnsAggs = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var aggs = [];
        /** @type {?} */
        var columns = (this.columns$.value || []).concat(this.$props.frozenColumns || []);
        columns
            .filter(function (column) { return column.aggProps; })
            .forEach(function (column) {
            aggs = aggs.concat(column.aggProps);
        });
        return aggs;
    };
    /**
     * @private
     * @param {?} props
     * @return {?}
     */
    PngTableComponent.prototype.resoleActionsColumn = /**
     * @private
     * @param {?} props
     * @return {?}
     */
    function (props) {
        /** @type {?} */
        var actionColumn;
        /** @type {?} */
        var actionColumnIndex = -1;
        props.columns.some(function (column, i) {
            if (column.isActionColumn) {
                actionColumn = column;
                actionColumnIndex = i;
                return true;
            }
            return false;
        });
        if (actionColumnIndex >= 0) {
            props.columns = CommonsUtils.removeByIndex(props.columns, actionColumnIndex);
        }
        if (props.$ext.hasAddAction) {
            this.addBtn = tslib_1.__assign({}, defaultAddButton, { context: this });
        }
        /** @type {?} */
        var buttons = [];
        if (props.$ext.hasViewAction) {
            buttons.push(tslib_1.__assign({}, defaultViewButton, { show: props.$ext.hasViewAction }));
        }
        if (props.$ext.hasDeleteAction) {
            buttons.push(tslib_1.__assign({}, defaultDeleteButton, { show: props.$ext.hasDeleteAction }));
        }
        if (props.$ext.hasAuditAction) {
            buttons.push(tslib_1.__assign({}, defaultAuditButton, { show: props.$ext.hasAuditAction }));
        }
        if (props.$ext.hasDownloadAction) {
            buttons.push(tslib_1.__assign({}, defaultDownloadButton, { show: props.$ext.hasDownloadAction }));
        }
        if (props.$ext.hasEditAction) {
            buttons.push(tslib_1.__assign({}, defaultEditButton, { show: props.$ext.hasEditAction }));
        }
        if (buttons.length > 0 && !actionColumn) {
            actionColumn = tslib_1.__assign({}, defaultActionColumn, actionColumn || {});
        }
        if (buttons.length > 0) {
            actionColumn.cellContent = tslib_1.__spread(CommonsUtils.getArrayValue(actionColumn.cellContent) || [], buttons);
        }
        if (actionColumn) {
            if (this.$props.$ext.frozenActionColumn) {
                actionColumn.frozen = true;
            }
            if (this.$props.$ext.rowActionsPlaceAhead) {
                ((/** @type {?} */ (this.$props.columns))).splice(0, 0, actionColumn);
            }
            else {
                this.$props.columns.push(actionColumn);
            }
        }
        if (this.$props.$ext.hasRowIndex) {
            this.$props.columns.splice(0, 0, defaultRowIndexColumn);
        }
    };
    /**
     * @private
     * @param {?=} state
     * @return {?}
     */
    PngTableComponent.prototype.getApiDataProps = /**
     * @private
     * @param {?=} state
     * @return {?}
     */
    function (state) {
        /** @type {?} */
        var tableMetaData = this.table.createLazyLoadMetadata();
        /** @type {?} */
        var tableQuery = this.getTableQuery(state);
        /** @type {?} */
        var apiDataProps = (/** @type {?} */ (tslib_1.__assign({}, tableQuery, { dataPath: '/', returnFields: this.dataColumnNames, from: tableMetaData.first, size: tableMetaData.rows })));
        apiDataProps.requestOptions = apiDataProps.requestOptions || {};
        if (!apiDataProps.requestOptions.tag) {
            apiDataProps.requestOptions.tag = this.$id;
        }
        return apiDataProps;
    };
    PngTableComponent.decorators = [
        { type: Component, args: [{
                    selector: 'png-table',
                    template: "<p-table #pngTable\n         (onDataReady)=\"onDataReady($event)\"\n         (onLazyLoad)=\"load($event)\"\n         (selectionChange)=\"rowSelect($event)\"\n         [(selection)]=\"selectedRows\"\n         [columns]=\"columns$|async\"\n         [context]=\"ctx\"\n         [erApiData]=\"apiDataProps\"\n         [props]=\"$props\"\n         [totalRecords]=\"(data$|async)?.total\"\n         [value]=\"bodyData$|async\"\n         erPropsBind\n>\n  <ng-template pTemplate=\"caption\">\n    <png-table-caption\n      (onSimpleSearch)=\"updateSimpleSearch($event)\"\n      [addButton]=\"addBtn\"\n      [caption]=\"$props.caption\"\n      [customerTpl]=\"template(templateNames.caption)\"\n      [hasAddAction]=\"$props.$ext.hasAddAction\"\n      [hasSearchBox]=\"$props.$ext.hasSearchBox\"\n      [hasSearchInput]=\"$props.$ext.hasSearchInput\"\n    >\n    </png-table-caption>\n    <ng-container *ngIf=\"$props.$ext.caption\">\n      <er-dyna-content [content]=\"$props.$ext.caption\" [context]=\"getEventContext()\"></er-dyna-content>\n    </ng-container>\n  </ng-template>\n\n  <ng-template let-columns pTemplate=\"colgroup\">\n    <ng-container *ngTemplateOutlet=\"colGroupTpl;\n                     context:{$implicit:$props,context:getEventContext(),columns:columns}\">\n    </ng-container>\n  </ng-template>\n\n\n  <ng-template let-columns pTemplate=\"header\">\n    <ng-container\n      *ngTemplateOutlet=\"template(templateNames.spanHeader); context:{$implicit:columns}\"></ng-container>\n    <ng-container *ngIf=\"$props.$ext.spanHeader\">\n      <span [outerHTML]=\"$props.$ext.spanHeader\"></span>\n    </ng-container>\n    <tr (onAggKeysSet)=\"updateColAggKeys($event)\"\n        (onFiltersSet)=\"updateColFilters($event)\"\n        [columns]=\"columns\"\n        [customerTpl]=\"template(templateNames.header)\"\n        png-table-header\n    >\n    </tr>\n\n    <ng-container *ngIf=\"(data$|async)?.aggs as aggValues\">\n      <tr [aggValues]=\"aggValues\"\n          [columns]=\"columns\"\n          [customerTpl]=\"template(templateNames.headerSummary)\"\n          png-table-summary\n      >\n      </tr>\n    </ng-container>\n  </ng-template>\n\n  <!--<ng-container *ngIf=\"$$props.frozenValue\">-->\n  <!--<ng-template pTemplate=\"frozenrows\" let-row let-columns=\"columns\">-->\n  <!--<ng-container *ngTemplateOutlet=\"template(templateNames.frozenRows,defaultBodyTpl);-->\n  <!--context:{$implicit:row,columns:columns,$props:$$props,table:pngTable}\">-->\n  <!--</ng-container>-->\n  <!--</ng-template>-->\n  <!--</ng-container>-->\n\n  <ng-template let-columns=\"columns\" let-expanded=\"expanded\" let-row let-rowIndex=\"rowIndex\" pTemplate=\"body\">\n    <tr [cellTpl]=\"template(templateNames.cell)\"\n        [columns]=\"columns\"\n        [customerTpl]=\"template(templateNames.body)\"\n        [dataCellTpl]=\"template(templateNames.dataCell)\"\n        [expanded]=\"expanded\"\n        [ngClass]=\"getRowStyleClass({row: row, rowIndex: rowIndex})\"\n        [ngStyle]=\"getRowStyle({row: row, rowIndex: rowIndex})\"\n        [pSelectableRowIndex]=\"rowIndex\"\n        [pSelectableRow]=\"row\"\n        [rowIndex]=\"rowIndex\"\n        [row]=\"row\"\n        png-table-body-row\n    >\n    </tr>\n  </ng-template>\n\n  <ng-template let-columns=\"columns\" let-row pTemplate=\"rowexpansion\">\n    <tr [columns]=\"dataColumns\"\n        [customerTpl]=\"template(templateNames.rowExpansion)\"\n        [rowId]=\"row[$props.dataKey || 'id']\"\n        png-table-expanded-row\n    >\n    </tr>\n  </ng-template>\n\n  <ng-template let-columns pTemplate=\"footer\">\n    <tr [columns]=\"columns\"\n        [customerTpl]=\"template(templateNames.footer)\"\n        png-table-footer\n    >\n    </tr>\n  </ng-template>\n\n  <ng-container *ngIf=\"(data$|async)?.aggs as aggValues\">\n    <ng-template pTemplate=\"summary\">\n      <tr [aggValues]=\"aggValues\"\n          [columns]=\"dataColumns\"\n          [customerTpl]=\"template(templateNames.footerSummary)\"\n          png-table-summary\n      >\n      </tr>\n    </ng-template>\n  </ng-container>\n\n  <ng-template let-state pTemplate=\"paginatorleft\">\n    <ng-container *ngIf=\"(data$|async)?.total as totalRecords\">\n      <ng-container\n        *ngTemplateOutlet=\"template(templateNames.paginatorLeft,paginationLeftTpl);context:{$implicit:state,totalRecords:totalRecords}\">\n      </ng-container>\n    </ng-container>\n  </ng-template>\n\n  <ng-template let-state pTemplate=\"paginatorright\">\n    <div class=\"d-flex align-content-center\">\n      <er-http-status [tag]=\"$id\" class=\"mr-2\"></er-http-status>\n      <ng-container *ngIf=\"$props.$ext.hasColumnSelector\">\n        <png-table-column-selector\n          (onColumnsChange)=\"updateColumns($event)\"\n          [columns]=\"columns$|async\"\n          [optionColumns]=\"$props.columns\"\n        >\n        </png-table-column-selector>\n      </ng-container>\n      <ng-container *ngIf=\"$props.$ext.hasPaginatorRight\">\n        <ng-container\n          *ngTemplateOutlet=\"template(templateNames.paginatorRight);context:{$implicit:state}\"></ng-container>\n      </ng-container>\n    </div>\n  </ng-template>\n\n\n  <ng-template #colGroupTpl let-columns=\"columns\" let-props>\n    <colgroup>\n      <col *ngIf=\"props.$ext.rowExpandable\" style=\"width: 3em\">\n      <col *ngIf=\"props.$ext.hasRowCheckbox\" style=\"width: 3em\">\n      <col *ngFor=\"let col of columns\" [ngClass]=\"getHeaderStyleClass(col)\"\n           [ngStyle]=\"getHeaderStyle(col)\"\n           [width]=\"col.width\"\n      >\n    </colgroup>\n  </ng-template>\n\n  <ng-template #defaultFrozonRowsTpl let-columns=\"columns\" let-row>\n  </ng-template>\n\n  <ng-template let-columns pTemplate=\"emptymessage\">\n    <tr>\n      <td [attr.colspan]=\"columns?.length\">\n        <strong>{{$props.$ext.emptyMessage}}</strong>\n      </td>\n    </tr>\n  </ng-template>\n</p-table>\n\n<ng-template #paginationLeftTpl let-state let-totalRecords=\"totalRecords\">\n  <span class=\"paginationLeft\"><span *ngIf=\"simpleQuery || complexQuery\"\n                                     class=\"font-weight-bold text-danger \"><u>\u641C\u7D22\u7ED3\u679C</u></span>\u663E\u793A {{totalRecords < 1 ? 0 : state.first + 1}}\n    -\n  {{totalRecords > 0 ? ((state.rows+ state.first) <= totalRecords ? (state.rows + state.first) :\n  totalRecords) : 0}}\uFF0C\u5171 {{totalRecords ? totalRecords : 0}} \u6761</span>\n</ng-template>\n\n\n<p-overlayPanel #overlayPanel [dismissable]=\"overlayContext?.dismissable\"\n                [showCloseIcon]=\"overlayContext?.showCloseIcon\"\n                [id]=\"overlayContext?.id\"\n                [ngStyle]=\"overlayContext?.overlayStyle\"\n                [styleClass]=\"overlayContext?.overlayStyleClass\">\n  <ng-container *ngIf=\"overlayContext\">\n    <ng-container [ngSwitch]=\"overlayContext.type\">\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.PANEL\">\n        <er-dyna-content [content]=\"overlayContext.content\"\n                         [context]=\"overlayContext.context\"\n                         [styleClass]=\"overlayContext.styleClass\"\n                         [style]=\"overlayContext.style\"\n        ></er-dyna-content>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.TABLE\">\n        <png-table erPropsBind [props]=\"overlayContext.content\"></png-table>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.CHART\">\n        <png-chart erPropsBind [props]=\"overlayContext.content\"></png-chart>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.MENU\">\n        <p-menu appendTo=\"body\" [popup]=\"true\" [model]=\"overlayContext.content\"></p-menu>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.TREE\">\n        <pre [erJsonViewer]=\"overlayContext.content\" openLevel=\"1\"></pre>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.FRAME\">\n        <iframe [ngClass]=\"overlayContext.styleClass\" [ngStyle]=\"overlayContext.style\"\n                [src]=\"overlayContext.content|erSafeHtml:'resource'\" frameborder=\"0\"\n                allowfullscreen></iframe>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.COMPONENT\">\n        <er-dyna-content [content]=\"overlayContext.content\"\n                         [context]=\"overlayContext.context\"\n                         [styleClass]=\"overlayContext.styleClass\"\n                         [style]=\"overlayContext.style\"\n        ></er-dyna-content>\n      </ng-container>\n    </ng-container>\n  </ng-container>\n</p-overlayPanel>\n\n<!--<div style=\"position: relative;\">-->\n<!--<p-paginator rows=\"10\"-->\n<!--(onLazyLoad)=\"load($event)\"-->\n<!--(onPageChange)=\"load($event)\"-->\n<!--[totalRecords]=\"totalRecords\"-->\n<!--[rowsPerPageOptions]=\"[10, 25]\">-->\n<!--</p-paginator>-->\n<!--<span style=\"position: absolute; top:3px; right:5px; margin: 5px;\">Total records: {{totalRecords}} </span>-->\n<!--</div>-->\n",
                    providers: [{
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(function () { return PngTableComponent; }),
                            multi: true
                        }],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    styles: ["/deep/ .ui-paginator{font-size:.8rem!important}/deep/ td.col-expandable,/deep/ th.col-expandable{width:1em}/deep/ td.col-checkbox,/deep/ th.col-checkbox{width:1em}/deep/ td.col-radio,/deep/ th.col-radio{width:5px}/deep/ td.row-index,/deep/ th.row-index{width:100px}/deep/ td.circle,/deep/ th.circle{border-radius:50%!important}/deep/ td.col-summary,/deep/ th.col-summary{background-color:#068020;color:#fff!important}"]
                }] }
    ];
    /** @nocollapse */
    PngTableComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: Router },
        { type: ActivatedRoute }
    ]; };
    PngTableComponent.propDecorators = {
        table: [{ type: ViewChild, args: ['pngTable',] }],
        overlayPanel: [{ type: ViewChild, args: ['overlayPanel',] }],
        popupMenu: [{ type: ViewChild, args: [Menu,] }]
    };
    return PngTableComponent;
}(DataAwareControlWrapperComponent));
export { PngTableComponent };
if (false) {
    /** @type {?} */
    PngTableComponent.prototype.OVERLAY_TYPE;
    /** @type {?} */
    PngTableComponent.prototype.table;
    /** @type {?} */
    PngTableComponent.prototype.overlayPanel;
    /** @type {?} */
    PngTableComponent.prototype.popupMenu;
    /** @type {?} */
    PngTableComponent.prototype.bodyData$;
    /** @type {?} */
    PngTableComponent.prototype.columns$;
    /** @type {?} */
    PngTableComponent.prototype.dataColumnNames;
    /** @type {?} */
    PngTableComponent.prototype.dataColumns;
    /** @type {?} */
    PngTableComponent.prototype.templateNames;
    /** @type {?} */
    PngTableComponent.prototype.$defaultProps;
    /** @type {?} */
    PngTableComponent.prototype.simpleQuery;
    /** @type {?} */
    PngTableComponent.prototype.complexQuery;
    /** @type {?} */
    PngTableComponent.prototype.eventQuery;
    /** @type {?} */
    PngTableComponent.prototype.selectedRows;
    /** @type {?} */
    PngTableComponent.prototype.addBtn;
    /** @type {?} */
    PngTableComponent.prototype.overlayContext;
    /** @type {?} */
    PngTableComponent.prototype.switch;
    /** @type {?} */
    PngTableComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    PngTableComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    PngTableComponent.prototype.activatedRoute;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL3ByaW1lbmcvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90YWJsZS9jb21wb25lbnQvdGFibGUvY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFDLHVCQUF1QixFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQWEsU0FBUyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3RILE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ2pELE9BQU8sRUFBQyxjQUFjLEVBQUUsTUFBTSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDdkQsT0FBTyxFQUFDLGdDQUFnQyxFQUFDLE1BQU0sVUFBVSxDQUFDO0FBQzFELE9BQU8sRUFBQyxlQUFlLEVBQTBCLFFBQVEsRUFBRSxLQUFLLEVBQWtCLFdBQVcsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUNoSCxPQUFPLEVBQUMsWUFBWSxFQUFFLGFBQWEsRUFBRSxXQUFXLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFDbkUsT0FBTyxLQUFLLEdBQUcsTUFBTSxpQkFBaUIsQ0FBQztBQUN2QyxPQUFPLEVBQUMsSUFBSSxFQUFFLFlBQVksRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQ25ELE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDcEMsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUNyQyxPQUFPLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFDTCxtQkFBbUIsRUFDbkIsZ0JBQWdCLEVBQ2hCLGtCQUFrQixFQUNsQixtQkFBbUIsRUFDbkIscUJBQXFCLEVBQ3JCLGlCQUFpQixFQUNqQixxQkFBcUIsRUFDckIsb0JBQW9CLEVBQ3BCLHFCQUFxQixFQUNyQixpQkFBaUIsRUFDbEIsTUFBTSxlQUFl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RXhCLFNBQVMsU0FBQyxJQUFJOztJQWdlakIsd0JBQUM7Q0FBQSxBQW5mRCxDQVd1QyxnQ0FBZ0MsR0F3ZXRFO1NBeGVZLGlCQUFpQjs7O0lBRTVCLHlDQUEyQjs7SUFFM0Isa0NBQW9DOztJQUVwQyx5Q0FBc0Q7O0lBRXRELHNDQUFpQzs7SUFFakMsc0NBQWtGOztJQUVsRixxQ0FBeUc7O0lBRXpHLDRDQUEwQjs7SUFFMUIsd0NBQW1DOztJQUVuQywwQ0FlRTs7SUFFRiwwQ0FBcUM7O0lBRXJDLHdDQUFtQjs7SUFFbkIseUNBQWlCOztJQUVqQix1Q0FBZ0I7O0lBRWhCLHlDQUFrQjs7SUFFbEIsbUNBQVk7O0lBRVosMkNBQStCOztJQUUvQixtQ0FBYzs7SUFFRiwrQkFBNEI7Ozs7O0lBQUUsbUNBQXNCOzs7OztJQUFFLDJDQUFzQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIGZvcndhcmRSZWYsIE9uRGVzdHJveSwgVmlld0NoaWxkfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7TkdfVkFMVUVfQUNDRVNTT1J9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7QWN0aXZhdGVkUm91dGUsIFJvdXRlcn0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7RGF0YUF3YXJlQ29udHJvbFdyYXBwZXJDb21wb25lbnR9IGZyb20gJ0Blci9jb3JlJztcbmltcG9ydCB7QWdnTWV0aG9kc1Byb3BzLCBBZ2dQcm9wcywgQXBpRGF0YVByb3BzLCBEYXRhVHlwZSwgT3JkZXIsIE92ZXJsYXlDb250ZXh0LCBPdmVybGF5VHlwZX0gZnJvbSAnQGVyL3R5cGVzJztcbmltcG9ydCB7Q29tbW9uc1V0aWxzLCBEYXRhSXRlbVV0aWxzLCBTdGF0ZXNVdGlsc30gZnJvbSAnQGVyL3V0aWxzJztcbmltcG9ydCAqIGFzIGVzYiBmcm9tICdlbGFzdGljLWJ1aWxkZXInO1xuaW1wb3J0IHtNZW51LCBPdmVybGF5UGFuZWx9IGZyb20gJ3ByaW1lbmcvcHJpbWVuZyc7XG5pbXBvcnQge1RhYmxlfSBmcm9tICdwcmltZW5nL3RhYmxlJztcbmltcG9ydCB7QmVoYXZpb3JTdWJqZWN0fSBmcm9tICdyeGpzJztcbmltcG9ydCB7ZmlsdGVyLCBza2lwfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge1xuICBkZWZhdWx0QWN0aW9uQ29sdW1uLFxuICBkZWZhdWx0QWRkQnV0dG9uLFxuICBkZWZhdWx0QXVkaXRCdXR0b24sXG4gIGRlZmF1bHREZWxldGVCdXR0b24sXG4gIGRlZmF1bHREb3dubG9hZEJ1dHRvbixcbiAgZGVmYXVsdEVkaXRCdXR0b24sXG4gIGRlZmF1bHRQbmdDb2x1bW5Qcm9wcyxcbiAgZGVmYXVsdFBuZ1RhYmxlUHJvcHMsXG4gIGRlZmF1bHRSb3dJbmRleENvbHVtbixcbiAgZGVmYXVsdFZpZXdCdXR0b25cbn0gZnJvbSAnLi4vLi4vZGVmYXVsdCc7XG5pbXBvcnQge1BuZ1RhYmxlQ29sdW1uUHJvcHMsIFBuZ1RhYmxlUHJvcHN9IGZyb20gJy4uLy4uL3R5cGVzJztcbmltcG9ydCB7UG5nVGFibGVVdGlsc30gZnJvbSAnLi4vLi4vdXRpbCc7XG5cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG5nLXRhYmxlJyxcbiAgdGVtcGxhdGVVcmw6ICd0cGwuaHRtbCcsXG4gIHN0eWxlVXJsczogWydzdHlsZXMuc2NzcyddLFxuICBwcm92aWRlcnM6IFt7XG4gICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gUG5nVGFibGVDb21wb25lbnQpLFxuICAgIG11bHRpOiB0cnVlXG4gIH1dLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBQbmdUYWJsZUNvbXBvbmVudCBleHRlbmRzIERhdGFBd2FyZUNvbnRyb2xXcmFwcGVyQ29tcG9uZW50PFBuZ1RhYmxlUHJvcHM+IGltcGxlbWVudHMgT25EZXN0cm95IHtcblxuICBPVkVSTEFZX1RZUEUgPSBPdmVybGF5VHlwZTtcblxuICBAVmlld0NoaWxkKCdwbmdUYWJsZScpIHRhYmxlOiBUYWJsZTtcblxuICBAVmlld0NoaWxkKCdvdmVybGF5UGFuZWwnKSBvdmVybGF5UGFuZWw6IE92ZXJsYXlQYW5lbDtcblxuICBAVmlld0NoaWxkKE1lbnUpIHBvcHVwTWVudTogTWVudTtcblxuICBib2R5RGF0YSQ6IEJlaGF2aW9yU3ViamVjdDx7fVtdPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8UG5nVGFibGVDb2x1bW5Qcm9wc1tdPihbXSk7XG5cbiAgY29sdW1ucyQ6IEJlaGF2aW9yU3ViamVjdDxQbmdUYWJsZUNvbHVtblByb3BzW10+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxQbmdUYWJsZUNvbHVtblByb3BzW10+KHVuZGVmaW5lZCk7XG5cbiAgZGF0YUNvbHVtbk5hbWVzOiBzdHJpbmdbXTtcblxuICBkYXRhQ29sdW1uczogUG5nVGFibGVDb2x1bW5Qcm9wc1tdO1xuXG4gIHRlbXBsYXRlTmFtZXMgPSB7XG4gICAgY2FwdGlvbjogJ2NhcHRpb24nLFxuICAgIHNwYW5IZWFkZXI6ICdzcGFuSGVhZGVyJyxcbiAgICBoZWFkZXI6ICdoZWFkZXInLFxuICAgIGhlYWRlclN1bW1hcnk6ICdoZWFkZXJTdW1tYXJ5JyxcbiAgICBib2R5OiAnYm9keScsXG4gICAgZnJvemVuUm93czogJ2Zyb3plblJvd3MnLFxuICAgIGNlbGw6ICdjZWxsJyxcbiAgICBkYXRhQ2VsbDogJ2RhdGFDZWxsJyxcbiAgICBmb290ZXI6ICdmb290ZXInLFxuICAgIGZvb3RlclN1bW1hcnk6ICdzdW1tYXJ5JyxcbiAgICBjb2xHcm91cDogJ2NvbGdyb3VwJyxcbiAgICByb3dFeHBhbnNpb246ICdyb3dleHBhbnNpb24nLFxuICAgIHBhZ2luYXRvckxlZnQ6ICdwYWdpbmF0b3JMZWZ0JyxcbiAgICBwYWdpbmF0b3JSaWdodDogJ3BhZ2luYXRvclJpZ2h0J1xuICB9O1xuXG4gICRkZWZhdWx0UHJvcHMgPSBkZWZhdWx0UG5nVGFibGVQcm9wcztcblxuICBzaW1wbGVRdWVyeTogYW55W107XG5cbiAgY29tcGxleFF1ZXJ5OiB7fTtcblxuICBldmVudFF1ZXJ5ID0gW107XG5cbiAgc2VsZWN0ZWRSb3dzID0gW107XG5cbiAgYWRkQnRuOiBhbnk7XG5cbiAgb3ZlcmxheUNvbnRleHQ6IE92ZXJsYXlDb250ZXh0O1xuXG4gIHN3aXRjaCA9IHRydWU7XG5cbiAgY29uc3RydWN0b3IocHVibGljIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiwgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlciwgcHJpdmF0ZSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgZ2V0IGFwaUVudHJ5KCkge1xuICAgIHJldHVybiB0aGlzLiRwcm9wcy4kZXh0LmFwaURhdGFQcm9wcyAmJiB0aGlzLiRwcm9wcy4kZXh0LmFwaURhdGFQcm9wcy5hcGlFbnRyeTtcbiAgfVxuXG4gIGdldCAkaWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuJHByb3BzLiRpZDtcbiAgfVxuXG4gIG9uUHJvcHNJbml0KCkge1xuICAgIGlmICh0aGlzLiRwcm9wcy5lbnRpdHkpIHtcbiAgICAgIGlmICghdGhpcy4kcHJvcHMuY2FwdGlvbiB8fCB0aGlzLiRwcm9wcy5jYXB0aW9uWydtZXRob2QnXSkge1xuICAgICAgICBjb25zdCBjYXB0aW9uID0gQ29tbW9uc1V0aWxzLmdldFZhbHVlKHRoaXMuJHByb3BzLmNhcHRpb24sIHRoaXMuJHByb3BzLmVudGl0eS5sYWJlbCk7XG4gICAgICAgIHRoaXMuJHByb3BzLmNhcHRpb24gPSBjYXB0aW9uIHx8IGDmtY/op4gke3RoaXMuJHByb3BzLmVudGl0eS5sYWJlbCB8fCAnJ31gO1xuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLiRwcm9wcy4kZXh0LmFwaURhdGFQcm9wcykge1xuICAgICAgICB0aGlzLiRwcm9wcy4kZXh0LmFwaURhdGFQcm9wcyA9IHt9O1xuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLiRwcm9wcy4kZXh0LmFwaURhdGFQcm9wcy5hcGlFbnRyeSkge1xuICAgICAgICB0aGlzLiRwcm9wcy4kZXh0LmFwaURhdGFQcm9wcy5hcGlFbnRyeSA9IHRoaXMuJHByb3BzLmVudGl0eS5hcGlFbnRyeSB8fCAnJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy4kcHJvcHMuY29sdW1ucykge1xuICAgICAgdGhpcy5yZXNvbGVBY3Rpb25zQ29sdW1uKHRoaXMuJHByb3BzKTtcbiAgICAgIGxldCBvcmRlciA9IDA7XG4gICAgICB0aGlzLiRwcm9wcy5jb2x1bW5zLmZvckVhY2goY29sdW1uID0+IHtcbiAgICAgICAgUG5nVGFibGVVdGlscy5yZXNvbHZlQ29sdW1uQnlEYXRhRmllbGQoY29sdW1uKTtcbiAgICAgICAgQ29tbW9uc1V0aWxzLmRlZmF1bHRzKGNvbHVtbiwgZGVmYXVsdFBuZ0NvbHVtblByb3BzKTtcbiAgICAgICAgaWYgKCFjb2x1bW4ub3JkZXIpIHtcbiAgICAgICAgICBjb2x1bW4ub3JkZXIgPSArK29yZGVyO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiRwcm9wcy5zY3JvbGxhYmxlICYmIHRoaXMuJHByb3BzLnNjcm9sbFdpZHRoICYmIGNvbHVtbi53aWR0aCAmJiBjb2x1bW4ud2lkdGguZW5kc1dpdGgoJyUnKSkge1xuICAgICAgICAgIGNvbHVtbi53aWR0aCA9IGRlZmF1bHRQbmdDb2x1bW5Qcm9wcy53aWR0aDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29sdW1uLm92ZXJsYXlzKSB7XG4gICAgICAgICAgY29sdW1uLm92ZXJsYXlzID0gQ29tbW9uc1V0aWxzLmdldEFycmF5VmFsdWUoY29sdW1uLm92ZXJsYXlzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29sdW1uLmhlYWRlck92ZXJsYXlzKSB7XG4gICAgICAgICAgY29sdW1uLmhlYWRlck92ZXJsYXlzID0gQ29tbW9uc1V0aWxzLmdldEFycmF5VmFsdWUoY29sdW1uLmhlYWRlck92ZXJsYXlzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICh0aGlzLiRwcm9wcy52aXJ0dWFsU2Nyb2xsKSB7XG4gICAgICB0aGlzLiRwcm9wcy5hbHdheXNTaG93UGFnaW5hdG9yID0gZmFsc2U7XG4gICAgICB0aGlzLiRwcm9wcy5wYWdpbmF0b3IgPSBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHRoaXMuJHByb3BzLnNjcm9sbGFibGUpIHtcbiAgICAgIENvbW1vbnNVdGlscy5zZXQodGhpcy4kcHJvcHMsICdzdHlsZS53aWR0aCcsIHRoaXMuJHByb3BzLnNjcm9sbFdpZHRoKTtcbiAgICB9XG4gICAgY29uc3QgZnJvemVuQ29sdW1ucyA9IHRoaXMuJHByb3BzLmNvbHVtbnMuZmlsdGVyKGNvbHVtbiA9PiBjb2x1bW4uZnJvemVuKTtcbiAgICBpZiAoZnJvemVuQ29sdW1ucy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLiRwcm9wcy5mcm96ZW5Db2x1bW5zID0gZnJvemVuQ29sdW1ucztcbiAgICAgIGlmICghdGhpcy4kcHJvcHMuJGV4dC5yb3dIZWlnaHQpIHtcbiAgICAgICAgdGhpcy4kcHJvcHMuJGV4dC5yb3dIZWlnaHQgPSAnMzBweCc7XG4gICAgICB9XG4gICAgICBsZXQgZnJvemVuV2lkdGggPSAwO1xuICAgICAgZnJvemVuQ29sdW1ucy5mb3JFYWNoKGNvbHVtbiA9PiB7XG4gICAgICAgIGxldCB3aWR0aCA9IDE1MDtcbiAgICAgICAgaWYgKGNvbHVtbi53aWR0aCkge1xuICAgICAgICAgIHdpZHRoID0gTnVtYmVyKGNvbHVtbi53aWR0aC5zdWJzdHIoMCwgY29sdW1uLndpZHRoLmxlbmd0aCAtIDIpKTtcbiAgICAgICAgfVxuICAgICAgICBmcm96ZW5XaWR0aCArPSB3aWR0aCB8fCAxNTA7XG4gICAgICAgIGNvbHVtbi5zdHlsZUNsYXNzID0gY29sdW1uLnN0eWxlQ2xhc3MgfHwgJycgKyAnIHRhYmxlLWZyb3plbi1jb2x1bW4nO1xuICAgICAgfSk7XG4gICAgICB0aGlzLiRwcm9wcy5mcm96ZW5XaWR0aCA9IGAke2Zyb3plbldpZHRofXB4YDtcbiAgICB9XG4gICAgdGhpcy51cGRhdGVDb2x1bW5zKCk7XG4gICAgdGhpcy5hcGlEYXRhUHJvcHMgPSB0aGlzLmdldEFwaURhdGFQcm9wcygpO1xuICAgIHRoaXMuJHN1YnNjcmlwdGlvbnMgPSBTdGF0ZXNVdGlscy5vYnNlcnZlKHRoaXMuJGlkKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcihzdGF0ZSA9PiAhIXN0YXRlKSxcbiAgICAgICAgc2tpcCgxKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZShzdGF0ZSA9PiB7XG4gICAgICAgIHRoaXMudGFibGUuZmlyc3QgPSAwO1xuICAgICAgICB0aGlzLmxvYWQoc3RhdGUpO1xuICAgICAgfSk7XG4gICAgaWYgKHRoaXMuJHByb3BzLiRleHQuZGF0YUl0ZW1zKSB7XG4gICAgICB0aGlzLmRhdGEkLm5leHQoe1xuICAgICAgICBpdGVtczogdGhpcy4kcHJvcHMuJGV4dC5kYXRhSXRlbXMsXG4gICAgICAgIHRvdGFsOiB0aGlzLiRwcm9wcy4kZXh0LmRhdGFJdGVtcy5sZW5ndGhcbiAgICAgIH0pO1xuICAgIH1cbiAgICBTdGF0ZXNVdGlscy5jcmVhdGUodGhpcy4kaWQsIHtcbiAgICAgIGNvbXBvbmVudDogdGhpc1xuICAgIH0sIHRydWUpO1xuICB9XG5cbiAgdXBkYXRlQ29sdW1ucyhldmVudD8pIHtcbiAgICBsZXQgY29sdW1ucztcbiAgICBpZiAoIWV2ZW50KSB7XG4gICAgICBjb2x1bW5zID0gdGhpcy4kcHJvcHMuY29sdW1ucy5maWx0ZXIoY29sdW1uID0+ICFjb2x1bW4uZnJvemVuKSB8fCBbXTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29sdW1ucyA9IGV2ZW50LnZhbHVlO1xuICAgIH1cbiAgICBjb2x1bW5zLnNvcnQoKGEsIGIpID0+IGEub3JkZXIgLSBiLm9yZGVyKTtcbiAgICB0aGlzLmRhdGFDb2x1bW5zID0gY29sdW1ucy5maWx0ZXIoY29sdW1uID0+ICFjb2x1bW4uaXNBY3Rpb25Db2x1bW4gfHwgIShjb2x1bW4uaGlkZGVuICYmICFjb2x1bW4uZmV0Y2gpKTtcbiAgICBpZiAoIWV2ZW50KSB7XG4gICAgICBjb2x1bW5zID0gY29sdW1ucy5maWx0ZXIoY29sdW1uID0+ICFjb2x1bW4uaGlkZGVuKTtcbiAgICB9XG4gICAgdGhpcy5kYXRhQ29sdW1uTmFtZXMgPSBDb21tb25zVXRpbHMuY29tcGFjdCh0aGlzLmRhdGFDb2x1bW5zLm1hcChjb2x1bW4gPT4gY29sdW1uLmtleSkpO1xuICAgIGlmICh0aGlzLiRwcm9wcy5mcm96ZW5Db2x1bW5zKSB7XG4gICAgICB0aGlzLiRwcm9wcy5mcm96ZW5Db2x1bW5zLmZvckVhY2goY29sdW1uID0+IHtcbiAgICAgICAgaWYgKGNvbHVtbi5rZXkpIHtcbiAgICAgICAgICB0aGlzLmRhdGFDb2x1bW5OYW1lcy5wdXNoKGNvbHVtbi5rZXkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhpcy5jb2x1bW5zJC5uZXh0KGNvbHVtbnMpO1xuICAgIGlmIChldmVudCkge1xuICAgICAgdGhpcy5sb2FkKCk7XG4gICAgfVxuICB9XG5cbiAgdXBkYXRlQ29sQWdnS2V5cyhldmVudCkge1xuICAgIGlmIChldmVudC5jb2x1bW4pIHtcbiAgICAgIGNvbnN0IGNvbHVtbiA9IGV2ZW50LmNvbHVtbjtcbiAgICAgIGNvbnN0IGFnZ1Byb3BzID0gW107XG4gICAgICBpZiAoZXZlbnQubWV0aG9kcyAmJiBldmVudC5tZXRob2RzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZXZlbnQubWV0aG9kcy5mb3JFYWNoKG1ldGhvZCA9PiB7XG4gICAgICAgICAgYWdnUHJvcHMucHVzaCg8QWdnUHJvcHM+e1xuICAgICAgICAgICAgbmFtZTogYCR7Y29sdW1uLmtleX0tJHttZXRob2R9YCxcbiAgICAgICAgICAgIGZpZWxkOiBjb2x1bW4uYWdnS2V5IHx8IGNvbHVtbi5rZXksXG4gICAgICAgICAgICBtZXRob2Q6IEFnZ01ldGhvZHNQcm9wc1ttZXRob2RdWydrZXknXVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbHVtbi5hZ2dQcm9wcyA9IGFnZ1Byb3BzO1xuICAgICAgU3RhdGVzVXRpbHMudXBkYXRlKHRoaXMuJGlkLCB7fSk7XG4gICAgfVxuICB9XG5cbiAgdXBkYXRlQ29sRmlsdGVycyhldmVudCkge1xuICAgIGlmIChldmVudC5jb2x1bW4pIHtcbiAgICAgIGNvbnN0IGNvbHVtbiA9IGV2ZW50LmNvbHVtbjtcbiAgICAgIGNvbHVtbi5maWx0ZXJzID0gW107XG4gICAgICBpZiAoZXZlbnQudmFsdWUpIHtcbiAgICAgICAgY29sdW1uLmZpbHRlcnMucHVzaChldmVudC52YWx1ZSk7XG4gICAgICB9XG4gICAgICBTdGF0ZXNVdGlscy51cGRhdGUodGhpcy4kaWQsIHt9KTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVTaW1wbGVTZWFyY2goZXZlbnQpIHtcbiAgICBpZiAoQ29tbW9uc1V0aWxzLmlzRW1wdHkoZXZlbnQpKSB7XG4gICAgICB0aGlzLnNpbXBsZVF1ZXJ5ID0gdW5kZWZpbmVkO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoZXZlbnQuaW5kZXhPZignXCInKSA9PT0gLTEpIHtcbiAgICAgICAgZXZlbnQgPSBgXCIke2V2ZW50fVwiYDtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2ltcGxlUXVlcnkgPSBbZXNiLnNpbXBsZVF1ZXJ5U3RyaW5nUXVlcnkoZXZlbnQpXTtcbiAgICB9XG4gICAgdGhpcy5sb2FkKCk7XG4gIH1cblxuICBnZXRDb2x1bW5CeUtleShrZXkpOiBQbmdUYWJsZUNvbHVtblByb3BzIHtcbiAgICBjb25zdCBjb2x1bW5zID0gdGhpcy4kcHJvcHMuY29sdW1ucy5maWx0ZXIoY29sdW1uID0+IGNvbHVtbi5rZXkgPT09IGtleSk7XG4gICAgaWYgKGNvbHVtbnMubGVuZ3RoID49IDEpIHtcbiAgICAgIHJldHVybiBjb2x1bW5zWzBdO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIGdldFJvd1N0eWxlQ2xhc3Mocm93KSB7XG4gICAgcmV0dXJuIENvbW1vbnNVdGlscy5nZXRWYWx1ZSh0aGlzLiRwcm9wcy4kZXh0LnJvd1N0eWxlQ2xhc3MsIHJvdyk7XG4gIH1cblxuICBnZXRSb3dTdHlsZShyb3cpIHtcbiAgICBjb25zdCBzdHlsZSA9IENvbW1vbnNVdGlscy5nZXRWYWx1ZSh0aGlzLiRwcm9wcy4kZXh0LnJvd1N0eWxlLCByb3cpIHx8IHt9O1xuICAgIGlmICh0aGlzLiRwcm9wcy4kZXh0LnJvd0hlaWdodCkge1xuICAgICAgc3R5bGVbJ2hlaWdodCddID0gdGhpcy4kcHJvcHMuJGV4dC5yb3dIZWlnaHQ7XG4gICAgfVxuICAgIHJldHVybiBzdHlsZTtcbiAgfVxuXG4gIGdldEhlYWRlclN0eWxlQ2xhc3MoY29sdW1uKSB7XG4gICAgcmV0dXJuIENvbW1vbnNVdGlscy5nZXRWYWx1ZShjb2x1bW4uaGVhZGVyU3R5bGVDbGFzcywgY29sdW1uKTtcbiAgfVxuXG4gIGdldEhlYWRlclN0eWxlKGNvbHVtbikge1xuICAgIHJldHVybiBDb21tb25zVXRpbHMuZ2V0VmFsdWUoY29sdW1uLmhlYWRlclN0eWxlLCBjb2x1bW4pO1xuICB9XG5cbiAgcm93U2VsZWN0KGV2ZW50KSB7XG4gICAgdGhpcy51cGRhdGVUb3VjaCgpO1xuICAgIHRoaXMudmFsdWUgPSBEYXRhSXRlbVV0aWxzLmdldEl0ZW1WYWx1ZShldmVudCwgdGhpcy4kcHJvcHMuJGV4dC5kYXRhSXRlbVByb3BzICYmIHRoaXMuJHByb3BzLiRleHQuZGF0YUl0ZW1Qcm9wcy52YWx1ZUtleSk7XG4gIH1cblxuICBsb2FkKHN0YXRlPykge1xuICAgIHRoaXMuYXBpRGF0YVByb3BzID0gdGhpcy5nZXRBcGlEYXRhUHJvcHMoc3RhdGUpO1xuICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICBvbkRhdGFSZWFkeShkYXRhKSB7XG4gICAgY29uc3QgZGF0YVBhdGggPSBDb21tb25zVXRpbHMuZ2V0KHRoaXMuJHByb3BzLCAnJGV4dC5hcGlEYXRhUHJvcHMuZGF0YVBhdGgnKTtcbiAgICBpZiAoZGF0YVBhdGggJiYgZGF0YVBhdGggIT09ICcvJykge1xuICAgICAgdGhpcy5ib2R5RGF0YSQubmV4dChkYXRhKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5ib2R5RGF0YSQubmV4dChkYXRhLml0ZW1zIHx8IFtdKTtcbiAgICB9XG4gIH1cblxuICBzaG93T3ZlcmxheShjdHg6IE92ZXJsYXlDb250ZXh0KSB7XG4gICAgaWYgKGN0eCAmJiBjdHguY29udGVudCkge1xuICAgICAgdGhpcy5vdmVybGF5Q29udGV4dCA9IHtcbiAgICAgICAgZGlzbWlzc2FibGU6IHRydWUsXG4gICAgICAgIHNob3dDbG9zZUljb246IHRydWUsXG4gICAgICAgIC4uLmN0eFxuICAgICAgfTtcbiAgICAgIHRoaXMub3ZlcmxheVBhbmVsLmhpZGUoKTtcbiAgICAgIHRoaXMub3ZlcmxheVBhbmVsLnRvZ2dsZShjdHguJGV2ZW50KTtcbiAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH1cbiAgfVxuXG4gIGhpZGVQYW5lbCgpIHtcbiAgICB0aGlzLm92ZXJsYXlQYW5lbC5oaWRlKCk7XG4gIH1cblxuICByZXNldFF1ZXJ5KCkge1xuICAgIHRoaXMuc2ltcGxlUXVlcnkgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jb21wbGV4UXVlcnkgPSB1bmRlZmluZWQ7XG4gIH1cblxuICByZXNldEZvcmVpZ25RdWVyeSgpIHtcbiAgICB0aGlzLmV2ZW50UXVlcnkgPSBbXTtcbiAgfVxuXG4gIG5hdmlnYXRlKHVybDogc3RyaW5nLCBjb21tYW5kcz86IGFueVtdLCBwYXJhbXM/KSB7XG4gICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW3tvdXRsZXRzOiB7W3RoaXMuJHByb3BzLiRleHQucm91dGVyT3V0bGV0XTogW3VybCwgLi4uY29tbWFuZHNdfX1dLCB7XG4gICAgICByZWxhdGl2ZVRvOiB0aGlzLmFjdGl2YXRlZFJvdXRlLFxuICAgICAgc2tpcExvY2F0aW9uQ2hhbmdlOiBmYWxzZSxcbiAgICAgIHF1ZXJ5UGFyYW1zOiBwYXJhbXNcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLiRwcm9wcyAmJiB0aGlzLiRwcm9wcy4kaWQpIHtcbiAgICAgIFN0YXRlc1V0aWxzLmRlbGV0ZVN0YXRlKHRoaXMuJHByb3BzLiRpZCk7XG4gICAgfVxuICAgIHN1cGVyLm5nT25EZXN0cm95KCk7XG4gIH1cblxuICBnZXRUYWJsZVF1ZXJ5KHN0YXRlPykge1xuXG4gICAgaWYgKHN0YXRlICYmIChzdGF0ZS5xdWVyeSB8fCBzdGF0ZS5maWx0ZXIpKSB7XG4gICAgICB0aGlzLmV2ZW50UXVlcnkgPSBbXG4gICAgICAgIC4uLkNvbW1vbnNVdGlscy5nZXRBcnJheVZhbHVlKHN0YXRlWydxdWVyeSddIHx8IHt9KSxcbiAgICAgICAgLi4uQ29tbW9uc1V0aWxzLmdldEFycmF5VmFsdWUoc3RhdGVbJ2ZpbHRlciddIHx8IHt9KVxuICAgICAgXTtcbiAgICB9XG5cbiAgICBjb25zdCBmaWx0ZXJzID0gW1xuICAgICAgLi4udGhpcy5nZXRDb2x1bW5zRmlsdGVycygpLFxuICAgICAgLi4udGhpcy5ldmVudFF1ZXJ5LFxuICAgICAgLi4udGhpcy5zaW1wbGVRdWVyeSB8fCBbXSxcbiAgICAgIC4uLkNvbW1vbnNVdGlscy5nZXRBcnJheVZhbHVlKHRoaXMuY29tcGxleFF1ZXJ5KSB8fCBbXVxuICAgIF07XG5cbiAgICBjb25zdCBnQXBpRGF0YVByb3BzID0gQ29tbW9uc1V0aWxzLmNvcHkoQ29tbW9uc1V0aWxzLmdldCh0aGlzLiRwcm9wcywgJyRleHQuYXBpRGF0YVByb3BzJykpO1xuXG4gICAgbGV0IGFwaUZpbHRlciA9IGdBcGlEYXRhUHJvcHMuZmlsdGVyIHx8IHt9O1xuICAgIGlmIChhcGlGaWx0ZXJbJyRhbmQnXSkge1xuICAgICAgYXBpRmlsdGVyWyckYW5kJ10gPSBbXG4gICAgICAgIC4uLmFwaUZpbHRlclsnJGFuZCddLFxuICAgICAgICAuLi5maWx0ZXJzXG4gICAgICBdO1xuICAgIH0gZWxzZSBpZiAoYXBpRmlsdGVyWyckb3InXSkge1xuICAgICAgYXBpRmlsdGVyWyckYW5kJ10gPSBmaWx0ZXJzO1xuICAgIH0gZWxzZSB7XG4gICAgICBhcGlGaWx0ZXIgPSBDb21tb25zVXRpbHMuZ2V0QXJyYXlWYWx1ZShhcGlGaWx0ZXIpXG4gICAgICAgIC5jb25jYXQoZmlsdGVycyk7XG4gICAgfVxuICAgIGFwaUZpbHRlciA9IGFwaUZpbHRlci5maWx0ZXIoZiA9PiAhQ29tbW9uc1V0aWxzLmlzRW1wdHkoZikpO1xuXG4gICAgbGV0IGFnZ1Byb3BzID0gZ0FwaURhdGFQcm9wcy5hZ2dQcm9wcyB8fCB7fTtcbiAgICBhZ2dQcm9wcyA9IENvbW1vbnNVdGlscy5nZXRBcnJheVZhbHVlKGFnZ1Byb3BzKS5jb25jYXQodGhpcy5nZXRDb2x1bW5zQWdncygpKTtcbiAgICBhZ2dQcm9wcyA9IGFnZ1Byb3BzLmZpbHRlcihhID0+IE9iamVjdC5rZXlzKGEpLmxlbmd0aCA+IDApO1xuXG4gICAgbGV0IHNvcnQgPSBnQXBpRGF0YVByb3BzLnNvcnQgfHwgW107XG4gICAgY29uc3QgdGFibGVNZXRhRGF0YSA9IHRoaXMudGFibGUuY3JlYXRlTGF6eUxvYWRNZXRhZGF0YSgpO1xuICAgIHNvcnQgPSBDb21tb25zVXRpbHMuZ2V0QXJyYXlWYWx1ZShzb3J0KTtcbiAgICBjb25zdCB0YWJsZVNvcnQgPSB0YWJsZU1ldGFEYXRhLnNvcnRGaWVsZDtcbiAgICBpZiAodGFibGVTb3J0KSB7XG4gICAgICBjb25zdCBjb2x1bW4gPSB0aGlzLmdldENvbHVtbkJ5S2V5KHRhYmxlU29ydCk7XG4gICAgICBjb25zdCBzb3J0S2V5ID0gKGNvbHVtbiAmJiBjb2x1bW4uc29ydEtleSkgfHwgdGFibGVTb3J0O1xuICAgICAgc29ydC5wdXNoKHtbc29ydEtleV06IHRhYmxlTWV0YURhdGEuc29ydE9yZGVyID09PSAxID8gT3JkZXIuQVNDIDogT3JkZXIuREVTQ30pO1xuICAgIH1cbiAgICBkZWxldGUgZ0FwaURhdGFQcm9wcy5maWx0ZXI7XG4gICAgZGVsZXRlIGdBcGlEYXRhUHJvcHMuYWdnUHJvcHM7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmdBcGlEYXRhUHJvcHMsXG4gICAgICBmaWx0ZXI6IGFwaUZpbHRlcixcbiAgICAgIGFnZ1Byb3BzLFxuICAgICAgc29ydFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdldENvbHVtbnNGaWx0ZXJzKCkge1xuICAgIGNvbnN0IGZpbHRlcnMgPSBbXTtcbiAgICBjb25zdCBjb2x1bW5zID0gKHRoaXMuY29sdW1ucyQudmFsdWUgfHwgW10pLmNvbmNhdCh0aGlzLiRwcm9wcy5mcm96ZW5Db2x1bW5zIHx8IFtdKTtcbiAgICBjb2x1bW5zXG4gICAgICAuZmlsdGVyKGNvbHVtbiA9PiBjb2x1bW4uZmlsdGVycylcbiAgICAgIC5mb3JFYWNoKGNvbHVtbiA9PlxuICAgICAgICBjb2x1bW4uZmlsdGVycy5maWx0ZXIoZiA9PiBmKVxuICAgICAgICAgIC5mb3JFYWNoKGYgPT4ge1xuICAgICAgICAgICAgbGV0IHF1ZXJ5O1xuICAgICAgICAgICAgc3dpdGNoIChjb2x1bW4uZmlsdGVyRGF0YVR5cGUgfHwgY29sdW1uLmRhdGFUeXBlIHx8IChjb2x1bW4uZGF0YUZpZWxkICYmIGNvbHVtbi5kYXRhRmllbGQuZGF0YVR5cGUpIHx8IERhdGFUeXBlLlNUUklORykge1xuICAgICAgICAgICAgICBjYXNlIERhdGFUeXBlLk5VTUJFUjpcbiAgICAgICAgICAgICAgY2FzZSBEYXRhVHlwZS5EQVRFOlxuICAgICAgICAgICAgICAgIGlmIChDb21tb25zVXRpbHMuaXNBcnJheShmKSkge1xuICAgICAgICAgICAgICAgICAgcXVlcnkgPSBlc2IucmFuZ2VRdWVyeShjb2x1bW4uZmlsdGVyS2V5IHx8IGNvbHVtbi5rZXkpLmd0ZShmWzBdKS5sdGUoZlsxXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0gZXNiLnJhbmdlUXVlcnkoY29sdW1uLmZpbHRlcktleSB8fCBjb2x1bW4ua2V5KS5ndGUoZikubHRlKGYpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBxdWVyeSA9IGVzYi5tYXRjaFF1ZXJ5KGNvbHVtbi5maWx0ZXJLZXkgfHwgY29sdW1uLmtleSwgZik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaWx0ZXJzLnB1c2gocXVlcnkpO1xuICAgICAgICAgIH0pKTtcbiAgICByZXR1cm4gZmlsdGVycztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29sdW1uc0FnZ3MoKSB7XG4gICAgbGV0IGFnZ3M6IEFnZ1Byb3BzW10gPSBbXTtcbiAgICBjb25zdCBjb2x1bW5zID0gKHRoaXMuY29sdW1ucyQudmFsdWUgfHwgW10pLmNvbmNhdCh0aGlzLiRwcm9wcy5mcm96ZW5Db2x1bW5zIHx8IFtdKTtcbiAgICBjb2x1bW5zXG4gICAgICAuZmlsdGVyKGNvbHVtbiA9PiBjb2x1bW4uYWdnUHJvcHMpXG4gICAgICAuZm9yRWFjaChjb2x1bW4gPT4ge1xuICAgICAgICBhZ2dzID0gYWdncy5jb25jYXQoY29sdW1uLmFnZ1Byb3BzKTtcbiAgICAgIH0pO1xuICAgIHJldHVybiBhZ2dzO1xuICB9XG5cbiAgcHJpdmF0ZSByZXNvbGVBY3Rpb25zQ29sdW1uKHByb3BzOiBQbmdUYWJsZVByb3BzKSB7XG4gICAgbGV0IGFjdGlvbkNvbHVtbjogUG5nVGFibGVDb2x1bW5Qcm9wcztcbiAgICBsZXQgYWN0aW9uQ29sdW1uSW5kZXggPSAtMTtcbiAgICBwcm9wcy5jb2x1bW5zLnNvbWUoKGNvbHVtbiwgaSkgPT4ge1xuICAgICAgaWYgKGNvbHVtbi5pc0FjdGlvbkNvbHVtbikge1xuICAgICAgICBhY3Rpb25Db2x1bW4gPSBjb2x1bW47XG4gICAgICAgIGFjdGlvbkNvbHVtbkluZGV4ID0gaTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gICAgaWYgKGFjdGlvbkNvbHVtbkluZGV4ID49IDApIHtcbiAgICAgIHByb3BzLmNvbHVtbnMgPSBDb21tb25zVXRpbHMucmVtb3ZlQnlJbmRleChwcm9wcy5jb2x1bW5zLCBhY3Rpb25Db2x1bW5JbmRleCk7XG4gICAgfVxuICAgIGlmIChwcm9wcy4kZXh0Lmhhc0FkZEFjdGlvbikge1xuICAgICAgdGhpcy5hZGRCdG4gPSB7XG4gICAgICAgIC4uLmRlZmF1bHRBZGRCdXR0b24sXG4gICAgICAgIGNvbnRleHQ6IHRoaXNcbiAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IGJ1dHRvbnMgPSBbXTtcbiAgICBpZiAocHJvcHMuJGV4dC5oYXNWaWV3QWN0aW9uKSB7XG4gICAgICBidXR0b25zLnB1c2goe1xuICAgICAgICAuLi5kZWZhdWx0Vmlld0J1dHRvbixcbiAgICAgICAgc2hvdzogcHJvcHMuJGV4dC5oYXNWaWV3QWN0aW9uXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHByb3BzLiRleHQuaGFzRGVsZXRlQWN0aW9uKSB7XG4gICAgICBidXR0b25zLnB1c2goe1xuICAgICAgICAuLi5kZWZhdWx0RGVsZXRlQnV0dG9uLFxuICAgICAgICBzaG93OiBwcm9wcy4kZXh0Lmhhc0RlbGV0ZUFjdGlvblxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChwcm9wcy4kZXh0Lmhhc0F1ZGl0QWN0aW9uKSB7XG4gICAgICBidXR0b25zLnB1c2goe1xuICAgICAgICAuLi5kZWZhdWx0QXVkaXRCdXR0b24sXG4gICAgICAgIHNob3c6IHByb3BzLiRleHQuaGFzQXVkaXRBY3Rpb25cbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAocHJvcHMuJGV4dC5oYXNEb3dubG9hZEFjdGlvbikge1xuICAgICAgYnV0dG9ucy5wdXNoKHtcbiAgICAgICAgLi4uZGVmYXVsdERvd25sb2FkQnV0dG9uLFxuICAgICAgICBzaG93OiBwcm9wcy4kZXh0Lmhhc0Rvd25sb2FkQWN0aW9uXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHByb3BzLiRleHQuaGFzRWRpdEFjdGlvbikge1xuICAgICAgYnV0dG9ucy5wdXNoKHtcbiAgICAgICAgLi4uZGVmYXVsdEVkaXRCdXR0b24sXG4gICAgICAgIHNob3c6IHByb3BzLiRleHQuaGFzRWRpdEFjdGlvblxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChidXR0b25zLmxlbmd0aCA+IDAgJiYgIWFjdGlvbkNvbHVtbikge1xuICAgICAgYWN0aW9uQ29sdW1uID0ge1xuICAgICAgICAuLi5kZWZhdWx0QWN0aW9uQ29sdW1uLFxuICAgICAgICAuLi5hY3Rpb25Db2x1bW4gfHwge31cbiAgICAgIH07XG4gICAgfVxuICAgIGlmIChidXR0b25zLmxlbmd0aCA+IDApIHtcbiAgICAgIGFjdGlvbkNvbHVtbi5jZWxsQ29udGVudCA9IFtcbiAgICAgICAgLi4uQ29tbW9uc1V0aWxzLmdldEFycmF5VmFsdWUoYWN0aW9uQ29sdW1uLmNlbGxDb250ZW50KSB8fCBbXSxcbiAgICAgICAgLi4uYnV0dG9uc1xuICAgICAgXTtcbiAgICB9XG5cbiAgICBpZiAoYWN0aW9uQ29sdW1uKSB7XG4gICAgICBpZiAodGhpcy4kcHJvcHMuJGV4dC5mcm96ZW5BY3Rpb25Db2x1bW4pIHtcbiAgICAgICAgYWN0aW9uQ29sdW1uLmZyb3plbiA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy4kcHJvcHMuJGV4dC5yb3dBY3Rpb25zUGxhY2VBaGVhZCkge1xuICAgICAgICAoPGFueVtdPnRoaXMuJHByb3BzLmNvbHVtbnMpLnNwbGljZSgwLCAwLCBhY3Rpb25Db2x1bW4pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy4kcHJvcHMuY29sdW1ucy5wdXNoKGFjdGlvbkNvbHVtbik7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0aGlzLiRwcm9wcy4kZXh0Lmhhc1Jvd0luZGV4KSB7XG4gICAgICB0aGlzLiRwcm9wcy5jb2x1bW5zLnNwbGljZSgwLCAwLCBkZWZhdWx0Um93SW5kZXhDb2x1bW4pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0QXBpRGF0YVByb3BzKHN0YXRlPyk6IEFwaURhdGFQcm9wcyB7XG4gICAgY29uc3QgdGFibGVNZXRhRGF0YSA9IHRoaXMudGFibGUuY3JlYXRlTGF6eUxvYWRNZXRhZGF0YSgpO1xuICAgIGNvbnN0IHRhYmxlUXVlcnkgPSB0aGlzLmdldFRhYmxlUXVlcnkoc3RhdGUpO1xuICAgIGNvbnN0IGFwaURhdGFQcm9wcyA9IDxBcGlEYXRhUHJvcHM+e1xuICAgICAgLi4udGFibGVRdWVyeSxcbiAgICAgIGRhdGFQYXRoOiAnLycsXG4gICAgICByZXR1cm5GaWVsZHM6IHRoaXMuZGF0YUNvbHVtbk5hbWVzLFxuICAgICAgZnJvbTogdGFibGVNZXRhRGF0YS5maXJzdCxcbiAgICAgIHNpemU6IHRhYmxlTWV0YURhdGEucm93c1xuICAgIH07XG4gICAgYXBpRGF0YVByb3BzLnJlcXVlc3RPcHRpb25zID0gYXBpRGF0YVByb3BzLnJlcXVlc3RPcHRpb25zIHx8IHt9O1xuICAgIGlmICghYXBpRGF0YVByb3BzLnJlcXVlc3RPcHRpb25zLnRhZykge1xuICAgICAgYXBpRGF0YVByb3BzLnJlcXVlc3RPcHRpb25zLnRhZyA9IHRoaXMuJGlkO1xuICAgIH1cbiAgICByZXR1cm4gYXBpRGF0YVByb3BzO1xuICB9XG5cblxufVxuXG4vLyBkaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnaW5wdXQnKSlcbiJdfQ==