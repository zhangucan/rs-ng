/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { animate, state, style, transition, trigger } from '@angular/animations';
import { ChangeDetectionStrategy, Component, Input } from '@angular/core';
import { PngAdminWorkSpaceComponent } from '../../component';
import { WorkSpaceMainMenuComponent } from '../component';
export class WorkSpaceSubMenuComponent {
    /**
     * @param {?} ws
     * @param {?} wsMenu
     */
    constructor(ws, wsMenu) {
        this.ws = ws;
        this.wsMenu = wsMenu;
    }
    /**
     * @return {?}
     */
    get reset() {
        return this._reset;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set reset(val) {
        this._reset = val;
        if (this._reset && (this.ws.isHorizontal() || this.ws.isSlim())) {
            this.activeIndex = null;
        }
    }
    /**
     * @return {?}
     */
    get parentActive() {
        return this._parentActive;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set parentActive(val) {
        this._parentActive = val;
        if (!this._parentActive) {
            this.activeIndex = null;
        }
    }
    /**
     * @param {?} event
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    itemClick(event, item, index) {
        if (this.root) {
            this.ws.menuHoverActive = !this.ws.menuHoverActive;
        }
        // avoid processing disabled items
        if (item.disabled) {
            event.preventDefault();
            return true;
        }
        // activate current item and deactivate active sibling if any
        this.activeIndex = (this.activeIndex === index) ? null : index;
        // execute command
        if (item.command) {
            item.command({ originalEvent: event, item: item, menu: this.wsMenu, ws: this.ws });
        }
        // prevent hash change
        if (item.items || (!item.url && !item.routerLink)) {
            setTimeout(() => {
                this.ws.layoutMenuScrollerViewChild.moveBar();
            }, 450);
            event.preventDefault();
        }
        // hide menu
        if (!item.items) {
            if (this.ws.isHorizontal() || this.ws.isSlim()) {
                this.ws.resetMenu = true;
            }
            else {
                this.ws.resetMenu = false;
            }
            this.ws.overlayMenuActive = false;
            this.ws.staticMenuMobileActive = false;
            this.ws.menuHoverActive = !this.ws.menuHoverActive;
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    onMouseEnter(index) {
        if (this.root && this.ws.menuHoverActive && (this.ws.isHorizontal() || this.ws.isSlim())
            && !this.ws.isMobile() && !this.ws.isTablet()) {
            this.activeIndex = index;
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    isActive(index) {
        return this.activeIndex === index;
    }
}
WorkSpaceSubMenuComponent.decorators = [
    { type: Component, args: [{
                selector: '[png-ws-sub-menu]',
                template: "<ng-template ngFor let-child let-i=\"index\" [ngForOf]=\"(root ? item : item.items)\">\n  <li [ngClass]=\"{'active-menuitem': isActive(i)}\" [class]=\"child.badgeStyleClass\"\n      *ngIf=\"child.visible === false ? false : true\">\n    <a [href]=\"child.url||'#'\" (click)=\"itemClick($event,child,i)\" (mouseenter)=\"onMouseEnter(i)\"\n       class=\"ripplelink\" *ngIf=\"!child.routerLink\"\n       [attr.tabindex]=\"!visible ? '-1' : null\" [attr.target]=\"child.target\">\n      <i [ngClass]=\"child.icon\"></i><span>{{child.label}}</span>\n      <i class=\"fa fa-fw fa-angle-down menuitem-toggle-icon\" *ngIf=\"child.items\"></i>\n      <span class=\"menuitem-badge\" *ngIf=\"child.badge\">{{child.badge}}</span>\n    </a>\n\n    <a (click)=\"itemClick($event,child,i)\" (mouseenter)=\"onMouseEnter(i)\" class=\"ripplelink\" *ngIf=\"child.routerLink\"\n       [routerLink]=\"child.routerLink\" routerLinkActive=\"active-menuitem-routerlink\"\n       [routerLinkActiveOptions]=\"{exact: true}\" [attr.tabindex]=\"!visible ? '-1' : null\" [attr.target]=\"child.target\">\n      <i [ngClass]=\"child.icon\"></i><span>{{child.label}}</span>\n      <i class=\"fa fa-fw fa-angle-down menuitem-toggle-icon\" *ngIf=\"child.items\"></i>\n      <span class=\"menuitem-badge\" *ngIf=\"child.badge\">{{child.badge}}</span>\n    </a>\n    <div class=\"layout-menu-tooltip\">\n      <div class=\"layout-menu-tooltip-arrow\"></div>\n      <div class=\"layout-menu-tooltip-text\">{{child.label}}</div>\n    </div>\n    <div class=\"submenu-arrow\" *ngIf=\"child.items\"></div>\n    <ul png-ws-sub-menu [item]=\"child\" *ngIf=\"child.items\" [visible]=\"isActive(i)\" [reset]=\"reset\"\n        [parentActive]=\"isActive(i)\"\n        [@children]=\"(ws.isSlim()||ws.isHorizontal())&&root ? isActive(i) ?\n                     'visible' : 'hidden' : isActive(i) ? 'visibleAnimated' : 'hiddenAnimated'\"></ul>\n  </li>\n</ng-template>",
                animations: [
                    trigger('children', [
                        state('hiddenAnimated', style({
                            height: '0px'
                        })),
                        state('visibleAnimated', style({
                            height: '*'
                        })),
                        state('visible', style({
                            display: 'block'
                        })),
                        state('hidden', style({
                            display: 'none'
                        })),
                        transition('visibleAnimated => hiddenAnimated', animate('400ms cubic-bezier(0.86, 0, 0.07, 1)')),
                        transition('hiddenAnimated => visibleAnimated', animate('400ms cubic-bezier(0.86, 0, 0.07, 1)'))
                    ])
                ],
                changeDetection: ChangeDetectionStrategy.OnPush
            }] }
];
/** @nocollapse */
WorkSpaceSubMenuComponent.ctorParameters = () => [
    { type: PngAdminWorkSpaceComponent },
    { type: WorkSpaceMainMenuComponent }
];
WorkSpaceSubMenuComponent.propDecorators = {
    item: [{ type: Input }],
    root: [{ type: Input }],
    visible: [{ type: Input }],
    reset: [{ type: Input }],
    parentActive: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype.item;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype.root;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype.visible;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype.activeIndex;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype._reset;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype._parentActive;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype.ws;
    /** @type {?} */
    WorkSpaceSubMenuComponent.prototype.wsMenu;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL3ByaW1lbmcvIiwic291cmNlcyI6WyJsaWIvd29yay1zcGFjZS9tZW51L3N1Yi1tZW51L2NvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUMvRSxPQUFPLEVBQUMsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUV4RSxPQUFPLEVBQUMsMEJBQTBCLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUMzRCxPQUFPLEVBQUMsMEJBQTBCLEVBQUMsTUFBTSxjQUFjLENBQUM7QUEwQnhELE1BQU0sT0FBTyx5QkFBeUI7Ozs7O0lBVXBDLFlBQW1CLEVBQThCLEVBQVMsTUFBa0M7UUFBekUsT0FBRSxHQUFGLEVBQUUsQ0FBNEI7UUFBUyxXQUFNLEdBQU4sTUFBTSxDQUE0QjtJQUM1RixDQUFDOzs7O0lBSUQsSUFBYSxLQUFLO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUNyQixDQUFDOzs7OztJQUVELElBQUksS0FBSyxDQUFDLEdBQVk7UUFDcEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUM7UUFFbEIsSUFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUU7WUFDL0QsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7U0FDekI7SUFDSCxDQUFDOzs7O0lBSUQsSUFBYSxZQUFZO1FBQ3ZCLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQztJQUM1QixDQUFDOzs7OztJQUVELElBQUksWUFBWSxDQUFDLEdBQVk7UUFDM0IsSUFBSSxDQUFDLGFB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QVUsRUFBRTt3QkFDbEIsS0FBSyxDQUFDLGdCQUFnQixFQUFFLEtBQUssQ0FBQzs0QkFDNUIsTUFBTSxFQUFFLEtBQUs7eUJBQ2QsQ0FBQyxDQUFDO3dCQUNILEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxLQUFLLENBQUM7NEJBQzdCLE1BQU0sRUFBRSxHQUFHO3lCQUNaLENBQUMsQ0FBQzt3QkFDSCxLQUFLLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQzs0QkFDckIsT0FBTyxFQUFFLE9BQU87eUJBQ2pCLENBQUMsQ0FBQzt3QkFDSCxLQUFLLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQzs0QkFDcEIsT0FBTyxFQUFFLE1BQU07eUJBQ2hCLENBQUMsQ0FBQzt3QkFDSCxVQUFVLENBQUMsbUNBQW1DLEVBQUUsT0FBTyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7d0JBQ2hHLFVBQVUsQ0FBQyxtQ0FBbUMsRUFBRSxPQUFPLENBQUMsc0NBQXNDLENBQUMsQ0FBQztxQkFDakcsQ0FBQztpQkFDSDtnQkFDRCxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTthQUNoRDs7OztZQTFCTywwQkFBMEI7WUFDMUIsMEJBQTBCOzs7bUJBNEIvQixLQUFLO21CQUVMLEtBQUs7c0JBRUwsS0FBSztvQkFTTCxLQUFLOzJCQWNMLEtBQUs7Ozs7SUEzQk4seUNBQXdCOztJQUV4Qix5Q0FBdUI7O0lBRXZCLDRDQUEwQjs7SUFFMUIsZ0RBQW9COztJQUtwQiwyQ0FBZ0I7O0lBY2hCLGtEQUF1Qjs7SUFqQlgsdUNBQXFDOztJQUFFLDJDQUF5QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7YW5pbWF0ZSwgc3RhdGUsIHN0eWxlLCB0cmFuc2l0aW9uLCB0cmlnZ2VyfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcbmltcG9ydCB7Q2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCwgSW5wdXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtNZW51SXRlbX0gZnJvbSAncHJpbWVuZy9wcmltZW5nJztcbmltcG9ydCB7UG5nQWRtaW5Xb3JrU3BhY2VDb21wb25lbnR9IGZyb20gJy4uLy4uL2NvbXBvbmVudCc7XG5pbXBvcnQge1dvcmtTcGFjZU1haW5NZW51Q29tcG9uZW50fSBmcm9tICcuLi9jb21wb25lbnQnO1xuXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ1twbmctd3Mtc3ViLW1lbnVdJyxcbiAgdGVtcGxhdGVVcmw6ICd0cGwuaHRtbCcsXG4gIGFuaW1hdGlvbnM6IFtcbiAgICB0cmlnZ2VyKCdjaGlsZHJlbicsIFtcbiAgICAgIHN0YXRlKCdoaWRkZW5BbmltYXRlZCcsIHN0eWxlKHtcbiAgICAgICAgaGVpZ2h0OiAnMHB4J1xuICAgICAgfSkpLFxuICAgICAgc3RhdGUoJ3Zpc2libGVBbmltYXRlZCcsIHN0eWxlKHtcbiAgICAgICAgaGVpZ2h0OiAnKidcbiAgICAgIH0pKSxcbiAgICAgIHN0YXRlKCd2aXNpYmxlJywgc3R5bGUoe1xuICAgICAgICBkaXNwbGF5OiAnYmxvY2snXG4gICAgICB9KSksXG4gICAgICBzdGF0ZSgnaGlkZGVuJywgc3R5bGUoe1xuICAgICAgICBkaXNwbGF5OiAnbm9uZSdcbiAgICAgIH0pKSxcbiAgICAgIHRyYW5zaXRpb24oJ3Zpc2libGVBbmltYXRlZCA9PiBoaWRkZW5BbmltYXRlZCcsIGFuaW1hdGUoJzQwMG1zIGN1YmljLWJlemllcigwLjg2LCAwLCAwLjA3LCAxKScpKSxcbiAgICAgIHRyYW5zaXRpb24oJ2hpZGRlbkFuaW1hdGVkID0+IHZpc2libGVBbmltYXRlZCcsIGFuaW1hdGUoJzQwMG1zIGN1YmljLWJlemllcigwLjg2LCAwLCAwLjA3LCAxKScpKVxuICAgIF0pXG4gIF0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIFdvcmtTcGFjZVN1Yk1lbnVDb21wb25lbnQge1xuXG4gIEBJbnB1dCgpIGl0ZW06IE1lbnVJdGVtO1xuXG4gIEBJbnB1dCgpIHJvb3Q6IGJvb2xlYW47XG5cbiAgQElucHV0KCkgdmlzaWJsZTogYm9vbGVhbjtcblxuICBhY3RpdmVJbmRleDogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyB3czogUG5nQWRtaW5Xb3JrU3BhY2VDb21wb25lbnQsIHB1YmxpYyB3c01lbnU6IFdvcmtTcGFjZU1haW5NZW51Q29tcG9uZW50KSB7XG4gIH1cblxuICBfcmVzZXQ6IGJvb2xlYW47XG5cbiAgQElucHV0KCkgZ2V0IHJlc2V0KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9yZXNldDtcbiAgfVxuXG4gIHNldCByZXNldCh2YWw6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9yZXNldCA9IHZhbDtcblxuICAgIGlmICh0aGlzLl9yZXNldCAmJiAodGhpcy53cy5pc0hvcml6b250YWwoKSB8fCB0aGlzLndzLmlzU2xpbSgpKSkge1xuICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgX3BhcmVudEFjdGl2ZTogYm9vbGVhbjtcblxuICBASW5wdXQoKSBnZXQgcGFyZW50QWN0aXZlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9wYXJlbnRBY3RpdmU7XG4gIH1cblxuICBzZXQgcGFyZW50QWN0aXZlKHZhbDogYm9vbGVhbikge1xuICAgIHRoaXMuX3BhcmVudEFjdGl2ZSA9IHZhbDtcblxuICAgIGlmICghdGhpcy5fcGFyZW50QWN0aXZlKSB7XG4gICAgICB0aGlzLmFjdGl2ZUluZGV4ID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBpdGVtQ2xpY2soZXZlbnQ6IEV2ZW50LCBpdGVtOiBNZW51SXRlbSwgaW5kZXg6IG51bWJlcikge1xuICAgIGlmICh0aGlzLnJvb3QpIHtcbiAgICAgIHRoaXMud3MubWVudUhvdmVyQWN0aXZlID0gIXRoaXMud3MubWVudUhvdmVyQWN0aXZlO1xuICAgIH1cblxuICAgIC8vIGF2b2lkIHByb2Nlc3NpbmcgZGlzYWJsZWQgaXRlbXNcbiAgICBpZiAoaXRlbS5kaXNhYmxlZCkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIGFjdGl2YXRlIGN1cnJlbnQgaXRlbSBhbmQgZGVhY3RpdmF0ZSBhY3RpdmUgc2libGluZyBpZiBhbnlcbiAgICB0aGlzLmFjdGl2ZUluZGV4ID0gKHRoaXMuYWN0aXZlSW5kZXggPT09IGluZGV4KSA/IG51bGwgOiBpbmRleDtcblxuICAgIC8vIGV4ZWN1dGUgY29tbWFuZFxuICAgIGlmIChpdGVtLmNvbW1hbmQpIHtcbiAgICAgIGl0ZW0uY29tbWFuZCh7b3JpZ2luYWxFdmVudDogZXZlbnQsIGl0ZW06IGl0ZW0sIG1lbnU6IHRoaXMud3NNZW51LCB3czogdGhpcy53c30pO1xuICAgIH1cblxuICAgIC8vIHByZXZlbnQgaGFzaCBjaGFuZ2VcbiAgICBpZiAoaXRlbS5pdGVtcyB8fCAoIWl0ZW0udXJsICYmICFpdGVtLnJvdXRlckxpbmspKSB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy53cy5sYXlvdXRNZW51U2Nyb2xsZXJWaWV3Q2hpbGQubW92ZUJhcigpO1xuICAgICAgfSwgNDUwKTtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuXG4gICAgLy8gaGlkZSBtZW51XG4gICAgaWYgKCFpdGVtLml0ZW1zKSB7XG4gICAgICBpZiAodGhpcy53cy5pc0hvcml6b250YWwoKSB8fCB0aGlzLndzLmlzU2xpbSgpKSB7XG4gICAgICAgIHRoaXMud3MucmVzZXRNZW51ID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMud3MucmVzZXRNZW51ID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHRoaXMud3Mub3ZlcmxheU1lbnVBY3RpdmUgPSBmYWxzZTtcbiAgICAgIHRoaXMud3Muc3RhdGljTWVudU1vYmlsZUFjdGl2ZSA9IGZhbHNlO1xuICAgICAgdGhpcy53cy5tZW51SG92ZXJBY3RpdmUgPSAhdGhpcy53cy5tZW51SG92ZXJBY3RpdmU7XG4gICAgfVxuICB9XG5cbiAgb25Nb3VzZUVudGVyKGluZGV4OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5yb290ICYmIHRoaXMud3MubWVudUhvdmVyQWN0aXZlICYmICh0aGlzLndzLmlzSG9yaXpvbnRhbCgpIHx8IHRoaXMud3MuaXNTbGltKCkpXG4gICAgICAmJiAhdGhpcy53cy5pc01vYmlsZSgpICYmICF0aGlzLndzLmlzVGFibGV0KCkpIHtcbiAgICAgIHRoaXMuYWN0aXZlSW5kZXggPSBpbmRleDtcbiAgICB9XG4gIH1cblxuICBpc0FjdGl2ZShpbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuYWN0aXZlSW5kZXggPT09IGluZGV4O1xuICB9XG59XG4iXX0=