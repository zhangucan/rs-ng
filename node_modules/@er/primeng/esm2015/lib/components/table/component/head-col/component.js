/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import { BaseComponent } from '@er/core';
import { OverlayType } from '@er/types';
import { CommonsUtils } from '@er/utils';
import { PngTableComponent } from '../table/component';
export class PngTableHeaderColComponent extends BaseComponent {
    /**
     * @param {?} pngTable
     * @param {?} cd
     */
    constructor(pngTable, cd) {
        super();
        this.pngTable = pngTable;
        this.cd = cd;
        this.OVERLAY_TYPE = OverlayType;
        this.onFilterBtnClick = new EventEmitter();
        this.onAggsBtnClick = new EventEmitter();
    }
    /**
     * @return {?}
     */
    get colClass() {
        if (CommonsUtils.isFunction(this.column.colClass)) {
            return ((/** @type {?} */ (this.column.colClass))).call(this.pngTable, this.column);
        }
        else {
            return (/** @type {?} */ (this.column.colClass)) || '';
        }
    }
    /**
     * @return {?}
     */
    get width() {
        return this.column.width;
    }
    /**
     * @return {?}
     */
    get colStyle() {
        if (CommonsUtils.isFunction(this.column.colStyle)) {
            return ((/** @type {?} */ (this.column.colStyle))).call(this.pngTable, this.column);
        }
        else {
            return (/** @type {?} */ (this.column.colStyle)) || '';
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.column.headerOverlays) {
            ((/** @type {?} */ (this.column.headerOverlays))).filter(overlay => overlay.type === OverlayType.MENU)
                .forEach(overlay => {
                if (overlay.content['menuItem'].command) {
                    /** @type {?} */
                    const command = overlay.content['menuItem'].command;
                    overlay.content['menuItem'].command = (event) => command.call(this, this.headerContext(event));
                }
            });
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    filterClick(event) {
        this.onFilterBtnClick.emit({
            event,
            column: this.column
        });
    }
    /**
     * @param {?} event
     * @return {?}
     */
    aggsClick(event) {
        this.onAggsBtnClick.emit({
            $event: event,
            column: this.column
        });
    }
    /**
     * @param {?=} event
     * @return {?}
     */
    headerContext(event) {
        return {
            $event: event,
            $id: this.pngTable.$props.$id,
            column: this.column,
            pngTable: this.pngTable
        };
    }
    /**
     * @param {?} overlay
     * @param {?} index
     * @param {?=} event
     * @return {?}
     */
    overlayContext(overlay, index, event) {
        return {
            $event: event,
            type: overlay.type,
            content: CommonsUtils.getValue(overlay.content, this.headerContext(event)),
            context: overlay.context,
            styleClass: CommonsUtils.getValue(overlay.styleClass, this.headerContext(event)),
            style: CommonsUtils.getValue(overlay.style, this.headerContext(event)),
            overlayStyleClass: CommonsUtils.getValue(overlay.overlayStyleClass, this.headerContext(event)),
            overlayStyle: CommonsUtils.getValue(overlay.overlayStyle, this.headerContext(event)),
            id: `overlay-header-${this.column.key}-${index}`
        };
    }
}
PngTableHeaderColComponent.decorators = [
    { type: Component, args: [{
                selector: '[png-table-header-col]',
                template: `
    <span *ngIf="!column.sortable" [innerHTML]="column.label|erSafeHtml"></span>
    <span *ngIf="column.sortable" title="排序" [pSortableColumn]="column.key" [innerHTML]="column.label|erSafeHtml"></span>
    <p-sortIcon *ngIf="column.sortable" [field]="column.key"></p-sortIcon>
    <span *ngIf="column.filterable" class="pull-right">
              <i class="fa fa-filter" title="输入查询内容" [ngClass]="{'ui-state-highlight': column.filters && column.filters.length>0}"
                 (click)="filterClick($event)"></i>
            </span>
    <span *ngIf="column.aggable" class="pull-right">
              <i class="fa fa-sum" title="选择统计方法" [ngClass]="{'ui-state-highlight': column.aggProps && column.aggProps.length>0}"
                 (click)="aggsClick($event)"></i>
            </span>
    <ng-container *ngIf="column.headerOverlays">
      <ng-container *ngFor="let overlay of column.headerOverlays; index as i">
        <ng-container [ngSwitch]="overlay.type">
          <ng-container *ngSwitchCase="OVERLAY_TYPE.CHART">
            <i [ngClass]="overlay.icon || 'fa fa-bar-chart text-primary'" class="pull-right"
               (click)="pngTable.showOverlay(overlayContext(overlay,i,$event))"></i>
          </ng-container>
          <ng-container *ngSwitchCase="OVERLAY_TYPE.TABLE">
            <i [ngClass]="overlay.icon || 'fa fa-eye text-primary'" class="pull-right"
               (click)="pngTable.showOverlay(overlayContext(overlay,i,$event))"></i>
          </ng-container>
          <ng-container *ngSwitchCase="OVERLAY_TYPE.PANEL">
            <i [ngClass]="overlay.icon || 'fa fa-eye text-primary'" class="pull-right"
               (click)="pngTable.showOverlay(overlayContext(overlay,i,$event))"></i>
          </ng-container>
          <ng-container *ngSwitchCase="OVERLAY_TYPE.MENU">
            <i [ngClass]="overlay.icon || 'fa fa-arrow-circle-down text-primary'" class="pull-right"
               (click)="pngTable.showOverlay(overlayContext(overlay,i,$event))"></i>
          </ng-container>
          <ng-container *ngSwitchCase="OVERLAY_TYPE.FRAME">
            <i [ngClass]="overlay.icon || 'fa fa-play text-primary'"
               (click)="pngTable.showOverlay(overlayContext(overlay,i,$event))"></i>
          </ng-container>
          <ng-container *ngSwitchCase="OVERLAY_TYPE.COMPONENT">
            <i [ngClass]="overlay.icon || 'fa fa-eye text-primary'"
               (click)="pngTable.showOverlay(overlayContext(overlay,i,$event))"></i>
          </ng-container>
        </ng-container>
      </ng-container>
    </ng-container>
  `,
                changeDetection: ChangeDetectionStrategy.OnPush
            }] }
];
/** @nocollapse */
PngTableHeaderColComponent.ctorParameters = () => [
    { type: PngTableComponent },
    { type: ChangeDetectorRef }
];
PngTableHeaderColComponent.propDecorators = {
    column: [{ type: Input }],
    onFilterBtnClick: [{ type: Output }],
    onAggsBtnClick: [{ type: Output }],
    colClass: [{ type: HostBinding, args: ['class',] }],
    width: [{ type: HostBinding, args: ['style.width',] }],
    colStyle: [{ type: HostBinding, args: ['style',] }]
};
if (false) {
    /** @type {?} */
    PngTableHeaderColComponent.prototype.OVERLAY_TYPE;
    /** @type {?} */
    PngTableHeaderColComponent.prototype.column;
    /** @type {?} */
    PngTableHeaderColComponent.prototype.onFilterBtnClick;
    /** @type {?} */
    PngTableHeaderColComponent.prototype.onAggsBtnClick;
    /** @type {?} */
    PngTableHeaderColComponent.prototype.pngTable;
    /**
     * @type {?}
     * @private
     */
    PngTableHeaderColComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL3ByaW1lbmcvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90YWJsZS9jb21wb25lbnQvaGVhZC1jb2wvY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsdUJBQXVCLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUN0SSxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sVUFBVSxDQUFDO0FBQ3ZDLE9BQU8sRUFBMEIsV0FBVyxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQy9ELE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFFdkMsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFpRHJELE1BQU0sT0FBTywwQkFBMkIsU0FBUSxhQUFhOzs7OztJQVUzRCxZQUFtQixRQUEyQixFQUFVLEVBQXFCO1FBQzNFLEtBQUssRUFBRSxDQUFDO1FBRFMsYUFBUSxHQUFSLFFBQVEsQ0FBbUI7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQVI3RSxpQkFBWSxHQUFHLFdBQVcsQ0FBQztRQUlqQixxQkFBZ0IsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRXRDLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQUk5QyxDQUFDOzs7O0lBRUQsSUFDSSxRQUFRO1FBQ1YsSUFBSSxZQUFZLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDakQsT0FBTyxDQUFDLG1CQUFVLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDMUU7YUFBTTtZ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SyxDQUFDLENBQUM7WUFDdEUsaUJBQWlCLEVBQUUsWUFBWSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM5RixZQUFZLEVBQUUsWUFBWSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDcEYsRUFBRSxFQUFFLGtCQUFrQixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxLQUFLLEVBQUU7U0FDakQsQ0FBQztJQUNKLENBQUM7OztZQW5JRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLHdCQUF3QjtnQkFDbEMsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0EwQ1Q7Z0JBQ0QsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07YUFDaEQ7Ozs7WUFoRE8saUJBQWlCO1lBTFEsaUJBQWlCOzs7cUJBMEQvQyxLQUFLOytCQUVMLE1BQU07NkJBRU4sTUFBTTt1QkFNTixXQUFXLFNBQUMsT0FBTztvQkFTbkIsV0FBVyxTQUFDLGFBQWE7dUJBS3pCLFdBQVcsU0FBQyxPQUFPOzs7O0lBMUJwQixrREFBMkI7O0lBRTNCLDRDQUFxQzs7SUFFckMsc0RBQWdEOztJQUVoRCxvREFBOEM7O0lBRWxDLDhDQUFrQzs7Ozs7SUFBRSx3Q0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIEhvc3RCaW5kaW5nLCBJbnB1dCwgT25Jbml0LCBPdXRwdXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtCYXNlQ29tcG9uZW50fSBmcm9tICdAZXIvY29yZSc7XG5pbXBvcnQge092ZXJsYXksIE92ZXJsYXlDb250ZXh0LCBPdmVybGF5VHlwZX0gZnJvbSAnQGVyL3R5cGVzJztcbmltcG9ydCB7Q29tbW9uc1V0aWxzfSBmcm9tICdAZXIvdXRpbHMnO1xuaW1wb3J0IHtQbmdUYWJsZUNvbHVtblByb3BzfSBmcm9tICcuLi8uLi90eXBlcyc7XG5pbXBvcnQge1BuZ1RhYmxlQ29tcG9uZW50fSBmcm9tICcuLi90YWJsZS9jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdbcG5nLXRhYmxlLWhlYWRlci1jb2xdJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8c3BhbiAqbmdJZj1cIiFjb2x1bW4uc29ydGFibGVcIiBbaW5uZXJIVE1MXT1cImNvbHVtbi5sYWJlbHxlclNhZmVIdG1sXCI+PC9zcGFuPlxuICAgIDxzcGFuICpuZ0lmPVwiY29sdW1uLnNvcnRhYmxlXCIgdGl0bGU9XCLmjpLluo9cIiBbcFNvcnRhYmxlQ29sdW1uXT1cImNvbHVtbi5rZXlcIiBbaW5uZXJIVE1MXT1cImNvbHVtbi5sYWJlbHxlclNhZmVIdG1sXCI+PC9zcGFuPlxuICAgIDxwLXNvcnRJY29uICpuZ0lmPVwiY29sdW1uLnNvcnRhYmxlXCIgW2ZpZWxkXT1cImNvbHVtbi5rZXlcIj48L3Atc29ydEljb24+XG4gICAgPHNwYW4gKm5nSWY9XCJjb2x1bW4uZmlsdGVyYWJsZVwiIGNsYXNzPVwicHVsbC1yaWdodFwiPlxuICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLWZpbHRlclwiIHRpdGxlPVwi6L6T5YWl5p+l6K+i5YaF5a65XCIgW25nQ2xhc3NdPVwieyd1aS1zdGF0ZS1oaWdobGlnaHQnOiBjb2x1bW4uZmlsdGVycyAmJiBjb2x1bW4uZmlsdGVycy5sZW5ndGg+MH1cIlxuICAgICAgICAgICAgICAgICAoY2xpY2spPVwiZmlsdGVyQ2xpY2soJGV2ZW50KVwiPjwvaT5cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICA8c3BhbiAqbmdJZj1cImNvbHVtbi5hZ2dhYmxlXCIgY2xhc3M9XCJwdWxsLXJpZ2h0XCI+XG4gICAgICAgICAgICAgIDxpIGNsYXNzPVwiZmEgZmEtc3VtXCIgdGl0bGU9XCLpgInmi6nnu5/orqHmlrnms5VcIiBbbmdDbGFzc109XCJ7J3VpLXN0YXRlLWhpZ2hsaWdodCc6IGNvbHVtbi5hZ2dQcm9wcyAmJiBjb2x1bW4uYWdnUHJvcHMubGVuZ3RoPjB9XCJcbiAgICAgICAgICAgICAgICAgKGNsaWNrKT1cImFnZ3NDbGljaygkZXZlbnQpXCI+PC9pPlxuICAgICAgICAgICAgPC9zcGFuPlxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJjb2x1bW4uaGVhZGVyT3ZlcmxheXNcIj5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IG92ZXJsYXkgb2YgY29sdW1uLmhlYWRlck92ZXJsYXlzOyBpbmRleCBhcyBpXCI+XG4gICAgICAgIDxuZy1jb250YWluZXIgW25nU3dpdGNoXT1cIm92ZXJsYXkudHlwZVwiPlxuICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nU3dpdGNoQ2FzZT1cIk9WRVJMQVlfVFlQRS5DSEFSVFwiPlxuICAgICAgICAgICAgPGkgW25nQ2xhc3NdPVwib3ZlcmxheS5pY29uIHx8ICdmYSBmYS1iYXItY2hhcnQgdGV4dC1wcmltYXJ5J1wiIGNsYXNzPVwicHVsbC1yaWdodFwiXG4gICAgICAgICAgICAgICAoY2xpY2spPVwicG5nVGFibGUuc2hvd092ZXJsYXkob3ZlcmxheUNvbnRleHQob3ZlcmxheSxpLCRldmVudCkpXCI+PC9pPlxuICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nU3dpdGNoQ2FzZT1cIk9WRVJMQVlfVFlQRS5UQUJMRVwiPlxuICAgICAgICAgICAgPGkgW25nQ2xhc3NdPVwib3ZlcmxheS5pY29uIHx8ICdmYSBmYS1leWUgdGV4dC1wcmltYXJ5J1wiIGNsYXNzPVwicHVsbC1yaWdodFwiXG4gICAgICAgICAgICAgICAoY2xpY2spPVwicG5nVGFibGUuc2hvd092ZXJsYXkob3ZlcmxheUNvbnRleHQob3ZlcmxheSxpLCRldmVudCkpXCI+PC9pPlxuICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nU3dpdGNoQ2FzZT1cIk9WRVJMQVlfVFlQRS5QQU5FTFwiPlxuICAgICAgICAgICAgPGkgW25nQ2xhc3NdPVwib3ZlcmxheS5pY29uIHx8ICdmYSBmYS1leWUgdGV4dC1wcmltYXJ5J1wiIGNsYXNzPVwicHVsbC1yaWdodFwiXG4gICAgICAgICAgICAgICAoY2xpY2spPVwicG5nVGFibGUuc2hvd092ZXJsYXkob3ZlcmxheUNvbnRleHQob3ZlcmxheSxpLCRldmVudCkpXCI+PC9pPlxuICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nU3dpdGNoQ2FzZT1cIk9WRVJMQVlfVFlQRS5NRU5VXCI+XG4gICAgICAgICAgICA8aSBbbmdDbGFzc109XCJvdmVybGF5Lmljb24gfHwgJ2ZhIGZhLWFycm93LWNpcmNsZS1kb3duIHRleHQtcHJpbWFyeSdcIiBjbGFzcz1cInB1bGwtcmlnaHRcIlxuICAgICAgICAgICAgICAgKGNsaWNrKT1cInBuZ1RhYmxlLnNob3dPdmVybGF5KG92ZXJsYXlDb250ZXh0KG92ZXJsYXksaSwkZXZlbnQpKVwiPjwvaT5cbiAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICA8bmctY29udGFpbmVyICpuZ1N3aXRjaENhc2U9XCJPVkVSTEFZX1RZUEUuRlJBTUVcIj5cbiAgICAgICAgICAgIDxpIFtuZ0NsYXNzXT1cIm92ZXJsYXkuaWNvbiB8fCAnZmEgZmEtcGxheSB0ZXh0LXByaW1hcnknXCJcbiAgICAgICAgICAgICAgIChjbGljayk9XCJwbmdUYWJsZS5zaG93T3ZlcmxheShvdmVybGF5Q29udGV4dChvdmVybGF5LGksJGV2ZW50KSlcIj48L2k+XG4gICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdTd2l0Y2hDYXNlPVwiT1ZFUkxBWV9UWVBFLkNPTVBPTkVOVFwiPlxuICAgICAgICAgICAgPGkgW25nQ2xhc3NdPVwib3ZlcmxheS5pY29uIHx8ICdmYSBmYS1leWUgdGV4dC1wcmltYXJ5J1wiXG4gICAgICAgICAgICAgICAoY2xpY2spPVwicG5nVGFibGUuc2hvd092ZXJsYXkob3ZlcmxheUNvbnRleHQob3ZlcmxheSxpLCRldmVudCkpXCI+PC9pPlxuICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgIDwvbmctY29udGFpbmVyPlxuICBgLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBQbmdUYWJsZUhlYWRlckNvbENvbXBvbmVudCBleHRlbmRzIEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIE9WRVJMQVlfVFlQRSA9IE92ZXJsYXlUeXBlO1xuXG4gIEBJbnB1dCgpIGNvbHVtbjogUG5nVGFibGVDb2x1bW5Qcm9wcztcblxuICBAT3V0cHV0KCkgb25GaWx0ZXJCdG5DbGljayA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBAT3V0cHV0KCkgb25BZ2dzQnRuQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgY29uc3RydWN0b3IocHVibGljIHBuZ1RhYmxlOiBQbmdUYWJsZUNvbXBvbmVudCwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcycpXG4gIGdldCBjb2xDbGFzcygpOiBzdHJpbmcge1xuICAgIGlmIChDb21tb25zVXRpbHMuaXNGdW5jdGlvbih0aGlzLmNvbHVtbi5jb2xDbGFzcykpIHtcbiAgICAgIHJldHVybiAoPEZ1bmN0aW9uPnRoaXMuY29sdW1uLmNvbENsYXNzKS5jYWxsKHRoaXMucG5nVGFibGUsIHRoaXMuY29sdW1uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIDxzdHJpbmc+dGhpcy5jb2x1bW4uY29sQ2xhc3MgfHwgJyc7XG4gICAgfVxuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdzdHlsZS53aWR0aCcpXG4gIGdldCB3aWR0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5jb2x1bW4ud2lkdGg7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ3N0eWxlJylcbiAgZ2V0IGNvbFN0eWxlKCk6IHN0cmluZyB7XG4gICAgaWYgKENvbW1vbnNVdGlscy5pc0Z1bmN0aW9uKHRoaXMuY29sdW1uLmNvbFN0eWxlKSkge1xuICAgICAgcmV0dXJuICg8RnVuY3Rpb24+dGhpcy5jb2x1bW4uY29sU3R5bGUpLmNhbGwodGhpcy5wbmdUYWJsZSwgdGhpcy5jb2x1bW4pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gPHN0cmluZz50aGlzLmNvbHVtbi5jb2xTdHlsZSB8fCAnJztcbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb2x1bW4uaGVhZGVyT3ZlcmxheXMpIHtcbiAgICAgICg8T3ZlcmxheVtdPnRoaXMuY29sdW1uLmhlYWRlck92ZXJsYXlzKS5maWx0ZXIob3ZlcmxheSA9PiBvdmVybGF5LnR5cGUgPT09IE92ZXJsYXlUeXBlLk1FTlUpXG4gICAgICAgIC5mb3JFYWNoKG92ZXJsYXkgPT4ge1xuICAgICAgICAgIGlmIChvdmVybGF5LmNvbnRlbnRbJ21lbnVJdGVtJ10uY29tbWFuZCkge1xuICAgICAgICAgICAgY29uc3QgY29tbWFuZCA9IG92ZXJsYXkuY29udGVudFsnbWVudUl0ZW0nXS5jb21tYW5kO1xuICAgICAgICAgICAgb3ZlcmxheS5jb250ZW50WydtZW51SXRlbSddLmNvbW1hbmQgPSAoZXZlbnQpID0+IGNvbW1hbmQuY2FsbCh0aGlzLCB0aGlzLmhlYWRlckNvbnRleHQoZXZlbnQpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGZpbHRlckNsaWNrKGV2ZW50KSB7XG4gICAgdGhpcy5vbkZpbHRlckJ0bkNsaWNrLmVtaXQoe1xuICAgICAgZXZlbnQsXG4gICAgICBjb2x1bW46IHRoaXMuY29sdW1uXG4gICAgfSk7XG4gIH1cblxuICBhZ2dzQ2xpY2soZXZlbnQpIHtcbiAgICB0aGlzLm9uQWdnc0J0bkNsaWNrLmVtaXQoe1xuICAgICAgJGV2ZW50OiBldmVudCxcbiAgICAgIGNvbHVtbjogdGhpcy5jb2x1bW5cbiAgICB9KTtcbiAgfVxuXG4gIGhlYWRlckNvbnRleHQoZXZlbnQ/KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICRldmVudDogZXZlbnQsXG4gICAgICAkaWQ6IHRoaXMucG5nVGFibGUuJHByb3BzLiRpZCxcbiAgICAgIGNvbHVtbjogdGhpcy5jb2x1bW4sXG4gICAgICBwbmdUYWJsZTogdGhpcy5wbmdUYWJsZVxuICAgIH07XG4gIH1cblxuICBvdmVybGF5Q29udGV4dChvdmVybGF5LCBpbmRleCwgZXZlbnQ/KTogT3ZlcmxheUNvbnRleHQge1xuICAgIHJldHVybiB7XG4gICAgICAkZXZlbnQ6IGV2ZW50LFxuICAgICAgdHlwZTogb3ZlcmxheS50eXBlLFxuICAgICAgY29udGVudDogQ29tbW9uc1V0aWxzLmdldFZhbHVlKG92ZXJsYXkuY29udGVudCwgdGhpcy5oZWFkZXJDb250ZXh0KGV2ZW50KSksXG4gICAgICBjb250ZXh0OiBvdmVybGF5LmNvbnRleHQsXG4gICAgICBzdHlsZUNsYXNzOiBDb21tb25zVXRpbHMuZ2V0VmFsdWUob3ZlcmxheS5zdHlsZUNsYXNzLCB0aGlzLmhlYWRlckNvbnRleHQoZXZlbnQpKSxcbiAgICAgIHN0eWxlOiBDb21tb25zVXRpbHMuZ2V0VmFsdWUob3ZlcmxheS5zdHlsZSwgdGhpcy5oZWFkZXJDb250ZXh0KGV2ZW50KSksXG4gICAgICBvdmVybGF5U3R5bGVDbGFzczogQ29tbW9uc1V0aWxzLmdldFZhbHVlKG92ZXJsYXkub3ZlcmxheVN0eWxlQ2xhc3MsIHRoaXMuaGVhZGVyQ29udGV4dChldmVudCkpLFxuICAgICAgb3ZlcmxheVN0eWxlOiBDb21tb25zVXRpbHMuZ2V0VmFsdWUob3ZlcmxheS5vdmVybGF5U3R5bGUsIHRoaXMuaGVhZGVyQ29udGV4dChldmVudCkpLFxuICAgICAgaWQ6IGBvdmVybGF5LWhlYWRlci0ke3RoaXMuY29sdW1uLmtleX0tJHtpbmRleH1gXG4gICAgfTtcbiAgfVxufVxuIl19