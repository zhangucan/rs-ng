/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, Component, Input, QueryList, ViewChildren } from '@angular/core';
import { BaseComponent, DataFieldUtils, SelectorDirective } from '@er/core';
import { DataAttr, DataType, OverlayType } from '@er/types';
import { CommonsUtils } from '@er/utils';
import { PngTableBodyCellComponent } from '../body-cell/component';
import { PngTableComponent } from '../table/component';
export class PngTableBodyCellContentComponent extends BaseComponent {
    /**
     * @param {?} pngTable
     * @param {?} cell
     */
    constructor(pngTable, cell) {
        super();
        this.pngTable = pngTable;
        this.cell = cell;
        this.DATA_ATTR = DataAttr;
        this.DATA_TYPE = DataType;
        this.OVERLAY_TYPE = OverlayType;
    }
    /**
     * @return {?}
     */
    get cellContent() {
        if (this.column.dataAttr === DataAttr.BUTTONS) {
            /** @type {?} */
            let btns = this.column.cellContent;
            btns = CommonsUtils.getArrayValue(btns);
            btns = btns.filter(btn => !btn.show || btn.show === true || btn.show.method === true || (CommonsUtils.isFunction(btn.show.method) && (/** @type {?} */ ((btn.show.method).call(this, this.cellContext())))));
            return btns;
        }
        /** @type {?} */
        let content = this.getValue(this.column.cellContent || this.row[this.column.key]);
        if (CommonsUtils.isEmpty(content) && this.column.defaultCellContent !== undefined) {
            content = this.column.defaultCellContent;
        }
        if (this.column.contentKey) {
            content = CommonsUtils.get(content, this.column.contentKey);
            if (CommonsUtils.isArray(content)) {
                content = (/** @type {?} */ (content.join(',')));
            }
        }
        else if (this.column.format) {
            CommonsUtils.format(content, this.column.format);
        }
        else if (CommonsUtils.isFunction(this.column.formatter)) {
            content = ((/** @type {?} */ (this.column.formatter)))(content);
        }
        else if (this.column.formatter || CommonsUtils.isTemplateStr(content)) {
            content = CommonsUtils.templateStr(((/** @type {?} */ (this.column.formatter))) || content, this.row);
        }
        else if (CommonsUtils.isJson(content)) {
            content = DataFieldUtils.getFieldDisplayContent(content, this.column.dataField);
        }
        if (CommonsUtils.isString(content) && this.column.maxLength && content.length > this.column.maxLength) {
            content = content.substr(0, this.column.maxLength) + '...';
        }
        if (content === true) {
            return '是';
        }
        else if (content === false) {
            return '否';
        }
        return content;
    }
    /**
     * @return {?}
     */
    get cellIcon() {
        return this.getValue(this.column.cellIcon);
    }
    /**
     * @return {?}
     */
    get toolTip() {
        /** @type {?} */
        const toolTip = this.getValue(this.column.toolTip);
        if (!toolTip && this.column.maxLength && this.row[this.column.key] && this.row[this.column.key].length > this.column.maxLength) {
            return this.row[this.column.key];
        }
        return toolTip;
    }
    /**
     * @return {?}
     */
    get cellClass() {
        return CommonsUtils.getValue(this.column.cellStyleClass, this.cellContext());
    }
    /**
     * @return {?}
     */
    get cellStyle() {
        return CommonsUtils.getValue(this.column.cellStyle, this.cellContext());
    }
    /**
     * @return {?}
     */
    get routLink() {
        if (!this.column.routLink) {
            return;
        }
        /** @type {?} */
        let routerLink = this.column.routLink;
        if (CommonsUtils.isString(routerLink)) {
            routerLink = [routerLink];
        }
        /** @type {?} */
        let routeParams;
        if (this.column.routParam) {
            if (CommonsUtils.isFunction(this.column.routParam)) {
                routeParams = ((/** @type {?} */ (this.column.routParam))).call(this.pngTable, this.column, this.row) || [];
            }
            else if (CommonsUtils.isArray(this.column.routParam)) {
                routeParams = ((/** @type {?} */ (this.column.routParam))).map(param => this.row[param]) || [];
            }
            else if (CommonsUtils.isString(this.column.routParam)) {
                routeParams = [this.row[(/** @type {?} */ (this.column.routParam))]] || [];
            }
            else if (this.pngTable.$props.dataKey) {
                routeParams = [this.row[this.pngTable.$props.dataKey]] || [];
            }
        }
        if (routeParams) {
            routerLink = [...(/** @type {?} */ (routerLink)), ...routeParams];
        }
        return routerLink;
    }
    /**
     * @return {?}
     */
    get queryParam() {
        if (!this.column.routQueryParams) {
            return;
        }
        if (CommonsUtils.isFunction(this.column.routQueryParams)) {
            return ((/** @type {?} */ (this.column.routQueryParams))).call(this.pngTable, this.column, this.row);
        }
        else if (CommonsUtils.isArray(this.column.routQueryParams)) {
            /** @type {?} */
            const params = {};
            ((/** @type {?} */ (this.column.routQueryParams))).map(param => params[param] = this.row[param]);
            return params;
        }
        else if (CommonsUtils.isString(this.column.routQueryParams)) {
            return { [(/** @type {?} */ (this.column.routQueryParams))]: this.row[(/** @type {?} */ (this.column.routQueryParams))] };
        }
        return undefined;
    }
    /**
     * @param {?} icon
     * @return {?}
     */
    iconClass(icon) {
        if (icon && icon.trim().startsWith('fa-')) {
            return `fa ${icon}`;
        }
        return icon;
    }
    /**
     * @param {?} attr
     * @return {?}
     */
    hasAttr(attr) {
        return this.column.dataAttr === attr ||
            (CommonsUtils.isArray(this.column.dataAttr) && ((/** @type {?} */ (this.column.dataAttr))).indexOf(attr) >= 0);
    }
    /**
     * @param {?} overlay
     * @param {?} index
     * @param {?=} event
     * @return {?}
     */
    overlayContext(overlay, index, event) {
        return Object.assign({}, this.cellContext(event), { type: overlay.type, content: this.getValue(overlay.content), context: overlay.context, styleClass: this.getValue(overlay.styleClass), style: this.getValue(overlay.style), overlayStyleClass: this.getValue(overlay.overlayStyleClass), overlayStyle: this.getValue(overlay.overlayStyle), id: `overlay-cell-${this.column.key}-${index}` });
    }
    /**
     * @param {?} content
     * @return {?}
     */
    treeContent(content) {
        if (CommonsUtils.isArray(content)) {
            return '共' + ((/** @type {?} */ (content))).length + '项';
        }
        else if (CommonsUtils.isJson(content)) {
            return '共' + Object.keys(content).length + '项';
        }
        else {
            return content;
        }
    }
    /**
     * @param {?} content
     * @param {?=} event
     * @return {?}
     */
    overlayTreeContext(content, event) {
        return Object.assign({}, this.cellContext(event), { type: OverlayType.TREE, content: content });
    }
    /**
     * @param {?=} event
     * @return {?}
     */
    cellContext(event) {
        return this.cell.cellContext(event);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.column.overlays) {
            ((/** @type {?} */ (this.column.overlays))).filter(overlay => overlay.type === OverlayType.MENU)
                .forEach(overlay => {
                if (overlay.content['menuItem'].command) {
                    /** @type {?} */
                    const command = overlay.content['menuItem'].command;
                    overlay.content['menuItem'].command = (event) => command.call(this, this.cellContext(event));
                }
            });
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    cellClick(event) {
        event.preventDefault();
        if (this.column.onClick) {
            this.column.onClick.call(this.pngTable, this.cellContext(event));
        }
    }
    /**
     * @param {?} event
     * @param {?} tipText
     * @return {?}
     */
    toggleTip(event, tipText) {
        if (tipText) {
            this.pngTable.showOverlay((/** @type {?} */ ({
                $event: event,
                content: tipText,
                styleClass: 'alert alert-info',
                style: {
                    overflow: 'auto',
                    width: '300px',
                    height: '300px'
                }
            })));
        }
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    getValue(target) {
        return CommonsUtils.getValue(target, this.cellContext()) || '';
    }
}
PngTableBodyCellContentComponent.decorators = [
    { type: Component, args: [{
                selector: 'png-table-body-cell-content',
                template: "<ng-container *ngIf=\"customerTpl;else default\">\n  <ng-container *ngTemplateOutlet=\"customerTpl;context:cellContext()\"></ng-container>\n</ng-container>\n<ng-template #default>\n  <ng-container *ngIf=\"column.overlays\">\n    <ng-container *ngFor=\"let overlay of column.overlays; index as i\">\n      <ng-container [ngSwitch]=\"overlay.type\">\n        <ng-container *ngSwitchCase=\"OVERLAY_TYPE.CHART\">\n          <i [ngClass]=\"overlay.icon || 'fa fa-bar-chart text-primary'\" class=\"pull-right\"\n             title=\"\u663E\u793A\u56FE\u5F62\" (click)=\"pngTable.showOverlay(overlayContext(overlay,i,$event))\"></i>\n        </ng-container>\n        <ng-container *ngSwitchCase=\"OVERLAY_TYPE.TABLE\">\n          <i [ngClass]=\"overlay.icon || 'fa fa-eye text-primary'\" class=\"pull-right\"\n             title=\"\u663E\u793A\u8868\u683C\" (click)=\"pngTable.showOverlay(overlayContext(overlay,i,$event))\"></i>\n        </ng-container>\n        <ng-container *ngSwitchCase=\"OVERLAY_TYPE.PANEL\">\n          <i [ngClass]=\"overlay.icon || 'fa fa-eye text-primary'\" class=\"pull-right\"\n             title=\"\u663E\u793A\u66F4\u591A\u4FE1\u606F\" (click)=\"pngTable.showOverlay(overlayContext(overlay,i,$event))\"></i>\n        </ng-container>\n        <ng-container *ngSwitchCase=\"OVERLAY_TYPE.MENU\">\n          <i [ngClass]=\"overlay.icon || 'fa fa-arrow-circle-down text-primary'\" class=\"pull-right\"\n             title=\"\u663E\u793A\u83DC\u5355\" (click)=\"pngTable.showOverlay(overlayContext(overlay,i,$event))\"></i>\n        </ng-container>\n        <ng-container *ngSwitchCase=\"OVERLAY_TYPE.FRAME\">\n          <i [ngClass]=\"overlay.icon || 'fa fa-play text-primary'\"\n             title=\"\u663E\u793A\u66F4\u591A\u5185\u5BB9\" (click)=\"pngTable.showOverlay(overlayContext(overlay,i,$event))\"></i>\n        </ng-container>\n        <ng-container *ngSwitchCase=\"OVERLAY_TYPE.COMPONENT\">\n          <i [ngClass]=\"overlay.icon || 'fa fa-eye text-primary'\"\n             title=\"\u663E\u793A\u66F4\u591A\u5185\u5BB9\" (click)=\"pngTable.showOverlay(overlayContext(overlay,i,$event))\"></i>\n        </ng-container>\n      </ng-container>\n    </ng-container>\n  </ng-container>\n  <ng-container [ngSwitch]=\"column.dataAttr\">\n    <ng-container *ngSwitchCase=\"DATA_ATTR.IMAGE\">\n      <png-image [imageStyleClass]=\"cellClass\"\n                 [imageStyle]=\"cellStyle\"\n                 size=\"small\"\n                 [fileId]=\"cellContent\"\n                 [showDescription]=\"false\"\n      >\n      </png-image>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"DATA_ATTR.TAG\">\n        <span erTag [pTooltip]=\"toolTip\"\n              tooltipPosition=\"top\"\n              class=\"pull-right\"\n              [ngClass]=\"cellClass\"\n              [ngStyle]=\"cellStyle\">{{cellContent}}</span>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"DATA_ATTR.URL\">\n      <a [pTooltip]=\"toolTip\"\n         tooltipPosition=\"top\"\n         [href]=\"routLink\"\n         [ngClass]=\"cellClass\"\n         [ngStyle]=\"cellStyle\"\n         target=\"_blank\">{{cellContent}}</a>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"DATA_ATTR.COLOR\">\n      <span [ngClass]=\"cellContent | lowercase\"></span>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"DATA_ATTR.TREE\">\n      <span class=\"pull-right\">\n        {{treeContent(cellContent)}} <i class=\"fa fa-tree blue\" title=\"\u67E5\u770B\u5185\u5BB9\"\n                                        (click)=\"pngTable.showOverlay(overlayTreeContext(cellContent,$event))\"></i>\n      </span>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"DATA_ATTR.ICON\">\n      <span class=\"pull-right\"><i [ngClass]=\"iconClass(cellContent)\"></i></span>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"DATA_ATTR.DATE\">\n      <span>{{cellContent | date: 'yyyy-MM-dd'}}</span>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"DATA_ATTR.TIME\">\n      <span>{{cellContent | date: 'HH:mm:ss'}}</span>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"DATA_ATTR.DATE_TIME\">\n      <span>{{cellContent | date: 'yyyy-MM-dd HH:mm:ss'}}</span>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"DATA_ATTR.UP_TO_NOW\">\n      <ng-container *ngIf=\"cellContent\">\n       <span erTag class=\"pull-right date-to-now\" [pTooltip]=\"cellContent\" tooltipPosition=\"top\">\n        {{cellContent | erUpToNow}}\n      </span>\n        <i class=\"fa fa-clock-o pull-right\"></i>\n      </ng-container>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"DATA_ATTR.BADGE\">\n      <span [pTooltip]=\"toolTip\"\n            tooltipPosition=\"top\"\n            class='pull-right badge'\n            [ngClass]=\"cellClass\"\n            [ngStyle]=\"cellStyle\"\n            [innerHTML]=\"cellContent\"></span>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"DATA_ATTR.CODE\">\n      <span [pTooltip]=\"toolTip\"\n            tooltipPosition=\"top\"\n            class=\"pull-right data-code\"\n            [ngClass]=\"cellClass\"\n            [ngStyle]=\"cellStyle\"\n            [innerHTML]=\"cellContent\"></span>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"DATA_ATTR.PERCENT\">\n      <span [innerHTML]=\"cellContent|erPercent\"></span>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"DATA_ATTR.BUTTONS\">\n      <png-buttons [btns]=\"cellContent\" [context]=\"cellContext()\" [styleClass]=\"cellClass\"\n                   [style]=\"cellStyle\"></png-buttons>\n    </ng-container>\n    <ng-container *ngSwitchDefault>\n      <ng-container *ngIf=\"column.routLink || column.routParam\">\n        <a [pTooltip]=\"toolTip\" tooltipPosition=\"top\"\n           [ngClass]=\"cellClass\"\n           [ngStyle]=\"cellStyle\"\n           [routerLink]=\"routLink\" [queryParams]=\"queryParam\"\n           [innerHTML]=\"cellContent\"></a>\n      </ng-container>\n      <ng-container *ngIf=\"column.onClick\">\n        <a href=\"#\" [pTooltip]=\"toolTip\" tooltipPosition=\"top\"\n           [ngClass]=\"cellClass\"\n           [ngStyle]=\"cellStyle\"\n           (click)=\"cellClick($event)\"\n           [innerHTML]=\"cellContent\"></a>\n      </ng-container>\n      <ng-container *ngIf=\"!(column.routLink || column.routParam) && !column.onClick\">\n              <span [innerHTML]=\"cellContent\"\n                    [pTooltip]=\"toolTip\"\n                    tooltipPosition=\"top\"\n                    [ngClass]=\"cellClass\"\n                    [ngStyle]=\"cellStyle\"\n                    class=\"pull-right\"\n                    (click)=\"toggleTip($event, toolTip)\"\n              ></span>\n      </ng-container>\n    </ng-container>\n  </ng-container>\n</ng-template>\n",
                changeDetection: ChangeDetectionStrategy.OnPush
            }] }
];
/** @nocollapse */
PngTableBodyCellContentComponent.ctorParameters = () => [
    { type: PngTableComponent },
    { type: PngTableBodyCellComponent }
];
PngTableBodyCellContentComponent.propDecorators = {
    column: [{ type: Input }],
    row: [{ type: Input }],
    rowIndex: [{ type: Input }],
    selectors: [{ type: ViewChildren, args: [SelectorDirective,] }]
};
if (false) {
    /** @type {?} */
    PngTableBodyCellContentComponent.prototype.DATA_ATTR;
    /** @type {?} */
    PngTableBodyCellContentComponent.prototype.DATA_TYPE;
    /** @type {?} */
    PngTableBodyCellContentComponent.prototype.OVERLAY_TYPE;
    /** @type {?} */
    PngTableBodyCellContentComponent.prototype.column;
    /** @type {?} */
    PngTableBodyCellContentComponent.prototype.row;
    /** @type {?} */
    PngTableBodyCellContentComponent.prototype.rowIndex;
    /** @type {?} */
    PngTableBodyCellContentComponent.prototype.selectors;
    /** @type {?} */
    PngTableBodyCellContentComponent.prototype.pngTable;
    /**
     * @type {?}
     * @private
     */
    PngTableBodyCellContentComponent.prototype.cell;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL3ByaW1lbmcvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90YWJsZS9jb21wb25lbnQvYm9keS1jZWxsLWNvbnRlbnQvY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxTQUFTLEVBQUUsWUFBWSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3pHLE9BQU8sRUFBQyxhQUFhLEVBQUUsY0FBYyxFQUFFLGlCQUFpQixFQUFDLE1BQU0sVUFBVSxDQUFDO0FBQzFFLE9BQU8sRUFBQyxRQUFRLEVBQUUsUUFBUSxFQUEyQixXQUFXLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFDbkYsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUV2QyxPQUFPLEVBQUMseUJBQXlCLEVBQUMsTUFBTSx3QkFBd0IsQ0FBQztBQUNqRSxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQztBQVFyRCxNQUFNLE9BQU8sZ0NBQWlDLFNBQVEsYUFBYTs7Ozs7SUFnQmpFLFlBQW1CLFFBQTJCLEVBQzFCLElBQStCO1FBQ2pELEtBQUssRUFBRSxDQUFDO1FBRlMsYUFBUSxHQUFSLFFBQVEsQ0FBbUI7UUFDMUIsU0FBSSxHQUFKLElBQUksQ0FBMkI7UUFmbkQsY0FBUyxHQUFHLFFBQVEsQ0FBQztRQUVyQixjQUFTLEdBQUcsUUFBUSxDQUFDO1FBRXJCLGlCQUFZLEdBQUcsV0FBVyxDQUFDO0lBYTNCLENBQUM7Ozs7SUFFRCxJQUFJLFdBQVc7UUFDYixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQyxPQUFPLEVBQUU7O2dCQUN6QyxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXO1lBQ2xDLElBQUksR0FBRyxZQUFZLENBQUMsYUFBYSxDQUFDLElB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QkFBdUIsQ0FBQyxNQUFNO2FBQ2hEOzs7O1lBTk8saUJBQWlCO1lBRGpCLHlCQUF5Qjs7O3FCQWlCOUIsS0FBSztrQkFFTCxLQUFLO3VCQUVMLEtBQUs7d0JBRUwsWUFBWSxTQUFDLGlCQUFpQjs7OztJQVovQixxREFBcUI7O0lBRXJCLHFEQUFxQjs7SUFFckIsd0RBQTJCOztJQUUzQixrREFBcUM7O0lBRXJDLCtDQUFtQjs7SUFFbkIsb0RBQTBCOztJQUUxQixxREFBeUU7O0lBRTdELG9EQUFrQzs7Ozs7SUFDbEMsZ0RBQXVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBRdWVyeUxpc3QsIFZpZXdDaGlsZHJlbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0Jhc2VDb21wb25lbnQsIERhdGFGaWVsZFV0aWxzLCBTZWxlY3RvckRpcmVjdGl2ZX0gZnJvbSAnQGVyL2NvcmUnO1xuaW1wb3J0IHtEYXRhQXR0ciwgRGF0YVR5cGUsIE92ZXJsYXksIE92ZXJsYXlDb250ZXh0LCBPdmVybGF5VHlwZX0gZnJvbSAnQGVyL3R5cGVzJztcbmltcG9ydCB7Q29tbW9uc1V0aWxzfSBmcm9tICdAZXIvdXRpbHMnO1xuaW1wb3J0IHtQbmdUYWJsZUNvbHVtblByb3BzfSBmcm9tICcuLi8uLi90eXBlcyc7XG5pbXBvcnQge1BuZ1RhYmxlQm9keUNlbGxDb21wb25lbnR9IGZyb20gJy4uL2JvZHktY2VsbC9jb21wb25lbnQnO1xuaW1wb3J0IHtQbmdUYWJsZUNvbXBvbmVudH0gZnJvbSAnLi4vdGFibGUvY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG5nLXRhYmxlLWJvZHktY2VsbC1jb250ZW50JyxcbiAgdGVtcGxhdGVVcmw6ICd0cGwuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuXG5leHBvcnQgY2xhc3MgUG5nVGFibGVCb2R5Q2VsbENvbnRlbnRDb21wb25lbnQgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICBEQVRBX0FUVFIgPSBEYXRhQXR0cjtcblxuICBEQVRBX1RZUEUgPSBEYXRhVHlwZTtcblxuICBPVkVSTEFZX1RZUEUgPSBPdmVybGF5VHlwZTtcblxuICBASW5wdXQoKSBjb2x1bW46IFBuZ1RhYmxlQ29sdW1uUHJvcHM7XG5cbiAgQElucHV0KCkgcm93OiB7fVtdO1xuXG4gIEBJbnB1dCgpIHJvd0luZGV4OiBudW1iZXI7XG5cbiAgQFZpZXdDaGlsZHJlbihTZWxlY3RvckRpcmVjdGl2ZSkgc2VsZWN0b3JzOiBRdWVyeUxpc3Q8U2VsZWN0b3JEaXJlY3RpdmU+O1xuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBwbmdUYWJsZTogUG5nVGFibGVDb21wb25lbnQsXG4gICAgICAgICAgICAgIHByaXZhdGUgY2VsbDogUG5nVGFibGVCb2R5Q2VsbENvbXBvbmVudCkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBnZXQgY2VsbENvbnRlbnQoKSB7XG4gICAgaWYgKHRoaXMuY29sdW1uLmRhdGFBdHRyID09PSBEYXRhQXR0ci5CVVRUT05TKSB7XG4gICAgICBsZXQgYnRucyA9IHRoaXMuY29sdW1uLmNlbGxDb250ZW50O1xuICAgICAgYnRucyA9IENvbW1vbnNVdGlscy5nZXRBcnJheVZhbHVlKGJ0bnMpO1xuICAgICAgYnRucyA9IGJ0bnMuZmlsdGVyKGJ0biA9PiAhYnRuLnNob3cgfHwgYnRuLnNob3cgPT09IHRydWUgfHwgYnRuLnNob3cubWV0aG9kID09PSB0cnVlIHx8IChDb21tb25zVXRpbHMuaXNGdW5jdGlvbihidG4uc2hvdy5tZXRob2QpICYmIDxGdW5jdGlvbj4oYnRuLnNob3cubWV0aG9kKS5jYWxsKHRoaXMsIHRoaXMuY2VsbENvbnRleHQoKSkpKTtcbiAgICAgIHJldHVybiBidG5zO1xuICAgIH1cbiAgICBsZXQgY29udGVudCA9IHRoaXMuZ2V0VmFsdWUodGhpcy5jb2x1bW4uY2VsbENvbnRlbnQgfHwgdGhpcy5yb3dbdGhpcy5jb2x1bW4ua2V5XSk7XG4gICAgaWYgKENvbW1vbnNVdGlscy5pc0VtcHR5KGNvbnRlbnQpICYmIHRoaXMuY29sdW1uLmRlZmF1bHRDZWxsQ29udGVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb250ZW50ID0gdGhpcy5jb2x1bW4uZGVmYXVsdENlbGxDb250ZW50O1xuICAgIH1cbiAgICBpZiAodGhpcy5jb2x1bW4uY29udGVudEtleSkge1xuICAgICAgY29udGVudCA9IENvbW1vbnNVdGlscy5nZXQoY29udGVudCwgdGhpcy5jb2x1bW4uY29udGVudEtleSk7XG4gICAgICBpZiAoQ29tbW9uc1V0aWxzLmlzQXJyYXkoY29udGVudCkpIHtcbiAgICAgICAgY29udGVudCA9IDxzdHJpbmdbXT5jb250ZW50LmpvaW4oJywnKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMuY29sdW1uLmZvcm1hdCkge1xuICAgICAgQ29tbW9uc1V0aWxzLmZvcm1hdChjb250ZW50LCB0aGlzLmNvbHVtbi5mb3JtYXQpO1xuICAgIH0gZWxzZSBpZiAoQ29tbW9uc1V0aWxzLmlzRnVuY3Rpb24odGhpcy5jb2x1bW4uZm9ybWF0dGVyKSkge1xuICAgICAgY29udGVudCA9ICh0aGlzLmNvbHVtbi5mb3JtYXR0ZXIgYXMgRnVuY3Rpb24pKGNvbnRlbnQpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jb2x1bW4uZm9ybWF0dGVyIHx8IENvbW1vbnNVdGlscy5pc1RlbXBsYXRlU3RyKGNvbnRlbnQpKSB7XG4gICAgICBjb250ZW50ID0gQ29tbW9uc1V0aWxzLnRlbXBsYXRlU3RyKCh0aGlzLmNvbHVtbi5mb3JtYXR0ZXIgYXMgc3RyaW5nKSB8fCBjb250ZW50LCB0aGlzLnJvdyk7XG4gICAgfSBlbHNlIGlmIChDb21tb25zVXRpbHMuaXNKc29uKGNvbnRlbnQpKSB7XG4gICAgICBjb250ZW50ID0gRGF0YUZpZWxkVXRpbHMuZ2V0RmllbGREaXNwbGF5Q29udGVudChjb250ZW50LCB0aGlzLmNvbHVtbi5kYXRhRmllbGQpO1xuICAgIH1cbiAgICBpZiAoQ29tbW9uc1V0aWxzLmlzU3RyaW5nKGNvbnRlbnQpICYmIHRoaXMuY29sdW1uLm1heExlbmd0aCAmJiBjb250ZW50Lmxlbmd0aCA+IHRoaXMuY29sdW1uLm1heExlbmd0aCkge1xuICAgICAgY29udGVudCA9IGNvbnRlbnQuc3Vic3RyKDAsIHRoaXMuY29sdW1uLm1heExlbmd0aCkgKyAnLi4uJztcbiAgICB9XG4gICAgaWYgKGNvbnRlbnQgPT09IHRydWUpIHtcbiAgICAgIHJldHVybiAn5pivJztcbiAgICB9IGVsc2UgaWYgKGNvbnRlbnQgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gJ+WQpic7XG4gICAgfVxuICAgIHJldHVybiBjb250ZW50O1xuICB9XG5cbiAgZ2V0IGNlbGxJY29uKCkge1xuICAgIHJldHVybiB0aGlzLmdldFZhbHVlKHRoaXMuY29sdW1uLmNlbGxJY29uKTtcbiAgfVxuXG4gIGdldCB0b29sVGlwKCkge1xuICAgIGNvbnN0IHRvb2xUaXAgPSB0aGlzLmdldFZhbHVlKHRoaXMuY29sdW1uLnRvb2xUaXApO1xuICAgIGlmICghdG9vbFRpcCAmJiB0aGlzLmNvbHVtbi5tYXhMZW5ndGggJiYgdGhpcy5yb3dbdGhpcy5jb2x1bW4ua2V5XSAmJiB0aGlzLnJvd1t0aGlzLmNvbHVtbi5rZXldLmxlbmd0aCA+IHRoaXMuY29sdW1uLm1heExlbmd0aCkge1xuICAgICAgcmV0dXJuIHRoaXMucm93W3RoaXMuY29sdW1uLmtleV07XG4gICAgfVxuICAgIHJldHVybiB0b29sVGlwO1xuICB9XG5cbiAgZ2V0IGNlbGxDbGFzcygpIHtcbiAgICByZXR1cm4gQ29tbW9uc1V0aWxzLmdldFZhbHVlKHRoaXMuY29sdW1uLmNlbGxTdHlsZUNsYXNzLCB0aGlzLmNlbGxDb250ZXh0KCkpO1xuICB9XG5cbiAgZ2V0IGNlbGxTdHlsZSgpIHtcbiAgICByZXR1cm4gQ29tbW9uc1V0aWxzLmdldFZhbHVlKHRoaXMuY29sdW1uLmNlbGxTdHlsZSwgdGhpcy5jZWxsQ29udGV4dCgpKTtcbiAgfVxuXG4gIGdldCByb3V0TGluaygpIHtcbiAgICBpZiAoIXRoaXMuY29sdW1uLnJvdXRMaW5rKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCByb3V0ZXJMaW5rID0gdGhpcy5jb2x1bW4ucm91dExpbms7XG4gICAgaWYgKENvbW1vbnNVdGlscy5pc1N0cmluZyhyb3V0ZXJMaW5rKSkge1xuICAgICAgcm91dGVyTGluayA9IFtyb3V0ZXJMaW5rXTtcbiAgICB9XG4gICAgbGV0IHJvdXRlUGFyYW1zOiBhbnlbXTtcbiAgICBpZiAodGhpcy5jb2x1bW4ucm91dFBhcmFtKSB7XG4gICAgICBpZiAoQ29tbW9uc1V0aWxzLmlzRnVuY3Rpb24odGhpcy5jb2x1bW4ucm91dFBhcmFtKSkge1xuICAgICAgICByb3V0ZVBhcmFtcyA9ICg8RnVuY3Rpb24+dGhpcy5jb2x1bW4ucm91dFBhcmFtKS5jYWxsKHRoaXMucG5nVGFibGUsIHRoaXMuY29sdW1uLCB0aGlzLnJvdykgfHwgW107XG4gICAgICB9IGVsc2UgaWYgKENvbW1vbnNVdGlscy5pc0FycmF5KHRoaXMuY29sdW1uLnJvdXRQYXJhbSkpIHtcbiAgICAgICAgcm91dGVQYXJhbXMgPSAoPGFueVtdPnRoaXMuY29sdW1uLnJvdXRQYXJhbSkubWFwKHBhcmFtID0+IHRoaXMucm93W3BhcmFtXSkgfHwgW107XG4gICAgICB9IGVsc2UgaWYgKENvbW1vbnNVdGlscy5pc1N0cmluZyh0aGlzLmNvbHVtbi5yb3V0UGFyYW0pKSB7XG4gICAgICAgIHJvdXRlUGFyYW1zID0gW3RoaXMucm93WzxzdHJpbmc+dGhpcy5jb2x1bW4ucm91dFBhcmFtXV0gfHwgW107XG4gICAgICB9IGVsc2UgaWYgKHRoaXMucG5nVGFibGUuJHByb3BzLmRhdGFLZXkpIHtcbiAgICAgICAgcm91dGVQYXJhbXMgPSBbdGhpcy5yb3dbdGhpcy5wbmdUYWJsZS4kcHJvcHMuZGF0YUtleV1dIHx8IFtdO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAocm91dGVQYXJhbXMpIHtcbiAgICAgIHJvdXRlckxpbmsgPSBbLi4uPGFueVtdPnJvdXRlckxpbmssIC4uLnJvdXRlUGFyYW1zXTtcbiAgICB9XG4gICAgcmV0dXJuIHJvdXRlckxpbms7XG4gIH1cblxuICBnZXQgcXVlcnlQYXJhbSgpIHtcbiAgICBpZiAoIXRoaXMuY29sdW1uLnJvdXRRdWVyeVBhcmFtcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoQ29tbW9uc1V0aWxzLmlzRnVuY3Rpb24odGhpcy5jb2x1bW4ucm91dFF1ZXJ5UGFyYW1zKSkge1xuICAgICAgcmV0dXJuICg8RnVuY3Rpb24+dGhpcy5jb2x1bW4ucm91dFF1ZXJ5UGFyYW1zKS5jYWxsKHRoaXMucG5nVGFibGUsIHRoaXMuY29sdW1uLCB0aGlzLnJvdyk7XG4gICAgfSBlbHNlIGlmIChDb21tb25zVXRpbHMuaXNBcnJheSh0aGlzLmNvbHVtbi5yb3V0UXVlcnlQYXJhbXMpKSB7XG4gICAgICBjb25zdCBwYXJhbXMgPSB7fTtcbiAgICAgICg8YW55W10+dGhpcy5jb2x1bW4ucm91dFF1ZXJ5UGFyYW1zKS5tYXAocGFyYW0gPT4gcGFyYW1zW3BhcmFtXSA9IHRoaXMucm93W3BhcmFtXSk7XG4gICAgICByZXR1cm4gcGFyYW1zO1xuICAgIH0gZWxzZSBpZiAoQ29tbW9uc1V0aWxzLmlzU3RyaW5nKHRoaXMuY29sdW1uLnJvdXRRdWVyeVBhcmFtcykpIHtcbiAgICAgIHJldHVybiB7WzxzdHJpbmc+dGhpcy5jb2x1bW4ucm91dFF1ZXJ5UGFyYW1zXTogdGhpcy5yb3dbPHN0cmluZz50aGlzLmNvbHVtbi5yb3V0UXVlcnlQYXJhbXNdfTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGljb25DbGFzcyhpY29uKSB7XG4gICAgaWYgKGljb24gJiYgaWNvbi50cmltKCkuc3RhcnRzV2l0aCgnZmEtJykpIHtcbiAgICAgIHJldHVybiBgZmEgJHtpY29ufWA7XG4gICAgfVxuICAgIHJldHVybiBpY29uO1xuICB9XG5cbiAgaGFzQXR0cihhdHRyKSB7XG4gICAgcmV0dXJuIHRoaXMuY29sdW1uLmRhdGFBdHRyID09PSBhdHRyIHx8XG4gICAgICAoQ29tbW9uc1V0aWxzLmlzQXJyYXkodGhpcy5jb2x1bW4uZGF0YUF0dHIpICYmICh0aGlzLmNvbHVtbi5kYXRhQXR0ciBhcyBEYXRhQXR0cltdKS5pbmRleE9mKGF0dHIpID49IDApO1xuICB9XG5cbiAgb3ZlcmxheUNvbnRleHQob3ZlcmxheSwgaW5kZXgsIGV2ZW50Pyk6IE92ZXJsYXlDb250ZXh0IHtcbiAgICByZXR1cm4ge1xuICAgICAgLi4udGhpcy5jZWxsQ29udGV4dChldmVudCksXG4gICAgICB0eXBlOiBvdmVybGF5LnR5cGUsXG4gICAgICBjb250ZW50OiB0aGlzLmdldFZhbHVlKG92ZXJsYXkuY29udGVudCksXG4gICAgICBjb250ZXh0OiBvdmVybGF5LmNvbnRleHQsXG4gICAgICBzdHlsZUNsYXNzOiB0aGlzLmdldFZhbHVlKG92ZXJsYXkuc3R5bGVDbGFzcyksXG4gICAgICBzdHlsZTogdGhpcy5nZXRWYWx1ZShvdmVybGF5LnN0eWxlKSxcbiAgICAgIG92ZXJsYXlTdHlsZUNsYXNzOiB0aGlzLmdldFZhbHVlKG92ZXJsYXkub3ZlcmxheVN0eWxlQ2xhc3MpLFxuICAgICAgb3ZlcmxheVN0eWxlOiB0aGlzLmdldFZhbHVlKG92ZXJsYXkub3ZlcmxheVN0eWxlKSxcbiAgICAgIGlkOiBgb3ZlcmxheS1jZWxsLSR7dGhpcy5jb2x1bW4ua2V5fS0ke2luZGV4fWBcbiAgICB9O1xuICB9XG5cbiAgdHJlZUNvbnRlbnQoY29udGVudCkge1xuICAgIGlmIChDb21tb25zVXRpbHMuaXNBcnJheShjb250ZW50KSkge1xuICAgICAgcmV0dXJuICflhbEnICsgKGNvbnRlbnQgYXMgYW55W10pLmxlbmd0aCArICfpobknO1xuICAgIH0gZWxzZSBpZiAoQ29tbW9uc1V0aWxzLmlzSnNvbihjb250ZW50KSkge1xuICAgICAgcmV0dXJuICflhbEnICsgT2JqZWN0LmtleXMoY29udGVudCkubGVuZ3RoICsgJ+mhuSc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBjb250ZW50O1xuICAgIH1cbiAgfVxuXG4gIG92ZXJsYXlUcmVlQ29udGV4dChjb250ZW50LCBldmVudD8pOiBPdmVybGF5Q29udGV4dCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnRoaXMuY2VsbENvbnRleHQoZXZlbnQpLFxuICAgICAgdHlwZTogT3ZlcmxheVR5cGUuVFJFRSxcbiAgICAgIGNvbnRlbnQ6IGNvbnRlbnRcbiAgICB9O1xuICB9XG5cbiAgY2VsbENvbnRleHQoZXZlbnQ/KSB7XG4gICAgcmV0dXJuIHRoaXMuY2VsbC5jZWxsQ29udGV4dChldmVudCk7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb2x1bW4ub3ZlcmxheXMpIHtcbiAgICAgICg8T3ZlcmxheVtdPnRoaXMuY29sdW1uLm92ZXJsYXlzKS5maWx0ZXIob3ZlcmxheSA9PiBvdmVybGF5LnR5cGUgPT09IE92ZXJsYXlUeXBlLk1FTlUpXG4gICAgICAgIC5mb3JFYWNoKG92ZXJsYXkgPT4ge1xuICAgICAgICAgIGlmIChvdmVybGF5LmNvbnRlbnRbJ21lbnVJdGVtJ10uY29tbWFuZCkge1xuICAgICAgICAgICAgY29uc3QgY29tbWFuZCA9IG92ZXJsYXkuY29udGVudFsnbWVudUl0ZW0nXS5jb21tYW5kO1xuICAgICAgICAgICAgb3ZlcmxheS5jb250ZW50WydtZW51SXRlbSddLmNvbW1hbmQgPSAoZXZlbnQpID0+IGNvbW1hbmQuY2FsbCh0aGlzLCB0aGlzLmNlbGxDb250ZXh0KGV2ZW50KSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBjZWxsQ2xpY2soZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGlmICh0aGlzLmNvbHVtbi5vbkNsaWNrKSB7XG4gICAgICB0aGlzLmNvbHVtbi5vbkNsaWNrLmNhbGwodGhpcy5wbmdUYWJsZSwgdGhpcy5jZWxsQ29udGV4dChldmVudCkpO1xuICAgIH1cbiAgfVxuXG4gIHRvZ2dsZVRpcChldmVudCwgdGlwVGV4dCkge1xuICAgIGlmICh0aXBUZXh0KSB7XG4gICAgICB0aGlzLnBuZ1RhYmxlLnNob3dPdmVybGF5KDxPdmVybGF5Q29udGV4dD57XG4gICAgICAgICRldmVudDogZXZlbnQsXG4gICAgICAgIGNvbnRlbnQ6IHRpcFRleHQsXG4gICAgICAgIHN0eWxlQ2xhc3M6ICdhbGVydCBhbGVydC1pbmZvJyxcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICBvdmVyZmxvdzogJ2F1dG8nLFxuICAgICAgICAgIHdpZHRoOiAnMzAwcHgnLFxuICAgICAgICAgIGhlaWdodDogJzMwMHB4J1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFZhbHVlKHRhcmdldCkge1xuICAgIHJldHVybiBDb21tb25zVXRpbHMuZ2V0VmFsdWUodGFyZ2V0LCB0aGlzLmNlbGxDb250ZXh0KCkpIHx8ICcnO1xuICB9XG59XG4iXX0=