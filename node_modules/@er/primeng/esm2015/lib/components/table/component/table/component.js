/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, forwardRef, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { ActivatedRoute, Router } from '@angular/router';
import { DataAwareControlWrapperComponent } from '@er/core';
import { AggMethodsProps, DataType, Order, OverlayType } from '@er/types';
import { CommonsUtils, DataItemUtils, StatesUtils } from '@er/utils';
import * as esb from 'elastic-builder';
import { Menu, OverlayPanel } from 'primeng/primeng';
import { Table } from 'primeng/table';
import { BehaviorSubject } from 'rxjs';
import { filter, skip } from 'rxjs/operators';
import { defaultActionColumn, defaultAddButton, defaultAuditButton, defaultDeleteButton, defaultDownloadButton, defaultEditButton, defaultPngColumnProps, defaultPngTableProps, defaultRowIndexColumn, defaultViewButton } from '../../default';
import { PngTableUtils } from '../../util';
export class PngTableComponent extends DataAwareControlWrapperComponent {
    /**
     * @param {?} cd
     * @param {?} router
     * @param {?} activatedRoute
     */
    constructor(cd, router, activatedRoute) {
        super();
        this.cd = cd;
        this.router = router;
        this.activatedRoute = activatedRoute;
        this.OVERLAY_TYPE = OverlayType;
        this.bodyData$ = new BehaviorSubject([]);
        this.columns$ = new BehaviorSubject(undefined);
        this.templateNames = {
            caption: 'caption',
            spanHeader: 'spanHeader',
            header: 'header',
            headerSummary: 'headerSummary',
            body: 'body',
            frozenRows: 'frozenRows',
            cell: 'cell',
            dataCell: 'dataCell',
            footer: 'footer',
            footerSummary: 'summary',
            colGroup: 'colgroup',
            rowExpansion: 'rowexpansion',
            paginatorLeft: 'paginatorLeft',
            paginatorRight: 'paginatorRight'
        };
        this.$defaultProps = defaultPngTableProps;
        this.eventQuery = [];
        this.selectedRows = [];
        this.switch = true;
    }
    /**
     * @return {?}
     */
    get apiEntry() {
        return this.$props.$ext.apiDataProps && this.$props.$ext.apiDataProps.apiEntry;
    }
    /**
     * @return {?}
     */
    get $id() {
        return this.$props.$id;
    }
    /**
     * @return {?}
     */
    onPropsInit() {
        if (this.$props.entity) {
            if (!this.$props.caption || this.$props.caption['method']) {
                /** @type {?} */
                const caption = CommonsUtils.getValue(this.$props.caption, this.$props.entity.label);
                this.$props.caption = caption || `浏览${this.$props.entity.label || ''}`;
            }
            if (!this.$props.$ext.apiDataProps) {
                this.$props.$ext.apiDataProps = {};
            }
            if (!this.$props.$ext.apiDataProps.apiEntry) {
                this.$props.$ext.apiDataProps.apiEntry = this.$props.entity.apiEntry || '';
            }
        }
        if (this.$props.columns) {
            this.resoleActionsColumn(this.$props);
            /** @type {?} */
            let order = 0;
            this.$props.columns.forEach(column => {
                PngTableUtils.resolveColumnByDataField(column);
                CommonsUtils.defaults(column, defaultPngColumnProps);
                if (!column.order) {
                    column.order = ++order;
                }
                if (this.$props.scrollable && this.$props.scrollWidth && column.width && column.width.endsWith('%')) {
                    column.width = defaultPngColumnProps.width;
                }
                if (column.overlays) {
                    column.overlays = CommonsUtils.getArrayValue(column.overlays);
                }
                if (column.headerOverlays) {
                    column.headerOverlays = CommonsUtils.getArrayValue(column.headerOverlays);
                }
            });
        }
        if (this.$props.virtualScroll) {
            this.$props.alwaysShowPaginator = false;
            this.$props.paginator = false;
        }
        if (this.$props.scrollable) {
            CommonsUtils.set(this.$props, 'style.width', this.$props.scrollWidth);
        }
        /** @type {?} */
        const frozenColumns = this.$props.columns.filter(column => column.frozen);
        if (frozenColumns.length > 0) {
            this.$props.frozenColumns = frozenColumns;
            if (!this.$props.$ext.rowHeight) {
                this.$props.$ext.rowHeight = '30px';
            }
            /** @type {?} */
            let frozenWidth = 0;
            frozenColumns.forEach(column => {
                /** @type {?} */
                let width = 150;
                if (column.width) {
                    width = Number(column.width.substr(0, column.width.length - 2));
                }
                frozenWidth += width || 150;
                column.styleClass = column.styleClass || '' + ' table-frozen-column';
            });
            this.$props.frozenWidth = `${frozenWidth}px`;
        }
        this.updateColumns();
        this.apiDataProps = this.getApiDataProps();
        this.$subscriptions = StatesUtils.observe(this.$id)
            .pipe(filter(state => !!state), skip(1))
            .subscribe(state => {
            this.table.first = 0;
            this.load(state);
        });
        if (this.$props.$ext.dataItems) {
            this.data$.next({
                items: this.$props.$ext.dataItems,
                total: this.$props.$ext.dataItems.length
            });
        }
        StatesUtils.create(this.$id, {
            component: this
        }, true);
    }
    /**
     * @param {?=} event
     * @return {?}
     */
    updateColumns(event) {
        /** @type {?} */
        let columns;
        if (!event) {
            columns = this.$props.columns.filter(column => !column.frozen) || [];
        }
        else {
            columns = event.value;
        }
        columns.sort((a, b) => a.order - b.order);
        this.dataColumns = columns.filter(column => !column.isActionColumn || !(column.hidden && !column.fetch));
        if (!event) {
            columns = columns.filter(column => !column.hidden);
        }
        this.dataColumnNames = CommonsUtils.compact(this.dataColumns.map(column => column.key));
        if (this.$props.frozenColumns) {
            this.$props.frozenColumns.forEach(column => {
                if (column.key) {
                    this.dataColumnNames.push(column.key);
                }
            });
        }
        this.columns$.next(columns);
        if (event) {
            this.load();
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    updateColAggKeys(event) {
        if (event.column) {
            /** @type {?} */
            const column = event.column;
            /** @type {?} */
            const aggProps = [];
            if (event.methods && event.methods.length > 0) {
                event.methods.forEach(method => {
                    aggProps.push((/** @type {?} */ ({
                        name: `${column.key}-${method}`,
                        field: column.aggKey || column.key,
                        method: AggMethodsProps[method]['key']
                    })));
                });
            }
            column.aggProps = aggProps;
            StatesUtils.update(this.$id, {});
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    updateColFilters(event) {
        if (event.column) {
            /** @type {?} */
            const column = event.column;
            column.filters = [];
            if (event.value) {
                column.filters.push(event.value);
            }
            StatesUtils.update(this.$id, {});
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    updateSimpleSearch(event) {
        if (CommonsUtils.isEmpty(event)) {
            this.simpleQuery = undefined;
        }
        else {
            if (event.indexOf('"') === -1) {
                event = `"${event}"`;
            }
            this.simpleQuery = [esb.simpleQueryStringQuery(event)];
        }
        this.load();
    }
    /**
     * @param {?} key
     * @return {?}
     */
    getColumnByKey(key) {
        /** @type {?} */
        const columns = this.$props.columns.filter(column => column.key === key);
        if (columns.length >= 1) {
            return columns[0];
        }
        else {
            return undefined;
        }
    }
    /**
     * @param {?} row
     * @return {?}
     */
    getRowStyleClass(row) {
        return CommonsUtils.getValue(this.$props.$ext.rowStyleClass, row);
    }
    /**
     * @param {?} row
     * @return {?}
     */
    getRowStyle(row) {
        /** @type {?} */
        const style = CommonsUtils.getValue(this.$props.$ext.rowStyle, row) || {};
        if (this.$props.$ext.rowHeight) {
            style['height'] = this.$props.$ext.rowHeight;
        }
        return style;
    }
    /**
     * @param {?} column
     * @return {?}
     */
    getHeaderStyleClass(column) {
        return CommonsUtils.getValue(column.headerStyleClass, column);
    }
    /**
     * @param {?} column
     * @return {?}
     */
    getHeaderStyle(column) {
        return CommonsUtils.getValue(column.headerStyle, column);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    rowSelect(event) {
        this.updateTouch();
        this.value = DataItemUtils.getItemValue(event, this.$props.$ext.dataItemProps && this.$props.$ext.dataItemProps.valueKey);
    }
    /**
     * @param {?=} state
     * @return {?}
     */
    load(state) {
        this.apiDataProps = this.getApiDataProps(state);
        this.cd.markForCheck();
    }
    /**
     * @param {?} data
     * @return {?}
     */
    onDataReady(data) {
        /** @type {?} */
        const dataPath = CommonsUtils.get(this.$props, '$ext.apiDataProps.dataPath');
        if (dataPath && dataPath !== '/') {
            this.bodyData$.next(data);
        }
        else {
            this.bodyData$.next(data.items || []);
        }
    }
    /**
     * @param {?} ctx
     * @return {?}
     */
    showOverlay(ctx) {
        if (ctx && ctx.content) {
            this.overlayContext = Object.assign({ dismissable: true, showCloseIcon: true }, ctx);
            this.overlayPanel.hide();
            this.overlayPanel.toggle(ctx.$event);
            this.cd.detectChanges();
        }
    }
    /**
     * @return {?}
     */
    hidePanel() {
        this.overlayPanel.hide();
    }
    /**
     * @return {?}
     */
    resetQuery() {
        this.simpleQuery = undefined;
        this.complexQuery = undefined;
    }
    /**
     * @return {?}
     */
    resetForeignQuery() {
        this.eventQuery = [];
    }
    /**
     * @param {?} url
     * @param {?=} commands
     * @param {?=} params
     * @return {?}
     */
    navigate(url, commands, params) {
        this.router.navigate([{ outlets: { [this.$props.$ext.routerOutlet]: [url, ...commands] } }], {
            relativeTo: this.activatedRoute,
            skipLocationChange: false,
            queryParams: params
        });
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.$props && this.$props.$id) {
            StatesUtils.deleteState(this.$props.$id);
        }
        super.ngOnDestroy();
    }
    /**
     * @param {?=} state
     * @return {?}
     */
    getTableQuery(state) {
        if (state && (state.query || state.filter)) {
            this.eventQuery = [
                ...CommonsUtils.getArrayValue(state['query'] || {}),
                ...CommonsUtils.getArrayValue(state['filter'] || {})
            ];
        }
        /** @type {?} */
        const filters = [
            ...this.getColumnsFilters(),
            ...this.eventQuery,
            ...this.simpleQuery || [],
            ...CommonsUtils.getArrayValue(this.complexQuery) || []
        ];
        /** @type {?} */
        const gApiDataProps = CommonsUtils.copy(CommonsUtils.get(this.$props, '$ext.apiDataProps'));
        /** @type {?} */
        let apiFilter = gApiDataProps.filter || {};
        if (apiFilter['$and']) {
            apiFilter['$and'] = [
                ...apiFilter['$and'],
                ...filters
            ];
        }
        else if (apiFilter['$or']) {
            apiFilter['$and'] = filters;
        }
        else {
            apiFilter = CommonsUtils.getArrayValue(apiFilter)
                .concat(filters);
        }
        apiFilter = apiFilter.filter(f => !CommonsUtils.isEmpty(f));
        /** @type {?} */
        let aggProps = gApiDataProps.aggProps || {};
        aggProps = CommonsUtils.getArrayValue(aggProps).concat(this.getColumnsAggs());
        aggProps = aggProps.filter(a => Object.keys(a).length > 0);
        /** @type {?} */
        let sort = gApiDataProps.sort || [];
        /** @type {?} */
        const tableMetaData = this.table.createLazyLoadMetadata();
        sort = CommonsUtils.getArrayValue(sort);
        /** @type {?} */
        const tableSort = tableMetaData.sortField;
        if (tableSort) {
            /** @type {?} */
            const column = this.getColumnByKey(tableSort);
            /** @type {?} */
            const sortKey = (column && column.sortKey) || tableSort;
            sort.push({ [sortKey]: tableMetaData.sortOrder === 1 ? Order.ASC : Order.DESC });
        }
        delete gApiDataProps.filter;
        delete gApiDataProps.aggProps;
        return Object.assign({}, gApiDataProps, { filter: apiFilter, aggProps,
            sort });
    }
    /**
     * @private
     * @return {?}
     */
    getColumnsFilters() {
        /** @type {?} */
        const filters = [];
        /** @type {?} */
        const columns = (this.columns$.value || []).concat(this.$props.frozenColumns || []);
        columns
            .filter(column => column.filters)
            .forEach(column => column.filters.filter(f => f)
            .forEach(f => {
            /** @type {?} */
            let query;
            switch (column.filterDataType || column.dataType || (column.dataField && column.dataField.dataType) || DataType.STRING) {
                case DataType.NUMBER:
                case DataType.DATE:
                    if (CommonsUtils.isArray(f)) {
                        query = esb.rangeQuery(column.filterKey || column.key).gte(f[0]).lte(f[1]);
                    }
                    else {
                        query = esb.rangeQuery(column.filterKey || column.key).gte(f).lte(f);
                    }
                    break;
                default:
                    query = esb.matchQuery(column.filterKey || column.key, f);
            }
            filters.push(query);
        }));
        return filters;
    }
    /**
     * @private
     * @return {?}
     */
    getColumnsAggs() {
        /** @type {?} */
        let aggs = [];
        /** @type {?} */
        const columns = (this.columns$.value || []).concat(this.$props.frozenColumns || []);
        columns
            .filter(column => column.aggProps)
            .forEach(column => {
            aggs = aggs.concat(column.aggProps);
        });
        return aggs;
    }
    /**
     * @private
     * @param {?} props
     * @return {?}
     */
    resoleActionsColumn(props) {
        /** @type {?} */
        let actionColumn;
        /** @type {?} */
        let actionColumnIndex = -1;
        props.columns.some((column, i) => {
            if (column.isActionColumn) {
                actionColumn = column;
                actionColumnIndex = i;
                return true;
            }
            return false;
        });
        if (actionColumnIndex >= 0) {
            props.columns = CommonsUtils.removeByIndex(props.columns, actionColumnIndex);
        }
        if (props.$ext.hasAddAction) {
            this.addBtn = Object.assign({}, defaultAddButton, { context: this });
        }
        /** @type {?} */
        const buttons = [];
        if (props.$ext.hasViewAction) {
            buttons.push(Object.assign({}, defaultViewButton, { show: props.$ext.hasViewAction }));
        }
        if (props.$ext.hasDeleteAction) {
            buttons.push(Object.assign({}, defaultDeleteButton, { show: props.$ext.hasDeleteAction }));
        }
        if (props.$ext.hasAuditAction) {
            buttons.push(Object.assign({}, defaultAuditButton, { show: props.$ext.hasAuditAction }));
        }
        if (props.$ext.hasDownloadAction) {
            buttons.push(Object.assign({}, defaultDownloadButton, { show: props.$ext.hasDownloadAction }));
        }
        if (props.$ext.hasEditAction) {
            buttons.push(Object.assign({}, defaultEditButton, { show: props.$ext.hasEditAction }));
        }
        if (buttons.length > 0 && !actionColumn) {
            actionColumn = Object.assign({}, defaultActionColumn, actionColumn || {});
        }
        if (buttons.length > 0) {
            actionColumn.cellContent = [
                ...CommonsUtils.getArrayValue(actionColumn.cellContent) || [],
                ...buttons
            ];
        }
        if (actionColumn) {
            if (this.$props.$ext.frozenActionColumn) {
                actionColumn.frozen = true;
            }
            if (this.$props.$ext.rowActionsPlaceAhead) {
                ((/** @type {?} */ (this.$props.columns))).splice(0, 0, actionColumn);
            }
            else {
                this.$props.columns.push(actionColumn);
            }
        }
        if (this.$props.$ext.hasRowIndex) {
            this.$props.columns.splice(0, 0, defaultRowIndexColumn);
        }
    }
    /**
     * @private
     * @param {?=} state
     * @return {?}
     */
    getApiDataProps(state) {
        /** @type {?} */
        const tableMetaData = this.table.createLazyLoadMetadata();
        /** @type {?} */
        const tableQuery = this.getTableQuery(state);
        /** @type {?} */
        const apiDataProps = (/** @type {?} */ (Object.assign({}, tableQuery, { dataPath: '/', returnFields: this.dataColumnNames, from: tableMetaData.first, size: tableMetaData.rows })));
        apiDataProps.requestOptions = apiDataProps.requestOptions || {};
        if (!apiDataProps.requestOptions.tag) {
            apiDataProps.requestOptions.tag = this.$id;
        }
        return apiDataProps;
    }
}
PngTableComponent.decorators = [
    { type: Component, args: [{
                selector: 'png-table',
                template: "<p-table #pngTable\n         (onDataReady)=\"onDataReady($event)\"\n         (onLazyLoad)=\"load($event)\"\n         (selectionChange)=\"rowSelect($event)\"\n         [(selection)]=\"selectedRows\"\n         [columns]=\"columns$|async\"\n         [context]=\"ctx\"\n         [erApiData]=\"apiDataProps\"\n         [props]=\"$props\"\n         [totalRecords]=\"(data$|async)?.total\"\n         [value]=\"bodyData$|async\"\n         erPropsBind\n>\n  <ng-template pTemplate=\"caption\">\n    <png-table-caption\n      (onSimpleSearch)=\"updateSimpleSearch($event)\"\n      [addButton]=\"addBtn\"\n      [caption]=\"$props.caption\"\n      [customerTpl]=\"template(templateNames.caption)\"\n      [hasAddAction]=\"$props.$ext.hasAddAction\"\n      [hasSearchBox]=\"$props.$ext.hasSearchBox\"\n      [hasSearchInput]=\"$props.$ext.hasSearchInput\"\n    >\n    </png-table-caption>\n    <ng-container *ngIf=\"$props.$ext.caption\">\n      <er-dyna-content [content]=\"$props.$ext.caption\" [context]=\"getEventContext()\"></er-dyna-content>\n    </ng-container>\n  </ng-template>\n\n  <ng-template let-columns pTemplate=\"colgroup\">\n    <ng-container *ngTemplateOutlet=\"colGroupTpl;\n                     context:{$implicit:$props,context:getEventContext(),columns:columns}\">\n    </ng-container>\n  </ng-template>\n\n\n  <ng-template let-columns pTemplate=\"header\">\n    <ng-container\n      *ngTemplateOutlet=\"template(templateNames.spanHeader); context:{$implicit:columns}\"></ng-container>\n    <ng-container *ngIf=\"$props.$ext.spanHeader\">\n      <span [outerHTML]=\"$props.$ext.spanHeader\"></span>\n    </ng-container>\n    <tr (onAggKeysSet)=\"updateColAggKeys($event)\"\n        (onFiltersSet)=\"updateColFilters($event)\"\n        [columns]=\"columns\"\n        [customerTpl]=\"template(templateNames.header)\"\n        png-table-header\n    >\n    </tr>\n\n    <ng-container *ngIf=\"(data$|async)?.aggs as aggValues\">\n      <tr [aggValues]=\"aggValues\"\n          [columns]=\"columns\"\n          [customerTpl]=\"template(templateNames.headerSummary)\"\n          png-table-summary\n      >\n      </tr>\n    </ng-container>\n  </ng-template>\n\n  <!--<ng-container *ngIf=\"$$props.frozenValue\">-->\n  <!--<ng-template pTemplate=\"frozenrows\" let-row let-columns=\"columns\">-->\n  <!--<ng-container *ngTemplateOutlet=\"template(templateNames.frozenRows,defaultBodyTpl);-->\n  <!--context:{$implicit:row,columns:columns,$props:$$props,table:pngTable}\">-->\n  <!--</ng-container>-->\n  <!--</ng-template>-->\n  <!--</ng-container>-->\n\n  <ng-template let-columns=\"columns\" let-expanded=\"expanded\" let-row let-rowIndex=\"rowIndex\" pTemplate=\"body\">\n    <tr [cellTpl]=\"template(templateNames.cell)\"\n        [columns]=\"columns\"\n        [customerTpl]=\"template(templateNames.body)\"\n        [dataCellTpl]=\"template(templateNames.dataCell)\"\n        [expanded]=\"expanded\"\n        [ngClass]=\"getRowStyleClass({row: row, rowIndex: rowIndex})\"\n        [ngStyle]=\"getRowStyle({row: row, rowIndex: rowIndex})\"\n        [pSelectableRowIndex]=\"rowIndex\"\n        [pSelectableRow]=\"row\"\n        [rowIndex]=\"rowIndex\"\n        [row]=\"row\"\n        png-table-body-row\n    >\n    </tr>\n  </ng-template>\n\n  <ng-template let-columns=\"columns\" let-row pTemplate=\"rowexpansion\">\n    <tr [columns]=\"dataColumns\"\n        [customerTpl]=\"template(templateNames.rowExpansion)\"\n        [rowId]=\"row[$props.dataKey || 'id']\"\n        png-table-expanded-row\n    >\n    </tr>\n  </ng-template>\n\n  <ng-template let-columns pTemplate=\"footer\">\n    <tr [columns]=\"columns\"\n        [customerTpl]=\"template(templateNames.footer)\"\n        png-table-footer\n    >\n    </tr>\n  </ng-template>\n\n  <ng-container *ngIf=\"(data$|async)?.aggs as aggValues\">\n    <ng-template pTemplate=\"summary\">\n      <tr [aggValues]=\"aggValues\"\n          [columns]=\"dataColumns\"\n          [customerTpl]=\"template(templateNames.footerSummary)\"\n          png-table-summary\n      >\n      </tr>\n    </ng-template>\n  </ng-container>\n\n  <ng-template let-state pTemplate=\"paginatorleft\">\n    <ng-container *ngIf=\"(data$|async)?.total as totalRecords\">\n      <ng-container\n        *ngTemplateOutlet=\"template(templateNames.paginatorLeft,paginationLeftTpl);context:{$implicit:state,totalRecords:totalRecords}\">\n      </ng-container>\n    </ng-container>\n  </ng-template>\n\n  <ng-template let-state pTemplate=\"paginatorright\">\n    <div class=\"d-flex align-content-center\">\n      <er-http-status [tag]=\"$id\" class=\"mr-2\"></er-http-status>\n      <ng-container *ngIf=\"$props.$ext.hasColumnSelector\">\n        <png-table-column-selector\n          (onColumnsChange)=\"updateColumns($event)\"\n          [columns]=\"columns$|async\"\n          [optionColumns]=\"$props.columns\"\n        >\n        </png-table-column-selector>\n      </ng-container>\n      <ng-container *ngIf=\"$props.$ext.hasPaginatorRight\">\n        <ng-container\n          *ngTemplateOutlet=\"template(templateNames.paginatorRight);context:{$implicit:state}\"></ng-container>\n      </ng-container>\n    </div>\n  </ng-template>\n\n\n  <ng-template #colGroupTpl let-columns=\"columns\" let-props>\n    <colgroup>\n      <col *ngIf=\"props.$ext.rowExpandable\" style=\"width: 3em\">\n      <col *ngIf=\"props.$ext.hasRowCheckbox\" style=\"width: 3em\">\n      <col *ngFor=\"let col of columns\" [ngClass]=\"getHeaderStyleClass(col)\"\n           [ngStyle]=\"getHeaderStyle(col)\"\n           [width]=\"col.width\"\n      >\n    </colgroup>\n  </ng-template>\n\n  <ng-template #defaultFrozonRowsTpl let-columns=\"columns\" let-row>\n  </ng-template>\n\n  <ng-template let-columns pTemplate=\"emptymessage\">\n    <tr>\n      <td [attr.colspan]=\"columns?.length\">\n        <strong>{{$props.$ext.emptyMessage}}</strong>\n      </td>\n    </tr>\n  </ng-template>\n</p-table>\n\n<ng-template #paginationLeftTpl let-state let-totalRecords=\"totalRecords\">\n  <span class=\"paginationLeft\"><span *ngIf=\"simpleQuery || complexQuery\"\n                                     class=\"font-weight-bold text-danger \"><u>\u641C\u7D22\u7ED3\u679C</u></span>\u663E\u793A {{totalRecords < 1 ? 0 : state.first + 1}}\n    -\n  {{totalRecords > 0 ? ((state.rows+ state.first) <= totalRecords ? (state.rows + state.first) :\n  totalRecords) : 0}}\uFF0C\u5171 {{totalRecords ? totalRecords : 0}} \u6761</span>\n</ng-template>\n\n\n<p-overlayPanel #overlayPanel [dismissable]=\"overlayContext?.dismissable\"\n                [showCloseIcon]=\"overlayContext?.showCloseIcon\"\n                [id]=\"overlayContext?.id\"\n                [ngStyle]=\"overlayContext?.overlayStyle\"\n                [styleClass]=\"overlayContext?.overlayStyleClass\">\n  <ng-container *ngIf=\"overlayContext\">\n    <ng-container [ngSwitch]=\"overlayContext.type\">\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.PANEL\">\n        <er-dyna-content [content]=\"overlayContext.content\"\n                         [context]=\"overlayContext.context\"\n                         [styleClass]=\"overlayContext.styleClass\"\n                         [style]=\"overlayContext.style\"\n        ></er-dyna-content>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.TABLE\">\n        <png-table erPropsBind [props]=\"overlayContext.content\"></png-table>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.CHART\">\n        <png-chart erPropsBind [props]=\"overlayContext.content\"></png-chart>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.MENU\">\n        <p-menu appendTo=\"body\" [popup]=\"true\" [model]=\"overlayContext.content\"></p-menu>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.TREE\">\n        <pre [erJsonViewer]=\"overlayContext.content\" openLevel=\"1\"></pre>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.FRAME\">\n        <iframe [ngClass]=\"overlayContext.styleClass\" [ngStyle]=\"overlayContext.style\"\n                [src]=\"overlayContext.content|erSafeHtml:'resource'\" frameborder=\"0\"\n                allowfullscreen></iframe>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"OVERLAY_TYPE.COMPONENT\">\n        <er-dyna-content [content]=\"overlayContext.content\"\n                         [context]=\"overlayContext.context\"\n                         [styleClass]=\"overlayContext.styleClass\"\n                         [style]=\"overlayContext.style\"\n        ></er-dyna-content>\n      </ng-container>\n    </ng-container>\n  </ng-container>\n</p-overlayPanel>\n\n<!--<div style=\"position: relative;\">-->\n<!--<p-paginator rows=\"10\"-->\n<!--(onLazyLoad)=\"load($event)\"-->\n<!--(onPageChange)=\"load($event)\"-->\n<!--[totalRecords]=\"totalRecords\"-->\n<!--[rowsPerPageOptions]=\"[10, 25]\">-->\n<!--</p-paginator>-->\n<!--<span style=\"position: absolute; top:3px; right:5px; margin: 5px;\">Total records: {{totalRecords}} </span>-->\n<!--</div>-->\n",
                providers: [{
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef(() => PngTableComponent),
                        multi: true
                    }],
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: ["/deep/ .ui-paginator{font-size:.8rem!important}/deep/ td.col-expandable,/deep/ th.col-expandable{width:1em}/deep/ td.col-checkbox,/deep/ th.col-checkbox{width:1em}/deep/ td.col-radio,/deep/ th.col-radio{width:5px}/deep/ td.row-index,/deep/ th.row-index{width:100px}/deep/ td.circle,/deep/ th.circle{border-radius:50%!important}/deep/ td.col-summary,/deep/ th.col-summary{background-color:#068020;color:#fff!important}"]
            }] }
];
/** @nocollapse */
PngTableComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: Router },
    { type: ActivatedRoute }
];
PngTableComponent.propDecorators = {
    table: [{ type: ViewChild, args: ['pngTable',] }],
    overlayPanel: [{ type: ViewChild, args: ['overlayPanel',] }],
    popupMenu: [{ type: ViewChild, args: [Menu,] }]
};
if (false) {
    /** @type {?} */
    PngTableComponent.prototype.OVERLAY_TYPE;
    /** @type {?} */
    PngTableComponent.prototype.table;
    /** @type {?} */
    PngTableComponent.prototype.overlayPanel;
    /** @type {?} */
    PngTableComponent.prototype.popupMenu;
    /** @type {?} */
    PngTableComponent.prototype.bodyData$;
    /** @type {?} */
    PngTableComponent.prototype.columns$;
    /** @type {?} */
    PngTableComponent.prototype.dataColumnNames;
    /** @type {?} */
    PngTableComponent.prototype.dataColumns;
    /** @type {?} */
    PngTableComponent.prototype.templateNames;
    /** @type {?} */
    PngTableComponent.prototype.$defaultProps;
    /** @type {?} */
    PngTableComponent.prototype.simpleQuery;
    /** @type {?} */
    PngTableComponent.prototype.complexQuery;
    /** @type {?} */
    PngTableComponent.prototype.eventQuery;
    /** @type {?} */
    PngTableComponent.prototype.selectedRows;
    /** @type {?} */
    PngTableComponent.prototype.addBtn;
    /** @type {?} */
    PngTableComponent.prototype.overlayContext;
    /** @type {?} */
    PngTableComponent.prototype.switch;
    /** @type {?} */
    PngTableComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    PngTableComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    PngTableComponent.prototype.activatedRoute;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL3ByaW1lbmcvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90YWJsZS9jb21wb25lbnQvdGFibGUvY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsdUJBQXVCLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBYSxTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDdEgsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDakQsT0FBTyxFQUFDLGNBQWMsRUFBRSxNQUFNLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUN2RCxPQUFPLEVBQUMsZ0NBQWdDLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFDMUQsT0FBTyxFQUFDLGVBQWUsRUFBMEIsUUFBUSxFQUFFLEtBQUssRUFBa0IsV0FBVyxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQ2hILE9BQU8sRUFBQyxZQUFZLEVBQUUsYUFBYSxFQUFFLFdBQVcsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUNuRSxPQUFPLEtBQUssR0FBRyxNQUFNLGlCQUFpQixDQUFDO0FBQ3ZDLE9BQU8sRUFBQyxJQUFJLEVBQUUsWUFBWSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDbkQsT0FBTyxFQUFDLEtBQUssRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNwQyxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ3JDLE9BQU8sRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUMsT0FBTyxFQUNMLG1CQUFtQixFQUNuQixnQkFBZ0IsRUFDaEIsa0JBQWtCLEVBQ2xCLG1CQUFtQixFQUNuQixxQkFBcUIsRUFDckIsaUJBQWlCLEVBQ2pCLHFCQUFxQixFQUNyQixvQkFBb0IsRUFDcEIscUJBQXFCLEVBQ3JCLGlCQUFpQixFQUNsQixNQUFNLGVBQWUs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QUE0Qjs7Ozs7SUFBRSxtQ0FBc0I7Ozs7O0lBQUUsMkNBQXNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgZm9yd2FyZFJlZiwgT25EZXN0cm95LCBWaWV3Q2hpbGR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtOR19WQUxVRV9BQ0NFU1NPUn0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHtBY3RpdmF0ZWRSb3V0ZSwgUm91dGVyfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHtEYXRhQXdhcmVDb250cm9sV3JhcHBlckNvbXBvbmVudH0gZnJvbSAnQGVyL2NvcmUnO1xuaW1wb3J0IHtBZ2dNZXRob2RzUHJvcHMsIEFnZ1Byb3BzLCBBcGlEYXRhUHJvcHMsIERhdGFUeXBlLCBPcmRlciwgT3ZlcmxheUNvbnRleHQsIE92ZXJsYXlUeXBlfSBmcm9tICdAZXIvdHlwZXMnO1xuaW1wb3J0IHtDb21tb25zVXRpbHMsIERhdGFJdGVtVXRpbHMsIFN0YXRlc1V0aWxzfSBmcm9tICdAZXIvdXRpbHMnO1xuaW1wb3J0ICogYXMgZXNiIGZyb20gJ2VsYXN0aWMtYnVpbGRlcic7XG5pbXBvcnQge01lbnUsIE92ZXJsYXlQYW5lbH0gZnJvbSAncHJpbWVuZy9wcmltZW5nJztcbmltcG9ydCB7VGFibGV9IGZyb20gJ3ByaW1lbmcvdGFibGUnO1xuaW1wb3J0IHtCZWhhdmlvclN1YmplY3R9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtmaWx0ZXIsIHNraXB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7XG4gIGRlZmF1bHRBY3Rpb25Db2x1bW4sXG4gIGRlZmF1bHRBZGRCdXR0b24sXG4gIGRlZmF1bHRBdWRpdEJ1dHRvbixcbiAgZGVmYXVsdERlbGV0ZUJ1dHRvbixcbiAgZGVmYXVsdERvd25sb2FkQnV0dG9uLFxuICBkZWZhdWx0RWRpdEJ1dHRvbixcbiAgZGVmYXVsdFBuZ0NvbHVtblByb3BzLFxuICBkZWZhdWx0UG5nVGFibGVQcm9wcyxcbiAgZGVmYXVsdFJvd0luZGV4Q29sdW1uLFxuICBkZWZhdWx0Vmlld0J1dHRvblxufSBmcm9tICcuLi8uLi9kZWZhdWx0JztcbmltcG9ydCB7UG5nVGFibGVDb2x1bW5Qcm9wcywgUG5nVGFibGVQcm9wc30gZnJvbSAnLi4vLi4vdHlwZXMnO1xuaW1wb3J0IHtQbmdUYWJsZVV0aWxzfSBmcm9tICcuLi8uLi91dGlsJztcblxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwbmctdGFibGUnLFxuICB0ZW1wbGF0ZVVybDogJ3RwbC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJ3N0eWxlcy5zY3NzJ10sXG4gIHByb3ZpZGVyczogW3tcbiAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBQbmdUYWJsZUNvbXBvbmVudCksXG4gICAgbXVsdGk6IHRydWVcbiAgfV0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIFBuZ1RhYmxlQ29tcG9uZW50IGV4dGVuZHMgRGF0YUF3YXJlQ29udHJvbFdyYXBwZXJDb21wb25lbnQ8UG5nVGFibGVQcm9wcz4gaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuXG4gIE9WRVJMQVlfVFlQRSA9IE92ZXJsYXlUeXBlO1xuXG4gIEBWaWV3Q2hpbGQoJ3BuZ1RhYmxlJykgdGFibGU6IFRhYmxlO1xuXG4gIEBWaWV3Q2hpbGQoJ292ZXJsYXlQYW5lbCcpIG92ZXJsYXlQYW5lbDogT3ZlcmxheVBhbmVsO1xuXG4gIEBWaWV3Q2hpbGQoTWVudSkgcG9wdXBNZW51OiBNZW51O1xuXG4gIGJvZHlEYXRhJDogQmVoYXZpb3JTdWJqZWN0PHt9W10+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxQbmdUYWJsZUNvbHVtblByb3BzW10+KFtdKTtcblxuICBjb2x1bW5zJDogQmVoYXZpb3JTdWJqZWN0PFBuZ1RhYmxlQ29sdW1uUHJvcHNbXT4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFBuZ1RhYmxlQ29sdW1uUHJvcHNbXT4odW5kZWZpbmVkKTtcblxuICBkYXRhQ29sdW1uTmFtZXM6IHN0cmluZ1tdO1xuXG4gIGRhdGFDb2x1bW5zOiBQbmdUYWJsZUNvbHVtblByb3BzW107XG5cbiAgdGVtcGxhdGVOYW1lcyA9IHtcbiAgICBjYXB0aW9uOiAnY2FwdGlvbicsXG4gICAgc3BhbkhlYWRlcjogJ3NwYW5IZWFkZXInLFxuICAgIGhlYWRlcjogJ2hlYWRlcicsXG4gICAgaGVhZGVyU3VtbWFyeTogJ2hlYWRlclN1bW1hcnknLFxuICAgIGJvZHk6ICdib2R5JyxcbiAgICBmcm96ZW5Sb3dzOiAnZnJvemVuUm93cycsXG4gICAgY2VsbDogJ2NlbGwnLFxuICAgIGRhdGFDZWxsOiAnZGF0YUNlbGwnLFxuICAgIGZvb3RlcjogJ2Zvb3RlcicsXG4gICAgZm9vdGVyU3VtbWFyeTogJ3N1bW1hcnknLFxuICAgIGNvbEdyb3VwOiAnY29sZ3JvdXAnLFxuICAgIHJvd0V4cGFuc2lvbjogJ3Jvd2V4cGFuc2lvbicsXG4gICAgcGFnaW5hdG9yTGVmdDogJ3BhZ2luYXRvckxlZnQnLFxuICAgIHBhZ2luYXRvclJpZ2h0OiAncGFnaW5hdG9yUmlnaHQnXG4gIH07XG5cbiAgJGRlZmF1bHRQcm9wcyA9IGRlZmF1bHRQbmdUYWJsZVByb3BzO1xuXG4gIHNpbXBsZVF1ZXJ5OiBhbnlbXTtcblxuICBjb21wbGV4UXVlcnk6IHt9O1xuXG4gIGV2ZW50UXVlcnkgPSBbXTtcblxuICBzZWxlY3RlZFJvd3MgPSBbXTtcblxuICBhZGRCdG46IGFueTtcblxuICBvdmVybGF5Q29udGV4dDogT3ZlcmxheUNvbnRleHQ7XG5cbiAgc3dpdGNoID0gdHJ1ZTtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgY2Q6IENoYW5nZURldGVjdG9yUmVmLCBwcml2YXRlIHJvdXRlcjogUm91dGVyLCBwcml2YXRlIGFjdGl2YXRlZFJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBnZXQgYXBpRW50cnkoKSB7XG4gICAgcmV0dXJuIHRoaXMuJHByb3BzLiRleHQuYXBpRGF0YVByb3BzICYmIHRoaXMuJHByb3BzLiRleHQuYXBpRGF0YVByb3BzLmFwaUVudHJ5O1xuICB9XG5cbiAgZ2V0ICRpZCgpIHtcbiAgICByZXR1cm4gdGhpcy4kcHJvcHMuJGlkO1xuICB9XG5cbiAgb25Qcm9wc0luaXQoKSB7XG4gICAgaWYgKHRoaXMuJHByb3BzLmVudGl0eSkge1xuICAgICAgaWYgKCF0aGlzLiRwcm9wcy5jYXB0aW9uIHx8IHRoaXMuJHByb3BzLmNhcHRpb25bJ21ldGhvZCddKSB7XG4gICAgICAgIGNvbnN0IGNhcHRpb24gPSBDb21tb25zVXRpbHMuZ2V0VmFsdWUodGhpcy4kcHJvcHMuY2FwdGlvbiwgdGhpcy4kcHJvcHMuZW50aXR5LmxhYmVsKTtcbiAgICAgICAgdGhpcy4kcHJvcHMuY2FwdGlvbiA9IGNhcHRpb24gfHwgYOa1j+iniCR7dGhpcy4kcHJvcHMuZW50aXR5LmxhYmVsIHx8ICcnfWA7XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMuJHByb3BzLiRleHQuYXBpRGF0YVByb3BzKSB7XG4gICAgICAgIHRoaXMuJHByb3BzLiRleHQuYXBpRGF0YVByb3BzID0ge307XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMuJHByb3BzLiRleHQuYXBpRGF0YVByb3BzLmFwaUVudHJ5KSB7XG4gICAgICAgIHRoaXMuJHByb3BzLiRleHQuYXBpRGF0YVByb3BzLmFwaUVudHJ5ID0gdGhpcy4kcHJvcHMuZW50aXR5LmFwaUVudHJ5IHx8ICcnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLiRwcm9wcy5jb2x1bW5zKSB7XG4gICAgICB0aGlzLnJlc29sZUFjdGlvbnNDb2x1bW4odGhpcy4kcHJvcHMpO1xuICAgICAgbGV0IG9yZGVyID0gMDtcbiAgICAgIHRoaXMuJHByb3BzLmNvbHVtbnMuZm9yRWFjaChjb2x1bW4gPT4ge1xuICAgICAgICBQbmdUYWJsZVV0aWxzLnJlc29sdmVDb2x1bW5CeURhdGFGaWVsZChjb2x1bW4pO1xuICAgICAgICBDb21tb25zVXRpbHMuZGVmYXVsdHMoY29sdW1uLCBkZWZhdWx0UG5nQ29sdW1uUHJvcHMpO1xuICAgICAgICBpZiAoIWNvbHVtbi5vcmRlcikge1xuICAgICAgICAgIGNvbHVtbi5vcmRlciA9ICsrb3JkZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuJHByb3BzLnNjcm9sbGFibGUgJiYgdGhpcy4kcHJvcHMuc2Nyb2xsV2lkdGggJiYgY29sdW1uLndpZHRoICYmIGNvbHVtbi53aWR0aC5lbmRzV2l0aCgnJScpKSB7XG4gICAgICAgICAgY29sdW1uLndpZHRoID0gZGVmYXVsdFBuZ0NvbHVtblByb3BzLndpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb2x1bW4ub3ZlcmxheXMpIHtcbiAgICAgICAgICBjb2x1bW4ub3ZlcmxheXMgPSBDb21tb25zVXRpbHMuZ2V0QXJyYXlWYWx1ZShjb2x1bW4ub3ZlcmxheXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb2x1bW4uaGVhZGVyT3ZlcmxheXMpIHtcbiAgICAgICAgICBjb2x1bW4uaGVhZGVyT3ZlcmxheXMgPSBDb21tb25zVXRpbHMuZ2V0QXJyYXlWYWx1ZShjb2x1bW4uaGVhZGVyT3ZlcmxheXMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHRoaXMuJHByb3BzLnZpcnR1YWxTY3JvbGwpIHtcbiAgICAgIHRoaXMuJHByb3BzLmFsd2F5c1Nob3dQYWdpbmF0b3IgPSBmYWxzZTtcbiAgICAgIHRoaXMuJHByb3BzLnBhZ2luYXRvciA9IGZhbHNlO1xuICAgIH1cbiAgICBpZiAodGhpcy4kcHJvcHMuc2Nyb2xsYWJsZSkge1xuICAgICAgQ29tbW9uc1V0aWxzLnNldCh0aGlzLiRwcm9wcywgJ3N0eWxlLndpZHRoJywgdGhpcy4kcHJvcHMuc2Nyb2xsV2lkdGgpO1xuICAgIH1cbiAgICBjb25zdCBmcm96ZW5Db2x1bW5zID0gdGhpcy4kcHJvcHMuY29sdW1ucy5maWx0ZXIoY29sdW1uID0+IGNvbHVtbi5mcm96ZW4pO1xuICAgIGlmIChmcm96ZW5Db2x1bW5zLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuJHByb3BzLmZyb3plbkNvbHVtbnMgPSBmcm96ZW5Db2x1bW5zO1xuICAgICAgaWYgKCF0aGlzLiRwcm9wcy4kZXh0LnJvd0hlaWdodCkge1xuICAgICAgICB0aGlzLiRwcm9wcy4kZXh0LnJvd0hlaWdodCA9ICczMHB4JztcbiAgICAgIH1cbiAgICAgIGxldCBmcm96ZW5XaWR0aCA9IDA7XG4gICAgICBmcm96ZW5Db2x1bW5zLmZvckVhY2goY29sdW1uID0+IHtcbiAgICAgICAgbGV0IHdpZHRoID0gMTUwO1xuICAgICAgICBpZiAoY29sdW1uLndpZHRoKSB7XG4gICAgICAgICAgd2lkdGggPSBOdW1iZXIoY29sdW1uLndpZHRoLnN1YnN0cigwLCBjb2x1bW4ud2lkdGgubGVuZ3RoIC0gMikpO1xuICAgICAgICB9XG4gICAgICAgIGZyb3plbldpZHRoICs9IHdpZHRoIHx8IDE1MDtcbiAgICAgICAgY29sdW1uLnN0eWxlQ2xhc3MgPSBjb2x1bW4uc3R5bGVDbGFzcyB8fCAnJyArICcgdGFibGUtZnJvemVuLWNvbHVtbic7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuJHByb3BzLmZyb3plbldpZHRoID0gYCR7ZnJvemVuV2lkdGh9cHhgO1xuICAgIH1cbiAgICB0aGlzLnVwZGF0ZUNvbHVtbnMoKTtcbiAgICB0aGlzLmFwaURhdGFQcm9wcyA9IHRoaXMuZ2V0QXBpRGF0YVByb3BzKCk7XG4gICAgdGhpcy4kc3Vic2NyaXB0aW9ucyA9IFN0YXRlc1V0aWxzLm9ic2VydmUodGhpcy4kaWQpXG4gICAgICAucGlwZShcbiAgICAgICAgZmlsdGVyKHN0YXRlID0+ICEhc3RhdGUpLFxuICAgICAgICBza2lwKDEpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKHN0YXRlID0+IHtcbiAgICAgICAgdGhpcy50YWJsZS5maXJzdCA9IDA7XG4gICAgICAgIHRoaXMubG9hZChzdGF0ZSk7XG4gICAgICB9KTtcbiAgICBpZiAodGhpcy4kcHJvcHMuJGV4dC5kYXRhSXRlbXMpIHtcbiAgICAgIHRoaXMuZGF0YSQubmV4dCh7XG4gICAgICAgIGl0ZW1zOiB0aGlzLiRwcm9wcy4kZXh0LmRhdGFJdGVtcyxcbiAgICAgICAgdG90YWw6IHRoaXMuJHByb3BzLiRleHQuZGF0YUl0ZW1zLmxlbmd0aFxuICAgICAgfSk7XG4gICAgfVxuICAgIFN0YXRlc1V0aWxzLmNyZWF0ZSh0aGlzLiRpZCwge1xuICAgICAgY29tcG9uZW50OiB0aGlzXG4gICAgfSwgdHJ1ZSk7XG4gIH1cblxuICB1cGRhdGVDb2x1bW5zKGV2ZW50Pykge1xuICAgIGxldCBjb2x1bW5zO1xuICAgIGlmICghZXZlbnQpIHtcbiAgICAgIGNvbHVtbnMgPSB0aGlzLiRwcm9wcy5jb2x1bW5zLmZpbHRlcihjb2x1bW4gPT4gIWNvbHVtbi5mcm96ZW4pIHx8IFtdO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb2x1bW5zID0gZXZlbnQudmFsdWU7XG4gICAgfVxuICAgIGNvbHVtbnMuc29ydCgoYSwgYikgPT4gYS5vcmRlciAtIGIub3JkZXIpO1xuICAgIHRoaXMuZGF0YUNvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcihjb2x1bW4gPT4gIWNvbHVtbi5pc0FjdGlvbkNvbHVtbiB8fCAhKGNvbHVtbi5oaWRkZW4gJiYgIWNvbHVtbi5mZXRjaCkpO1xuICAgIGlmICghZXZlbnQpIHtcbiAgICAgIGNvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcihjb2x1bW4gPT4gIWNvbHVtbi5oaWRkZW4pO1xuICAgIH1cbiAgICB0aGlzLmRhdGFDb2x1bW5OYW1lcyA9IENvbW1vbnNVdGlscy5jb21wYWN0KHRoaXMuZGF0YUNvbHVtbnMubWFwKGNvbHVtbiA9PiBjb2x1bW4ua2V5KSk7XG4gICAgaWYgKHRoaXMuJHByb3BzLmZyb3plbkNvbHVtbnMpIHtcbiAgICAgIHRoaXMuJHByb3BzLmZyb3plbkNvbHVtbnMuZm9yRWFjaChjb2x1bW4gPT4ge1xuICAgICAgICBpZiAoY29sdW1uLmtleSkge1xuICAgICAgICAgIHRoaXMuZGF0YUNvbHVtbk5hbWVzLnB1c2goY29sdW1uLmtleSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLmNvbHVtbnMkLm5leHQoY29sdW1ucyk7XG4gICAgaWYgKGV2ZW50KSB7XG4gICAgICB0aGlzLmxvYWQoKTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVDb2xBZ2dLZXlzKGV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LmNvbHVtbikge1xuICAgICAgY29uc3QgY29sdW1uID0gZXZlbnQuY29sdW1uO1xuICAgICAgY29uc3QgYWdnUHJvcHMgPSBbXTtcbiAgICAgIGlmIChldmVudC5tZXRob2RzICYmIGV2ZW50Lm1ldGhvZHMubGVuZ3RoID4gMCkge1xuICAgICAgICBldmVudC5tZXRob2RzLmZvckVhY2gobWV0aG9kID0+IHtcbiAgICAgICAgICBhZ2dQcm9wcy5wdXNoKDxBZ2dQcm9wcz57XG4gICAgICAgICAgICBuYW1lOiBgJHtjb2x1bW4ua2V5fS0ke21ldGhvZH1gLFxuICAgICAgICAgICAgZmllbGQ6IGNvbHVtbi5hZ2dLZXkgfHwgY29sdW1uLmtleSxcbiAgICAgICAgICAgIG1ldGhvZDogQWdnTWV0aG9kc1Byb3BzW21ldGhvZF1bJ2tleSddXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29sdW1uLmFnZ1Byb3BzID0gYWdnUHJvcHM7XG4gICAgICBTdGF0ZXNVdGlscy51cGRhdGUodGhpcy4kaWQsIHt9KTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVDb2xGaWx0ZXJzKGV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LmNvbHVtbikge1xuICAgICAgY29uc3QgY29sdW1uID0gZXZlbnQuY29sdW1uO1xuICAgICAgY29sdW1uLmZpbHRlcnMgPSBbXTtcbiAgICAgIGlmIChldmVudC52YWx1ZSkge1xuICAgICAgICBjb2x1bW4uZmlsdGVycy5wdXNoKGV2ZW50LnZhbHVlKTtcbiAgICAgIH1cbiAgICAgIFN0YXRlc1V0aWxzLnVwZGF0ZSh0aGlzLiRpZCwge30pO1xuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZVNpbXBsZVNlYXJjaChldmVudCkge1xuICAgIGlmIChDb21tb25zVXRpbHMuaXNFbXB0eShldmVudCkpIHtcbiAgICAgIHRoaXMuc2ltcGxlUXVlcnkgPSB1bmRlZmluZWQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChldmVudC5pbmRleE9mKCdcIicpID09PSAtMSkge1xuICAgICAgICBldmVudCA9IGBcIiR7ZXZlbnR9XCJgO1xuICAgICAgfVxuICAgICAgdGhpcy5zaW1wbGVRdWVyeSA9IFtlc2Iuc2ltcGxlUXVlcnlTdHJpbmdRdWVyeShldmVudCldO1xuICAgIH1cbiAgICB0aGlzLmxvYWQoKTtcbiAgfVxuXG4gIGdldENvbHVtbkJ5S2V5KGtleSk6IFBuZ1RhYmxlQ29sdW1uUHJvcHMge1xuICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLiRwcm9wcy5jb2x1bW5zLmZpbHRlcihjb2x1bW4gPT4gY29sdW1uLmtleSA9PT0ga2V5KTtcbiAgICBpZiAoY29sdW1ucy5sZW5ndGggPj0gMSkge1xuICAgICAgcmV0dXJuIGNvbHVtbnNbMF07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG5cbiAgZ2V0Um93U3R5bGVDbGFzcyhyb3cpIHtcbiAgICByZXR1cm4gQ29tbW9uc1V0aWxzLmdldFZhbHVlKHRoaXMuJHByb3BzLiRleHQucm93U3R5bGVDbGFzcywgcm93KTtcbiAgfVxuXG4gIGdldFJvd1N0eWxlKHJvdykge1xuICAgIGNvbnN0IHN0eWxlID0gQ29tbW9uc1V0aWxzLmdldFZhbHVlKHRoaXMuJHByb3BzLiRleHQucm93U3R5bGUsIHJvdykgfHwge307XG4gICAgaWYgKHRoaXMuJHByb3BzLiRleHQucm93SGVpZ2h0KSB7XG4gICAgICBzdHlsZVsnaGVpZ2h0J10gPSB0aGlzLiRwcm9wcy4kZXh0LnJvd0hlaWdodDtcbiAgICB9XG4gICAgcmV0dXJuIHN0eWxlO1xuICB9XG5cbiAgZ2V0SGVhZGVyU3R5bGVDbGFzcyhjb2x1bW4pIHtcbiAgICByZXR1cm4gQ29tbW9uc1V0aWxzLmdldFZhbHVlKGNvbHVtbi5oZWFkZXJTdHlsZUNsYXNzLCBjb2x1bW4pO1xuICB9XG5cbiAgZ2V0SGVhZGVyU3R5bGUoY29sdW1uKSB7XG4gICAgcmV0dXJuIENvbW1vbnNVdGlscy5nZXRWYWx1ZShjb2x1bW4uaGVhZGVyU3R5bGUsIGNvbHVtbik7XG4gIH1cblxuICByb3dTZWxlY3QoZXZlbnQpIHtcbiAgICB0aGlzLnVwZGF0ZVRvdWNoKCk7XG4gICAgdGhpcy52YWx1ZSA9IERhdGFJdGVtVXRpbHMuZ2V0SXRlbVZhbHVlKGV2ZW50LCB0aGlzLiRwcm9wcy4kZXh0LmRhdGFJdGVtUHJvcHMgJiYgdGhpcy4kcHJvcHMuJGV4dC5kYXRhSXRlbVByb3BzLnZhbHVlS2V5KTtcbiAgfVxuXG4gIGxvYWQoc3RhdGU/KSB7XG4gICAgdGhpcy5hcGlEYXRhUHJvcHMgPSB0aGlzLmdldEFwaURhdGFQcm9wcyhzdGF0ZSk7XG4gICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuXG4gIG9uRGF0YVJlYWR5KGRhdGEpIHtcbiAgICBjb25zdCBkYXRhUGF0aCA9IENvbW1vbnNVdGlscy5nZXQodGhpcy4kcHJvcHMsICckZXh0LmFwaURhdGFQcm9wcy5kYXRhUGF0aCcpO1xuICAgIGlmIChkYXRhUGF0aCAmJiBkYXRhUGF0aCAhPT0gJy8nKSB7XG4gICAgICB0aGlzLmJvZHlEYXRhJC5uZXh0KGRhdGEpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmJvZHlEYXRhJC5uZXh0KGRhdGEuaXRlbXMgfHwgW10pO1xuICAgIH1cbiAgfVxuXG4gIHNob3dPdmVybGF5KGN0eDogT3ZlcmxheUNvbnRleHQpIHtcbiAgICBpZiAoY3R4ICYmIGN0eC5jb250ZW50KSB7XG4gICAgICB0aGlzLm92ZXJsYXlDb250ZXh0ID0ge1xuICAgICAgICBkaXNtaXNzYWJsZTogdHJ1ZSxcbiAgICAgICAgc2hvd0Nsb3NlSWNvbjogdHJ1ZSxcbiAgICAgICAgLi4uY3R4XG4gICAgICB9O1xuICAgICAgdGhpcy5vdmVybGF5UGFuZWwuaGlkZSgpO1xuICAgICAgdGhpcy5vdmVybGF5UGFuZWwudG9nZ2xlKGN0eC4kZXZlbnQpO1xuICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICB9XG5cbiAgaGlkZVBhbmVsKCkge1xuICAgIHRoaXMub3ZlcmxheVBhbmVsLmhpZGUoKTtcbiAgfVxuXG4gIHJlc2V0UXVlcnkoKSB7XG4gICAgdGhpcy5zaW1wbGVRdWVyeSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmNvbXBsZXhRdWVyeSA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHJlc2V0Rm9yZWlnblF1ZXJ5KCkge1xuICAgIHRoaXMuZXZlbnRRdWVyeSA9IFtdO1xuICB9XG5cbiAgbmF2aWdhdGUodXJsOiBzdHJpbmcsIGNvbW1hbmRzPzogYW55W10sIHBhcmFtcz8pIHtcbiAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbe291dGxldHM6IHtbdGhpcy4kcHJvcHMuJGV4dC5yb3V0ZXJPdXRsZXRdOiBbdXJsLCAuLi5jb21tYW5kc119fV0sIHtcbiAgICAgIHJlbGF0aXZlVG86IHRoaXMuYWN0aXZhdGVkUm91dGUsXG4gICAgICBza2lwTG9jYXRpb25DaGFuZ2U6IGZhbHNlLFxuICAgICAgcXVlcnlQYXJhbXM6IHBhcmFtc1xuICAgIH0pO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuJHByb3BzICYmIHRoaXMuJHByb3BzLiRpZCkge1xuICAgICAgU3RhdGVzVXRpbHMuZGVsZXRlU3RhdGUodGhpcy4kcHJvcHMuJGlkKTtcbiAgICB9XG4gICAgc3VwZXIubmdPbkRlc3Ryb3koKTtcbiAgfVxuXG4gIGdldFRhYmxlUXVlcnkoc3RhdGU/KSB7XG5cbiAgICBpZiAoc3RhdGUgJiYgKHN0YXRlLnF1ZXJ5IHx8IHN0YXRlLmZpbHRlcikpIHtcbiAgICAgIHRoaXMuZXZlbnRRdWVyeSA9IFtcbiAgICAgICAgLi4uQ29tbW9uc1V0aWxzLmdldEFycmF5VmFsdWUoc3RhdGVbJ3F1ZXJ5J10gfHwge30pLFxuICAgICAgICAuLi5Db21tb25zVXRpbHMuZ2V0QXJyYXlWYWx1ZShzdGF0ZVsnZmlsdGVyJ10gfHwge30pXG4gICAgICBdO1xuICAgIH1cblxuICAgIGNvbnN0IGZpbHRlcnMgPSBbXG4gICAgICAuLi50aGlzLmdldENvbHVtbnNGaWx0ZXJzKCksXG4gICAgICAuLi50aGlzLmV2ZW50UXVlcnksXG4gICAgICAuLi50aGlzLnNpbXBsZVF1ZXJ5IHx8IFtdLFxuICAgICAgLi4uQ29tbW9uc1V0aWxzLmdldEFycmF5VmFsdWUodGhpcy5jb21wbGV4UXVlcnkpIHx8IFtdXG4gICAgXTtcblxuICAgIGNvbnN0IGdBcGlEYXRhUHJvcHMgPSBDb21tb25zVXRpbHMuY29weShDb21tb25zVXRpbHMuZ2V0KHRoaXMuJHByb3BzLCAnJGV4dC5hcGlEYXRhUHJvcHMnKSk7XG5cbiAgICBsZXQgYXBpRmlsdGVyID0gZ0FwaURhdGFQcm9wcy5maWx0ZXIgfHwge307XG4gICAgaWYgKGFwaUZpbHRlclsnJGFuZCddKSB7XG4gICAgICBhcGlGaWx0ZXJbJyRhbmQnXSA9IFtcbiAgICAgICAgLi4uYXBpRmlsdGVyWyckYW5kJ10sXG4gICAgICAgIC4uLmZpbHRlcnNcbiAgICAgIF07XG4gICAgfSBlbHNlIGlmIChhcGlGaWx0ZXJbJyRvciddKSB7XG4gICAgICBhcGlGaWx0ZXJbJyRhbmQnXSA9IGZpbHRlcnM7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFwaUZpbHRlciA9IENvbW1vbnNVdGlscy5nZXRBcnJheVZhbHVlKGFwaUZpbHRlcilcbiAgICAgICAgLmNvbmNhdChmaWx0ZXJzKTtcbiAgICB9XG4gICAgYXBpRmlsdGVyID0gYXBpRmlsdGVyLmZpbHRlcihmID0+ICFDb21tb25zVXRpbHMuaXNFbXB0eShmKSk7XG5cbiAgICBsZXQgYWdnUHJvcHMgPSBnQXBpRGF0YVByb3BzLmFnZ1Byb3BzIHx8IHt9O1xuICAgIGFnZ1Byb3BzID0gQ29tbW9uc1V0aWxzLmdldEFycmF5VmFsdWUoYWdnUHJvcHMpLmNvbmNhdCh0aGlzLmdldENvbHVtbnNBZ2dzKCkpO1xuICAgIGFnZ1Byb3BzID0gYWdnUHJvcHMuZmlsdGVyKGEgPT4gT2JqZWN0LmtleXMoYSkubGVuZ3RoID4gMCk7XG5cbiAgICBsZXQgc29ydCA9IGdBcGlEYXRhUHJvcHMuc29ydCB8fCBbXTtcbiAgICBjb25zdCB0YWJsZU1ldGFEYXRhID0gdGhpcy50YWJsZS5jcmVhdGVMYXp5TG9hZE1ldGFkYXRhKCk7XG4gICAgc29ydCA9IENvbW1vbnNVdGlscy5nZXRBcnJheVZhbHVlKHNvcnQpO1xuICAgIGNvbnN0IHRhYmxlU29ydCA9IHRhYmxlTWV0YURhdGEuc29ydEZpZWxkO1xuICAgIGlmICh0YWJsZVNvcnQpIHtcbiAgICAgIGNvbnN0IGNvbHVtbiA9IHRoaXMuZ2V0Q29sdW1uQnlLZXkodGFibGVTb3J0KTtcbiAgICAgIGNvbnN0IHNvcnRLZXkgPSAoY29sdW1uICYmIGNvbHVtbi5zb3J0S2V5KSB8fCB0YWJsZVNvcnQ7XG4gICAgICBzb3J0LnB1c2goe1tzb3J0S2V5XTogdGFibGVNZXRhRGF0YS5zb3J0T3JkZXIgPT09IDEgPyBPcmRlci5BU0MgOiBPcmRlci5ERVNDfSk7XG4gICAgfVxuICAgIGRlbGV0ZSBnQXBpRGF0YVByb3BzLmZpbHRlcjtcbiAgICBkZWxldGUgZ0FwaURhdGFQcm9wcy5hZ2dQcm9wcztcbiAgICByZXR1cm4ge1xuICAgICAgLi4uZ0FwaURhdGFQcm9wcyxcbiAgICAgIGZpbHRlcjogYXBpRmlsdGVyLFxuICAgICAgYWdnUHJvcHMsXG4gICAgICBzb3J0XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29sdW1uc0ZpbHRlcnMoKSB7XG4gICAgY29uc3QgZmlsdGVycyA9IFtdO1xuICAgIGNvbnN0IGNvbHVtbnMgPSAodGhpcy5jb2x1bW5zJC52YWx1ZSB8fCBbXSkuY29uY2F0KHRoaXMuJHByb3BzLmZyb3plbkNvbHVtbnMgfHwgW10pO1xuICAgIGNvbHVtbnNcbiAgICAgIC5maWx0ZXIoY29sdW1uID0+IGNvbHVtbi5maWx0ZXJzKVxuICAgICAgLmZvckVhY2goY29sdW1uID0+XG4gICAgICAgIGNvbHVtbi5maWx0ZXJzLmZpbHRlcihmID0+IGYpXG4gICAgICAgICAgLmZvckVhY2goZiA9PiB7XG4gICAgICAgICAgICBsZXQgcXVlcnk7XG4gICAgICAgICAgICBzd2l0Y2ggKGNvbHVtbi5maWx0ZXJEYXRhVHlwZSB8fCBjb2x1bW4uZGF0YVR5cGUgfHwgKGNvbHVtbi5kYXRhRmllbGQgJiYgY29sdW1uLmRhdGFGaWVsZC5kYXRhVHlwZSkgfHwgRGF0YVR5cGUuU1RSSU5HKSB7XG4gICAgICAgICAgICAgIGNhc2UgRGF0YVR5cGUuTlVNQkVSOlxuICAgICAgICAgICAgICBjYXNlIERhdGFUeXBlLkRBVEU6XG4gICAgICAgICAgICAgICAgaWYgKENvbW1vbnNVdGlscy5pc0FycmF5KGYpKSB7XG4gICAgICAgICAgICAgICAgICBxdWVyeSA9IGVzYi5yYW5nZVF1ZXJ5KGNvbHVtbi5maWx0ZXJLZXkgfHwgY29sdW1uLmtleSkuZ3RlKGZbMF0pLmx0ZShmWzFdKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgcXVlcnkgPSBlc2IucmFuZ2VRdWVyeShjb2x1bW4uZmlsdGVyS2V5IHx8IGNvbHVtbi5rZXkpLmd0ZShmKS5sdGUoZik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHF1ZXJ5ID0gZXNiLm1hdGNoUXVlcnkoY29sdW1uLmZpbHRlcktleSB8fCBjb2x1bW4ua2V5LCBmKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbHRlcnMucHVzaChxdWVyeSk7XG4gICAgICAgICAgfSkpO1xuICAgIHJldHVybiBmaWx0ZXJzO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb2x1bW5zQWdncygpIHtcbiAgICBsZXQgYWdnczogQWdnUHJvcHNbXSA9IFtdO1xuICAgIGNvbnN0IGNvbHVtbnMgPSAodGhpcy5jb2x1bW5zJC52YWx1ZSB8fCBbXSkuY29uY2F0KHRoaXMuJHByb3BzLmZyb3plbkNvbHVtbnMgfHwgW10pO1xuICAgIGNvbHVtbnNcbiAgICAgIC5maWx0ZXIoY29sdW1uID0+IGNvbHVtbi5hZ2dQcm9wcylcbiAgICAgIC5mb3JFYWNoKGNvbHVtbiA9PiB7XG4gICAgICAgIGFnZ3MgPSBhZ2dzLmNvbmNhdChjb2x1bW4uYWdnUHJvcHMpO1xuICAgICAgfSk7XG4gICAgcmV0dXJuIGFnZ3M7XG4gIH1cblxuICBwcml2YXRlIHJlc29sZUFjdGlvbnNDb2x1bW4ocHJvcHM6IFBuZ1RhYmxlUHJvcHMpIHtcbiAgICBsZXQgYWN0aW9uQ29sdW1uOiBQbmdUYWJsZUNvbHVtblByb3BzO1xuICAgIGxldCBhY3Rpb25Db2x1bW5JbmRleCA9IC0xO1xuICAgIHByb3BzLmNvbHVtbnMuc29tZSgoY29sdW1uLCBpKSA9PiB7XG4gICAgICBpZiAoY29sdW1uLmlzQWN0aW9uQ29sdW1uKSB7XG4gICAgICAgIGFjdGlvbkNvbHVtbiA9IGNvbHVtbjtcbiAgICAgICAgYWN0aW9uQ29sdW1uSW5kZXggPSBpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcbiAgICBpZiAoYWN0aW9uQ29sdW1uSW5kZXggPj0gMCkge1xuICAgICAgcHJvcHMuY29sdW1ucyA9IENvbW1vbnNVdGlscy5yZW1vdmVCeUluZGV4KHByb3BzLmNvbHVtbnMsIGFjdGlvbkNvbHVtbkluZGV4KTtcbiAgICB9XG4gICAgaWYgKHByb3BzLiRleHQuaGFzQWRkQWN0aW9uKSB7XG4gICAgICB0aGlzLmFkZEJ0biA9IHtcbiAgICAgICAgLi4uZGVmYXVsdEFkZEJ1dHRvbixcbiAgICAgICAgY29udGV4dDogdGhpc1xuICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgYnV0dG9ucyA9IFtdO1xuICAgIGlmIChwcm9wcy4kZXh0Lmhhc1ZpZXdBY3Rpb24pIHtcbiAgICAgIGJ1dHRvbnMucHVzaCh7XG4gICAgICAgIC4uLmRlZmF1bHRWaWV3QnV0dG9uLFxuICAgICAgICBzaG93OiBwcm9wcy4kZXh0Lmhhc1ZpZXdBY3Rpb25cbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAocHJvcHMuJGV4dC5oYXNEZWxldGVBY3Rpb24pIHtcbiAgICAgIGJ1dHRvbnMucHVzaCh7XG4gICAgICAgIC4uLmRlZmF1bHREZWxldGVCdXR0b24sXG4gICAgICAgIHNob3c6IHByb3BzLiRleHQuaGFzRGVsZXRlQWN0aW9uXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHByb3BzLiRleHQuaGFzQXVkaXRBY3Rpb24pIHtcbiAgICAgIGJ1dHRvbnMucHVzaCh7XG4gICAgICAgIC4uLmRlZmF1bHRBdWRpdEJ1dHRvbixcbiAgICAgICAgc2hvdzogcHJvcHMuJGV4dC5oYXNBdWRpdEFjdGlvblxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChwcm9wcy4kZXh0Lmhhc0Rvd25sb2FkQWN0aW9uKSB7XG4gICAgICBidXR0b25zLnB1c2goe1xuICAgICAgICAuLi5kZWZhdWx0RG93bmxvYWRCdXR0b24sXG4gICAgICAgIHNob3c6IHByb3BzLiRleHQuaGFzRG93bmxvYWRBY3Rpb25cbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAocHJvcHMuJGV4dC5oYXNFZGl0QWN0aW9uKSB7XG4gICAgICBidXR0b25zLnB1c2goe1xuICAgICAgICAuLi5kZWZhdWx0RWRpdEJ1dHRvbixcbiAgICAgICAgc2hvdzogcHJvcHMuJGV4dC5oYXNFZGl0QWN0aW9uXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGJ1dHRvbnMubGVuZ3RoID4gMCAmJiAhYWN0aW9uQ29sdW1uKSB7XG4gICAgICBhY3Rpb25Db2x1bW4gPSB7XG4gICAgICAgIC4uLmRlZmF1bHRBY3Rpb25Db2x1bW4sXG4gICAgICAgIC4uLmFjdGlvbkNvbHVtbiB8fCB7fVxuICAgICAgfTtcbiAgICB9XG4gICAgaWYgKGJ1dHRvbnMubGVuZ3RoID4gMCkge1xuICAgICAgYWN0aW9uQ29sdW1uLmNlbGxDb250ZW50ID0gW1xuICAgICAgICAuLi5Db21tb25zVXRpbHMuZ2V0QXJyYXlWYWx1ZShhY3Rpb25Db2x1bW4uY2VsbENvbnRlbnQpIHx8IFtdLFxuICAgICAgICAuLi5idXR0b25zXG4gICAgICBdO1xuICAgIH1cblxuICAgIGlmIChhY3Rpb25Db2x1bW4pIHtcbiAgICAgIGlmICh0aGlzLiRwcm9wcy4kZXh0LmZyb3plbkFjdGlvbkNvbHVtbikge1xuICAgICAgICBhY3Rpb25Db2x1bW4uZnJvemVuID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLiRwcm9wcy4kZXh0LnJvd0FjdGlvbnNQbGFjZUFoZWFkKSB7XG4gICAgICAgICg8YW55W10+dGhpcy4kcHJvcHMuY29sdW1ucykuc3BsaWNlKDAsIDAsIGFjdGlvbkNvbHVtbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLiRwcm9wcy5jb2x1bW5zLnB1c2goYWN0aW9uQ29sdW1uKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMuJHByb3BzLiRleHQuaGFzUm93SW5kZXgpIHtcbiAgICAgIHRoaXMuJHByb3BzLmNvbHVtbnMuc3BsaWNlKDAsIDAsIGRlZmF1bHRSb3dJbmRleENvbHVtbik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRBcGlEYXRhUHJvcHMoc3RhdGU/KTogQXBpRGF0YVByb3BzIHtcbiAgICBjb25zdCB0YWJsZU1ldGFEYXRhID0gdGhpcy50YWJsZS5jcmVhdGVMYXp5TG9hZE1ldGFkYXRhKCk7XG4gICAgY29uc3QgdGFibGVRdWVyeSA9IHRoaXMuZ2V0VGFibGVRdWVyeShzdGF0ZSk7XG4gICAgY29uc3QgYXBpRGF0YVByb3BzID0gPEFwaURhdGFQcm9wcz57XG4gICAgICAuLi50YWJsZVF1ZXJ5LFxuICAgICAgZGF0YVBhdGg6ICcvJyxcbiAgICAgIHJldHVybkZpZWxkczogdGhpcy5kYXRhQ29sdW1uTmFtZXMsXG4gICAgICBmcm9tOiB0YWJsZU1ldGFEYXRhLmZpcnN0LFxuICAgICAgc2l6ZTogdGFibGVNZXRhRGF0YS5yb3dzXG4gICAgfTtcbiAgICBhcGlEYXRhUHJvcHMucmVxdWVzdE9wdGlvbnMgPSBhcGlEYXRhUHJvcHMucmVxdWVzdE9wdGlvbnMgfHwge307XG4gICAgaWYgKCFhcGlEYXRhUHJvcHMucmVxdWVzdE9wdGlvbnMudGFnKSB7XG4gICAgICBhcGlEYXRhUHJvcHMucmVxdWVzdE9wdGlvbnMudGFnID0gdGhpcy4kaWQ7XG4gICAgfVxuICAgIHJldHVybiBhcGlEYXRhUHJvcHM7XG4gIH1cblxuXG59XG5cbi8vIGRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdpbnB1dCcpKVxuIl19