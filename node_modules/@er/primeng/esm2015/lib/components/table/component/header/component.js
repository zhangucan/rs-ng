/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { BaseComponent } from '@er/core';
import { AggMethodsProps, DataType } from '@er/types';
import { OverlayPanel } from 'primeng/primeng';
import { PngTableComponent } from '../table/component';
export class PngTableHeaderComponent extends BaseComponent {
    /**
     * @param {?} pngTable
     */
    constructor(pngTable) {
        super();
        this.pngTable = pngTable;
        this.onFiltersSet = new EventEmitter();
        this.onAggKeysSet = new EventEmitter();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    showFilterPanel(event) {
        this.filterColumn = event.column;
        /** @type {?} */
        const filters = this.filterColumn.filters;
        if (filters && filters.length > 0) {
            this.queryValue = filters[0];
        }
        else {
            this.queryValue = undefined;
        }
        this.filterPanel.toggle(event.event);
    }
    /**
     * @return {?}
     */
    clearFilterColumn() {
        this.filterColumn = undefined;
    }
    /**
     * @return {?}
     */
    clearAggColumn() {
        this.aggColumn = undefined;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    showAggsPanel(event) {
        this.availableAggs = [];
        this.aggColumn = event.column;
        /** @type {?} */
        const type = this.aggColumn.dataType || DataType.STRING;
        this.aggMethods = (this.aggColumn.aggProps || []).map(aggProp => aggProp.method);
        Object.keys(AggMethodsProps).forEach(method => {
            if (!AggMethodsProps[method].dataTypes || (AggMethodsProps[method].dataTypes && AggMethodsProps[method].dataTypes.indexOf(type) >= 0)) {
                this.availableAggs.push({
                    label: AggMethodsProps[method].label,
                    key: AggMethodsProps[method].key
                });
            }
        });
        this.aggPanel.toggle(event.$event);
    }
    /**
     * @return {?}
     */
    setAggs() {
        this.onAggKeysSet.emit({ column: this.aggColumn, methods: this.aggMethods });
    }
    /**
     * @param {?} event
     * @return {?}
     */
    updateFilters(event) {
        this.filterPanel.hide();
        this.onFiltersSet.emit(event);
    }
}
PngTableHeaderComponent.decorators = [
    { type: Component, args: [{
                selector: '[png-table-header]',
                template: `
    <ng-container *ngIf="customerTpl;else default">
      <ng-container *ngTemplateOutlet="customerTpl;context:{$implicit:columns,context:pngTable}"></ng-container>
    </ng-container>
    <ng-template #default>
      <th *ngIf="pngTable.$props.$ext.rowExpandable" class="col-expandable"></th>
      <th *ngIf="pngTable.$props.$ext.hasRowCheckbox" class="col-checkbox" title="全选">
        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
      </th>
      <th *ngIf="pngTable.$props.$ext.hasRowRadioButton" class="col-radio"></th>
      <th *ngFor="let column of columns" pReorderableColumn pResizableColumn
          png-table-header-col
          [column]="column"
          (onFilterBtnClick)="showFilterPanel($event)"
          (onAggsBtnClick)="showAggsPanel($event)"
      >
      </th>
    </ng-template>
    <div class="d-none">
      <p-overlayPanel #filterPanel appendTo="body"
                      [dismissable]="false" (onHide)="clearFilterColumn()"
                      [showCloseIcon]="true">
        <ng-container *ngIf="filterColumn">
          <png-field-data-filter [column]="filterColumn" [queryValue]="queryValue"
                                 (onFilterChange)="updateFilters($event)"></png-field-data-filter>
        </ng-container>
      </p-overlayPanel>
      <p-overlayPanel #aggPanel appendTo="body"
                      [dismissable]="true" (onHide)="clearAggColumn()"
                      [showCloseIcon]="true">
        <div class="shadow" style="width:150px;margin-bottom:10px">
          <h6>可选统计方式</h6>
          <ng-container *ngFor="let agg of availableAggs">
            <div style="font-size: .8em">
              <p-checkbox name="aggs" [value]="agg['key']" [label]="agg['label']"
                          [(ngModel)]="aggMethods" (onChange)="setAggs()"></p-checkbox>
            </div>
          </ng-container>
        </div>
      </p-overlayPanel>
    </div>
  `,
                changeDetection: ChangeDetectionStrategy.OnPush
            }] }
];
/** @nocollapse */
PngTableHeaderComponent.ctorParameters = () => [
    { type: PngTableComponent }
];
PngTableHeaderComponent.propDecorators = {
    columns: [{ type: Input }],
    onFiltersSet: [{ type: Output }],
    onAggKeysSet: [{ type: Output }],
    filterPanel: [{ type: ViewChild, args: ['filterPanel',] }],
    aggPanel: [{ type: ViewChild, args: ['aggPanel',] }]
};
if (false) {
    /** @type {?} */
    PngTableHeaderComponent.prototype.columns;
    /** @type {?} */
    PngTableHeaderComponent.prototype.onFiltersSet;
    /** @type {?} */
    PngTableHeaderComponent.prototype.onAggKeysSet;
    /** @type {?} */
    PngTableHeaderComponent.prototype.filterPanel;
    /** @type {?} */
    PngTableHeaderComponent.prototype.aggPanel;
    /** @type {?} */
    PngTableHeaderComponent.prototype.availableAggs;
    /** @type {?} */
    PngTableHeaderComponent.prototype.filterColumn;
    /** @type {?} */
    PngTableHeaderComponent.prototype.queryValue;
    /** @type {?} */
    PngTableHeaderComponent.prototype.aggColumn;
    /** @type {?} */
    PngTableHeaderComponent.prototype.aggMethods;
    /** @type {?} */
    PngTableHeaderComponent.prototype.pngTable;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL3ByaW1lbmcvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90YWJsZS9jb21wb25lbnQvaGVhZGVyL2NvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLHVCQUF1QixFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDekcsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLFVBQVUsQ0FBQztBQUN2QyxPQUFPLEVBQUMsZUFBZSxFQUFFLFFBQVEsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUNwRCxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFFN0MsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFpRHJELE1BQU0sT0FBTyx1QkFBd0IsU0FBUSxhQUFhOzs7O0lBc0J4RCxZQUFtQixRQUEyQjtRQUM1QyxLQUFLLEVBQUUsQ0FBQztRQURTLGFBQVEsR0FBUixRQUFRLENBQW1CO1FBbEJwQyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFbEMsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBa0I1QyxDQUFDOzs7OztJQUVELGVBQWUsQ0FBQyxLQUFLO1FBQ25CLElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQzs7Y0FDM0IsT0FBTyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTztRQUN6QyxJQUFJLE9BQU8sSUFBSSxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNqQyxJQUFJLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUM5QjthQUFNO1lBQ0wsSUFBSSxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUM7U0FDN0I7UUFDRCxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdkMsQ0FBQzs7OztJQUVELGlCQUFpQjtRQUNmLElBQUksQ0FBQyxZQUFZLEdBQUcsU0FBUyxDQUFDO0lBQ2hDLENBQUM7Ozs7SUFFRCxjQUFjO1FBQ1osSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7SUFDN0IsQ0FBQzs7Ozs7SUFFRCxhQUFhLENBQUMsS0FBSztRQUNqQixJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7O2NBQ3hCLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsTUFBTTtRQUN2RCxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pGLE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQzVDLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQVMsSUFBSSxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRTtnQkFDckksSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUM7b0JBQ3RCLEtBQUssRUFBRSxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSztvQkFDcEMsR0FBRyxFQUFFLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHO2lCQUNqQyxDQUFDLENBQUM7YUFDSjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3JDLENBQUM7Ozs7SUFFRCxPQUFPO1FBQ0wsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFNBQVMsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBQyxDQUFDLENBQUM7SUFDN0UsQ0FBQzs7Ozs7SUFFRCxhQUFhLENBQUMsS0FBSztRQUNqQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2hDLENBQUM7OztZQW5IRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLG9CQUFvQjtnQkFDOUIsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXlDVDtnQkFDRCxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTthQUNoRDs7OztZQS9DTyxpQkFBaUI7OztzQkFtRHRCLEtBQUs7MkJBRUwsTUFBTTsyQkFFTixNQUFNOzBCQUVOLFNBQVMsU0FBQyxhQUFhO3VCQUV2QixTQUFTLFNBQUMsVUFBVTs7OztJQVJyQiwwQ0FBd0M7O0lBRXhDLCtDQUE0Qzs7SUFFNUMsK0NBQTRDOztJQUU1Qyw4Q0FBb0Q7O0lBRXBELDJDQUE4Qzs7SUFFOUMsZ0RBQW9COztJQUVwQiwrQ0FBa0M7O0lBRWxDLDZDQUFnQjs7SUFFaEIsNENBQStCOztJQUUvQiw2Q0FBcUI7O0lBRVQsMkNBQWtDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIFZpZXdDaGlsZH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0Jhc2VDb21wb25lbnR9IGZyb20gJ0Blci9jb3JlJztcbmltcG9ydCB7QWdnTWV0aG9kc1Byb3BzLCBEYXRhVHlwZX0gZnJvbSAnQGVyL3R5cGVzJztcbmltcG9ydCB7T3ZlcmxheVBhbmVsfSBmcm9tICdwcmltZW5nL3ByaW1lbmcnO1xuaW1wb3J0IHtQbmdUYWJsZUNvbHVtblByb3BzfSBmcm9tICcuLi8uLi90eXBlcyc7XG5pbXBvcnQge1BuZ1RhYmxlQ29tcG9uZW50fSBmcm9tICcuLi90YWJsZS9jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdbcG5nLXRhYmxlLWhlYWRlcl0nLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJjdXN0b21lclRwbDtlbHNlIGRlZmF1bHRcIj5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJjdXN0b21lclRwbDtjb250ZXh0OnskaW1wbGljaXQ6Y29sdW1ucyxjb250ZXh0OnBuZ1RhYmxlfVwiPjwvbmctY29udGFpbmVyPlxuICAgIDwvbmctY29udGFpbmVyPlxuICAgIDxuZy10ZW1wbGF0ZSAjZGVmYXVsdD5cbiAgICAgIDx0aCAqbmdJZj1cInBuZ1RhYmxlLiRwcm9wcy4kZXh0LnJvd0V4cGFuZGFibGVcIiBjbGFzcz1cImNvbC1leHBhbmRhYmxlXCI+PC90aD5cbiAgICAgIDx0aCAqbmdJZj1cInBuZ1RhYmxlLiRwcm9wcy4kZXh0Lmhhc1Jvd0NoZWNrYm94XCIgY2xhc3M9XCJjb2wtY2hlY2tib3hcIiB0aXRsZT1cIuWFqOmAiVwiPlxuICAgICAgICA8cC10YWJsZUhlYWRlckNoZWNrYm94PjwvcC10YWJsZUhlYWRlckNoZWNrYm94PlxuICAgICAgPC90aD5cbiAgICAgIDx0aCAqbmdJZj1cInBuZ1RhYmxlLiRwcm9wcy4kZXh0Lmhhc1Jvd1JhZGlvQnV0dG9uXCIgY2xhc3M9XCJjb2wtcmFkaW9cIj48L3RoPlxuICAgICAgPHRoICpuZ0Zvcj1cImxldCBjb2x1bW4gb2YgY29sdW1uc1wiIHBSZW9yZGVyYWJsZUNvbHVtbiBwUmVzaXphYmxlQ29sdW1uXG4gICAgICAgICAgcG5nLXRhYmxlLWhlYWRlci1jb2xcbiAgICAgICAgICBbY29sdW1uXT1cImNvbHVtblwiXG4gICAgICAgICAgKG9uRmlsdGVyQnRuQ2xpY2spPVwic2hvd0ZpbHRlclBhbmVsKCRldmVudClcIlxuICAgICAgICAgIChvbkFnZ3NCdG5DbGljayk9XCJzaG93QWdnc1BhbmVsKCRldmVudClcIlxuICAgICAgPlxuICAgICAgPC90aD5cbiAgICA8L25nLXRlbXBsYXRlPlxuICAgIDxkaXYgY2xhc3M9XCJkLW5vbmVcIj5cbiAgICAgIDxwLW92ZXJsYXlQYW5lbCAjZmlsdGVyUGFuZWwgYXBwZW5kVG89XCJib2R5XCJcbiAgICAgICAgICAgICAgICAgICAgICBbZGlzbWlzc2FibGVdPVwiZmFsc2VcIiAob25IaWRlKT1cImNsZWFyRmlsdGVyQ29sdW1uKClcIlxuICAgICAgICAgICAgICAgICAgICAgIFtzaG93Q2xvc2VJY29uXT1cInRydWVcIj5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImZpbHRlckNvbHVtblwiPlxuICAgICAgICAgIDxwbmctZmllbGQtZGF0YS1maWx0ZXIgW2NvbHVtbl09XCJmaWx0ZXJDb2x1bW5cIiBbcXVlcnlWYWx1ZV09XCJxdWVyeVZhbHVlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvbkZpbHRlckNoYW5nZSk9XCJ1cGRhdGVGaWx0ZXJzKCRldmVudClcIj48L3BuZy1maWVsZC1kYXRhLWZpbHRlcj5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8L3Atb3ZlcmxheVBhbmVsPlxuICAgICAgPHAtb3ZlcmxheVBhbmVsICNhZ2dQYW5lbCBhcHBlbmRUbz1cImJvZHlcIlxuICAgICAgICAgICAgICAgICAgICAgIFtkaXNtaXNzYWJsZV09XCJ0cnVlXCIgKG9uSGlkZSk9XCJjbGVhckFnZ0NvbHVtbigpXCJcbiAgICAgICAgICAgICAgICAgICAgICBbc2hvd0Nsb3NlSWNvbl09XCJ0cnVlXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzaGFkb3dcIiBzdHlsZT1cIndpZHRoOjE1MHB4O21hcmdpbi1ib3R0b206MTBweFwiPlxuICAgICAgICAgIDxoNj7lj6/pgInnu5/orqHmlrnlvI88L2g2PlxuICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IGFnZyBvZiBhdmFpbGFibGVBZ2dzXCI+XG4gICAgICAgICAgICA8ZGl2IHN0eWxlPVwiZm9udC1zaXplOiAuOGVtXCI+XG4gICAgICAgICAgICAgIDxwLWNoZWNrYm94IG5hbWU9XCJhZ2dzXCIgW3ZhbHVlXT1cImFnZ1sna2V5J11cIiBbbGFiZWxdPVwiYWdnWydsYWJlbCddXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgWyhuZ01vZGVsKV09XCJhZ2dNZXRob2RzXCIgKG9uQ2hhbmdlKT1cInNldEFnZ3MoKVwiPjwvcC1jaGVja2JveD5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvcC1vdmVybGF5UGFuZWw+XG4gICAgPC9kaXY+XG4gIGAsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuXG5leHBvcnQgY2xhc3MgUG5nVGFibGVIZWFkZXJDb21wb25lbnQgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcblxuICBASW5wdXQoKSBjb2x1bW5zOiBQbmdUYWJsZUNvbHVtblByb3BzW107XG5cbiAgQE91dHB1dCgpIG9uRmlsdGVyc1NldCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBAT3V0cHV0KCkgb25BZ2dLZXlzU2V0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIEBWaWV3Q2hpbGQoJ2ZpbHRlclBhbmVsJykgZmlsdGVyUGFuZWw6IE92ZXJsYXlQYW5lbDtcblxuICBAVmlld0NoaWxkKCdhZ2dQYW5lbCcpIGFnZ1BhbmVsOiBPdmVybGF5UGFuZWw7XG5cbiAgYXZhaWxhYmxlQWdnczoge31bXTtcblxuICBmaWx0ZXJDb2x1bW46IFBuZ1RhYmxlQ29sdW1uUHJvcHM7XG5cbiAgcXVlcnlWYWx1ZTogYW55O1xuXG4gIGFnZ0NvbHVtbjogUG5nVGFibGVDb2x1bW5Qcm9wcztcblxuICBhZ2dNZXRob2RzOiBzdHJpbmdbXTtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgcG5nVGFibGU6IFBuZ1RhYmxlQ29tcG9uZW50KSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHNob3dGaWx0ZXJQYW5lbChldmVudCkge1xuICAgIHRoaXMuZmlsdGVyQ29sdW1uID0gZXZlbnQuY29sdW1uO1xuICAgIGNvbnN0IGZpbHRlcnMgPSB0aGlzLmZpbHRlckNvbHVtbi5maWx0ZXJzO1xuICAgIGlmIChmaWx0ZXJzICYmIGZpbHRlcnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5xdWVyeVZhbHVlID0gZmlsdGVyc1swXTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5xdWVyeVZhbHVlID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICB0aGlzLmZpbHRlclBhbmVsLnRvZ2dsZShldmVudC5ldmVudCk7XG4gIH1cblxuICBjbGVhckZpbHRlckNvbHVtbigpIHtcbiAgICB0aGlzLmZpbHRlckNvbHVtbiA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIGNsZWFyQWdnQ29sdW1uKCkge1xuICAgIHRoaXMuYWdnQ29sdW1uID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgc2hvd0FnZ3NQYW5lbChldmVudCkge1xuICAgIHRoaXMuYXZhaWxhYmxlQWdncyA9IFtdO1xuICAgIHRoaXMuYWdnQ29sdW1uID0gZXZlbnQuY29sdW1uO1xuICAgIGNvbnN0IHR5cGUgPSB0aGlzLmFnZ0NvbHVtbi5kYXRhVHlwZSB8fCBEYXRhVHlwZS5TVFJJTkc7XG4gICAgdGhpcy5hZ2dNZXRob2RzID0gKHRoaXMuYWdnQ29sdW1uLmFnZ1Byb3BzIHx8IFtdKS5tYXAoYWdnUHJvcCA9PiBhZ2dQcm9wLm1ldGhvZCk7XG4gICAgT2JqZWN0LmtleXMoQWdnTWV0aG9kc1Byb3BzKS5mb3JFYWNoKG1ldGhvZCA9PiB7XG4gICAgICBpZiAoIUFnZ01ldGhvZHNQcm9wc1ttZXRob2RdLmRhdGFUeXBlcyB8fCAoQWdnTWV0aG9kc1Byb3BzW21ldGhvZF0uZGF0YVR5cGVzICYmIEFnZ01ldGhvZHNQcm9wc1ttZXRob2RdLmRhdGFUeXBlcy5pbmRleE9mKHR5cGUpID49IDApKSB7XG4gICAgICAgIHRoaXMuYXZhaWxhYmxlQWdncy5wdXNoKHtcbiAgICAgICAgICBsYWJlbDogQWdnTWV0aG9kc1Byb3BzW21ldGhvZF0ubGFiZWwsXG4gICAgICAgICAga2V5OiBBZ2dNZXRob2RzUHJvcHNbbWV0aG9kXS5rZXlcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5hZ2dQYW5lbC50b2dnbGUoZXZlbnQuJGV2ZW50KTtcbiAgfVxuXG4gIHNldEFnZ3MoKSB7XG4gICAgdGhpcy5vbkFnZ0tleXNTZXQuZW1pdCh7Y29sdW1uOiB0aGlzLmFnZ0NvbHVtbiwgbWV0aG9kczogdGhpcy5hZ2dNZXRob2RzfSk7XG4gIH1cblxuICB1cGRhdGVGaWx0ZXJzKGV2ZW50KSB7XG4gICAgdGhpcy5maWx0ZXJQYW5lbC5oaWRlKCk7XG4gICAgdGhpcy5vbkZpbHRlcnNTZXQuZW1pdChldmVudCk7XG4gIH1cblxufVxuIl19