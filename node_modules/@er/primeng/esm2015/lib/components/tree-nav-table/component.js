/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, Input, ViewChild } from '@angular/core';
import { ActivatedRoute, NavigationEnd, Router } from '@angular/router';
import { RouteBindComponent } from '@er/core';
import { ANIMATIONS } from '@er/presets';
import { CommonsUtils, IdUtils } from '@er/utils';
import { PngTableComponent } from '../table/component/table/component';
import { PngTreeComponent } from '../tree/component';
export class PngTreeNavTableComponent extends RouteBindComponent {
    /**
     * @param {?} cd
     * @param {?} router
     * @param {?} activatedRoute
     */
    constructor(cd, router, activatedRoute) {
        super();
        this.cd = cd;
        this.router = router;
        this.activatedRoute = activatedRoute;
        this.switchable = true;
        this.hideTree = false;
        this.$subscriptions = this.router.events.subscribe(event => {
            if (event instanceof NavigationEnd) {
                this.isFormOutlet = event.url.indexOf('(aux:') > 0;
                if (this.isRestore) {
                    this.isRestore = false;
                    this.refresh();
                }
                this.cd.markForCheck();
            }
        });
    }
    /**
     * @return {?}
     */
    get isFormOutlet() {
        return this._isFormOutlet;
    }
    /**
     * @param {?} formOutlet
     * @return {?}
     */
    set isFormOutlet(formOutlet) {
        if (this.isFormOutlet !== formOutlet) {
            this._isFormOutlet = formOutlet;
        }
    }
    /**
     * @return {?}
     */
    refresh() {
        this.pngTable.load();
        if (this.pngTree && this.refreshTree) {
            this.refreshTree = false;
            this.pngTree.load();
        }
    }
    /**
     * @param {?} props
     * @return {?}
     */
    beforeRoutePropsBind(props) {
        this.tree = undefined;
        this.table = undefined;
        this.switchable = true;
        this.hideTree = false;
        if (props.caption) {
            CommonsUtils.set(props, 'table.caption', props.caption);
        }
        return props;
    }
    /**
     * @return {?}
     */
    afterRoutePropsBind() {
        if (!this.tree) {
            this.switchable = false;
        }
        else {
            this.hideTree = false;
            this.switchable = true;
            this.tree.$id = IdUtils.getRandom();
            this.tree.$container = this;
            CommonsUtils.set(this.tree, '$ext.$container', this);
        }
        if (this.table) {
            this.table.$id = IdUtils.getRandom();
            this.table.$container = this;
            CommonsUtils.set(this.table, '$ext.$container', this);
        }
    }
    /**
     * @return {?}
     */
    closeTree() {
        this.hideTree = true;
    }
    /**
     * @return {?}
     */
    back() {
        this.isRestore = true;
        this.router.navigate(['./', { outlets: { aux: null } }], {
            relativeTo: this.activatedRoute
        });
    }
}
PngTreeNavTableComponent.decorators = [
    { type: Component, args: [{
                selector: 'png-tree-nav-table',
                template: `
    <div [hidden]="isFormOutlet">
      <er-fluid-container>
        <er-left-right [hideLeft]="!tree || hideTree" [switchable]="!!tree && switchable">
          <ng-template erTypedTemplate="left">
            <png-panel *ngIf="tree" [icon]="tree.$ext?.captionIcon || 'fa fa-tree'" [header]="tree.$ext?.caption || '管理树'">
              <png-tree erPropsBind [props]="tree" (onEmptyNode)="closeTree()"></png-tree>
            </png-panel>
          </ng-template>
          <ng-template erTypedTemplate="right">
            <div *ngIf="table">
              <div [@fadeIn]="true">
                <png-table erPropsBind [props]="table"></png-table>
              </div>
            </div>
          </ng-template>
        </er-left-right>
      </er-fluid-container>
    </div>
    <router-outlet name="aux">
      <ng-container *ngTemplateOutlet="goBack"></ng-container>
    </router-outlet>
    <ng-container *ngTemplateOutlet="goBack"></ng-container>
    <ng-template #goBack>
      <div *ngIf="isFormOutlet">
        <a (click)="back()" class="btn btn-outline-primary"
           title="返回到数据浏览"> <i class="fa fa-2x text-danger fa-sign-out fa-rotate-180"></i> 返回</a>

      </div>
    </ng-template>
  `,
                animations: [
                    ANIMATIONS.zoomIn,
                    ANIMATIONS.fadeIn
                ],
                changeDetection: ChangeDetectionStrategy.OnPush
            }] }
];
/** @nocollapse */
PngTreeNavTableComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: Router },
    { type: ActivatedRoute }
];
PngTreeNavTableComponent.propDecorators = {
    tree: [{ type: Input }],
    table: [{ type: Input }],
    switchable: [{ type: Input }],
    hideTree: [{ type: Input }],
    pngTable: [{ type: ViewChild, args: [PngTableComponent,] }],
    pngTree: [{ type: ViewChild, args: [PngTreeComponent,] }]
};
if (false) {
    /** @type {?} */
    PngTreeNavTableComponent.prototype.tree;
    /** @type {?} */
    PngTreeNavTableComponent.prototype.table;
    /** @type {?} */
    PngTreeNavTableComponent.prototype.switchable;
    /** @type {?} */
    PngTreeNavTableComponent.prototype.hideTree;
    /** @type {?} */
    PngTreeNavTableComponent.prototype.pngTable;
    /** @type {?} */
    PngTreeNavTableComponent.prototype.pngTree;
    /** @type {?} */
    PngTreeNavTableComponent.prototype.refreshTree;
    /** @type {?} */
    PngTreeNavTableComponent.prototype.isRestore;
    /** @type {?} */
    PngTreeNavTableComponent.prototype._isFormOutlet;
    /**
     * @type {?}
     * @private
     */
    PngTreeNavTableComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    PngTreeNavTableComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    PngTreeNavTableComponent.prototype.activatedRoute;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL3ByaW1lbmcvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90cmVlLW5hdi10YWJsZS9jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBQyx1QkFBdUIsRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUN0RyxPQUFPLEVBQUMsY0FBYyxFQUFFLGFBQWEsRUFBRSxNQUFNLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUN0RSxPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFDNUMsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLGFBQWEsQ0FBQztBQUN2QyxPQUFPLEVBQUMsWUFBWSxFQUFFLE9BQU8sRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUNoRCxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxvQ0FBb0MsQ0FBQztBQUVyRSxPQUFPLEVBQUMsZ0JBQWdCLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQztBQTBDbkQsTUFBTSxPQUFPLHdCQUF5QixTQUFRLGtCQUFrQjs7Ozs7O0lBbUI5RCxZQUFvQixFQUFxQixFQUFVLE1BQWMsRUFBVSxjQUE4QjtRQUN2RyxLQUFLLEVBQUUsQ0FBQztRQURVLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUFVLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQWJoRyxlQUFVLEdBQUcsSUFBSSxDQUFDO1FBRWxCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFheEIsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDekQsSUFBSSxLQUFLLFlBQVksYUFBYSxFQUFFO2dCQUNsQyxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUss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QUFFLG9CQUFvQjtnQkFDOUIsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0E4QlQ7Z0JBQ0QsVUFBVSxFQUFFO29CQUNWLFVBQVUsQ0FBQyxNQUFNO29CQUNqQixVQUFVLENBQUMsTUFBTTtpQkFDbEI7Z0JBQ0QsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07YUFDaEQ7Ozs7WUFoRGdDLGlCQUFpQjtZQUNYLE1BQU07WUFBckMsY0FBYzs7O21CQWtEbkIsS0FBSztvQkFFTCxLQUFLO3lCQUVMLEtBQUs7dUJBRUwsS0FBSzt1QkFFTCxTQUFTLFNBQUMsaUJBQWlCO3NCQUUzQixTQUFTLFNBQUMsZ0JBQWdCOzs7O0lBVjNCLHdDQUE0Qjs7SUFFNUIseUNBQThCOztJQUU5Qiw4Q0FBMkI7O0lBRTNCLDRDQUEwQjs7SUFFMUIsNENBQTBEOztJQUUxRCwyQ0FBdUQ7O0lBRXZELCtDQUFxQjs7SUFFckIsNkNBQW1COztJQUNuQixpREFBdUI7Ozs7O0lBRVgsc0NBQTZCOzs7OztJQUFFLDBDQUFzQjs7Ozs7SUFBRSxrREFBc0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBJbnB1dCwgVmlld0NoaWxkfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7QWN0aXZhdGVkUm91dGUsIE5hdmlnYXRpb25FbmQsIFJvdXRlcn0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7Um91dGVCaW5kQ29tcG9uZW50fSBmcm9tICdAZXIvY29yZSc7XG5pbXBvcnQge0FOSU1BVElPTlN9IGZyb20gJ0Blci9wcmVzZXRzJztcbmltcG9ydCB7Q29tbW9uc1V0aWxzLCBJZFV0aWxzfSBmcm9tICdAZXIvdXRpbHMnO1xuaW1wb3J0IHtQbmdUYWJsZUNvbXBvbmVudH0gZnJvbSAnLi4vdGFibGUvY29tcG9uZW50L3RhYmxlL2NvbXBvbmVudCc7XG5pbXBvcnQge1BuZ1RhYmxlUHJvcHN9IGZyb20gJy4uL3RhYmxlL3R5cGVzJztcbmltcG9ydCB7UG5nVHJlZUNvbXBvbmVudH0gZnJvbSAnLi4vdHJlZS9jb21wb25lbnQnO1xuaW1wb3J0IHtQbmdUcmVlUHJvcHN9IGZyb20gJy4uL3RyZWUvdHlwZXMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwbmctdHJlZS1uYXYtdGFibGUnLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxkaXYgW2hpZGRlbl09XCJpc0Zvcm1PdXRsZXRcIj5cbiAgICAgIDxlci1mbHVpZC1jb250YWluZXI+XG4gICAgICAgIDxlci1sZWZ0LXJpZ2h0IFtoaWRlTGVmdF09XCIhdHJlZSB8fCBoaWRlVHJlZVwiIFtzd2l0Y2hhYmxlXT1cIiEhdHJlZSAmJiBzd2l0Y2hhYmxlXCI+XG4gICAgICAgICAgPG5nLXRlbXBsYXRlIGVyVHlwZWRUZW1wbGF0ZT1cImxlZnRcIj5cbiAgICAgICAgICAgIDxwbmctcGFuZWwgKm5nSWY9XCJ0cmVlXCIgW2ljb25dPVwidHJlZS4kZXh0Py5jYXB0aW9uSWNvbiB8fCAnZmEgZmEtdHJlZSdcIiBbaGVhZGVyXT1cInRyZWUuJGV4dD8uY2FwdGlvbiB8fCAn566h55CG5qCRJ1wiPlxuICAgICAgICAgICAgICA8cG5nLXRyZWUgZXJQcm9wc0JpbmQgW3Byb3BzXT1cInRyZWVcIiAob25FbXB0eU5vZGUpPVwiY2xvc2VUcmVlKClcIj48L3BuZy10cmVlPlxuICAgICAgICAgICAgPC9wbmctcGFuZWw+XG4gICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgICA8bmctdGVtcGxhdGUgZXJUeXBlZFRlbXBsYXRlPVwicmlnaHRcIj5cbiAgICAgICAgICAgIDxkaXYgKm5nSWY9XCJ0YWJsZVwiPlxuICAgICAgICAgICAgICA8ZGl2IFtAZmFkZUluXT1cInRydWVcIj5cbiAgICAgICAgICAgICAgICA8cG5nLXRhYmxlIGVyUHJvcHNCaW5kIFtwcm9wc109XCJ0YWJsZVwiPjwvcG5nLXRhYmxlPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICAgIDwvZXItbGVmdC1yaWdodD5cbiAgICAgIDwvZXItZmx1aWQtY29udGFpbmVyPlxuICAgIDwvZGl2PlxuICAgIDxyb3V0ZXItb3V0bGV0IG5hbWU9XCJhdXhcIj5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJnb0JhY2tcIj48L25nLWNvbnRhaW5lcj5cbiAgICA8L3JvdXRlci1vdXRsZXQ+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImdvQmFja1wiPjwvbmctY29udGFpbmVyPlxuICAgIDxuZy10ZW1wbGF0ZSAjZ29CYWNrPlxuICAgICAgPGRpdiAqbmdJZj1cImlzRm9ybU91dGxldFwiPlxuICAgICAgICA8YSAoY2xpY2spPVwiYmFjaygpXCIgY2xhc3M9XCJidG4gYnRuLW91dGxpbmUtcHJpbWFyeVwiXG4gICAgICAgICAgIHRpdGxlPVwi6L+U5Zue5Yiw5pWw5o2u5rWP6KeIXCI+IDxpIGNsYXNzPVwiZmEgZmEtMnggdGV4dC1kYW5nZXIgZmEtc2lnbi1vdXQgZmEtcm90YXRlLTE4MFwiPjwvaT4g6L+U5ZuePC9hPlxuXG4gICAgICA8L2Rpdj5cbiAgICA8L25nLXRlbXBsYXRlPlxuICBgLFxuICBhbmltYXRpb25zOiBbXG4gICAgQU5JTUFUSU9OUy56b29tSW4sXG4gICAgQU5JTUFUSU9OUy5mYWRlSW5cbiAgXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgUG5nVHJlZU5hdlRhYmxlQ29tcG9uZW50IGV4dGVuZHMgUm91dGVCaW5kQ29tcG9uZW50IHtcblxuICBASW5wdXQoKSB0cmVlOiBQbmdUcmVlUHJvcHM7XG5cbiAgQElucHV0KCkgdGFibGU6IFBuZ1RhYmxlUHJvcHM7XG5cbiAgQElucHV0KCkgc3dpdGNoYWJsZSA9IHRydWU7XG5cbiAgQElucHV0KCkgaGlkZVRyZWUgPSBmYWxzZTtcblxuICBAVmlld0NoaWxkKFBuZ1RhYmxlQ29tcG9uZW50KSBwbmdUYWJsZTogUG5nVGFibGVDb21wb25lbnQ7XG5cbiAgQFZpZXdDaGlsZChQbmdUcmVlQ29tcG9uZW50KSBwbmdUcmVlOiBQbmdUcmVlQ29tcG9uZW50O1xuXG4gIHJlZnJlc2hUcmVlOiBib29sZWFuO1xuXG4gIGlzUmVzdG9yZTogYm9vbGVhbjtcbiAgX2lzRm9ybU91dGxldDogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiwgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlciwgcHJpdmF0ZSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuJHN1YnNjcmlwdGlvbnMgPSB0aGlzLnJvdXRlci5ldmVudHMuc3Vic2NyaWJlKGV2ZW50ID0+IHtcbiAgICAgIGlmIChldmVudCBpbnN0YW5jZW9mIE5hdmlnYXRpb25FbmQpIHtcbiAgICAgICAgdGhpcy5pc0Zvcm1PdXRsZXQgPSBldmVudC51cmwuaW5kZXhPZignKGF1eDonKSA+IDA7XG4gICAgICAgIGlmICh0aGlzLmlzUmVzdG9yZSkge1xuICAgICAgICAgIHRoaXMuaXNSZXN0b3JlID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGdldCBpc0Zvcm1PdXRsZXQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lzRm9ybU91dGxldDtcbiAgfVxuXG4gIHNldCBpc0Zvcm1PdXRsZXQoZm9ybU91dGxldCkge1xuICAgIGlmICh0aGlzLmlzRm9ybU91dGxldCAhPT0gZm9ybU91dGxldCkge1xuICAgICAgdGhpcy5faXNGb3JtT3V0bGV0ID0gZm9ybU91dGxldDtcbiAgICB9XG4gIH1cblxuICByZWZyZXNoKCkge1xuICAgIHRoaXMucG5nVGFibGUubG9hZCgpO1xuICAgIGlmICh0aGlzLnBuZ1RyZWUgJiYgdGhpcy5yZWZyZXNoVHJlZSkge1xuICAgICAgdGhpcy5yZWZyZXNoVHJlZSA9IGZhbHNlO1xuICAgICAgdGhpcy5wbmdUcmVlLmxvYWQoKTtcbiAgICB9XG4gIH1cblxuICBiZWZvcmVSb3V0ZVByb3BzQmluZChwcm9wcykge1xuICAgIHRoaXMudHJlZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnRhYmxlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc3dpdGNoYWJsZSA9IHRydWU7XG4gICAgdGhpcy5oaWRlVHJlZSA9IGZhbHNlO1xuICAgIGlmIChwcm9wcy5jYXB0aW9uKSB7XG4gICAgICBDb21tb25zVXRpbHMuc2V0KHByb3BzLCAndGFibGUuY2FwdGlvbicsIHByb3BzLmNhcHRpb24pO1xuICAgIH1cbiAgICByZXR1cm4gcHJvcHM7XG4gIH1cblxuICBhZnRlclJvdXRlUHJvcHNCaW5kKCkge1xuICAgIGlmICghdGhpcy50cmVlKSB7XG4gICAgICB0aGlzLnN3aXRjaGFibGUgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5oaWRlVHJlZSA9IGZhbHNlO1xuICAgICAgdGhpcy5zd2l0Y2hhYmxlID0gdHJ1ZTtcbiAgICAgIHRoaXMudHJlZS4kaWQgPSBJZFV0aWxzLmdldFJhbmRvbSgpO1xuICAgICAgdGhpcy50cmVlLiRjb250YWluZXIgPSB0aGlzO1xuICAgICAgQ29tbW9uc1V0aWxzLnNldCh0aGlzLnRyZWUsICckZXh0LiRjb250YWluZXInLCB0aGlzKTtcbiAgICB9XG4gICAgaWYgKHRoaXMudGFibGUpIHtcbiAgICAgIHRoaXMudGFibGUuJGlkID0gSWRVdGlscy5nZXRSYW5kb20oKTtcbiAgICAgIHRoaXMudGFibGUuJGNvbnRhaW5lciA9IHRoaXM7XG4gICAgICBDb21tb25zVXRpbHMuc2V0KHRoaXMudGFibGUsICckZXh0LiRjb250YWluZXInLCB0aGlzKTtcbiAgICB9XG4gIH1cblxuICBjbG9zZVRyZWUoKSB7XG4gICAgdGhpcy5oaWRlVHJlZSA9IHRydWU7XG4gIH1cblxuICBiYWNrKCkge1xuICAgIHRoaXMuaXNSZXN0b3JlID0gdHJ1ZTtcbiAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJy4vJywge291dGxldHM6IHthdXg6IG51bGx9fV0sIHtcbiAgICAgIHJlbGF0aXZlVG86IHRoaXMuYWN0aXZhdGVkUm91dGVcbiAgICB9KTtcbiAgfVxuXG4gIC8vIG5nT25Jbml0KCkge1xuICAvLyAgIHN1cGVyLm5nT25Jbml0KCk7XG4gIC8vICAgYWxlcnQoKTtcbiAgLy8gfVxufVxuIl19