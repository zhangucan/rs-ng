/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { BaseComponent, HttpUtils } from '@er/core';
import { HttpResponseType } from '@er/types';
import { CommonsUtils, ConfigUtils, DialogUtils } from '@er/utils';
import { Lightbox } from 'primeng/primeng';
export class PngImageComponent extends BaseComponent {
    /**
     * @param {?} cd
     * @param {?} sanitizer
     */
    constructor(cd, sanitizer) {
        super();
        this.cd = cd;
        this.sanitizer = sanitizer;
        this.imageViewStyle = { 'max-height': '300px', 'max-width': '500px', 'overflow': 'auto' };
        this.showDescription = true;
        this.descriptionChange = new EventEmitter();
    }
    /**
     * @return {?}
     */
    get description() {
        return this._description;
    }
    /**
     * @param {?} description
     * @return {?}
     */
    set description(description) {
        this._description = description;
        this.descriptionChange.emit(description);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.src) {
            if (CommonsUtils.isArray(this.src)) {
                if (this.src.length === 1) {
                    this.images = undefined;
                    this.image = this.src[0];
                    this.fullImage = this.src[0];
                }
                else {
                    this.images = [];
                    this.image = this.src[0];
                    this.fullImage = this.src[0];
                    ((/** @type {?} */ (this.src))).forEach(image => {
                        if (CommonsUtils.isString(image)) {
                            this.images.push({ source: image });
                        }
                        else {
                            this.images.push(image);
                        }
                    });
                }
            }
            else {
                this.images = undefined;
                this.image = this.src;
                this.fullImage = this.src;
            }
        }
        if (changes.fileId) {
            /** @type {?} */
            let fileId;
            if (!this.fileId) {
                this.images = undefined;
                this.image = null;
            }
            else {
                if (CommonsUtils.isArray(this.fileId)) {
                    if (this.fileId.length === 0) {
                        this.images = undefined;
                        this.image = null;
                        return;
                    }
                    else {
                        fileId = this.fileId[0];
                    }
                }
                else {
                    fileId = this.fileId;
                }
                HttpUtils.request({
                    uri: `${ConfigUtils.getConfig().api.servers['image'].uri}/${fileId}${this.size ? '?' + this.size : ''}`,
                    observe: 'events',
                    responseType: HttpResponseType.BLOB
                }).subscribe(response => {
                    /** @type {?} */
                    const objectURL = this.sanitizer.bypassSecurityTrustUrl((window.URL.createObjectURL(response.body)));
                    this.images = undefined;
                    this.image = objectURL;
                    this.fullImage = `${ConfigUtils.getConfig().api.servers['image'].uri}/${fileId}`;
                    /** @type {?} */
                    const descriptions = response.headers.getAll('description');
                    if (descriptions && descriptions.length > 0) {
                        this.description = descriptions[0];
                    }
                    this.cd.detectChanges();
                });
            }
        }
    }
    /**
     * @return {?}
     */
    viewImage() {
        if (this.images) {
            this.imageViewer.show();
            this.imageViewer.center();
        }
        else if (this.image) {
            DialogUtils.info('图片预览', this.imageViewTpl, (/** @type {?} */ ({})));
        }
    }
}
PngImageComponent.decorators = [
    { type: Component, args: [{
                selector: 'png-image',
                template: `
    <div [ngClass]="styleClass" [ngStyle]="style">
      <img *ngIf="image"
           style="margin: 5px"
           [src]="image"
           [ngClass]="imageStyleClass"
           [ngStyle]="imageStyle"
           [title]="description || ''"
           (click)="viewImage()"/>
      <div *ngIf="showDescription" [ngClass]="descriptionStyleClass" [ngStyle]="descriptionStyle">
        {{description}}
      </div>
    </div>
    <ng-template #imageView>
      <img [src]="fullImage" [ngStyle]="imageViewStyle" [ngClass]="imageViewStyleClass"/>
    </ng-template>
    <ng-template #imagesView>
      <p-lightbox [images]="images" [styleClass]="boxStyleClass" [style]="boxStyle"></p-lightbox>
    </ng-template>
  `,
                changeDetection: ChangeDetectionStrategy.OnPush
            }] }
];
/** @nocollapse */
PngImageComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: DomSanitizer }
];
PngImageComponent.propDecorators = {
    src: [{ type: Input }],
    styleClass: [{ type: Input }],
    style: [{ type: Input }],
    imageStyleClass: [{ type: Input }],
    imageStyle: [{ type: Input }],
    descriptionStyleClass: [{ type: Input }],
    descriptionStyle: [{ type: Input }],
    boxStyleClass: [{ type: Input }],
    boxStyle: [{ type: Input }],
    imageViewStyleClass: [{ type: Input }],
    imageViewStyle: [{ type: Input }],
    showDescription: [{ type: Input }],
    size: [{ type: Input }],
    fileId: [{ type: Input }],
    imageViewTpl: [{ type: ViewChild, args: ['imageView',] }],
    imageViewer: [{ type: ViewChild, args: ['imagesView',] }],
    descriptionChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    PngImageComponent.prototype.src;
    /** @type {?} */
    PngImageComponent.prototype.styleClass;
    /** @type {?} */
    PngImageComponent.prototype.style;
    /** @type {?} */
    PngImageComponent.prototype.imageStyleClass;
    /** @type {?} */
    PngImageComponent.prototype.imageStyle;
    /** @type {?} */
    PngImageComponent.prototype.descriptionStyleClass;
    /** @type {?} */
    PngImageComponent.prototype.descriptionStyle;
    /** @type {?} */
    PngImageComponent.prototype.boxStyleClass;
    /** @type {?} */
    PngImageComponent.prototype.boxStyle;
    /** @type {?} */
    PngImageComponent.prototype.imageViewStyleClass;
    /** @type {?} */
    PngImageComponent.prototype.imageViewStyle;
    /** @type {?} */
    PngImageComponent.prototype.showDescription;
    /** @type {?} */
    PngImageComponent.prototype.size;
    /** @type {?} */
    PngImageComponent.prototype.fileId;
    /** @type {?} */
    PngImageComponent.prototype.imageViewTpl;
    /** @type {?} */
    PngImageComponent.prototype.imageViewer;
    /** @type {?} */
    PngImageComponent.prototype.image;
    /** @type {?} */
    PngImageComponent.prototype.fullImage;
    /** @type {?} */
    PngImageComponent.prototype.images;
    /** @type {?} */
    PngImageComponent.prototype.descriptionChange;
    /** @type {?} */
    PngImageComponent.prototype._description;
    /**
     * @type {?}
     * @private
     */
    PngImageComponent.prototype.cd;
    /** @type {?} */
    PngImageComponent.prototype.sanitizer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL3ByaW1lbmcvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9pbWFnZS9jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxZQUFZLEVBQ1osS0FBSyxFQUVMLE1BQU0sRUFFTixXQUFXLEVBQ1gsU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSwyQkFBMkIsQ0FBQztBQUN2RCxPQUFPLEVBQUMsYUFBYSxFQUFFLFNBQVMsRUFBQyxNQUFNLFVBQVUsQ0FBQztBQUNsRCxPQUFPLEVBQUMsZ0JBQWdCLEVBQWtCLE1BQU0sV0FBVyxDQUFDO0FBQzVELE9BQU8sRUFBQyxZQUFZLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUNqRSxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUE0QnpDLE1BQU0sT0FBTyxpQkFBa0IsU0FBUSxhQUFhOzs7OztJQTRCbEQsWUFBb0IsRUFBcUIsRUFBUyxTQUF1QjtRQUN2RSxLQUFLLEVBQUUsQ0FBQztRQURVLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQVMsY0FBUyxHQUFULFNBQVMsQ0FBYztRQWpCaEUsbUJBQWMsR0FBUSxFQUFDLFlBQVksRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFDLENBQUM7UUFDeEYsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFjdEIsc0JBQWlCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQUlqRCxDQUFDOzs7O0lBSUQsSUFBSSxXQUFXO1FBQ2IsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBQzNCLENBQUM7Ozs7O0lBRUQsSUFBSSxXQUFXLENBQUMsV0FBVztRQUN6QixJ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Ozs7Ozs7Ozs7O0dBbUJUO2dCQUNELGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2FBQ2hEOzs7O1lBeENDLGlCQUFpQjtZQVVYLFlBQVk7OztrQkFpQ2pCLEtBQUs7eUJBQ0wsS0FBSztvQkFDTCxLQUFLOzhCQUNMLEtBQUs7eUJBQ0wsS0FBSztvQ0FDTCxLQUFLOytCQUNMLEtBQUs7NEJBQ0wsS0FBSzt1QkFDTCxLQUFLO2tDQUNMLEtBQUs7NkJBQ0wsS0FBSzs4QkFDTCxLQUFLO21CQUVMLEtBQUs7cUJBQ0wsS0FBSzsyQkFFTCxTQUFTLFNBQUMsV0FBVzswQkFFckIsU0FBUyxTQUFDLFlBQVk7Z0NBT3RCLE1BQU07Ozs7SUF6QlAsZ0NBQWtCOztJQUNsQix1Q0FBeUI7O0lBQ3pCLGtDQUFvQjs7SUFDcEIsNENBQThCOztJQUM5Qix1Q0FBeUI7O0lBQ3pCLGtEQUFvQzs7SUFDcEMsNkNBQStCOztJQUMvQiwwQ0FBNEI7O0lBQzVCLHFDQUF1Qjs7SUFDdkIsZ0RBQWtDOztJQUNsQywyQ0FBaUc7O0lBQ2pHLDRDQUFnQzs7SUFFaEMsaUNBQWtDOztJQUNsQyxtQ0FBd0I7O0lBRXhCLHlDQUF1RDs7SUFFdkQsd0NBQStDOztJQUUvQyxrQ0FBVzs7SUFFWCxzQ0FBZTs7SUFFZixtQ0FBYTs7SUFDYiw4Q0FBaUQ7O0lBTWpELHlDQUFxQjs7Ozs7SUFKVCwrQkFBNkI7O0lBQUUsc0NBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT3V0cHV0LFxuICBTaW1wbGVDaGFuZ2VzLFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0NoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtEb21TYW5pdGl6ZXJ9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xuaW1wb3J0IHtCYXNlQ29tcG9uZW50LCBIdHRwVXRpbHN9IGZyb20gJ0Blci9jb3JlJztcbmltcG9ydCB7SHR0cFJlc3BvbnNlVHlwZSwgUG9wdXBEaWFsb2dQcm9wfSBmcm9tICdAZXIvdHlwZXMnO1xuaW1wb3J0IHtDb21tb25zVXRpbHMsIENvbmZpZ1V0aWxzLCBEaWFsb2dVdGlsc30gZnJvbSAnQGVyL3V0aWxzJztcbmltcG9ydCB7TGlnaHRib3h9IGZyb20gJ3ByaW1lbmcvcHJpbWVuZyc7XG5cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG5nLWltYWdlJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2IFtuZ0NsYXNzXT1cInN0eWxlQ2xhc3NcIiBbbmdTdHlsZV09XCJzdHlsZVwiPlxuICAgICAgPGltZyAqbmdJZj1cImltYWdlXCJcbiAgICAgICAgICAgc3R5bGU9XCJtYXJnaW46IDVweFwiXG4gICAgICAgICAgIFtzcmNdPVwiaW1hZ2VcIlxuICAgICAgICAgICBbbmdDbGFzc109XCJpbWFnZVN0eWxlQ2xhc3NcIlxuICAgICAgICAgICBbbmdTdHlsZV09XCJpbWFnZVN0eWxlXCJcbiAgICAgICAgICAgW3RpdGxlXT1cImRlc2NyaXB0aW9uIHx8ICcnXCJcbiAgICAgICAgICAgKGNsaWNrKT1cInZpZXdJbWFnZSgpXCIvPlxuICAgICAgPGRpdiAqbmdJZj1cInNob3dEZXNjcmlwdGlvblwiIFtuZ0NsYXNzXT1cImRlc2NyaXB0aW9uU3R5bGVDbGFzc1wiIFtuZ1N0eWxlXT1cImRlc2NyaXB0aW9uU3R5bGVcIj5cbiAgICAgICAge3tkZXNjcmlwdGlvbn19XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8bmctdGVtcGxhdGUgI2ltYWdlVmlldz5cbiAgICAgIDxpbWcgW3NyY109XCJmdWxsSW1hZ2VcIiBbbmdTdHlsZV09XCJpbWFnZVZpZXdTdHlsZVwiIFtuZ0NsYXNzXT1cImltYWdlVmlld1N0eWxlQ2xhc3NcIi8+XG4gICAgPC9uZy10ZW1wbGF0ZT5cbiAgICA8bmctdGVtcGxhdGUgI2ltYWdlc1ZpZXc+XG4gICAgICA8cC1saWdodGJveCBbaW1hZ2VzXT1cImltYWdlc1wiIFtzdHlsZUNsYXNzXT1cImJveFN0eWxlQ2xhc3NcIiBbc3R5bGVdPVwiYm94U3R5bGVcIj48L3AtbGlnaHRib3g+XG4gICAgPC9uZy10ZW1wbGF0ZT5cbiAgYCxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5cbmV4cG9ydCBjbGFzcyBQbmdJbWFnZUNvbXBvbmVudCBleHRlbmRzIEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuICBASW5wdXQoKSBzcmM6IGFueTtcbiAgQElucHV0KCkgc3R5bGVDbGFzczogYW55O1xuICBASW5wdXQoKSBzdHlsZTogYW55O1xuICBASW5wdXQoKSBpbWFnZVN0eWxlQ2xhc3M6IGFueTtcbiAgQElucHV0KCkgaW1hZ2VTdHlsZTogYW55O1xuICBASW5wdXQoKSBkZXNjcmlwdGlvblN0eWxlQ2xhc3M6IGFueTtcbiAgQElucHV0KCkgZGVzY3JpcHRpb25TdHlsZTogYW55O1xuICBASW5wdXQoKSBib3hTdHlsZUNsYXNzOiBhbnk7XG4gIEBJbnB1dCgpIGJveFN0eWxlOiBhbnk7XG4gIEBJbnB1dCgpIGltYWdlVmlld1N0eWxlQ2xhc3M6IGFueTtcbiAgQElucHV0KCkgaW1hZ2VWaWV3U3R5bGU6IGFueSA9IHsnbWF4LWhlaWdodCc6ICczMDBweCcsICdtYXgtd2lkdGgnOiAnNTAwcHgnLCAnb3ZlcmZsb3cnOiAnYXV0byd9O1xuICBASW5wdXQoKSBzaG93RGVzY3JpcHRpb24gPSB0cnVlO1xuXG4gIEBJbnB1dCgpIHNpemU6ICdzbWFsbCcgfCAnbWVkaXVtJztcbiAgQElucHV0KCkgZmlsZUlkOiBzdHJpbmc7XG5cbiAgQFZpZXdDaGlsZCgnaW1hZ2VWaWV3JykgaW1hZ2VWaWV3VHBsOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIEBWaWV3Q2hpbGQoJ2ltYWdlc1ZpZXcnKSBpbWFnZVZpZXdlcjogTGlnaHRib3g7XG5cbiAgaW1hZ2U6IGFueTtcblxuICBmdWxsSW1hZ2U6IGFueTtcblxuICBpbWFnZXM6IHt9W107XG4gIEBPdXRwdXQoKSBkZXNjcmlwdGlvbkNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiwgcHVibGljIHNhbml0aXplcjogRG9tU2FuaXRpemVyKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIF9kZXNjcmlwdGlvbjogc3RyaW5nO1xuXG4gIGdldCBkZXNjcmlwdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fZGVzY3JpcHRpb247XG4gIH1cblxuICBzZXQgZGVzY3JpcHRpb24oZGVzY3JpcHRpb24pIHtcbiAgICB0aGlzLl9kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgIHRoaXMuZGVzY3JpcHRpb25DaGFuZ2UuZW1pdChkZXNjcmlwdGlvbik7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKGNoYW5nZXMuc3JjKSB7XG4gICAgICBpZiAoQ29tbW9uc1V0aWxzLmlzQXJyYXkodGhpcy5zcmMpKSB7XG4gICAgICAgIGlmICh0aGlzLnNyYy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICB0aGlzLmltYWdlcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICB0aGlzLmltYWdlID0gdGhpcy5zcmNbMF07XG4gICAgICAgICAgdGhpcy5mdWxsSW1hZ2UgPSB0aGlzLnNyY1swXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmltYWdlcyA9IFtdO1xuICAgICAgICAgIHRoaXMuaW1hZ2UgPSB0aGlzLnNyY1swXTtcbiAgICAgICAgICB0aGlzLmZ1bGxJbWFnZSA9IHRoaXMuc3JjWzBdO1xuICAgICAgICAgICg8YW55W10+dGhpcy5zcmMpLmZvckVhY2goaW1hZ2UgPT4ge1xuICAgICAgICAgICAgaWYgKENvbW1vbnNVdGlscy5pc1N0cmluZyhpbWFnZSkpIHtcbiAgICAgICAgICAgICAgdGhpcy5pbWFnZXMucHVzaCh7c291cmNlOiBpbWFnZX0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5pbWFnZXMucHVzaChpbWFnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaW1hZ2VzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmltYWdlID0gdGhpcy5zcmM7XG4gICAgICAgIHRoaXMuZnVsbEltYWdlID0gdGhpcy5zcmM7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChjaGFuZ2VzLmZpbGVJZCkge1xuICAgICAgbGV0IGZpbGVJZDtcbiAgICAgIGlmICghdGhpcy5maWxlSWQpIHtcbiAgICAgICAgdGhpcy5pbWFnZXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaW1hZ2UgPSBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKENvbW1vbnNVdGlscy5pc0FycmF5KHRoaXMuZmlsZUlkKSkge1xuICAgICAgICAgIGlmICh0aGlzLmZpbGVJZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuaW1hZ2VzID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5pbWFnZSA9IG51bGw7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZpbGVJZCA9IHRoaXMuZmlsZUlkWzBdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmaWxlSWQgPSB0aGlzLmZpbGVJZDtcbiAgICAgICAgfVxuICAgICAgICBIdHRwVXRpbHMucmVxdWVzdChcbiAgICAgICAgICB7XG4gICAgICAgICAgICB1cmk6IGAke0NvbmZpZ1V0aWxzLmdldENvbmZpZygpLmFwaS5zZXJ2ZXJzWydpbWFnZSddLnVyaX0vJHtmaWxlSWR9JHt0aGlzLnNpemUgPyAnPycgKyB0aGlzLnNpemUgOiAnJ31gLFxuICAgICAgICAgICAgb2JzZXJ2ZTogJ2V2ZW50cycsXG4gICAgICAgICAgICByZXNwb25zZVR5cGU6IEh0dHBSZXNwb25zZVR5cGUuQkxPQlxuICAgICAgICAgIH0pLnN1YnNjcmliZShyZXNwb25zZSA9PiB7XG4gICAgICAgICAgY29uc3Qgb2JqZWN0VVJMID0gdGhpcy5zYW5pdGl6ZXIuYnlwYXNzU2VjdXJpdHlUcnVzdFVybCgod2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwocmVzcG9uc2UuYm9keSkpKTtcbiAgICAgICAgICB0aGlzLmltYWdlcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICB0aGlzLmltYWdlID0gb2JqZWN0VVJMO1xuICAgICAgICAgIHRoaXMuZnVsbEltYWdlID0gYCR7Q29uZmlnVXRpbHMuZ2V0Q29uZmlnKCkuYXBpLnNlcnZlcnNbJ2ltYWdlJ10udXJpfS8ke2ZpbGVJZH1gO1xuICAgICAgICAgIGNvbnN0IGRlc2NyaXB0aW9ucyA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0QWxsKCdkZXNjcmlwdGlvbicpO1xuICAgICAgICAgIGlmIChkZXNjcmlwdGlvbnMgJiYgZGVzY3JpcHRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbnNbMF07XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB2aWV3SW1hZ2UoKSB7XG4gICAgaWYgKHRoaXMuaW1hZ2VzKSB7XG4gICAgICB0aGlzLmltYWdlVmlld2VyLnNob3coKTtcbiAgICAgIHRoaXMuaW1hZ2VWaWV3ZXIuY2VudGVyKCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmltYWdlKSB7XG4gICAgICBEaWFsb2dVdGlscy5pbmZvKCflm77niYfpooTop4gnLCB0aGlzLmltYWdlVmlld1RwbCwgPFBvcHVwRGlhbG9nUHJvcD57fSk7XG4gICAgfVxuICB9XG59XG4iXX0=