/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { QueryList, ViewChild, ViewChildren, ViewContainerRef } from '@angular/core';
import { ComponentUtils } from '@er/core';
import { CommonsUtils } from '@er/utils';
import { ValidationMessageDirective } from '@er/validate';
import { FieldType } from '@ngx-formly/core';
import { FormlyPropsBindDirective } from '../directives/props/directive';
/**
 * @abstract
 */
export class ErFormlyFieldType extends FieldType {
    /**
     * @return {?}
     */
    get attrs() {
        return this.field['attrs'] || {};
    }
    /**
     * @return {?}
     */
    get props() {
        return this.field['props'] || {};
    }
    /**
     * @return {?}
     */
    get context() {
        return this.field['context'] || {};
    }
    /**
     * @return {?}
     */
    get value() {
        return this.formControl.value;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set value(val) {
        this.formControl.setValue(val);
    }
    /**
     * @param {?=} key
     * @return {?}
     */
    component(key) {
        return this.form['components'] &&
            this.form['components'][key || this.field.key];
    }
    /**
     * @param {?=} key
     * @return {?}
     */
    data$(key) {
        return this.form['components'] &&
            this.form['components'][key || this.field.key] &&
            this.form['components'][key || this.field.key].data$;
    }
    /**
     * @param {?=} key
     * @return {?}
     */
    control(key) {
        return this.form.get(key);
    }
    /**
     * @param {?} key
     * @return {?}
     */
    fieldProps(key) {
        /** @type {?} */
        const props = this.field['formProps'].fields.filter(prop => prop.key === key);
        return (props && props.length === 1) ? props[0] : undefined;
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        /** @type {?} */
        const _widgets = this.widgets.toArray();
        /** @type {?} */
        let component;
        if (_widgets.length === 1) {
            component = ComponentUtils.getHostComponentInst(_widgets[0]);
        }
        else if (_widgets.length > 1) {
            component = _widgets.map(widget => ComponentUtils.getHostComponentInst(widget));
        }
        if (this.validateMessage) {
            this.validateMessage.showError = this.showError || true;
        }
        if (!this.form['components']) {
            this.form['components'] = {};
        }
        this.form['components'][this.field.key] = component;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.field['props'] = this.field['props'] || {};
        if (this.defaultProps) {
            this.field['props'] = CommonsUtils.defaults({}, this.field['props'], this.defaultProps);
        }
        this.field['formlyField'] = this;
    }
}
ErFormlyFieldType.propDecorators = {
    widgets: [{ type: ViewChildren, args: [FormlyPropsBindDirective, { read: ViewContainerRef },] }],
    validateMessage: [{ type: ViewChild, args: [ValidationMessageDirective,] }]
};
if (false) {
    /** @type {?} */
    ErFormlyFieldType.prototype.defaultProps;
    /** @type {?} */
    ErFormlyFieldType.prototype.widgets;
    /** @type {?} */
    ErFormlyFieldType.prototype.validateMessage;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmllbGQtdHlwZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Blci9mb3JtbHkvIiwic291cmNlcyI6WyJsaWIvYmFzZS9maWVsZC10eXBlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQXdCLFNBQVMsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLGdCQUFnQixFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRTFHLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFDeEMsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUN2QyxPQUFPLEVBQUMsMEJBQTBCLEVBQUMsTUFBTSxjQUFjLENBQUM7QUFDeEQsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGtCQUFrQixDQUFDO0FBQzNDLE9BQU8sRUFBQyx3QkFBd0IsRUFBQyxNQUFNLCtCQUErQixDQUFDOzs7O0FBR3ZFLE1BQU0sT0FBZ0IsaUJBQWtCLFNBQVEsU0FBOEI7Ozs7SUFRNUUsSUFBSSxLQUFLO1FBQ1AsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNuQyxDQUFDOzs7O0lBRUQsSUFBSSxLQUFLO1FBQ1AsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNuQyxDQUFDOzs7O0lBRUQsSUFBSSxPQUFPO1FBQ1QsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNyQyxDQUFDOzs7O0lBRUQsSUFBSSxLQUFLO1FBQ1AsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQztJQUNoQyxDQUFDOzs7OztJQUVELElBQUksS0FBSyxDQUFDLEdBQUc7UUFDWCxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNqQyxDQUFDOzs7OztJQUVELFNBQVMsQ0FBQyxHQUFJO1FBQ1osT0FB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QWlCOztJQUVqQixvQ0FBdUc7O0lBRXZHLDRDQUFtRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7QWZ0ZXJWaWV3SW5pdCwgT25Jbml0LCBRdWVyeUxpc3QsIFZpZXdDaGlsZCwgVmlld0NoaWxkcmVuLCBWaWV3Q29udGFpbmVyUmVmfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7QWJzdHJhY3RDb250cm9sfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQge0NvbXBvbmVudFV0aWxzfSBmcm9tICdAZXIvY29yZSc7XG5pbXBvcnQge0NvbW1vbnNVdGlsc30gZnJvbSAnQGVyL3V0aWxzJztcbmltcG9ydCB7VmFsaWRhdGlvbk1lc3NhZ2VEaXJlY3RpdmV9IGZyb20gJ0Blci92YWxpZGF0ZSc7XG5pbXBvcnQge0ZpZWxkVHlwZX0gZnJvbSAnQG5neC1mb3JtbHkvY29yZSc7XG5pbXBvcnQge0Zvcm1seVByb3BzQmluZERpcmVjdGl2ZX0gZnJvbSAnLi4vZGlyZWN0aXZlcy9wcm9wcy9kaXJlY3RpdmUnO1xuaW1wb3J0IHtFckZvcm1seUZpZWxkQ29uZmlnfSBmcm9tICcuL2ZpZWxkLWNvbmZpZyc7XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBFckZvcm1seUZpZWxkVHlwZSBleHRlbmRzIEZpZWxkVHlwZTxFckZvcm1seUZpZWxkQ29uZmlnPiBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XG5cbiAgZGVmYXVsdFByb3BzOiB7fTtcblxuICBAVmlld0NoaWxkcmVuKEZvcm1seVByb3BzQmluZERpcmVjdGl2ZSwge3JlYWQ6IFZpZXdDb250YWluZXJSZWZ9KSB3aWRnZXRzOiBRdWVyeUxpc3Q8Vmlld0NvbnRhaW5lclJlZj47XG5cbiAgQFZpZXdDaGlsZChWYWxpZGF0aW9uTWVzc2FnZURpcmVjdGl2ZSkgdmFsaWRhdGVNZXNzYWdlOiBWYWxpZGF0aW9uTWVzc2FnZURpcmVjdGl2ZTtcblxuICBnZXQgYXR0cnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuZmllbGRbJ2F0dHJzJ10gfHwge307XG4gIH1cblxuICBnZXQgcHJvcHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuZmllbGRbJ3Byb3BzJ10gfHwge307XG4gIH1cblxuICBnZXQgY29udGV4dCgpIHtcbiAgICByZXR1cm4gdGhpcy5maWVsZFsnY29udGV4dCddIHx8IHt9O1xuICB9XG5cbiAgZ2V0IHZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLmZvcm1Db250cm9sLnZhbHVlO1xuICB9XG5cbiAgc2V0IHZhbHVlKHZhbCkge1xuICAgIHRoaXMuZm9ybUNvbnRyb2wuc2V0VmFsdWUodmFsKTtcbiAgfVxuXG4gIGNvbXBvbmVudChrZXk/KSB7XG4gICAgcmV0dXJuIHRoaXMuZm9ybVsnY29tcG9uZW50cyddICYmXG4gICAgICB0aGlzLmZvcm1bJ2NvbXBvbmVudHMnXVtrZXkgfHwgdGhpcy5maWVsZC5rZXldO1xuICB9XG5cbiAgZGF0YSQoa2V5Pykge1xuICAgIHJldHVybiB0aGlzLmZvcm1bJ2NvbXBvbmVudHMnXSAmJlxuICAgICAgdGhpcy5mb3JtWydjb21wb25lbnRzJ11ba2V5IHx8IHRoaXMuZmllbGQua2V5XSAmJlxuICAgICAgdGhpcy5mb3JtWydjb21wb25lbnRzJ11ba2V5IHx8IHRoaXMuZmllbGQua2V5XS5kYXRhJDtcbiAgfVxuXG4gIGNvbnRyb2woa2V5Pzogc3RyaW5nIHwgc3RyaW5nW10pOiBBYnN0cmFjdENvbnRyb2wge1xuICAgIHJldHVybiB0aGlzLmZvcm0uZ2V0KGtleSk7XG4gIH1cblxuICBmaWVsZFByb3BzKGtleSkge1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5maWVsZFsnZm9ybVByb3BzJ10uZmllbGRzLmZpbHRlcihwcm9wID0+IHByb3Aua2V5ID09PSBrZXkpO1xuICAgIHJldHVybiAocHJvcHMgJiYgcHJvcHMubGVuZ3RoID09PSAxKSA/IHByb3BzWzBdIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIGNvbnN0IF93aWRnZXRzID0gdGhpcy53aWRnZXRzLnRvQXJyYXkoKTtcbiAgICBsZXQgY29tcG9uZW50O1xuICAgIGlmIChfd2lkZ2V0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgIGNvbXBvbmVudCA9IENvbXBvbmVudFV0aWxzLmdldEhvc3RDb21wb25lbnRJbnN0KF93aWRnZXRzWzBdKTtcbiAgICB9IGVsc2UgaWYgKF93aWRnZXRzLmxlbmd0aCA+IDEpIHtcbiAgICAgIGNvbXBvbmVudCA9IF93aWRnZXRzLm1hcCh3aWRnZXQgPT4gQ29tcG9uZW50VXRpbHMuZ2V0SG9zdENvbXBvbmVudEluc3Qod2lkZ2V0KSk7XG4gICAgfVxuICAgIGlmICh0aGlzLnZhbGlkYXRlTWVzc2FnZSkge1xuICAgICAgdGhpcy52YWxpZGF0ZU1lc3NhZ2Uuc2hvd0Vycm9yID0gdGhpcy5zaG93RXJyb3IgfHwgdHJ1ZTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLmZvcm1bJ2NvbXBvbmVudHMnXSkge1xuICAgICAgdGhpcy5mb3JtWydjb21wb25lbnRzJ10gPSB7fTtcbiAgICB9XG4gICAgdGhpcy5mb3JtWydjb21wb25lbnRzJ11bdGhpcy5maWVsZC5rZXldID0gY29tcG9uZW50O1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5maWVsZFsncHJvcHMnXSA9IHRoaXMuZmllbGRbJ3Byb3BzJ10gfHwge307XG4gICAgaWYgKHRoaXMuZGVmYXVsdFByb3BzKSB7XG4gICAgICB0aGlzLmZpZWxkWydwcm9wcyddID0gQ29tbW9uc1V0aWxzLmRlZmF1bHRzKHt9LCB0aGlzLmZpZWxkWydwcm9wcyddLCB0aGlzLmRlZmF1bHRQcm9wcyk7XG4gICAgfVxuICAgIHRoaXMuZmllbGRbJ2Zvcm1seUZpZWxkJ10gPSB0aGlzO1xuICB9XG59XG4iXX0=