/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, Input } from '@angular/core';
import { BaseFormComponent } from '@er/core';
import { Subject } from 'rxjs';
export class FormlyFormComponent extends BaseFormComponent {
    /**
     * @param {?} cd
     */
    constructor(cd) {
        super(cd);
        this.cd = cd;
        this.options = {};
        this.valueChanges$ = new Subject();
    }
    /**
     * @return {?}
     */
    get formlyOptions() {
        return Object.assign({ fieldChanges: this.valueChanges$ }, this.options);
    }
    /**
     * @return {?}
     */
    get submitTips() {
        if (!this.form.valid) {
            /** @type {?} */
            const fields = this.getFormErrorFields();
            /** @type {?} */
            const labels = [];
            fields.forEach(field => {
                /** @type {?} */
                const formlyField = this.formlyField(field);
                if (formlyField) {
                    /** @type {?} */
                    const label = formlyField.templateOptions && formlyField.templateOptions.label || field;
                    labels.push(label.replace(':', ''));
                }
            });
            return `请正确写以下信息️：${labels.join(',')}`;
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        super.ngOnInit();
        /** @type {?} */
        const valueChanges$ = this.options.fieldChanges || this.valueChanges$;
        if (this.valueChanges) {
            this.$subscriptions = valueChanges$.subscribe(event => {
                this.valueChanges(Object.assign({}, event, { formlyForm: this }));
            });
        }
    }
    /**
     * @param {?=} other
     * @return {?}
     */
    getEventContext(other) {
        return super.getEventContext({
            fields: this.fields,
            formOptions: this.options,
            formProps: this.formProps,
            formlyForm: this
        });
    }
    /**
     * @param {?} key
     * @return {?}
     */
    formlyField(key) {
        /** @type {?} */
        const props = this.fields.filter(prop => prop.key === key);
        return (props && props.length === 1) ? props[0] : undefined;
    }
}
FormlyFormComponent.decorators = [
    { type: Component, args: [{
                selector: 'er-formly-form',
                template: "<div [ngClass]=\"styleClass\" [ngStyle]=\"style\">\n  <ng-container *ngIf=\"header\">\n    <er-dyna-content [content]=\"header\"></er-dyna-content>\n  </ng-container>\n  <ng-container *ngIf=\"template(templateNames.header)\">\n    <ng-container *ngTemplateOutlet=\"template(templateNames.header);\n                                     context: getEventContext()\"></ng-container>\n  </ng-container>\n\n  <form [formGroup]=\"form\" [ngClass]=\"formStyleClass || 'mt-2'\" [ngStyle]=\"formStyle\" novalidate>\n    <formly-form [form]=\"form\"\n                 [options]=\"formlyOptions\"\n                 [(model)]=\"model\"\n                 [fields]=\"fields\"\n                 class=\"formly-form\">\n      <ng-content></ng-content>\n      <ng-container *ngTemplateOutlet=\"template(templateNames.buttons,default)\"></ng-container>\n    </formly-form>\n  </form>\n  <ng-container *ngIf=\"footer\">\n    <er-dyna-content [content]=\"footer\"></er-dyna-content>\n  </ng-container>\n  <ng-container *ngIf=\"template(templateNames.footer)\">\n    <ng-container *ngTemplateOutlet=\"template(templateNames.footer);\n                                     context: getEventContext()\"></ng-container>\n  </ng-container>\n</div>\n\n<ng-template #default>\n  <div [ngClass]=\"buttonsStyleClass\">\n    <er-button [stateKey]=\"formId\"\n               icon=\"fa fa-save\"\n               label=\"\u63D0&nbsp;&nbsp;&nbsp;\u4EA4\"\n               title=\"\u4FDD\u7559\u6570\u636E\u5230\u670D\u52A1\u7AEF\"\n               class=\"mr-2\"\n               type=\"button\"\n               [pTooltip]=\"submitTips\"\n               tooltipPosition=\"top\"\n               [tooltipDisabled]=\"form.valid\"\n               [disabled]=\"!form.valid\"\n               (onClick)=\"submit()\"\n               [styleClass]=\"submitBtnStyleClass\"\n    ></er-button>\n    <er-button icon=\"fa fa-circle-o\"\n               class=\"mr-2\"\n               label=\"\u91CD&nbsp;&nbsp;&nbsp;\u586B\"\n               title=\"\u6062\u590D\u5230\u4FEE\u6539\u524D\u7684\u72B6\u6001\"\n               [styleClass]=\"resetBtnStyleClass\"\n               (onClick)=\"resetModel()\">\n    </er-button>\n\n    <ng-container *ngFor=\"let btn of buttons\">\n      <er-button class=\"mr-2\" erPropsBind [props]=\"btn\" [context]=\"getEventContext(btn.context)\"></er-button>\n    </ng-container>\n\n  </div>\n</ng-template>\n"
            }] }
];
/** @nocollapse */
FormlyFormComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
FormlyFormComponent.propDecorators = {
    fields: [{ type: Input }],
    options: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    FormlyFormComponent.prototype.fields;
    /** @type {?} */
    FormlyFormComponent.prototype.options;
    /** @type {?} */
    FormlyFormComponent.prototype.formProps;
    /** @type {?} */
    FormlyFormComponent.prototype.valueChanges$;
    /**
     * @type {?}
     * @protected
     */
    FormlyFormComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL2Zvcm1seS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2Zvcm0vY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNsRSxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFJM0MsT0FBTyxFQUFDLE9BQU8sRUFBQyxNQUFNLE1BQU0sQ0FBQztBQU83QixNQUFNLE9BQU8sbUJBQW9CLFNBQVEsaUJBQWlCOzs7O0lBVXhELFlBQXNCLEVBQXFCO1FBQ3pDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztRQURVLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBTmxDLFlBQU8sR0FBc0IsRUFBRSxDQUFDO1FBSXpDLGtCQUFhLEdBQW9DLElBQUksT0FBTyxFQUFFLENBQUM7SUFJL0QsQ0FBQzs7OztJQUVELElBQUksYUFBYTtRQUNmLHVCQUNFLFlBQVksRUFBRSxJQUFJLENBQUMsYUFBYSxJQUM3QixJQUFJLENBQUMsT0FBTyxFQUNmO0lBQ0osQ0FBQzs7OztJQUVELElBQUksVUFBVTtRQUNaLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTs7a0JBQ2QsTUFBTSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsRUFBRTs7a0JBQ2xDLE1BQU0sR0FBRyxFQUFFO1lBQ2pCLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7O3NCQUNmLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQztnQkFDM0MsSUFBSSxXQUFXLEVBQUU7OzBCQUNULEtBQUssR0FBRyxXQUFXLENBQUMsZUFBZSxJQUFJLFdBQVcsQ0FBQyxlQUFlLENBQUMsS0FBSyxJQUFJLEtBQUs7b0JBQ3ZGLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztpQkFDckM7WUFDSCxDQUFDLENBQUMsQ0FBQztZQUNILE9BQU8sYUFBYSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7U0FDeEM7SUFDSCxDQUFDOzs7O0lBRUQsUUFBUTtRQUNOLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQzs7Y0FDWCxhQUFhLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLGFBQWE7UUFDckUsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxjQUFjLEdBQUcsYUFBYSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRTtnQkFDcEQsSUFBSSxDQUFDLFlBQVksbUJBQ1osS0FBSyxJQUNSLFVBQVUsRUFBRSxJQUFJLElBQ2hCLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQzs7Ozs7SUFFRCxlQUFlLENBQUMsS0FBTTtRQUNwQixPQUFPLEtBQUssQ0FBQyxlQUFlLENBQUM7WUFDM0IsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNO1lBQ25CLFdBQVcsRUFBRSxJQUFJLENBQUMsT0FBTztZQUN6QixTQUFTLEVBQUUsSUFBSSxDQUFDLFNBQVM7WUFDekIsVUFBVSxFQUFFLElBQUk7U0FDakIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs7Ozs7SUFFRCxXQUFXLENBQUMsR0FBRzs7Y0FDUCxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQztRQUMxRCxPQUFPLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0lBQzlELENBQUM7OztZQWpFRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGdCQUFnQjtnQkFDMUIsNjFFQUF1QjthQUN4Qjs7OztZQVhPLGlCQUFpQjs7O3FCQWN0QixLQUFLO3NCQUVMLEtBQUs7Ozs7SUFGTixxQ0FBdUM7O0lBRXZDLHNDQUF5Qzs7SUFFekMsd0NBQXFCOztJQUVyQiw0Q0FBK0Q7Ozs7O0lBRW5ELGlDQUErQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgSW5wdXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtCYXNlRm9ybUNvbXBvbmVudH0gZnJvbSAnQGVyL2NvcmUnO1xuaW1wb3J0IHtGb3JtUHJvcHN9IGZyb20gJ0Blci90eXBlcyc7XG5pbXBvcnQge0Zvcm1seUZvcm1PcHRpb25zfSBmcm9tICdAbmd4LWZvcm1seS9jb3JlJztcbmltcG9ydCB7Rm9ybWx5VmFsdWVDaGFuZ2VFdmVudH0gZnJvbSAnQG5neC1mb3JtbHkvY29yZS9saWIvY29tcG9uZW50cy9mb3JtbHkuZmllbGQuY29uZmlnJztcbmltcG9ydCB7U3ViamVjdH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge0VyRm9ybWx5RmllbGRDb25maWd9IGZyb20gJy4uLy4uL2Jhc2UvZmllbGQtY29uZmlnJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZXItZm9ybWx5LWZvcm0nLFxuICB0ZW1wbGF0ZVVybDogJ3RwbC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBGb3JtbHlGb3JtQ29tcG9uZW50IGV4dGVuZHMgQmFzZUZvcm1Db21wb25lbnQge1xuXG4gIEBJbnB1dCgpIGZpZWxkczogRXJGb3JtbHlGaWVsZENvbmZpZ1tdO1xuXG4gIEBJbnB1dCgpIG9wdGlvbnM6IEZvcm1seUZvcm1PcHRpb25zID0ge307XG5cbiAgZm9ybVByb3BzOiBGb3JtUHJvcHM7XG5cbiAgdmFsdWVDaGFuZ2VzJDogU3ViamVjdDxGb3JtbHlWYWx1ZUNoYW5nZUV2ZW50PiA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGNkOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgIHN1cGVyKGNkKTtcbiAgfVxuXG4gIGdldCBmb3JtbHlPcHRpb25zKCk6IEZvcm1seUZvcm1PcHRpb25zIHtcbiAgICByZXR1cm4ge1xuICAgICAgZmllbGRDaGFuZ2VzOiB0aGlzLnZhbHVlQ2hhbmdlcyQsXG4gICAgICAuLi50aGlzLm9wdGlvbnNcbiAgICB9O1xuICB9XG5cbiAgZ2V0IHN1Ym1pdFRpcHMoKSB7XG4gICAgaWYgKCF0aGlzLmZvcm0udmFsaWQpIHtcbiAgICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuZ2V0Rm9ybUVycm9yRmllbGRzKCk7XG4gICAgICBjb25zdCBsYWJlbHMgPSBbXTtcbiAgICAgIGZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHtcbiAgICAgICAgY29uc3QgZm9ybWx5RmllbGQgPSB0aGlzLmZvcm1seUZpZWxkKGZpZWxkKTtcbiAgICAgICAgaWYgKGZvcm1seUZpZWxkKSB7XG4gICAgICAgICAgY29uc3QgbGFiZWwgPSBmb3JtbHlGaWVsZC50ZW1wbGF0ZU9wdGlvbnMgJiYgZm9ybWx5RmllbGQudGVtcGxhdGVPcHRpb25zLmxhYmVsIHx8IGZpZWxkO1xuICAgICAgICAgIGxhYmVscy5wdXNoKGxhYmVsLnJlcGxhY2UoJzonLCAnJykpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBg6K+35q2j56Gu5YaZ5Lul5LiL5L+h5oGv77iP77yaJHtsYWJlbHMuam9pbignLCcpfWA7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgc3VwZXIubmdPbkluaXQoKTtcbiAgICBjb25zdCB2YWx1ZUNoYW5nZXMkID0gdGhpcy5vcHRpb25zLmZpZWxkQ2hhbmdlcyB8fCB0aGlzLnZhbHVlQ2hhbmdlcyQ7XG4gICAgaWYgKHRoaXMudmFsdWVDaGFuZ2VzKSB7XG4gICAgICB0aGlzLiRzdWJzY3JpcHRpb25zID0gdmFsdWVDaGFuZ2VzJC5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlcyh7XG4gICAgICAgICAgLi4uZXZlbnQsXG4gICAgICAgICAgZm9ybWx5Rm9ybTogdGhpc1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGdldEV2ZW50Q29udGV4dChvdGhlcj8pIHtcbiAgICByZXR1cm4gc3VwZXIuZ2V0RXZlbnRDb250ZXh0KHtcbiAgICAgIGZpZWxkczogdGhpcy5maWVsZHMsXG4gICAgICBmb3JtT3B0aW9uczogdGhpcy5vcHRpb25zLFxuICAgICAgZm9ybVByb3BzOiB0aGlzLmZvcm1Qcm9wcyxcbiAgICAgIGZvcm1seUZvcm06IHRoaXNcbiAgICB9KTtcbiAgfVxuXG4gIGZvcm1seUZpZWxkKGtleSkge1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5maWVsZHMuZmlsdGVyKHByb3AgPT4gcHJvcC5rZXkgPT09IGtleSk7XG4gICAgcmV0dXJuIChwcm9wcyAmJiBwcm9wcy5sZW5ndGggPT09IDEpID8gcHJvcHNbMF0gOiB1bmRlZmluZWQ7XG4gIH1cblxufVxuIl19