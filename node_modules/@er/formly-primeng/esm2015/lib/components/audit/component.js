/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input } from '@angular/core';
import { ApiUtils, AuthUtils, LogUtils } from '@er/core';
import { CommonsUtils, DateUtils, DialogUtils } from '@er/utils';
import { PngFormlyTypes } from '../../types/field-types';
import { PngFormlyUtils } from '../../utils';
import { PngFormlyFormComponent } from '../form/component';
export class PngFormlyAuditFormComponent extends PngFormlyFormComponent {
    constructor() {
        super(...arguments);
        this.buttonsStyleClass = 'text-center my-5';
        this.submitBtnStyleClass = 'btn btn-success';
        this.resetBtnStyleClass = 'btn btn-danger';
        this.initBtnStyleClass = 'btn btn-alert';
        this.backBtnStyleClass = 'btn btn-info';
    }
    /**
     * @param {?} formProps
     * @return {?}
     */
    resolveFormFields(formProps) {
        if (!formProps || !formProps['fields']) {
            LogUtils.error(this, '没有定义fields!', formProps);
            return;
        }
        if (!formProps.caption) {
            formProps.caption = `审核${formProps.entity.label}信息`;
        }
        formProps.fields.forEach(field => {
            field.type = PngFormlyTypes.value;
            PngFormlyUtils.resolveField(formProps, field, this);
        });
        /** @type {?} */
        const commentField = {
            key: 'comment',
            type: PngFormlyTypes.textArea,
            attrs: {
                placeholder: '请输入您的审核意见或备注'
            },
            templateOptions: {
                label: '审核意见',
                description: '审核不通过时，必须输入不通过的原因',
                minLength: 5
            }
        };
        PngFormlyUtils.resolveField(formProps, commentField, this);
        formProps.fields.push(commentField);
    }
    /**
     * @return {?}
     */
    onAccept() {
        /** @type {?} */
        const newState = this.saveAuditHis();
        ApiUtils.patchById(this.formlyForm.apiEntry, this.formlyForm.modelId, this.getSubmitData(newState), {
            tag: this.formlyForm.formId
        }).subscribe();
    }
    /**
     * @return {?}
     */
    onReject() {
        if (CommonsUtils.isEmpty(this.formlyForm.model['comment'])) {
            DialogUtils.error('操作无效', '请输入不通过的原因');
            return;
        }
        ApiUtils.patchById(this.formlyForm.apiEntry, this.formlyForm.modelId, this.getSubmitData(-1), {
            tag: this.formlyForm.formId
        }).subscribe();
    }
    /**
     * @param {?} state
     * @return {?}
     */
    getSubmitData(state) {
        return {
            audit: {
                state: state,
                auditComment: this.formlyForm.model['comment'],
                auditDate: DateUtils.getFormattedDate(),
                auditorName: AuthUtils.getCurrentUser().fullName,
                auditorId: AuthUtils.getCurrentUser().id
            }
        };
    }
    /**
     * @private
     * @return {?}
     */
    saveAuditHis() {
        /** @type {?} */
        const audit = this.formlyForm.model['audit'];
        if (audit) {
            /** @type {?} */
            const data = this.formlyForm.model;
            delete data['id'];
            ApiUtils.save(`${this.formlyForm.apiEntry}-audit-his`, data, {
                tag: this.formlyForm.formId
            }).subscribe();
            return ++audit['state'];
        }
        return 1;
    }
}
PngFormlyAuditFormComponent.decorators = [
    { type: Component, args: [{
                selector: 'png-formly-audit-form',
                template: `
    <png-panel [header]="formProps.caption"
               [footer]="formProps.footer"
               [icon]="formProps.icon"
               [toggleable]="formProps.collapsable"
    >
      <er-formly-form
        class="mt-2"
        erPropsBind
        [props]="formProps"
        [beforeSubmit]="beforeSubmit"
        [afterSubmit]="afterSubmit"
      >
        <ng-template erTypedTemplate="buttons">
          <div [ngClass]="buttonsStyleClass">
            <er-button [stateKey]="formlyForm.formId"
                       icon="fa fa-check"
                       label="通&nbsp;&nbsp;&nbsp;过"
                       title="保留数据到服务端"
                       class="mr-2"
                       type="button"
                       [disabled]="!formlyForm.form.valid"
                       [styleClass]="submitBtnStyleClass"
                       (onClick)="onAccept()"
            ></er-button>
            <er-button icon="fa fa-close"
                       class="ml-4"
                       label="不&nbsp;&nbsp;&nbsp;通&nbsp;&nbsp;&nbsp;过"
                       title="恢复到修改前的状态"
                       [styleClass]="resetBtnStyleClass"
                       (onClick)="onReject()"
            >
            </er-button>
          </div>

        </ng-template>
      </er-formly-form>
    </png-panel>

  `
            }] }
];
PngFormlyAuditFormComponent.propDecorators = {
    buttonsStyleClass: [{ type: Input }],
    submitBtnStyleClass: [{ type: Input }],
    resetBtnStyleClass: [{ type: Input }],
    initBtnStyleClass: [{ type: Input }],
    backBtnStyleClass: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    PngFormlyAuditFormComponent.prototype.buttonsStyleClass;
    /** @type {?} */
    PngFormlyAuditFormComponent.prototype.submitBtnStyleClass;
    /** @type {?} */
    PngFormlyAuditFormComponent.prototype.resetBtnStyleClass;
    /** @type {?} */
    PngFormlyAuditFormComponent.prototype.initBtnStyleClass;
    /** @type {?} */
    PngFormlyAuditFormComponent.prototype.backBtnStyleClass;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL2Zvcm1seS1wcmltZW5nLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYXVkaXQvY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLEtBQUssRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUMvQyxPQUFPLEVBQUMsUUFBUSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFHdkQsT0FBTyxFQUFDLFlBQVksRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQy9ELE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSx5QkFBeUIsQ0FBQztBQUN2RCxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sYUFBYSxDQUFDO0FBQzNDLE9BQU8sRUFBQyxzQkFBc0IsRUFBQyxNQUFNLG1CQUFtQixDQUFDO0FBNkN6RCxNQUFNLE9BQU8sMkJBQTRCLFNBQVEsc0JBQXNCO0lBM0N2RTs7UUE2Q1csc0JBQWlCLEdBQVEsa0JBQWtCLENBQUM7UUFFNUMsd0JBQW1CLEdBQVEsaUJBQWlCLENBQUM7UUFFN0MsdUJBQWtCLEdBQVEsZ0JBQWdCLENBQUM7UUFFM0Msc0JBQWlCLEdBQVEsZUFBZSxDQUFDO1FBRXpDLHNCQUFpQixHQUFRLGNBQWMsQ0FBQztJQXdFbkQsQ0FBQzs7Ozs7SUF0RUMsaUJBQWlCLENBQUMsU0FBb0I7UUFDcEMsSUFBSSxDQUFDLFNBQVMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUN0QyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxhQUFhLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDL0MsT0FBTztTQUNSO1FBQ0QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUU7WUFDdEIsU0FBUyxDQUFDLE9BQU8sR0FBRyxLQUFLLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxJQUFJLENBQUM7U0FDckQ7UUFDRCxTQUFTLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUMvQixLQUFLLENBQUMsSUFBSSxHQUFHLGNBQWMsQ0FBQyxLQUFLLENBQUM7WUFDbEMsY0FBYyxDQUFDLFlBQVksQ0FBQyxTQUFTLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3RELENBQUMsQ0FBQyxDQUFDOztjQUNHLFlBQVksR0FBd0I7WUFDeEMsR0FBRyxFQUFFLFNBQVM7WUFDZCxJQUFJLEVBQUUsY0FBYyxDQUFDLFFBQVE7WUFDN0IsS0FBSyxFQUFFO2dCQUNMLFdBQVcsRUFBRSxjQUFjO2FBQzVCO1lBQ0QsZUFBZSxFQUFFO2dCQUNmLEtBQUssRUFBRSxNQUFNO2dCQUNiLFdBQVcsRUFBRSxtQkFBbUI7Z0JBQ2hDLFNBQVMsRUFBRSxDQUFDO2FBQ2I7U0FDRjtRQUNELGNBQWMsQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFLFlBQVksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMzRCxTQUFTLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUN0QyxDQUFDOzs7O0lBRUQsUUFBUTs7Y0FDQSxRQUFRLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRTtRQUNwQyxRQUFRLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDbEcsR0FBRyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTTtTQUM1QixDQUFDLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDakIsQ0FBQzs7OztJQUVELFFBQVE7UUFDTixJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRTtZQUMxRCxXQUFXLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQztZQUN2QyxPQUFPO1NBQ1I7UUFDRCxRQUFRLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUM1RixHQUFHLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNO1NBQzVCLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNqQixDQUFDOzs7OztJQUVELGFBQWEsQ0FBQyxLQUFLO1FBQ2pCLE9BQU87WUFDTCxLQUFLLEVBQUU7Z0JBQ0wsS0FBSyxFQUFFLEtBQUs7Z0JBQ1osWUFBWSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQztnQkFDOUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxnQkFBZ0IsRUFBRTtnQkFDdkMsV0FBVyxFQUFFLFNBQVMsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxRQUFRO2dCQUNoRCxTQUFTLEVBQUUsU0FBUyxDQUFDLGNBQWMsRUFBRSxDQUFDLEVBQUU7YUFDekM7U0FDRixDQUFDO0lBQ0osQ0FBQzs7Ozs7SUFHTyxZQUFZOztjQUNaLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUM7UUFDNUMsSUFBSSxLQUFLLEVBQUU7O2tCQUNILElBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUs7WUFDbEMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEIsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxZQUFZLEVBQUUsSUFBSSxFQUFFO2dCQUMzRCxHQUFHLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNO2FBQzVCLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNmLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDekI7UUFDRCxPQUFPLENBQUMsQ0FBQztJQUNYLENBQUM7OztZQTVIRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLHVCQUF1QjtnQkFDakMsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F1Q1Q7YUFDRjs7O2dDQUdFLEtBQUs7a0NBRUwsS0FBSztpQ0FFTCxLQUFLO2dDQUVMLEtBQUs7Z0NBRUwsS0FBSzs7OztJQVJOLHdEQUFxRDs7SUFFckQsMERBQXNEOztJQUV0RCx5REFBb0Q7O0lBRXBELHdEQUFrRDs7SUFFbEQsd0RBQWlEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIElucHV0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7QXBpVXRpbHMsIEF1dGhVdGlscywgTG9nVXRpbHN9IGZyb20gJ0Blci9jb3JlJztcbmltcG9ydCB7RXJGb3JtbHlGaWVsZENvbmZpZ30gZnJvbSAnQGVyL2Zvcm1seSc7XG5pbXBvcnQge0Zvcm1Qcm9wc30gZnJvbSAnQGVyL3R5cGVzJztcbmltcG9ydCB7Q29tbW9uc1V0aWxzLCBEYXRlVXRpbHMsIERpYWxvZ1V0aWxzfSBmcm9tICdAZXIvdXRpbHMnO1xuaW1wb3J0IHtQbmdGb3JtbHlUeXBlc30gZnJvbSAnLi4vLi4vdHlwZXMvZmllbGQtdHlwZXMnO1xuaW1wb3J0IHtQbmdGb3JtbHlVdGlsc30gZnJvbSAnLi4vLi4vdXRpbHMnO1xuaW1wb3J0IHtQbmdGb3JtbHlGb3JtQ29tcG9uZW50fSBmcm9tICcuLi9mb3JtL2NvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BuZy1mb3JtbHktYXVkaXQtZm9ybScsXG4gIHRlbXBsYXRlOiBgXG4gICAgPHBuZy1wYW5lbCBbaGVhZGVyXT1cImZvcm1Qcm9wcy5jYXB0aW9uXCJcbiAgICAgICAgICAgICAgIFtmb290ZXJdPVwiZm9ybVByb3BzLmZvb3RlclwiXG4gICAgICAgICAgICAgICBbaWNvbl09XCJmb3JtUHJvcHMuaWNvblwiXG4gICAgICAgICAgICAgICBbdG9nZ2xlYWJsZV09XCJmb3JtUHJvcHMuY29sbGFwc2FibGVcIlxuICAgID5cbiAgICAgIDxlci1mb3JtbHktZm9ybVxuICAgICAgICBjbGFzcz1cIm10LTJcIlxuICAgICAgICBlclByb3BzQmluZFxuICAgICAgICBbcHJvcHNdPVwiZm9ybVByb3BzXCJcbiAgICAgICAgW2JlZm9yZVN1Ym1pdF09XCJiZWZvcmVTdWJtaXRcIlxuICAgICAgICBbYWZ0ZXJTdWJtaXRdPVwiYWZ0ZXJTdWJtaXRcIlxuICAgICAgPlxuICAgICAgICA8bmctdGVtcGxhdGUgZXJUeXBlZFRlbXBsYXRlPVwiYnV0dG9uc1wiPlxuICAgICAgICAgIDxkaXYgW25nQ2xhc3NdPVwiYnV0dG9uc1N0eWxlQ2xhc3NcIj5cbiAgICAgICAgICAgIDxlci1idXR0b24gW3N0YXRlS2V5XT1cImZvcm1seUZvcm0uZm9ybUlkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgaWNvbj1cImZhIGZhLWNoZWNrXCJcbiAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9XCLpgJombmJzcDsmbmJzcDsmbmJzcDvov4dcIlxuICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT1cIuS/neeVmeaVsOaNruWIsOacjeWKoeerr1wiXG4gICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVwibXItMlwiXG4gICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICAgICAgICAgICAgICBbZGlzYWJsZWRdPVwiIWZvcm1seUZvcm0uZm9ybS52YWxpZFwiXG4gICAgICAgICAgICAgICAgICAgICAgIFtzdHlsZUNsYXNzXT1cInN1Ym1pdEJ0blN0eWxlQ2xhc3NcIlxuICAgICAgICAgICAgICAgICAgICAgICAob25DbGljayk9XCJvbkFjY2VwdCgpXCJcbiAgICAgICAgICAgID48L2VyLWJ1dHRvbj5cbiAgICAgICAgICAgIDxlci1idXR0b24gaWNvbj1cImZhIGZhLWNsb3NlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9XCJtbC00XCJcbiAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9XCLkuI0mbmJzcDsmbmJzcDsmbmJzcDvpgJombmJzcDsmbmJzcDsmbmJzcDvov4dcIlxuICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT1cIuaBouWkjeWIsOS/ruaUueWJjeeahOeKtuaAgVwiXG4gICAgICAgICAgICAgICAgICAgICAgIFtzdHlsZUNsYXNzXT1cInJlc2V0QnRuU3R5bGVDbGFzc1wiXG4gICAgICAgICAgICAgICAgICAgICAgIChvbkNsaWNrKT1cIm9uUmVqZWN0KClcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgPC9lci1idXR0b24+XG4gICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgIDwvZXItZm9ybWx5LWZvcm0+XG4gICAgPC9wbmctcGFuZWw+XG5cbiAgYFxufSlcbmV4cG9ydCBjbGFzcyBQbmdGb3JtbHlBdWRpdEZvcm1Db21wb25lbnQgZXh0ZW5kcyBQbmdGb3JtbHlGb3JtQ29tcG9uZW50IHtcblxuICBASW5wdXQoKSBidXR0b25zU3R5bGVDbGFzczogYW55ID0gJ3RleHQtY2VudGVyIG15LTUnO1xuXG4gIEBJbnB1dCgpIHN1Ym1pdEJ0blN0eWxlQ2xhc3M6IGFueSA9ICdidG4gYnRuLXN1Y2Nlc3MnO1xuXG4gIEBJbnB1dCgpIHJlc2V0QnRuU3R5bGVDbGFzczogYW55ID0gJ2J0biBidG4tZGFuZ2VyJztcblxuICBASW5wdXQoKSBpbml0QnRuU3R5bGVDbGFzczogYW55ID0gJ2J0biBidG4tYWxlcnQnO1xuXG4gIEBJbnB1dCgpIGJhY2tCdG5TdHlsZUNsYXNzOiBhbnkgPSAnYnRuIGJ0bi1pbmZvJztcblxuICByZXNvbHZlRm9ybUZpZWxkcyhmb3JtUHJvcHM6IEZvcm1Qcm9wcykge1xuICAgIGlmICghZm9ybVByb3BzIHx8ICFmb3JtUHJvcHNbJ2ZpZWxkcyddKSB7XG4gICAgICBMb2dVdGlscy5lcnJvcih0aGlzLCAn5rKh5pyJ5a6a5LmJZmllbGRzIScsIGZvcm1Qcm9wcyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghZm9ybVByb3BzLmNhcHRpb24pIHtcbiAgICAgIGZvcm1Qcm9wcy5jYXB0aW9uID0gYOWuoeaguCR7Zm9ybVByb3BzLmVudGl0eS5sYWJlbH3kv6Hmga9gO1xuICAgIH1cbiAgICBmb3JtUHJvcHMuZmllbGRzLmZvckVhY2goZmllbGQgPT4ge1xuICAgICAgZmllbGQudHlwZSA9IFBuZ0Zvcm1seVR5cGVzLnZhbHVlO1xuICAgICAgUG5nRm9ybWx5VXRpbHMucmVzb2x2ZUZpZWxkKGZvcm1Qcm9wcywgZmllbGQsIHRoaXMpO1xuICAgIH0pO1xuICAgIGNvbnN0IGNvbW1lbnRGaWVsZDogRXJGb3JtbHlGaWVsZENvbmZpZyA9IHtcbiAgICAgIGtleTogJ2NvbW1lbnQnLFxuICAgICAgdHlwZTogUG5nRm9ybWx5VHlwZXMudGV4dEFyZWEsXG4gICAgICBhdHRyczoge1xuICAgICAgICBwbGFjZWhvbGRlcjogJ+ivt+i+k+WFpeaCqOeahOWuoeaguOaEj+ingeaIluWkh+azqCdcbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZU9wdGlvbnM6IHtcbiAgICAgICAgbGFiZWw6ICflrqHmoLjmhI/op4EnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ+WuoeaguOS4jemAmui/h+aXtu+8jOW/hemhu+i+k+WFpeS4jemAmui/h+eahOWOn+WboCcsXG4gICAgICAgIG1pbkxlbmd0aDogNVxuICAgICAgfVxuICAgIH07XG4gICAgUG5nRm9ybWx5VXRpbHMucmVzb2x2ZUZpZWxkKGZvcm1Qcm9wcywgY29tbWVudEZpZWxkLCB0aGlzKTtcbiAgICBmb3JtUHJvcHMuZmllbGRzLnB1c2goY29tbWVudEZpZWxkKTtcbiAgfVxuXG4gIG9uQWNjZXB0KCkge1xuICAgIGNvbnN0IG5ld1N0YXRlID0gdGhpcy5zYXZlQXVkaXRIaXMoKTtcbiAgICBBcGlVdGlscy5wYXRjaEJ5SWQodGhpcy5mb3JtbHlGb3JtLmFwaUVudHJ5LCB0aGlzLmZvcm1seUZvcm0ubW9kZWxJZCwgdGhpcy5nZXRTdWJtaXREYXRhKG5ld1N0YXRlKSwge1xuICAgICAgdGFnOiB0aGlzLmZvcm1seUZvcm0uZm9ybUlkXG4gICAgfSkuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBvblJlamVjdCgpIHtcbiAgICBpZiAoQ29tbW9uc1V0aWxzLmlzRW1wdHkodGhpcy5mb3JtbHlGb3JtLm1vZGVsWydjb21tZW50J10pKSB7XG4gICAgICBEaWFsb2dVdGlscy5lcnJvcign5pON5L2c5peg5pWIJywgJ+ivt+i+k+WFpeS4jemAmui/h+eahOWOn+WboCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBBcGlVdGlscy5wYXRjaEJ5SWQodGhpcy5mb3JtbHlGb3JtLmFwaUVudHJ5LCB0aGlzLmZvcm1seUZvcm0ubW9kZWxJZCwgdGhpcy5nZXRTdWJtaXREYXRhKC0xKSwge1xuICAgICAgdGFnOiB0aGlzLmZvcm1seUZvcm0uZm9ybUlkXG4gICAgfSkuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBnZXRTdWJtaXREYXRhKHN0YXRlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGF1ZGl0OiB7XG4gICAgICAgIHN0YXRlOiBzdGF0ZSxcbiAgICAgICAgYXVkaXRDb21tZW50OiB0aGlzLmZvcm1seUZvcm0ubW9kZWxbJ2NvbW1lbnQnXSxcbiAgICAgICAgYXVkaXREYXRlOiBEYXRlVXRpbHMuZ2V0Rm9ybWF0dGVkRGF0ZSgpLFxuICAgICAgICBhdWRpdG9yTmFtZTogQXV0aFV0aWxzLmdldEN1cnJlbnRVc2VyKCkuZnVsbE5hbWUsXG4gICAgICAgIGF1ZGl0b3JJZDogQXV0aFV0aWxzLmdldEN1cnJlbnRVc2VyKCkuaWRcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cblxuICBwcml2YXRlIHNhdmVBdWRpdEhpcygpOiBudW1iZXIge1xuICAgIGNvbnN0IGF1ZGl0ID0gdGhpcy5mb3JtbHlGb3JtLm1vZGVsWydhdWRpdCddO1xuICAgIGlmIChhdWRpdCkge1xuICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZm9ybWx5Rm9ybS5tb2RlbDtcbiAgICAgIGRlbGV0ZSBkYXRhWydpZCddO1xuICAgICAgQXBpVXRpbHMuc2F2ZShgJHt0aGlzLmZvcm1seUZvcm0uYXBpRW50cnl9LWF1ZGl0LWhpc2AsIGRhdGEsIHtcbiAgICAgICAgdGFnOiB0aGlzLmZvcm1seUZvcm0uZm9ybUlkXG4gICAgICB9KS5zdWJzY3JpYmUoKTtcbiAgICAgIHJldHVybiArK2F1ZGl0WydzdGF0ZSddO1xuICAgIH1cbiAgICByZXR1cm4gMTtcbiAgfVxufVxuIl19