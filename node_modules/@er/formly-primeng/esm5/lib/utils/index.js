/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { DataFieldUtils } from '@er/core';
import { DataAttr, DataType } from '@er/types';
import { CommonsUtils, ConfigUtils, DateUtils, DialogUtils, IdUtils } from '@er/utils';
import { NgValidators } from '@er/validate';
import { PngFormlyTypes } from '../types/field-types';
var PngFormlyUtils = /** @class */ (function () {
    function PngFormlyUtils() {
    }
    /**
     * @param {?} formProps
     * @param {?} field
     * @param {?=} formlyForm
     * @return {?}
     */
    PngFormlyUtils.resolveField = /**
     * @param {?} formProps
     * @param {?} field
     * @param {?=} formlyForm
     * @return {?}
     */
    function (formProps, field, formlyForm) {
        if (formProps) {
            field.formProps = formProps;
        }
        if (formlyForm) {
            field.formlyForm = formlyForm;
        }
        field.className = field.className || '' + 'formly-field';
        PngFormlyUtils.resolveDataField(formProps, field, formlyForm);
    };
    /**
     * @param {?} apiEntry
     * @param {?} fieldName
     * @param {?=} query
     * @param {?=} selectable
     * @return {?}
     */
    PngFormlyUtils.distinctSuggestProps = /**
     * @param {?} apiEntry
     * @param {?} fieldName
     * @param {?=} query
     * @param {?=} selectable
     * @return {?}
     */
    function (apiEntry, fieldName, query, selectable) {
        if (selectable === void 0) { selectable = false; }
        /** @type {?} */
        var props = {
            type: PngFormlyTypes.autoComplete,
            props: (/** @type {?} */ ({
                minLength: 1,
                size: 5,
                forceSelection: false,
                dropdown: false,
                placeholder: '请输入唯一的代码值',
                onSelect: function (ctx) {
                    if (!selectable) {
                        DialogUtils.error('无效操作', '该值已经存在，不能选择');
                        setTimeout(function () { return ctx.field.formControl.reset(); });
                    }
                },
                $ext: {
                    apiDataProps: (/** @type {?} */ ({
                        apiEntry: apiEntry,
                        query: query,
                        searchFields: fieldName,
                        withTerm: true
                    })),
                    dataItemProps: {
                        template: function (item) { return "<span title=\"\u8BE5\u503C\u5DF2\u7ECF\u5B58\u5728\uFF0C\u4E0D\u53EF\u7528\"><del>" + item[fieldName] + "</del></span> "; }
                    }
                }
            })),
            templateOptions: {
                required: false,
                description: '<span class="text-danger">内容必须唯一，可以不填，不填时系统自动生成</span>'
            }
        };
        return props;
    };
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    PngFormlyUtils.resolveValidators = /**
     * @private
     * @param {?} field
     * @return {?}
     */
    function (field) {
        if (field.validators) {
            /** @type {?} */
            var validates = field.validators;
            field.validators = {};
            if (CommonsUtils.isFunction(validates)) {
                field.validators.validation = [validates];
            }
            else if (CommonsUtils.isArray(validates)) {
                field.validators.validation = validates;
            }
            else {
                field.validators = validates;
            }
        }
        if (field.validations) {
            if (field.validators && field.validators['validation']) {
                field.validators.validation = tslib_1.__assign({}, field.validators.validation, field.validations);
            }
            else if (field.validators) {
                field.validators = tslib_1.__assign({}, field.validators, { validation: field.validations });
            }
            else {
                field.validators = {};
                field.validators.validation = field.validations;
            }
            delete field.validations;
        }
    };
    /**
     * @private
     * @param {?} dataField
     * @param {?} field
     * @return {?}
     */
    PngFormlyUtils.resolveBasic = /**
     * @private
     * @param {?} dataField
     * @param {?} field
     * @return {?}
     */
    function (dataField, field) {
        field.key = field.key || dataField.key;
        if (dataField.hidden) {
            field.hide = true;
        }
        if (dataField.defaultValue !== undefined) {
            field.defaultValue = dataField.defaultValue;
        }
        switch (dataField.dataAttr) {
            case DataAttr.CURRENCY:
                field.dataType = DataType.NUMBER;
                field.defaultValue = 0;
                break;
            case DataAttr.TEXT:
                field.type = PngFormlyTypes.textArea;
                break;
            case DataAttr.DISTINCT:
                Object.assign(field, PngFormlyUtils.distinctSuggestProps(field.apiEntry, field.key));
                break;
        }
        if (!field.type) {
            switch (dataField.dataType) {
                case DataType.STRING:
                    field.type = PngFormlyTypes.input;
                    break;
                case DataType.BOOLEAN:
                    field.type = PngFormlyTypes.switch;
                    break;
                case DataType.NUMBER:
                    field.type = PngFormlyTypes.spinner;
                    break;
                case DataType.DATE:
                    field.type = PngFormlyTypes.calendar;
                    break;
                default:
                    field.type = PngFormlyTypes.input;
            }
        }
    };
    /**
     * @private
     * @param {?} dataField
     * @param {?} field
     * @return {?}
     */
    PngFormlyUtils.resolveProps = /**
     * @private
     * @param {?} dataField
     * @param {?} field
     * @return {?}
     */
    function (dataField, field) {
        /** @type {?} */
        var props = {
            $ext: {}
        };
        if (dataField.dataItems) {
            props.$ext['dataItems'] = dataField.dataItems;
        }
        if (dataField.apiDataProps) {
            props.$ext['apiDataProps'] = dataField.apiDataProps;
        }
        if (dataField.dataItemProps) {
            props.$ext['dataItemProps'] = dataField.dataItemProps;
        }
        if (dataField.dataAttr === DataAttr.DATA_CODE) {
            props['dataKey'] = ConfigUtils.getConfig().dataFieldProps.dataCode.codeKey;
        }
        if (dataField.dataItems) {
            props.$ext['dataItems'] = dataField.dataItems;
        }
        switch (dataField.dataAttr) {
            case DataAttr.DATE_TIME:
                Object.assign(props, (/** @type {?} */ ({
                    dateFormat: 'yy-mm-dd hh:mm',
                    monthNavigator: true,
                    yearNavigator: true,
                    showTime: true
                })));
                break;
            case DataAttr.DATE:
                Object.assign(props, (/** @type {?} */ ({
                    dateFormat: 'yy-mm-dd',
                    monthNavigator: true,
                    yearNavigator: true
                })));
                break;
            case DataAttr.TIME:
                Object.assign(props, (/** @type {?} */ ({
                    timeOnly: true
                })));
                break;
            case DataAttr.MONTH:
                Object.assign(props, (/** @type {?} */ ({
                    view: 'month',
                    dateFormat: 'yy-mm',
                    yearNavigator: true,
                    monthNavigator: true,
                    yearRange: '2000:2020'
                })));
                break;
        }
        field.props = CommonsUtils.defaults(field.props, props);
    };
    /**
     * @private
     * @param {?} dataField
     * @param {?} field
     * @return {?}
     */
    PngFormlyUtils.resolveAttrs = /**
     * @private
     * @param {?} dataField
     * @param {?} field
     * @return {?}
     */
    function (dataField, field) {
        /** @type {?} */
        var attrs = {};
        switch (dataField.dataAttr) {
            case DataAttr.CURRENCY:
                CommonsUtils.set(attrs, '$ext.inputRule', 'pnum');
                CommonsUtils.set(attrs, '$ext.postText', '￥');
                break;
            case DataAttr.PHONE:
                CommonsUtils.set(attrs, '$ext.inputRule', 'pint');
                CommonsUtils.set(attrs, '$ext.preIcon', 'fa fa-phone');
                break;
            case DataAttr.ID_CARD:
                CommonsUtils.set(attrs, '$ext.inputRule', /[0-9]|X|x/);
                CommonsUtils.set(attrs, '$ext.preIcon', 'fa fa-id-card');
                break;
            case DataAttr.QQ:
                CommonsUtils.set(attrs, '$ext.inputRule', 'pint');
                CommonsUtils.set(attrs, '$ext.preIcon', 'fa fa-qq');
                break;
            case DataAttr.WE_CHAT:
                CommonsUtils.set(attrs, '$ext.inputRule', 'pint');
                CommonsUtils.set(attrs, '$ext.preIcon', 'fa fa-wechat');
                break;
            case DataAttr.EMAIL:
                CommonsUtils.set(attrs, '$ext.preText', '@');
                break;
            case DataAttr.URL:
                CommonsUtils.set(attrs, '$ext.preText', 'http://');
                break;
        }
        field.attrs = CommonsUtils.defaults(field.attrs, attrs);
    };
    /**
     * @private
     * @param {?} dataField
     * @param {?} field
     * @return {?}
     */
    PngFormlyUtils.resolveTemplateOptions = /**
     * @private
     * @param {?} dataField
     * @param {?} field
     * @return {?}
     */
    function (dataField, field) {
        /** @type {?} */
        var options = {};
        options.label = dataField.label + ":";
        if (dataField.required) {
            options.required = true;
        }
        if (dataField.description) {
            options.description = dataField.description;
        }
        if (dataField.placeholder) {
            options.placeholder = dataField.placeholder;
        }
        if (dataField.disabled) {
            options.disabled = dataField.disabled;
        }
        field.templateOptions = CommonsUtils.defaults(field.templateOptions, options);
    };
    /**
     * @private
     * @param {?} dataField
     * @param {?} field
     * @return {?}
     */
    PngFormlyUtils.resolveValidations = /**
     * @private
     * @param {?} dataField
     * @param {?} field
     * @return {?}
     */
    function (dataField, field) {
        /** @type {?} */
        var validations = [];
        if (dataField.maxLength) {
            validations.push(NgValidators.maxLength(dataField.maxLength));
        }
        if (dataField.minLength) {
            validations.push(NgValidators.minLength(dataField.minLength));
        }
        if (dataField.max) {
            validations.push(NgValidators.max(dataField.max));
        }
        if (dataField.min) {
            validations.push(NgValidators.min(dataField.min));
        }
        if (dataField.pattern) {
            validations.push(NgValidators.pattern(dataField.pattern));
        }
        if (dataField.dataAttr === DataAttr.ID_CARD) {
            validations.push(NgValidators.idCard);
        }
        if (validations.length > 0) {
            field.validations = validations;
        }
    };
    /**
     * @private
     * @param {?} dataField
     * @param {?} field
     * @return {?}
     */
    PngFormlyUtils.resolveParsers = /**
     * @private
     * @param {?} dataField
     * @param {?} field
     * @return {?}
     */
    function (dataField, field) {
        field.parsers = CommonsUtils.getArrayValue(dataField.parsers) || [];
        /** @type {?} */
        var parser;
        switch (dataField.dataAttr) {
            case DataAttr.CURRENCY:
                parser = function (val) { return val ? Number(val) : val; };
                break;
            case DataAttr.DATE:
                parser = function (val) { return val ? DateUtils.getFormattedDate(val, 'YYYY-MM-DD') : val; };
                break;
            case DataAttr.DATE_TIME:
                parser = function (val) { return val ? DateUtils.getFormattedDate(val, 'YYYY-MM-DD HH:mm:ss') : val; };
                break;
            case DataAttr.TIME:
                parser = function (val) { return val ? DateUtils.getFormattedDate(val, 'HH:mm:ss') : val; };
                break;
            case DataAttr.YEAR:
                parser = function (val) { return val ? DateUtils.getFormattedDate(val, 'YYYY') : val; };
                break;
            case DataAttr.MONTH:
                parser = function (val) { return val ? DateUtils.getFormattedDate(val, 'YYYY-MM') : val; };
                break;
            case DataAttr.PERCENT:
                parser = function (val) { return val ? Number(val) / 100 : val; };
                break;
            case DataAttr.ID_CARD:
                parser = function (val) { return val ? val.toUpperCase() : val; };
                break;
        }
        /** @type {?} */
        var parsers = CommonsUtils.getArrayValue(dataField.parsers) || [];
        if (parser) {
            parsers.push(function (val) {
                try {
                    return parser(val);
                }
                catch (e) {
                    return undefined;
                }
            });
        }
        if (parsers.length > 0) {
            field.parsers = parsers;
        }
    };
    /**
     * @private
     * @param {?} formProps
     * @param {?} field
     * @param {?=} formlyForm
     * @return {?}
     */
    PngFormlyUtils.resolveDataField = /**
     * @private
     * @param {?} formProps
     * @param {?} field
     * @param {?=} formlyForm
     * @return {?}
     */
    function (formProps, field, formlyForm) {
        if (field.fieldArray) {
            if (field.wrappers) {
                field.wrappers = CommonsUtils.getArrayValue(field.wrappers);
            }
            PngFormlyUtils.resolveField(function () { return formProps; }, field.fieldArray, function () { return formlyForm; }); // bind latter
        }
        else if (field.fieldGroup) {
            if (field.wrappers) {
                field.wrappers = CommonsUtils.getArrayValue(field.wrappers);
            }
            field.fieldGroup.forEach(function (aField) {
                if (field.templateOptions && field.templateOptions.landscape) {
                    CommonsUtils.set((/** @type {?} */ (aField)), 'templateOptions.landscape', field.templateOptions.landscape);
                }
                PngFormlyUtils.resolveField(formProps, aField, formlyForm);
            });
        }
        else {
            /** @type {?} */
            var dataField = field.dataField;
            if (field.template) {
                field.type = 'formly-template';
            }
            if (field.type === PngFormlyTypes.dyna) {
                Object.defineProperty(field, 'key', {
                    value: "$_" + IdUtils.getRandom(),
                    enumerable: false
                });
                // field.key = `$_${IdUtils.getRandom()}`;
            }
            if (!dataField) {
                if (!field.type) {
                    field.type = PngFormlyTypes.input;
                }
                if (field.parsers) {
                    field.parsers = CommonsUtils.getArrayValue(field.parsers);
                }
                PngFormlyUtils.resolveValidators(field);
                return;
            }
            dataField = CommonsUtils.merge(DataFieldUtils.getFieldDefaultProps(dataField), dataField);
            field.dataField = dataField;
            if (field.type && field.type === PngFormlyTypes.value) {
                field.key = field.key || field.dataField.key;
                CommonsUtils.set((/** @type {?} */ (field)), 'templateOptions.label', field.dataField.label);
                return field;
            }
            /** @type {?} */
            var resolvedField = {};
            PngFormlyUtils.resolveBasic(dataField, resolvedField);
            PngFormlyUtils.resolveProps(dataField, resolvedField);
            PngFormlyUtils.resolveAttrs(dataField, resolvedField);
            PngFormlyUtils.resolveTemplateOptions(dataField, resolvedField);
            PngFormlyUtils.resolveValidations(dataField, resolvedField);
            CommonsUtils.defaults(field, resolvedField);
            if (field.type === PngFormlyTypes.input) {
                if (field.props['$ext'].apiDataProps) {
                    field.type = PngFormlyTypes.autoComplete;
                }
                if (dataField.length) {
                    CommonsUtils.set((/** @type {?} */ (field)), 'attrs.size', dataField.length);
                }
            }
            /** @type {?} */
            var apiDataProps = CommonsUtils.get(field, 'props.$ext.apiDataProps');
            if (apiDataProps) {
                if (!apiDataProps.apiEntry) {
                    apiDataProps['apiEntry'] = formProps.apiEntry || formProps.entity && formProps.entity.apiEntry;
                }
                if (!apiDataProps.dataPath) {
                    apiDataProps['dataPath'] = 'items';
                }
            }
            PngFormlyUtils.resolveParsers(dataField, resolvedField);
            if (resolvedField.parsers) {
                field.parsers = field.parsers || [];
                field.parsers = field.parsers.concat(resolvedField.parsers);
            }
            PngFormlyUtils.resolveValidators(field);
        }
    };
    return PngFormlyUtils;
}());
export { PngFormlyUtils };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZXIvZm9ybWx5LXByaW1lbmcvIiwic291cmNlcyI6WyJsaWIvdXRpbHMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sVUFBVSxDQUFDO0FBR3hDLE9BQU8sRUFBZSxRQUFRLEVBQUUsUUFBUSxFQUFZLE1BQU0sV0FBVyxDQUFDO0FBQ3RFLE9BQU8sRUFBQyxZQUFZLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQ3JGLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxjQUFjLENBQUM7QUFDMUMsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBRXBEO0lBQUE7SUFxWkEsQ0FBQzs7Ozs7OztJQW5aUSwyQkFBWTs7Ozs7O0lBQW5CLFVBQW9CLFNBQW9CLEVBQUUsS0FBMEIsRUFBRSxVQUFXO1FBQy9FLElBQUksU0FBUyxFQUFFO1lBQ2IsS0FBSyxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7U0FDN0I7UUFDRCxJQUFJLFVBQVUsRUFBRTtZQUNkLEtBQUssQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1NBQy9CO1FBQ0QsS0FBSyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsU0FBUyxJQUFJLEVBQUUsR0FBRyxjQUFjLENBQUM7UUFDekQsY0FBYyxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDaEUsQ0FBQzs7Ozs7Ozs7SUFFTSxtQ0FBb0I7Ozs7Ozs7SUFBM0IsVUFBNEIsUUFBUSxFQUFFLFNBQVMsRUFBRSxLQUFNLEVBQUUsVUFBa0I7UUFBbEIsMkJBQUEsRUFBQSxrQkFBa0I7O1lBQ25FLEtBQUssR0FBRztZQUNaLElBQUksRUFBRSxjQUFjLENBQUMsWUFBWTtZQUNqQyxLQUFLLEVBQUUsbUJBQXNC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QzFDO2dCQUNELElBQUksU0FBUyxDQUFDLE1BQU0sRUFBRTtvQkFDcEIsWUFBWSxDQUFDLEdBQUcsQ0FBQyxtQkFBSSxLQUFLLEVBQUEsRUFBRSxZQUFZLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2lCQUM3RDthQUNGOztnQkFFSyxZQUFZLEdBQUcsWUFBWSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUseUJBQXlCLENBQUM7WUFFdkUsSUFBSSxZQUFZLEVBQUU7Z0JBQ2hCLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFO29CQUMxQixZQUFZLENBQUMsVUFBVSxDQUFDLEdBQUcsU0FBUyxDQUFDLFFBQVEsSUFBSSxTQUFTLENBQUMsTUFBTSxJQUFJLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO2lCQUNoRztnQkFDRCxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRTtvQkFDMUIsWUFBWSxDQUFDLFVBQVUsQ0FBQyxHQUFHLE9BQU8sQ0FBQztpQkFDcEM7YUFDRjtZQUVELGNBQWMsQ0FBQyxjQUFjLENBQUMsU0FBUyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1lBRXhELElBQUksYUFBYSxDQUFDLE9BQU8sRUFBRTtnQkFDekIsS0FBSyxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsT0FBTyxJQUFJLEVBQUUsQ0FBQztnQkFDcEMsS0FBSyxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDN0Q7WUFFRCxjQUFjLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7U0FFekM7SUFDSCxDQUFDO0lBQ0gscUJBQUM7QUFBRCxDQUFDLEFBclpELElBcVpDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtEYXRhRmllbGRVdGlsc30gZnJvbSAnQGVyL2NvcmUnO1xuaW1wb3J0IHtFckZvcm1seUZpZWxkQ29uZmlnLCBFckZvcm1seVRlbXBsYXRlT3B0aW9uc30gZnJvbSAnQGVyL2Zvcm1seSc7XG5pbXBvcnQge1BuZ0F1dG9Db21wbGV0ZVByb3BzLCBQbmdDYWxlbmRhclByb3BzfSBmcm9tICdAZXIvcHJpbWVuZyc7XG5pbXBvcnQge0FwaURhdGFQcm9wcywgRGF0YUF0dHIsIERhdGFUeXBlLCBGb3JtUHJvcHN9IGZyb20gJ0Blci90eXBlcyc7XG5pbXBvcnQge0NvbW1vbnNVdGlscywgQ29uZmlnVXRpbHMsIERhdGVVdGlscywgRGlhbG9nVXRpbHMsIElkVXRpbHN9IGZyb20gJ0Blci91dGlscyc7XG5pbXBvcnQge05nVmFsaWRhdG9yc30gZnJvbSAnQGVyL3ZhbGlkYXRlJztcbmltcG9ydCB7UG5nRm9ybWx5VHlwZXN9IGZyb20gJy4uL3R5cGVzL2ZpZWxkLXR5cGVzJztcblxuZXhwb3J0IGNsYXNzIFBuZ0Zvcm1seVV0aWxzIHtcblxuICBzdGF0aWMgcmVzb2x2ZUZpZWxkKGZvcm1Qcm9wczogRm9ybVByb3BzLCBmaWVsZDogRXJGb3JtbHlGaWVsZENvbmZpZywgZm9ybWx5Rm9ybT8pIHtcbiAgICBpZiAoZm9ybVByb3BzKSB7XG4gICAgICBmaWVsZC5mb3JtUHJvcHMgPSBmb3JtUHJvcHM7XG4gICAgfVxuICAgIGlmIChmb3JtbHlGb3JtKSB7XG4gICAgICBmaWVsZC5mb3JtbHlGb3JtID0gZm9ybWx5Rm9ybTtcbiAgICB9XG4gICAgZmllbGQuY2xhc3NOYW1lID0gZmllbGQuY2xhc3NOYW1lIHx8ICcnICsgJ2Zvcm1seS1maWVsZCc7XG4gICAgUG5nRm9ybWx5VXRpbHMucmVzb2x2ZURhdGFGaWVsZChmb3JtUHJvcHMsIGZpZWxkLCBmb3JtbHlGb3JtKTtcbiAgfVxuXG4gIHN0YXRpYyBkaXN0aW5jdFN1Z2dlc3RQcm9wcyhhcGlFbnRyeSwgZmllbGROYW1lLCBxdWVyeT8sIHNlbGVjdGFibGUgPSBmYWxzZSkge1xuICAgIGNvbnN0IHByb3BzID0ge1xuICAgICAgdHlwZTogUG5nRm9ybWx5VHlwZXMuYXV0b0NvbXBsZXRlLFxuICAgICAgcHJvcHM6IDxQbmdBdXRvQ29tcGxldGVQcm9wcz57XG4gICAgICAgIG1pbkxlbmd0aDogMSxcbiAgICAgICAgc2l6ZTogNSxcbiAgICAgICAgZm9yY2VTZWxlY3Rpb246IGZhbHNlLFxuICAgICAgICBkcm9wZG93bjogZmFsc2UsXG4gICAgICAgIHBsYWNlaG9sZGVyOiAn6K+36L6T5YWl5ZSv5LiA55qE5Luj56CB5YC8JyxcbiAgICAgICAgb25TZWxlY3Q6IChjdHgpID0+IHtcbiAgICAgICAgICBpZiAoIXNlbGVjdGFibGUpIHtcbiAgICAgICAgICAgIERpYWxvZ1V0aWxzLmVycm9yKCfml6DmlYjmk43kvZwnLCAn6K+l5YC85bey57uP5a2Y5Zyo77yM5LiN6IO96YCJ5oupJyk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGN0eC5maWVsZC5mb3JtQ29udHJvbC5yZXNldCgpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgICRleHQ6IHtcbiAgICAgICAgICBhcGlEYXRhUHJvcHM6IDxBcGlEYXRhUHJvcHM+e1xuICAgICAgICAgICAgYXBpRW50cnk6IGFwaUVudHJ5LFxuICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LFxuICAgICAgICAgICAgc2VhcmNoRmllbGRzOiBmaWVsZE5hbWUsXG4gICAgICAgICAgICB3aXRoVGVybTogdHJ1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZGF0YUl0ZW1Qcm9wczoge1xuICAgICAgICAgICAgdGVtcGxhdGU6IGl0ZW0gPT4gYDxzcGFuIHRpdGxlPVwi6K+l5YC85bey57uP5a2Y5Zyo77yM5LiN5Y+v55SoXCI+PGRlbD4ke2l0ZW1bZmllbGROYW1lXX08L2RlbD48L3NwYW4+IGBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZU9wdGlvbnM6IHtcbiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICBkZXNjcmlwdGlvbjogJzxzcGFuIGNsYXNzPVwidGV4dC1kYW5nZXJcIj7lhoXlrrnlv4XpobvllK/kuIDvvIzlj6/ku6XkuI3loavvvIzkuI3loavml7bns7vnu5/oh6rliqjnlJ/miJA8L3NwYW4+J1xuICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIHByb3BzO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgcmVzb2x2ZVZhbGlkYXRvcnMoZmllbGQpIHtcbiAgICBpZiAoZmllbGQudmFsaWRhdG9ycykge1xuICAgICAgY29uc3QgdmFsaWRhdGVzID0gZmllbGQudmFsaWRhdG9ycztcbiAgICAgIGZpZWxkLnZhbGlkYXRvcnMgPSB7fTtcbiAgICAgIGlmIChDb21tb25zVXRpbHMuaXNGdW5jdGlvbih2YWxpZGF0ZXMpKSB7XG4gICAgICAgIGZpZWxkLnZhbGlkYXRvcnMudmFsaWRhdGlvbiA9IFt2YWxpZGF0ZXNdO1xuICAgICAgfSBlbHNlIGlmIChDb21tb25zVXRpbHMuaXNBcnJheSh2YWxpZGF0ZXMpKSB7XG4gICAgICAgIGZpZWxkLnZhbGlkYXRvcnMudmFsaWRhdGlvbiA9IHZhbGlkYXRlcztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZpZWxkLnZhbGlkYXRvcnMgPSB2YWxpZGF0ZXM7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChmaWVsZC52YWxpZGF0aW9ucykge1xuICAgICAgaWYgKGZpZWxkLnZhbGlkYXRvcnMgJiYgZmllbGQudmFsaWRhdG9yc1sndmFsaWRhdGlvbiddKSB7XG4gICAgICAgIGZpZWxkLnZhbGlkYXRvcnMudmFsaWRhdGlvbiA9IHtcbiAgICAgICAgICAuLi5maWVsZC52YWxpZGF0b3JzLnZhbGlkYXRpb24sXG4gICAgICAgICAgLi4uZmllbGQudmFsaWRhdGlvbnNcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSBpZiAoZmllbGQudmFsaWRhdG9ycykge1xuICAgICAgICBmaWVsZC52YWxpZGF0b3JzID0ge1xuICAgICAgICAgIC4uLmZpZWxkLnZhbGlkYXRvcnMsXG4gICAgICAgICAgdmFsaWRhdGlvbjogZmllbGQudmFsaWRhdGlvbnNcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZpZWxkLnZhbGlkYXRvcnMgPSB7fTtcbiAgICAgICAgZmllbGQudmFsaWRhdG9ycy52YWxpZGF0aW9uID0gZmllbGQudmFsaWRhdGlvbnM7XG4gICAgICB9XG4gICAgICBkZWxldGUgZmllbGQudmFsaWRhdGlvbnM7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgcmVzb2x2ZUJhc2ljKGRhdGFGaWVsZCwgZmllbGQpIHtcblxuICAgIGZpZWxkLmtleSA9IGZpZWxkLmtleSB8fCBkYXRhRmllbGQua2V5O1xuXG4gICAgaWYgKGRhdGFGaWVsZC5oaWRkZW4pIHtcbiAgICAgIGZpZWxkLmhpZGUgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChkYXRhRmllbGQuZGVmYXVsdFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpZWxkLmRlZmF1bHRWYWx1ZSA9IGRhdGFGaWVsZC5kZWZhdWx0VmFsdWU7XG4gICAgfVxuXG4gICAgc3dpdGNoIChkYXRhRmllbGQuZGF0YUF0dHIpIHtcbiAgICAgIGNhc2UgRGF0YUF0dHIuQ1VSUkVOQ1k6XG4gICAgICAgIGZpZWxkLmRhdGFUeXBlID0gRGF0YVR5cGUuTlVNQkVSO1xuICAgICAgICBmaWVsZC5kZWZhdWx0VmFsdWUgPSAwO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRGF0YUF0dHIuVEVYVDpcbiAgICAgICAgZmllbGQudHlwZSA9IFBuZ0Zvcm1seVR5cGVzLnRleHRBcmVhO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRGF0YUF0dHIuRElTVElOQ1Q6XG4gICAgICAgIE9iamVjdC5hc3NpZ24oZmllbGQsIFBuZ0Zvcm1seVV0aWxzLmRpc3RpbmN0U3VnZ2VzdFByb3BzKGZpZWxkLmFwaUVudHJ5LCBmaWVsZC5rZXkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgaWYgKCFmaWVsZC50eXBlKSB7XG4gICAgICBzd2l0Y2ggKGRhdGFGaWVsZC5kYXRhVHlwZSkge1xuICAgICAgICBjYXNlIERhdGFUeXBlLlNUUklORzpcbiAgICAgICAgICBmaWVsZC50eXBlID0gUG5nRm9ybWx5VHlwZXMuaW5wdXQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRGF0YVR5cGUuQk9PTEVBTjpcbiAgICAgICAgICBmaWVsZC50eXBlID0gUG5nRm9ybWx5VHlwZXMuc3dpdGNoO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIERhdGFUeXBlLk5VTUJFUjpcbiAgICAgICAgICBmaWVsZC50eXBlID0gUG5nRm9ybWx5VHlwZXMuc3Bpbm5lcjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBEYXRhVHlwZS5EQVRFOlxuICAgICAgICAgIGZpZWxkLnR5cGUgPSBQbmdGb3JtbHlUeXBlcy5jYWxlbmRhcjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBmaWVsZC50eXBlID0gUG5nRm9ybWx5VHlwZXMuaW5wdXQ7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgcmVzb2x2ZVByb3BzKGRhdGFGaWVsZCwgZmllbGQpIHtcbiAgICBjb25zdCBwcm9wcyA9IHtcbiAgICAgICRleHQ6IHt9XG4gICAgfTtcbiAgICBpZiAoZGF0YUZpZWxkLmRhdGFJdGVtcykge1xuICAgICAgcHJvcHMuJGV4dFsnZGF0YUl0ZW1zJ10gPSBkYXRhRmllbGQuZGF0YUl0ZW1zO1xuICAgIH1cbiAgICBpZiAoZGF0YUZpZWxkLmFwaURhdGFQcm9wcykge1xuICAgICAgcHJvcHMuJGV4dFsnYXBpRGF0YVByb3BzJ10gPSBkYXRhRmllbGQuYXBpRGF0YVByb3BzO1xuICAgIH1cbiAgICBpZiAoZGF0YUZpZWxkLmRhdGFJdGVtUHJvcHMpIHtcbiAgICAgIHByb3BzLiRleHRbJ2RhdGFJdGVtUHJvcHMnXSA9IGRhdGFGaWVsZC5kYXRhSXRlbVByb3BzO1xuICAgIH1cbiAgICBpZiAoZGF0YUZpZWxkLmRhdGFBdHRyID09PSBEYXRhQXR0ci5EQVRBX0NPREUpIHtcbiAgICAgIHByb3BzWydkYXRhS2V5J10gPSBDb25maWdVdGlscy5nZXRDb25maWcoKS5kYXRhRmllbGRQcm9wcy5kYXRhQ29kZS5jb2RlS2V5O1xuICAgIH1cbiAgICBpZiAoZGF0YUZpZWxkLmRhdGFJdGVtcykge1xuICAgICAgcHJvcHMuJGV4dFsnZGF0YUl0ZW1zJ10gPSBkYXRhRmllbGQuZGF0YUl0ZW1zO1xuICAgIH1cbiAgICBzd2l0Y2ggKGRhdGFGaWVsZC5kYXRhQXR0cikge1xuICAgICAgY2FzZSBEYXRhQXR0ci5EQVRFX1RJTUU6XG4gICAgICAgIE9iamVjdC5hc3NpZ24ocHJvcHMsIDxQbmdDYWxlbmRhclByb3BzPntcbiAgICAgICAgICBkYXRlRm9ybWF0OiAneXktbW0tZGQgaGg6bW0nLFxuICAgICAgICAgIG1vbnRoTmF2aWdhdG9yOiB0cnVlLFxuICAgICAgICAgIHllYXJOYXZpZ2F0b3I6IHRydWUsXG4gICAgICAgICAgc2hvd1RpbWU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBEYXRhQXR0ci5EQVRFOlxuICAgICAgICBPYmplY3QuYXNzaWduKHByb3BzLCA8UG5nQ2FsZW5kYXJQcm9wcz57XG4gICAgICAgICAgZGF0ZUZvcm1hdDogJ3l5LW1tLWRkJyxcbiAgICAgICAgICBtb250aE5hdmlnYXRvcjogdHJ1ZSxcbiAgICAgICAgICB5ZWFyTmF2aWdhdG9yOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRGF0YUF0dHIuVElNRTpcbiAgICAgICAgT2JqZWN0LmFzc2lnbihwcm9wcywgPFBuZ0NhbGVuZGFyUHJvcHM+e1xuICAgICAgICAgIHRpbWVPbmx5OiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRGF0YUF0dHIuTU9OVEg6XG4gICAgICAgIE9iamVjdC5hc3NpZ24ocHJvcHMsIDxQbmdDYWxlbmRhclByb3BzPntcbiAgICAgICAgICB2aWV3OiAnbW9udGgnLFxuICAgICAgICAgIGRhdGVGb3JtYXQ6ICd5eS1tbScsXG4gICAgICAgICAgeWVhck5hdmlnYXRvcjogdHJ1ZSxcbiAgICAgICAgICBtb250aE5hdmlnYXRvcjogdHJ1ZSxcbiAgICAgICAgICB5ZWFyUmFuZ2U6ICcyMDAwOjIwMjAnXG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgZmllbGQucHJvcHMgPSBDb21tb25zVXRpbHMuZGVmYXVsdHMoZmllbGQucHJvcHMsIHByb3BzKTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIHJlc29sdmVBdHRycyhkYXRhRmllbGQsIGZpZWxkKSB7XG4gICAgY29uc3QgYXR0cnMgPSB7fTtcbiAgICBzd2l0Y2ggKGRhdGFGaWVsZC5kYXRhQXR0cikge1xuICAgICAgY2FzZSBEYXRhQXR0ci5DVVJSRU5DWTpcbiAgICAgICAgQ29tbW9uc1V0aWxzLnNldChhdHRycywgJyRleHQuaW5wdXRSdWxlJywgJ3BudW0nKTtcbiAgICAgICAgQ29tbW9uc1V0aWxzLnNldChhdHRycywgJyRleHQucG9zdFRleHQnLCAn77+lJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBEYXRhQXR0ci5QSE9ORTpcbiAgICAgICAgQ29tbW9uc1V0aWxzLnNldChhdHRycywgJyRleHQuaW5wdXRSdWxlJywgJ3BpbnQnKTtcbiAgICAgICAgQ29tbW9uc1V0aWxzLnNldChhdHRycywgJyRleHQucHJlSWNvbicsICdmYSBmYS1waG9uZScpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRGF0YUF0dHIuSURfQ0FSRDpcbiAgICAgICAgQ29tbW9uc1V0aWxzLnNldChhdHRycywgJyRleHQuaW5wdXRSdWxlJywgL1swLTldfFh8eC8pO1xuICAgICAgICBDb21tb25zVXRpbHMuc2V0KGF0dHJzLCAnJGV4dC5wcmVJY29uJywgJ2ZhIGZhLWlkLWNhcmQnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERhdGFBdHRyLlFROlxuICAgICAgICBDb21tb25zVXRpbHMuc2V0KGF0dHJzLCAnJGV4dC5pbnB1dFJ1bGUnLCAncGludCcpO1xuICAgICAgICBDb21tb25zVXRpbHMuc2V0KGF0dHJzLCAnJGV4dC5wcmVJY29uJywgJ2ZhIGZhLXFxJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBEYXRhQXR0ci5XRV9DSEFUOlxuICAgICAgICBDb21tb25zVXRpbHMuc2V0KGF0dHJzLCAnJGV4dC5pbnB1dFJ1bGUnLCAncGludCcpO1xuICAgICAgICBDb21tb25zVXRpbHMuc2V0KGF0dHJzLCAnJGV4dC5wcmVJY29uJywgJ2ZhIGZhLXdlY2hhdCcpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRGF0YUF0dHIuRU1BSUw6XG4gICAgICAgIENvbW1vbnNVdGlscy5zZXQoYXR0cnMsICckZXh0LnByZVRleHQnLCAnQCcpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRGF0YUF0dHIuVVJMOlxuICAgICAgICBDb21tb25zVXRpbHMuc2V0KGF0dHJzLCAnJGV4dC5wcmVUZXh0JywgJ2h0dHA6Ly8nKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGZpZWxkLmF0dHJzID0gQ29tbW9uc1V0aWxzLmRlZmF1bHRzKGZpZWxkLmF0dHJzLCBhdHRycyk7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyByZXNvbHZlVGVtcGxhdGVPcHRpb25zKGRhdGFGaWVsZCwgZmllbGQpIHtcbiAgICBjb25zdCBvcHRpb25zOiBFckZvcm1seVRlbXBsYXRlT3B0aW9ucyA9IHt9O1xuXG4gICAgb3B0aW9ucy5sYWJlbCA9IGAke2RhdGFGaWVsZC5sYWJlbH06YDtcblxuICAgIGlmIChkYXRhRmllbGQucmVxdWlyZWQpIHtcbiAgICAgIG9wdGlvbnMucmVxdWlyZWQgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoZGF0YUZpZWxkLmRlc2NyaXB0aW9uKSB7XG4gICAgICBvcHRpb25zLmRlc2NyaXB0aW9uID0gZGF0YUZpZWxkLmRlc2NyaXB0aW9uO1xuICAgIH1cbiAgICBpZiAoZGF0YUZpZWxkLnBsYWNlaG9sZGVyKSB7XG4gICAgICBvcHRpb25zLnBsYWNlaG9sZGVyID0gZGF0YUZpZWxkLnBsYWNlaG9sZGVyO1xuICAgIH1cbiAgICBpZiAoZGF0YUZpZWxkLmRpc2FibGVkKSB7XG4gICAgICBvcHRpb25zLmRpc2FibGVkID0gZGF0YUZpZWxkLmRpc2FibGVkO1xuICAgIH1cblxuICAgIGZpZWxkLnRlbXBsYXRlT3B0aW9ucyA9IENvbW1vbnNVdGlscy5kZWZhdWx0cyhmaWVsZC50ZW1wbGF0ZU9wdGlvbnMsIG9wdGlvbnMpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgcmVzb2x2ZVZhbGlkYXRpb25zKGRhdGFGaWVsZCwgZmllbGQpIHtcblxuICAgIGNvbnN0IHZhbGlkYXRpb25zID0gW107XG5cbiAgICBpZiAoZGF0YUZpZWxkLm1heExlbmd0aCkge1xuICAgICAgdmFsaWRhdGlvbnMucHVzaChOZ1ZhbGlkYXRvcnMubWF4TGVuZ3RoKGRhdGFGaWVsZC5tYXhMZW5ndGgpKTtcbiAgICB9XG4gICAgaWYgKGRhdGFGaWVsZC5taW5MZW5ndGgpIHtcbiAgICAgIHZhbGlkYXRpb25zLnB1c2goTmdWYWxpZGF0b3JzLm1pbkxlbmd0aChkYXRhRmllbGQubWluTGVuZ3RoKSk7XG4gICAgfVxuICAgIGlmIChkYXRhRmllbGQubWF4KSB7XG4gICAgICB2YWxpZGF0aW9ucy5wdXNoKE5nVmFsaWRhdG9ycy5tYXgoZGF0YUZpZWxkLm1heCkpO1xuICAgIH1cbiAgICBpZiAoZGF0YUZpZWxkLm1pbikge1xuICAgICAgdmFsaWRhdGlvbnMucHVzaChOZ1ZhbGlkYXRvcnMubWluKGRhdGFGaWVsZC5taW4pKTtcbiAgICB9XG4gICAgaWYgKGRhdGFGaWVsZC5wYXR0ZXJuKSB7XG4gICAgICB2YWxpZGF0aW9ucy5wdXNoKE5nVmFsaWRhdG9ycy5wYXR0ZXJuKGRhdGFGaWVsZC5wYXR0ZXJuKSk7XG4gICAgfVxuICAgIGlmIChkYXRhRmllbGQuZGF0YUF0dHIgPT09IERhdGFBdHRyLklEX0NBUkQpIHtcbiAgICAgIHZhbGlkYXRpb25zLnB1c2goTmdWYWxpZGF0b3JzLmlkQ2FyZCk7XG4gICAgfVxuXG4gICAgaWYgKHZhbGlkYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIGZpZWxkLnZhbGlkYXRpb25zID0gdmFsaWRhdGlvbnM7XG4gICAgfVxuXG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyByZXNvbHZlUGFyc2VycyhkYXRhRmllbGQsIGZpZWxkKSB7XG4gICAgZmllbGQucGFyc2VycyA9IENvbW1vbnNVdGlscy5nZXRBcnJheVZhbHVlKGRhdGFGaWVsZC5wYXJzZXJzKSB8fCBbXTtcbiAgICBsZXQgcGFyc2VyO1xuICAgIHN3aXRjaCAoZGF0YUZpZWxkLmRhdGFBdHRyKSB7XG4gICAgICBjYXNlIERhdGFBdHRyLkNVUlJFTkNZOlxuICAgICAgICBwYXJzZXIgPSAodmFsKSA9PiB2YWwgPyBOdW1iZXIodmFsKSA6IHZhbDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERhdGFBdHRyLkRBVEU6XG4gICAgICAgIHBhcnNlciA9ICh2YWwpID0+IHZhbCA/IERhdGVVdGlscy5nZXRGb3JtYXR0ZWREYXRlKHZhbCwgJ1lZWVktTU0tREQnKSA6IHZhbDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERhdGFBdHRyLkRBVEVfVElNRTpcbiAgICAgICAgcGFyc2VyID0gKHZhbCkgPT4gdmFsID8gRGF0ZVV0aWxzLmdldEZvcm1hdHRlZERhdGUodmFsLCAnWVlZWS1NTS1ERCBISDptbTpzcycpIDogdmFsO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRGF0YUF0dHIuVElNRTpcbiAgICAgICAgcGFyc2VyID0gKHZhbCkgPT4gdmFsID8gRGF0ZVV0aWxzLmdldEZvcm1hdHRlZERhdGUodmFsLCAnSEg6bW06c3MnKSA6IHZhbDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERhdGFBdHRyLllFQVI6XG4gICAgICAgIHBhcnNlciA9ICh2YWwpID0+IHZhbCA/IERhdGVVdGlscy5nZXRGb3JtYXR0ZWREYXRlKHZhbCwgJ1lZWVknKSA6IHZhbDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERhdGFBdHRyLk1PTlRIOlxuICAgICAgICBwYXJzZXIgPSAodmFsKSA9PiB2YWwgPyBEYXRlVXRpbHMuZ2V0Rm9ybWF0dGVkRGF0ZSh2YWwsICdZWVlZLU1NJykgOiB2YWw7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBEYXRhQXR0ci5QRVJDRU5UOlxuICAgICAgICBwYXJzZXIgPSAodmFsKSA9PiB2YWwgPyBOdW1iZXIodmFsKSAvIDEwMCA6IHZhbDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERhdGFBdHRyLklEX0NBUkQ6XG4gICAgICAgIHBhcnNlciA9ICh2YWwpID0+IHZhbCA/IHZhbC50b1VwcGVyQ2FzZSgpIDogdmFsO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgY29uc3QgcGFyc2VycyA9IENvbW1vbnNVdGlscy5nZXRBcnJheVZhbHVlKGRhdGFGaWVsZC5wYXJzZXJzKSB8fCBbXTtcbiAgICBpZiAocGFyc2VyKSB7XG4gICAgICBwYXJzZXJzLnB1c2goKHZhbCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJldHVybiBwYXJzZXIodmFsKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAocGFyc2Vycy5sZW5ndGggPiAwKSB7XG4gICAgICBmaWVsZC5wYXJzZXJzID0gcGFyc2VycztcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyByZXNvbHZlRGF0YUZpZWxkKGZvcm1Qcm9wczogRm9ybVByb3BzLCBmaWVsZDogRXJGb3JtbHlGaWVsZENvbmZpZywgZm9ybWx5Rm9ybT8pIHtcbiAgICBpZiAoZmllbGQuZmllbGRBcnJheSkge1xuICAgICAgaWYgKGZpZWxkLndyYXBwZXJzKSB7XG4gICAgICAgIGZpZWxkLndyYXBwZXJzID0gQ29tbW9uc1V0aWxzLmdldEFycmF5VmFsdWUoZmllbGQud3JhcHBlcnMpO1xuICAgICAgfVxuICAgICAgUG5nRm9ybWx5VXRpbHMucmVzb2x2ZUZpZWxkKCgpID0+IGZvcm1Qcm9wcywgZmllbGQuZmllbGRBcnJheSwgKCkgPT4gZm9ybWx5Rm9ybSk7IC8vIGJpbmQgbGF0dGVyXG4gICAgfSBlbHNlIGlmIChmaWVsZC5maWVsZEdyb3VwKSB7XG4gICAgICBpZiAoZmllbGQud3JhcHBlcnMpIHtcbiAgICAgICAgZmllbGQud3JhcHBlcnMgPSBDb21tb25zVXRpbHMuZ2V0QXJyYXlWYWx1ZShmaWVsZC53cmFwcGVycyk7XG4gICAgICB9XG4gICAgICBmaWVsZC5maWVsZEdyb3VwLmZvckVhY2goYUZpZWxkID0+IHtcbiAgICAgICAgaWYgKGZpZWxkLnRlbXBsYXRlT3B0aW9ucyAmJiBmaWVsZC50ZW1wbGF0ZU9wdGlvbnMubGFuZHNjYXBlKSB7XG4gICAgICAgICAgQ29tbW9uc1V0aWxzLnNldCg8e30+YUZpZWxkLCAndGVtcGxhdGVPcHRpb25zLmxhbmRzY2FwZScsIGZpZWxkLnRlbXBsYXRlT3B0aW9ucy5sYW5kc2NhcGUpO1xuICAgICAgICB9XG4gICAgICAgIFBuZ0Zvcm1seVV0aWxzLnJlc29sdmVGaWVsZChmb3JtUHJvcHMsIGFGaWVsZCwgZm9ybWx5Rm9ybSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuXG4gICAgICBsZXQgZGF0YUZpZWxkID0gZmllbGQuZGF0YUZpZWxkO1xuXG4gICAgICBpZiAoZmllbGQudGVtcGxhdGUpIHtcbiAgICAgICAgZmllbGQudHlwZSA9ICdmb3JtbHktdGVtcGxhdGUnO1xuICAgICAgfVxuXG4gICAgICBpZiAoZmllbGQudHlwZSA9PT0gUG5nRm9ybWx5VHlwZXMuZHluYSkge1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZmllbGQsICdrZXknLCB7XG4gICAgICAgICAgdmFsdWU6IGAkXyR7SWRVdGlscy5nZXRSYW5kb20oKX1gLFxuICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBmaWVsZC5rZXkgPSBgJF8ke0lkVXRpbHMuZ2V0UmFuZG9tKCl9YDtcbiAgICAgIH1cblxuICAgICAgaWYgKCFkYXRhRmllbGQpIHtcbiAgICAgICAgaWYgKCFmaWVsZC50eXBlKSB7XG4gICAgICAgICAgZmllbGQudHlwZSA9IFBuZ0Zvcm1seVR5cGVzLmlucHV0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChmaWVsZC5wYXJzZXJzKSB7XG4gICAgICAgICAgZmllbGQucGFyc2VycyA9IENvbW1vbnNVdGlscy5nZXRBcnJheVZhbHVlKGZpZWxkLnBhcnNlcnMpO1xuICAgICAgICB9XG4gICAgICAgIFBuZ0Zvcm1seVV0aWxzLnJlc29sdmVWYWxpZGF0b3JzKGZpZWxkKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBkYXRhRmllbGQgPSBDb21tb25zVXRpbHMubWVyZ2UoXG4gICAgICAgIERhdGFGaWVsZFV0aWxzLmdldEZpZWxkRGVmYXVsdFByb3BzKGRhdGFGaWVsZCksXG4gICAgICAgIGRhdGFGaWVsZFxuICAgICAgKTtcblxuICAgICAgZmllbGQuZGF0YUZpZWxkID0gZGF0YUZpZWxkO1xuXG4gICAgICBpZiAoZmllbGQudHlwZSAmJiBmaWVsZC50eXBlID09PSBQbmdGb3JtbHlUeXBlcy52YWx1ZSkge1xuICAgICAgICBmaWVsZC5rZXkgPSBmaWVsZC5rZXkgfHwgZmllbGQuZGF0YUZpZWxkLmtleTtcbiAgICAgICAgQ29tbW9uc1V0aWxzLnNldCg8e30+ZmllbGQsICd0ZW1wbGF0ZU9wdGlvbnMubGFiZWwnLCBmaWVsZC5kYXRhRmllbGQubGFiZWwpO1xuICAgICAgICByZXR1cm4gZmllbGQ7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc29sdmVkRmllbGQ6IEVyRm9ybWx5RmllbGRDb25maWcgPSB7fTtcblxuICAgICAgUG5nRm9ybWx5VXRpbHMucmVzb2x2ZUJhc2ljKGRhdGFGaWVsZCwgcmVzb2x2ZWRGaWVsZCk7XG5cbiAgICAgIFBuZ0Zvcm1seVV0aWxzLnJlc29sdmVQcm9wcyhkYXRhRmllbGQsIHJlc29sdmVkRmllbGQpO1xuXG4gICAgICBQbmdGb3JtbHlVdGlscy5yZXNvbHZlQXR0cnMoZGF0YUZpZWxkLCByZXNvbHZlZEZpZWxkKTtcblxuICAgICAgUG5nRm9ybWx5VXRpbHMucmVzb2x2ZVRlbXBsYXRlT3B0aW9ucyhkYXRhRmllbGQsIHJlc29sdmVkRmllbGQpO1xuXG4gICAgICBQbmdGb3JtbHlVdGlscy5yZXNvbHZlVmFsaWRhdGlvbnMoZGF0YUZpZWxkLCByZXNvbHZlZEZpZWxkKTtcblxuICAgICAgQ29tbW9uc1V0aWxzLmRlZmF1bHRzKGZpZWxkLCByZXNvbHZlZEZpZWxkKTtcblxuICAgICAgaWYgKGZpZWxkLnR5cGUgPT09IFBuZ0Zvcm1seVR5cGVzLmlucHV0KSB7XG4gICAgICAgIGlmIChmaWVsZC5wcm9wc1snJGV4dCddLmFwaURhdGFQcm9wcykge1xuICAgICAgICAgIGZpZWxkLnR5cGUgPSBQbmdGb3JtbHlUeXBlcy5hdXRvQ29tcGxldGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGFGaWVsZC5sZW5ndGgpIHtcbiAgICAgICAgICBDb21tb25zVXRpbHMuc2V0KDx7fT5maWVsZCwgJ2F0dHJzLnNpemUnLCBkYXRhRmllbGQubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBhcGlEYXRhUHJvcHMgPSBDb21tb25zVXRpbHMuZ2V0KGZpZWxkLCAncHJvcHMuJGV4dC5hcGlEYXRhUHJvcHMnKTtcblxuICAgICAgaWYgKGFwaURhdGFQcm9wcykge1xuICAgICAgICBpZiAoIWFwaURhdGFQcm9wcy5hcGlFbnRyeSkge1xuICAgICAgICAgIGFwaURhdGFQcm9wc1snYXBpRW50cnknXSA9IGZvcm1Qcm9wcy5hcGlFbnRyeSB8fCBmb3JtUHJvcHMuZW50aXR5ICYmIGZvcm1Qcm9wcy5lbnRpdHkuYXBpRW50cnk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFhcGlEYXRhUHJvcHMuZGF0YVBhdGgpIHtcbiAgICAgICAgICBhcGlEYXRhUHJvcHNbJ2RhdGFQYXRoJ10gPSAnaXRlbXMnO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIFBuZ0Zvcm1seVV0aWxzLnJlc29sdmVQYXJzZXJzKGRhdGFGaWVsZCwgcmVzb2x2ZWRGaWVsZCk7XG5cbiAgICAgIGlmIChyZXNvbHZlZEZpZWxkLnBhcnNlcnMpIHtcbiAgICAgICAgZmllbGQucGFyc2VycyA9IGZpZWxkLnBhcnNlcnMgfHwgW107XG4gICAgICAgIGZpZWxkLnBhcnNlcnMgPSBmaWVsZC5wYXJzZXJzLmNvbmNhdChyZXNvbHZlZEZpZWxkLnBhcnNlcnMpO1xuICAgICAgfVxuXG4gICAgICBQbmdGb3JtbHlVdGlscy5yZXNvbHZlVmFsaWRhdG9ycyhmaWVsZCk7XG5cbiAgICB9XG4gIH1cbn1cbiJdfQ==