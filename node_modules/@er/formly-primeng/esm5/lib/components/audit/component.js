/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { ApiUtils, AuthUtils, LogUtils } from '@er/core';
import { CommonsUtils, DateUtils, DialogUtils } from '@er/utils';
import { PngFormlyTypes } from '../../types/field-types';
import { PngFormlyUtils } from '../../utils';
import { PngFormlyFormComponent } from '../form/component';
var PngFormlyAuditFormComponent = /** @class */ (function (_super) {
    tslib_1.__extends(PngFormlyAuditFormComponent, _super);
    function PngFormlyAuditFormComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.buttonsStyleClass = 'text-center my-5';
        _this.submitBtnStyleClass = 'btn btn-success';
        _this.resetBtnStyleClass = 'btn btn-danger';
        _this.initBtnStyleClass = 'btn btn-alert';
        _this.backBtnStyleClass = 'btn btn-info';
        return _this;
    }
    /**
     * @param {?} formProps
     * @return {?}
     */
    PngFormlyAuditFormComponent.prototype.resolveFormFields = /**
     * @param {?} formProps
     * @return {?}
     */
    function (formProps) {
        var _this = this;
        if (!formProps || !formProps['fields']) {
            LogUtils.error(this, '没有定义fields!', formProps);
            return;
        }
        if (!formProps.caption) {
            formProps.caption = "\u5BA1\u6838" + formProps.entity.label + "\u4FE1\u606F";
        }
        formProps.fields.forEach(function (field) {
            field.type = PngFormlyTypes.value;
            PngFormlyUtils.resolveField(formProps, field, _this);
        });
        /** @type {?} */
        var commentField = {
            key: 'comment',
            type: PngFormlyTypes.textArea,
            attrs: {
                placeholder: '请输入您的审核意见或备注'
            },
            templateOptions: {
                label: '审核意见',
                description: '审核不通过时，必须输入不通过的原因',
                minLength: 5
            }
        };
        PngFormlyUtils.resolveField(formProps, commentField, this);
        formProps.fields.push(commentField);
    };
    /**
     * @return {?}
     */
    PngFormlyAuditFormComponent.prototype.onAccept = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var newState = this.saveAuditHis();
        ApiUtils.patchById(this.formlyForm.apiEntry, this.formlyForm.modelId, this.getSubmitData(newState), {
            tag: this.formlyForm.formId
        }).subscribe();
    };
    /**
     * @return {?}
     */
    PngFormlyAuditFormComponent.prototype.onReject = /**
     * @return {?}
     */
    function () {
        if (CommonsUtils.isEmpty(this.formlyForm.model['comment'])) {
            DialogUtils.error('操作无效', '请输入不通过的原因');
            return;
        }
        ApiUtils.patchById(this.formlyForm.apiEntry, this.formlyForm.modelId, this.getSubmitData(-1), {
            tag: this.formlyForm.formId
        }).subscribe();
    };
    /**
     * @param {?} state
     * @return {?}
     */
    PngFormlyAuditFormComponent.prototype.getSubmitData = /**
     * @param {?} state
     * @return {?}
     */
    function (state) {
        return {
            audit: {
                state: state,
                auditComment: this.formlyForm.model['comment'],
                auditDate: DateUtils.getFormattedDate(),
                auditorName: AuthUtils.getCurrentUser().fullName,
                auditorId: AuthUtils.getCurrentUser().id
            }
        };
    };
    /**
     * @private
     * @return {?}
     */
    PngFormlyAuditFormComponent.prototype.saveAuditHis = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var audit = this.formlyForm.model['audit'];
        if (audit) {
            /** @type {?} */
            var data = this.formlyForm.model;
            delete data['id'];
            ApiUtils.save(this.formlyForm.apiEntry + "-audit-his", data, {
                tag: this.formlyForm.formId
            }).subscribe();
            return ++audit['state'];
        }
        return 1;
    };
    PngFormlyAuditFormComponent.decorators = [
        { type: Component, args: [{
                    selector: 'png-formly-audit-form',
                    template: "\n    <png-panel [header]=\"formProps.caption\"\n               [footer]=\"formProps.footer\"\n               [icon]=\"formProps.icon\"\n               [toggleable]=\"formProps.collapsable\"\n    >\n      <er-formly-form\n        class=\"mt-2\"\n        erPropsBind\n        [props]=\"formProps\"\n        [beforeSubmit]=\"beforeSubmit\"\n        [afterSubmit]=\"afterSubmit\"\n      >\n        <ng-template erTypedTemplate=\"buttons\">\n          <div [ngClass]=\"buttonsStyleClass\">\n            <er-button [stateKey]=\"formlyForm.formId\"\n                       icon=\"fa fa-check\"\n                       label=\"\u901A&nbsp;&nbsp;&nbsp;\u8FC7\"\n                       title=\"\u4FDD\u7559\u6570\u636E\u5230\u670D\u52A1\u7AEF\"\n                       class=\"mr-2\"\n                       type=\"button\"\n                       [disabled]=\"!formlyForm.form.valid\"\n                       [styleClass]=\"submitBtnStyleClass\"\n                       (onClick)=\"onAccept()\"\n            ></er-button>\n            <er-button icon=\"fa fa-close\"\n                       class=\"ml-4\"\n                       label=\"\u4E0D&nbsp;&nbsp;&nbsp;\u901A&nbsp;&nbsp;&nbsp;\u8FC7\"\n                       title=\"\u6062\u590D\u5230\u4FEE\u6539\u524D\u7684\u72B6\u6001\"\n                       [styleClass]=\"resetBtnStyleClass\"\n                       (onClick)=\"onReject()\"\n            >\n            </er-button>\n          </div>\n\n        </ng-template>\n      </er-formly-form>\n    </png-panel>\n\n  "
                }] }
    ];
    PngFormlyAuditFormComponent.propDecorators = {
        buttonsStyleClass: [{ type: Input }],
        submitBtnStyleClass: [{ type: Input }],
        resetBtnStyleClass: [{ type: Input }],
        initBtnStyleClass: [{ type: Input }],
        backBtnStyleClass: [{ type: Input }]
    };
    return PngFormlyAuditFormComponent;
}(PngFormlyFormComponent));
export { PngFormlyAuditFormComponent };
if (false) {
    /** @type {?} */
    PngFormlyAuditFormComponent.prototype.buttonsStyleClass;
    /** @type {?} */
    PngFormlyAuditFormComponent.prototype.submitBtnStyleClass;
    /** @type {?} */
    PngFormlyAuditFormComponent.prototype.resetBtnStyleClass;
    /** @type {?} */
    PngFormlyAuditFormComponent.prototype.initBtnStyleClass;
    /** @type {?} */
    PngFormlyAuditFormComponent.prototype.backBtnStyleClass;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL2Zvcm1seS1wcmltZW5nLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYXVkaXQvY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDL0MsT0FBTyxFQUFDLFFBQVEsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFDLE1BQU0sVUFBVSxDQUFDO0FBR3ZELE9BQU8sRUFBQyxZQUFZLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUMvRCxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0seUJBQXlCLENBQUM7QUFDdkQsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLGFBQWEsQ0FBQztBQUMzQyxPQUFPLEVBQUMsc0JBQXNCLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQztBQUV6RDtJQTJDaUQsdURBQXNCO0lBM0N2RTtRQUFBLHFFQTZIQztRQWhGVSx1QkFBaUIsR0FBUSxrQkFBa0IsQ0FBQztRQUU1Qyx5QkFBbUIsR0FBUSxpQkFBaUIsQ0FBQztRQUU3Qyx3QkFBa0IsR0FBUSxnQkFBZ0IsQ0FBQztRQUUzQyx1QkFBaUIsR0FBUSxlQUFlLENBQUM7UUFFekMsdUJBQWlCLEdBQVEsY0FBYyxDQUFDOztJQXdFbkQsQ0FBQzs7Ozs7SUF0RUMsdURBQWlCOzs7O0lBQWpCLFVBQWtCLFNBQW9CO1FBQXRDLGlCQTBCQztRQXpCQyxJQUFJLENBQUMsU0FBUyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ3RDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxTQUFTLENBQUMsQ0FBQztZQUMvQyxPQUFPO1NBQ1I7UUFDRCxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRTtZQUN0QixTQUFTLENBQUMsT0FBTyxHQUFHLGlCQUFL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T0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUN6QjtRQUNELE9BQU8sQ0FBQyxDQUFDO0lBQ1gsQ0FBQzs7Z0JBNUhGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsdUJBQXVCO29CQUNqQyxRQUFRLEVBQUUsZy9DQXVDVDtpQkFDRjs7O29DQUdFLEtBQUs7c0NBRUwsS0FBSztxQ0FFTCxLQUFLO29DQUVMLEtBQUs7b0NBRUwsS0FBSzs7SUF3RVIsa0NBQUM7Q0FBQSxBQTdIRCxDQTJDaUQsc0JBQXNCLEdBa0Z0RTtTQWxGWSwyQkFBMkI7OztJQUV0Qyx3REFBcUQ7O0lBRXJELDBEQUFzRDs7SUFFdEQseURBQW9EOztJQUVwRCx3REFBa0Q7O0lBRWxELHdEQUFpRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBJbnB1dH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0FwaVV0aWxzLCBBdXRoVXRpbHMsIExvZ1V0aWxzfSBmcm9tICdAZXIvY29yZSc7XG5pbXBvcnQge0VyRm9ybWx5RmllbGRDb25maWd9IGZyb20gJ0Blci9mb3JtbHknO1xuaW1wb3J0IHtGb3JtUHJvcHN9IGZyb20gJ0Blci90eXBlcyc7XG5pbXBvcnQge0NvbW1vbnNVdGlscywgRGF0ZVV0aWxzLCBEaWFsb2dVdGlsc30gZnJvbSAnQGVyL3V0aWxzJztcbmltcG9ydCB7UG5nRm9ybWx5VHlwZXN9IGZyb20gJy4uLy4uL3R5cGVzL2ZpZWxkLXR5cGVzJztcbmltcG9ydCB7UG5nRm9ybWx5VXRpbHN9IGZyb20gJy4uLy4uL3V0aWxzJztcbmltcG9ydCB7UG5nRm9ybWx5Rm9ybUNvbXBvbmVudH0gZnJvbSAnLi4vZm9ybS9jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwbmctZm9ybWx5LWF1ZGl0LWZvcm0nLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxwbmctcGFuZWwgW2hlYWRlcl09XCJmb3JtUHJvcHMuY2FwdGlvblwiXG4gICAgICAgICAgICAgICBbZm9vdGVyXT1cImZvcm1Qcm9wcy5mb290ZXJcIlxuICAgICAgICAgICAgICAgW2ljb25dPVwiZm9ybVByb3BzLmljb25cIlxuICAgICAgICAgICAgICAgW3RvZ2dsZWFibGVdPVwiZm9ybVByb3BzLmNvbGxhcHNhYmxlXCJcbiAgICA+XG4gICAgICA8ZXItZm9ybWx5LWZvcm1cbiAgICAgICAgY2xhc3M9XCJtdC0yXCJcbiAgICAgICAgZXJQcm9wc0JpbmRcbiAgICAgICAgW3Byb3BzXT1cImZvcm1Qcm9wc1wiXG4gICAgICAgIFtiZWZvcmVTdWJtaXRdPVwiYmVmb3JlU3VibWl0XCJcbiAgICAgICAgW2FmdGVyU3VibWl0XT1cImFmdGVyU3VibWl0XCJcbiAgICAgID5cbiAgICAgICAgPG5nLXRlbXBsYXRlIGVyVHlwZWRUZW1wbGF0ZT1cImJ1dHRvbnNcIj5cbiAgICAgICAgICA8ZGl2IFtuZ0NsYXNzXT1cImJ1dHRvbnNTdHlsZUNsYXNzXCI+XG4gICAgICAgICAgICA8ZXItYnV0dG9uIFtzdGF0ZUtleV09XCJmb3JtbHlGb3JtLmZvcm1JZFwiXG4gICAgICAgICAgICAgICAgICAgICAgIGljb249XCJmYSBmYS1jaGVja1wiXG4gICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPVwi6YCaJm5ic3A7Jm5ic3A7Jm5ic3A76L+HXCJcbiAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU9XCLkv53nlZnmlbDmja7liLDmnI3liqHnq69cIlxuICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz1cIm1yLTJcIlxuICAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cIiFmb3JtbHlGb3JtLmZvcm0udmFsaWRcIlxuICAgICAgICAgICAgICAgICAgICAgICBbc3R5bGVDbGFzc109XCJzdWJtaXRCdG5TdHlsZUNsYXNzXCJcbiAgICAgICAgICAgICAgICAgICAgICAgKG9uQ2xpY2spPVwib25BY2NlcHQoKVwiXG4gICAgICAgICAgICA+PC9lci1idXR0b24+XG4gICAgICAgICAgICA8ZXItYnV0dG9uIGljb249XCJmYSBmYS1jbG9zZVwiXG4gICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVwibWwtNFwiXG4gICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPVwi5LiNJm5ic3A7Jm5ic3A7Jm5ic3A76YCaJm5ic3A7Jm5ic3A7Jm5ic3A76L+HXCJcbiAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU9XCLmgaLlpI3liLDkv67mlLnliY3nmoTnirbmgIFcIlxuICAgICAgICAgICAgICAgICAgICAgICBbc3R5bGVDbGFzc109XCJyZXNldEJ0blN0eWxlQ2xhc3NcIlxuICAgICAgICAgICAgICAgICAgICAgICAob25DbGljayk9XCJvblJlamVjdCgpXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgIDwvZXItYnV0dG9uPlxuICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICA8L2VyLWZvcm1seS1mb3JtPlxuICAgIDwvcG5nLXBhbmVsPlxuXG4gIGBcbn0pXG5leHBvcnQgY2xhc3MgUG5nRm9ybWx5QXVkaXRGb3JtQ29tcG9uZW50IGV4dGVuZHMgUG5nRm9ybWx5Rm9ybUNvbXBvbmVudCB7XG5cbiAgQElucHV0KCkgYnV0dG9uc1N0eWxlQ2xhc3M6IGFueSA9ICd0ZXh0LWNlbnRlciBteS01JztcblxuICBASW5wdXQoKSBzdWJtaXRCdG5TdHlsZUNsYXNzOiBhbnkgPSAnYnRuIGJ0bi1zdWNjZXNzJztcblxuICBASW5wdXQoKSByZXNldEJ0blN0eWxlQ2xhc3M6IGFueSA9ICdidG4gYnRuLWRhbmdlcic7XG5cbiAgQElucHV0KCkgaW5pdEJ0blN0eWxlQ2xhc3M6IGFueSA9ICdidG4gYnRuLWFsZXJ0JztcblxuICBASW5wdXQoKSBiYWNrQnRuU3R5bGVDbGFzczogYW55ID0gJ2J0biBidG4taW5mbyc7XG5cbiAgcmVzb2x2ZUZvcm1GaWVsZHMoZm9ybVByb3BzOiBGb3JtUHJvcHMpIHtcbiAgICBpZiAoIWZvcm1Qcm9wcyB8fCAhZm9ybVByb3BzWydmaWVsZHMnXSkge1xuICAgICAgTG9nVXRpbHMuZXJyb3IodGhpcywgJ+ayoeacieWumuS5iWZpZWxkcyEnLCBmb3JtUHJvcHMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIWZvcm1Qcm9wcy5jYXB0aW9uKSB7XG4gICAgICBmb3JtUHJvcHMuY2FwdGlvbiA9IGDlrqHmoLgke2Zvcm1Qcm9wcy5lbnRpdHkubGFiZWx95L+h5oGvYDtcbiAgICB9XG4gICAgZm9ybVByb3BzLmZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHtcbiAgICAgIGZpZWxkLnR5cGUgPSBQbmdGb3JtbHlUeXBlcy52YWx1ZTtcbiAgICAgIFBuZ0Zvcm1seVV0aWxzLnJlc29sdmVGaWVsZChmb3JtUHJvcHMsIGZpZWxkLCB0aGlzKTtcbiAgICB9KTtcbiAgICBjb25zdCBjb21tZW50RmllbGQ6IEVyRm9ybWx5RmllbGRDb25maWcgPSB7XG4gICAgICBrZXk6ICdjb21tZW50JyxcbiAgICAgIHR5cGU6IFBuZ0Zvcm1seVR5cGVzLnRleHRBcmVhLFxuICAgICAgYXR0cnM6IHtcbiAgICAgICAgcGxhY2Vob2xkZXI6ICfor7fovpPlhaXmgqjnmoTlrqHmoLjmhI/op4HmiJblpIfms6gnXG4gICAgICB9LFxuICAgICAgdGVtcGxhdGVPcHRpb25zOiB7XG4gICAgICAgIGxhYmVsOiAn5a6h5qC45oSP6KeBJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICflrqHmoLjkuI3pgJrov4fml7bvvIzlv4XpobvovpPlhaXkuI3pgJrov4fnmoTljp/lm6AnLFxuICAgICAgICBtaW5MZW5ndGg6IDVcbiAgICAgIH1cbiAgICB9O1xuICAgIFBuZ0Zvcm1seVV0aWxzLnJlc29sdmVGaWVsZChmb3JtUHJvcHMsIGNvbW1lbnRGaWVsZCwgdGhpcyk7XG4gICAgZm9ybVByb3BzLmZpZWxkcy5wdXNoKGNvbW1lbnRGaWVsZCk7XG4gIH1cblxuICBvbkFjY2VwdCgpIHtcbiAgICBjb25zdCBuZXdTdGF0ZSA9IHRoaXMuc2F2ZUF1ZGl0SGlzKCk7XG4gICAgQXBpVXRpbHMucGF0Y2hCeUlkKHRoaXMuZm9ybWx5Rm9ybS5hcGlFbnRyeSwgdGhpcy5mb3JtbHlGb3JtLm1vZGVsSWQsIHRoaXMuZ2V0U3VibWl0RGF0YShuZXdTdGF0ZSksIHtcbiAgICAgIHRhZzogdGhpcy5mb3JtbHlGb3JtLmZvcm1JZFxuICAgIH0pLnN1YnNjcmliZSgpO1xuICB9XG5cbiAgb25SZWplY3QoKSB7XG4gICAgaWYgKENvbW1vbnNVdGlscy5pc0VtcHR5KHRoaXMuZm9ybWx5Rm9ybS5tb2RlbFsnY29tbWVudCddKSkge1xuICAgICAgRGlhbG9nVXRpbHMuZXJyb3IoJ+aTjeS9nOaXoOaViCcsICfor7fovpPlhaXkuI3pgJrov4fnmoTljp/lm6AnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgQXBpVXRpbHMucGF0Y2hCeUlkKHRoaXMuZm9ybWx5Rm9ybS5hcGlFbnRyeSwgdGhpcy5mb3JtbHlGb3JtLm1vZGVsSWQsIHRoaXMuZ2V0U3VibWl0RGF0YSgtMSksIHtcbiAgICAgIHRhZzogdGhpcy5mb3JtbHlGb3JtLmZvcm1JZFxuICAgIH0pLnN1YnNjcmliZSgpO1xuICB9XG5cbiAgZ2V0U3VibWl0RGF0YShzdGF0ZSkge1xuICAgIHJldHVybiB7XG4gICAgICBhdWRpdDoge1xuICAgICAgICBzdGF0ZTogc3RhdGUsXG4gICAgICAgIGF1ZGl0Q29tbWVudDogdGhpcy5mb3JtbHlGb3JtLm1vZGVsWydjb21tZW50J10sXG4gICAgICAgIGF1ZGl0RGF0ZTogRGF0ZVV0aWxzLmdldEZvcm1hdHRlZERhdGUoKSxcbiAgICAgICAgYXVkaXRvck5hbWU6IEF1dGhVdGlscy5nZXRDdXJyZW50VXNlcigpLmZ1bGxOYW1lLFxuICAgICAgICBhdWRpdG9ySWQ6IEF1dGhVdGlscy5nZXRDdXJyZW50VXNlcigpLmlkXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG5cbiAgcHJpdmF0ZSBzYXZlQXVkaXRIaXMoKTogbnVtYmVyIHtcbiAgICBjb25zdCBhdWRpdCA9IHRoaXMuZm9ybWx5Rm9ybS5tb2RlbFsnYXVkaXQnXTtcbiAgICBpZiAoYXVkaXQpIHtcbiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmZvcm1seUZvcm0ubW9kZWw7XG4gICAgICBkZWxldGUgZGF0YVsnaWQnXTtcbiAgICAgIEFwaVV0aWxzLnNhdmUoYCR7dGhpcy5mb3JtbHlGb3JtLmFwaUVudHJ5fS1hdWRpdC1oaXNgLCBkYXRhLCB7XG4gICAgICAgIHRhZzogdGhpcy5mb3JtbHlGb3JtLmZvcm1JZFxuICAgICAgfSkuc3Vic2NyaWJlKCk7XG4gICAgICByZXR1cm4gKythdWRpdFsnc3RhdGUnXTtcbiAgICB9XG4gICAgcmV0dXJuIDE7XG4gIH1cbn1cbiJdfQ==