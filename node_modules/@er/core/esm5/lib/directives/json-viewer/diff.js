/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
var ObjectDiff = /** @class */ (function () {
    function ObjectDiff() {
        this.openChar = '{';
        this.closeChar = '}';
    }
    /**
     * @param {?} obj1
     * @param {?} obj2
     * @return {?}
     */
    ObjectDiff.diff = /**
     * @param {?} obj1
     * @param {?} obj2
     * @return {?}
     */
    function (obj1, obj2) {
        if (!ObjectDiff.instance) {
            ObjectDiff.instance = new ObjectDiff();
        }
        /** @type {?} */
        var diff = ObjectDiff.instance.diffOwnProperties(obj1, obj2);
        return '<pre>' + ObjectDiff.instance.formatChangesToHtml(diff) + '</pre>';
    };
    /**
     * @param {?} a
     * @param {?} b
     * @param {?} shallow
     * @param {?} isOwn
     * @return {?}
     */
    ObjectDiff.prototype.diff = /**
     * @param {?} a
     * @param {?} b
     * @param {?} shallow
     * @param {?} isOwn
     * @return {?}
     */
    function (a, b, shallow, isOwn) {
        if (a === b) {
            return this.equalObj(a);
        }
        /** @type {?} */
        var diffValue = {};
        /** @type {?} */
        var equal = true;
        if (!a) {
            a = {};
        }
        for (var key in a) {
            if ((!isOwn && key in b) || (isOwn && b && b.hasOwnProperty(key))) {
                if (a[key] === b[key]) {
                    diffValue[key] = this.equalObj(a[key]);
                }
                else {
                    if (!shallow && this.isValidAttr(a[key], b[key])) {
                        /** @type {?} */
                        var valueDiff = this.diff(a[key], b[key], shallow, isOwn);
                        if (valueDiff.changed === 'equal') {
                            diffValue[key] = this.equalObj(a[key]);
                        }
                        else {
                            equal = false;
                            diffValue[key] = valueDiff;
                        }
                    }
                    else {
                        equal = false;
                        diffValue[key] = {
                            changed: 'primitive change',
                            removed: a[key],
                            added: b[key]
                        };
                    }
                }
            }
            else {
                equal = false;
                diffValue[key] = {
                    changed: 'removed',
                    value: a[key]
                };
            }
        }
        for (var key in b) {
            if ((!isOwn && !(key in a)) || (isOwn && typeof a !== 'undefined' && !a.hasOwnProperty(key))) {
                equal = false;
                diffValue[key] = {
                    changed: 'added',
                    value: b[key]
                };
            }
        }
        if (equal) {
            return this.equalObj(a);
        }
        else {
            return {
                changed: 'object change',
                value: diffValue
            };
        }
    };
    /**
     * @param {?} a
     * @param {?} b
     * @param {?=} shallow
     * @return {?}
     */
    ObjectDiff.prototype.diffOwnProperties = /**
     * @param {?} a
     * @param {?} b
     * @param {?=} shallow
     * @return {?}
     */
    function (a, b, shallow) {
        return this.diff(a, b, shallow, true);
    };
    /**
     * @param {?} changes
     * @param {?=} shallow
     * @return {?}
     */
    ObjectDiff.prototype.formatToJsonXMLString = /**
     * @param {?} changes
     * @param {?=} shallow
     * @return {?}
     */
    function (changes, shallow) {
        /** @type {?} */
        var properties = [];
        /** @type {?} */
        var diff = changes.value;
        if (changes.changed === 'equal') {
            return this.inspect(diff, shallow);
        }
        for (var key in diff) {
            properties.push(this.formatChange(key, diff[key], shallow));
        }
        return '<span>' + this.openChar + '</span>\n<div class="diff-level">' + properties.join('<span>,</span>\n') + '\n</div><span>' + this.closeChar + '</span>';
    };
    /**
     * @param {?} obj
     * @param {?} shallow
     * @return {?}
     */
    ObjectDiff.prototype.formatToJson = /**
     * @param {?} obj
     * @param {?} shallow
     * @return {?}
     */
    function (obj, shallow) {
        return this.inspect(obj, shallow);
    };
    /**
     * @param {?} changes
     * @param {?=} shallow
     * @return {?}
     */
    ObjectDiff.prototype.formatChangesToHtml = /**
     * @param {?} changes
     * @param {?=} shallow
     * @return {?}
     */
    function (changes, shallow) {
        /** @type {?} */
        var properties = [];
        if (changes.changed === 'equal') {
            return '';
        }
        /** @type {?} */
        var diff = changes.value;
        for (var key in diff) {
            /** @type {?} */
            var changed = diff[key].changed;
            if (changed !== 'equal')
                properties.push(this.formatChange(key, diff[key], shallow, true));
        }
        return '<span>' + this.openChar + '</span>\n<div class="diff-level">' + properties.join('<span>,</span>\n') + '\n</div><span>' + this.closeChar + '</span>';
    };
    /**
     * @param {?} obj
     * @return {?}
     */
    ObjectDiff.prototype.equalObj = /**
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        return {
            changed: 'equal',
            value: obj
        };
    };
    /**
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    ObjectDiff.prototype.isValidAttr = /**
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    function (a, b) {
        /** @type {?} */
        var typeA = typeof a;
        /** @type {?} */
        var typeB = typeof b;
        return (a && b && (typeA === 'object' || typeA === 'function') && (typeB === 'object' || typeB === 'function'));
    };
    /**
     * @param {?} key
     * @param {?} diffItem
     * @param {?} shallow
     * @param {?=} diffOnly
     * @return {?}
     */
    ObjectDiff.prototype.formatChange = /**
     * @param {?} key
     * @param {?} diffItem
     * @param {?} shallow
     * @param {?=} diffOnly
     * @return {?}
     */
    function (key, diffItem, shallow, diffOnly) {
        /** @type {?} */
        var changed = diffItem.changed;
        /** @type {?} */
        var property;
        switch (changed) {
            case 'equal':
                property = (this.stringifyObjectKey(this.escapeHTML(key)) + '<span>: </span>' + this.inspect(diffItem.value));
                break;
            case 'removed':
                property = ('<del class="diff">' + this.stringifyObjectKey(this.escapeHTML(key)) + '<span>: </span>' + this.inspect(diffItem.value) + '</del>');
                break;
            case 'added':
                property = ('<ins class="diff">' + this.stringifyObjectKey(this.escapeHTML(key)) + '<span>: </span>' + this.inspect(diffItem.value) + '</ins>');
                break;
            case 'primitive change':
                /** @type {?} */
                var prefix = this.stringifyObjectKey(this.escapeHTML(key)) + '<span>: </span>';
                property = ('<del class="diff diff-key">' + prefix + this.inspect(diffItem.removed) + '</del><span>,</span>\n' +
                    '<ins class="diff diff-key">' + prefix + this.inspect(diffItem.added) + '</ins>');
                break;
            case 'object change':
                property = shallow ? '' : (this.stringifyObjectKey(key) + '<span>: </span>' + (diffOnly ? this.formatChangesToHtml(diffItem) : this.formatToJsonXMLString(diffItem)));
                break;
        }
        return property;
    };
    /**
     * @param {?} key
     * @return {?}
     */
    ObjectDiff.prototype.stringifyObjectKey = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        return /^[a-z0-9_$]*$/i.test(key) ?
            key :
            JSON.stringify(key);
    };
    /**
     * @param {?} string
     * @return {?}
     */
    ObjectDiff.prototype.escapeHTML = /**
     * @param {?} string
     * @return {?}
     */
    function (string) {
        return string.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    };
    /**
     * @param {?} obj
     * @param {?=} shallow
     * @return {?}
     */
    ObjectDiff.prototype.inspect = /**
     * @param {?} obj
     * @param {?=} shallow
     * @return {?}
     */
    function (obj, shallow) {
        /** @type {?} */
        var that = this;
        return _inspect('', obj, shallow);
        /**
         * @param {?} accumulator
         * @param {?} obj
         * @param {?=} shallow
         * @return {?}
         */
        function _inspect(accumulator, obj, shallow) {
            switch (typeof obj) {
                case 'object':
                    if (!obj) {
                        accumulator += 'null';
                        break;
                    }
                    if (shallow) {
                        accumulator += '[object]';
                        break;
                    }
                    /** @type {?} */
                    var keys = Object.keys(obj);
                    /** @type {?} */
                    var length_1 = keys.length;
                    if (length_1 === 0) {
                        accumulator += '<span>' + that.openChar + that.closeChar + '</span>';
                    }
                    else {
                        accumulator += '<span>' + that.openChar + '</span>\n<div class="diff-level">';
                        for (var i = 0; i < length_1; i++) {
                            /** @type {?} */
                            var key = keys[i];
                            accumulator = _inspect(accumulator + that.stringifyObjectKey(that.escapeHTML(key)) + '<span>: </span>', obj[key]);
                            if (i < length_1 - 1) {
                                accumulator += '<span>,</span>\n';
                            }
                        }
                        accumulator += '\n</div><span>' + that.closeChar + '</span>';
                    }
                    break;
                case 'string':
                    accumulator += JSON.stringify(that.escapeHTML(obj));
                    break;
                case 'undefined':
                    accumulator += 'undefined';
                    break;
                default:
                    accumulator += that.escapeHTML(String(obj));
                    break;
            }
            return accumulator;
        }
    };
    ObjectDiff.instance = undefined;
    return ObjectDiff;
}());
export { ObjectDiff };
if (false) {
    /**
     * @type {?}
     * @private
     */
    ObjectDiff.instance;
    /**
     * @type {?}
     * @private
     */
    ObjectDiff.prototype.openChar;
    /**
     * @type {?}
     * @private
     */
    ObjectDiff.prototype.closeChar;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlmZi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Blci9jb3JlLyIsInNvdXJjZXMiOlsibGliL2RpcmVjdGl2ZXMvanNvbi12aWV3ZXIvZGlmZi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUE7SUFBQTtRQUdVLGFBQVEsR0FBRyxHQUFHLENBQUM7UUFDZixjQUFTLEdBQUcsR0FBRyxDQUFDO0lBOE4xQixDQUFDOzs7Ozs7SUE1TlEsZUFBSTs7Ozs7SUFBWCxVQUFZLElBQUksRUFBRSxJQUFJO1FBQ3BCLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFO1lBQ3hCLFVBQVUsQ0FBQyxRQUFRLEdBQUcsSUFBSSxVQUFVLEVBQUUsQ0FBQztTQUN4Qzs7WUFDSyxJQUFJLEdBQUcsVUFBVSxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDO1FBQzlELE9BQU8sT0FBTyxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEdBQUcsUUFBUSxDQUFDO0lBQzVFLENBQUM7Ozs7Ozs7O0lBRUQseUJBQUk7Ozs7Ozs7SUFBSixVQUFLLENBQUMsRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLEtBQUs7UUFFdkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ1gsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3pCOztZQUVLLFNBQVMsR0FBRyxFQUFFOztZQUNoQixLQUFLLEdBQUcsSUFBSTtRQUVoQixJQUFJLENBQUMsQ0FBQyxFQUFFO1lBQ04sQ0FBQyxHQUFHLEVBQUUsQ0FBQztTQUNSO1FBRUQsS0FBSyxJQUFNLEdBQUcsSUFBSSxDQUFDLEVBQUU7WUFDbkIsSUFBSSxDQUFDLENBQUMsS0FBSyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxF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QUMsV0FBVyxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsaUJBQWlCLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7NEJBQ2xILElBQUksQ0FBQyxHQUFHLFFBQU0sR0FBRyxDQUFDLEVBQUU7Z0NBQ2xCLFdBQVcsSUFBSSxrQkFBa0IsQ0FBQzs2QkFDbkM7eUJBQ0Y7d0JBQ0QsV0FBVyxJQUFJLGdCQUFnQixHQUFHLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO3FCQUM5RDtvQkFDRCxNQUFNO2dCQUVSLEtBQUssUUFBUTtvQkFDWCxXQUFXLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQ3BELE1BQU07Z0JBRVIsS0FBSyxXQUFXO29CQUNkLFdBQVcsSUFBSSxXQUFXLENBQUM7b0JBQzNCLE1BQU07Z0JBRVI7b0JBQ0UsV0FBVyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQzVDLE1BQU07YUFDVDtZQUNELE9BQU8sV0FBVyxDQUFDO1FBQ3JCLENBQUM7SUFDSCxDQUFDO0lBL05jLG1CQUFRLEdBQWUsU0FBUyxDQUFDO0lBZ09sRCxpQkFBQztDQUFBLEFBbE9ELElBa09DO1NBbE9ZLFVBQVU7Ozs7OztJQUVyQixvQkFBZ0Q7Ozs7O0lBQ2hELDhCQUF1Qjs7Ozs7SUFDdkIsK0JBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIE9iamVjdERpZmYge1xuXG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBPYmplY3REaWZmID0gdW5kZWZpbmVkO1xuICBwcml2YXRlIG9wZW5DaGFyID0gJ3snO1xuICBwcml2YXRlIGNsb3NlQ2hhciA9ICd9JztcblxuICBzdGF0aWMgZGlmZihvYmoxLCBvYmoyKTogc3RyaW5nIHtcbiAgICBpZiAoIU9iamVjdERpZmYuaW5zdGFuY2UpIHtcbiAgICAgIE9iamVjdERpZmYuaW5zdGFuY2UgPSBuZXcgT2JqZWN0RGlmZigpO1xuICAgIH1cbiAgICBjb25zdCBkaWZmID0gT2JqZWN0RGlmZi5pbnN0YW5jZS5kaWZmT3duUHJvcGVydGllcyhvYmoxLCBvYmoyKTtcbiAgICByZXR1cm4gJzxwcmU+JyArIE9iamVjdERpZmYuaW5zdGFuY2UuZm9ybWF0Q2hhbmdlc1RvSHRtbChkaWZmKSArICc8L3ByZT4nO1xuICB9XG5cbiAgZGlmZihhLCBiLCBzaGFsbG93LCBpc093bikge1xuXG4gICAgaWYgKGEgPT09IGIpIHtcbiAgICAgIHJldHVybiB0aGlzLmVxdWFsT2JqKGEpO1xuICAgIH1cblxuICAgIGNvbnN0IGRpZmZWYWx1ZSA9IHt9O1xuICAgIGxldCBlcXVhbCA9IHRydWU7XG5cbiAgICBpZiAoIWEpIHtcbiAgICAgIGEgPSB7fTtcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IGtleSBpbiBhKSB7XG4gICAgICBpZiAoKCFpc093biAmJiBrZXkgaW4gYikgfHwgKGlzT3duICYmIGIgJiYgYi5oYXNPd25Qcm9wZXJ0eShrZXkpKSkge1xuICAgICAgICBpZiAoYVtrZXldID09PSBiW2tleV0pIHtcbiAgICAgICAgICBkaWZmVmFsdWVba2V5XSA9IHRoaXMuZXF1YWxPYmooYVtrZXldKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoIXNoYWxsb3cgJiYgdGhpcy5pc1ZhbGlkQXR0cihhW2tleV0sIGJba2V5XSkpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlRGlmZiA9IHRoaXMuZGlmZihhW2tleV0sIGJba2V5XSwgc2hhbGxvdywgaXNPd24pO1xuICAgICAgICAgICAgaWYgKHZhbHVlRGlmZi5jaGFuZ2VkID09PSAnZXF1YWwnKSB7XG4gICAgICAgICAgICAgIGRpZmZWYWx1ZVtrZXldID0gdGhpcy5lcXVhbE9iaihhW2tleV0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZXF1YWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgZGlmZlZhbHVlW2tleV0gPSB2YWx1ZURpZmY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGVxdWFsID0gZmFsc2U7XG4gICAgICAgICAgICBkaWZmVmFsdWVba2V5XSA9IHtcbiAgICAgICAgICAgICAgY2hhbmdlZDogJ3ByaW1pdGl2ZSBjaGFuZ2UnLFxuICAgICAgICAgICAgICByZW1vdmVkOiBhW2tleV0sXG4gICAgICAgICAgICAgIGFkZGVkOiBiW2tleV1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlcXVhbCA9IGZhbHNlO1xuICAgICAgICBkaWZmVmFsdWVba2V5XSA9IHtcbiAgICAgICAgICBjaGFuZ2VkOiAncmVtb3ZlZCcsXG4gICAgICAgICAgdmFsdWU6IGFba2V5XVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAoY29uc3Qga2V5IGluIGIpIHtcbiAgICAgIGlmICgoIWlzT3duICYmICEoa2V5IGluIGEpKSB8fCAoaXNPd24gJiYgdHlwZW9mIGEgIT09ICd1bmRlZmluZWQnICYmICFhLmhhc093blByb3BlcnR5KGtleSkpKSB7XG4gICAgICAgIGVxdWFsID0gZmFsc2U7XG4gICAgICAgIGRpZmZWYWx1ZVtrZXldID0ge1xuICAgICAgICAgIGNoYW5nZWQ6ICdhZGRlZCcsXG4gICAgICAgICAgdmFsdWU6IGJba2V5XVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChlcXVhbCkge1xuICAgICAgcmV0dXJuIHRoaXMuZXF1YWxPYmooYSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNoYW5nZWQ6ICdvYmplY3QgY2hhbmdlJyxcbiAgICAgICAgdmFsdWU6IGRpZmZWYWx1ZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuXG4gIGRpZmZPd25Qcm9wZXJ0aWVzKGEsIGIsIHNoYWxsb3c/KSB7XG4gICAgcmV0dXJuIHRoaXMuZGlmZihhLCBiLCBzaGFsbG93LCB0cnVlKTtcbiAgfVxuXG4gIGZvcm1hdFRvSnNvblhNTFN0cmluZyhjaGFuZ2VzLCBzaGFsbG93Pykge1xuICAgIGNvbnN0IHByb3BlcnRpZXMgPSBbXTtcblxuICAgIGNvbnN0IGRpZmYgPSBjaGFuZ2VzLnZhbHVlO1xuICAgIGlmIChjaGFuZ2VzLmNoYW5nZWQgPT09ICdlcXVhbCcpIHtcbiAgICAgIHJldHVybiB0aGlzLmluc3BlY3QoZGlmZiwgc2hhbGxvdyk7XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBrZXkgaW4gZGlmZikge1xuICAgICAgcHJvcGVydGllcy5wdXNoKHRoaXMuZm9ybWF0Q2hhbmdlKGtleSwgZGlmZltrZXldLCBzaGFsbG93KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuICc8c3Bhbj4nICsgdGhpcy5vcGVuQ2hhciArICc8L3NwYW4+XFxuPGRpdiBjbGFzcz1cImRpZmYtbGV2ZWxcIj4nICsgcHJvcGVydGllcy5qb2luKCc8c3Bhbj4sPC9zcGFuPlxcbicpICsgJ1xcbjwvZGl2PjxzcGFuPicgKyB0aGlzLmNsb3NlQ2hhciArICc8L3NwYW4+JztcblxuICB9XG5cbiAgZm9ybWF0VG9Kc29uKG9iaiwgc2hhbGxvdykge1xuICAgIHJldHVybiB0aGlzLmluc3BlY3Qob2JqLCBzaGFsbG93KTtcbiAgfVxuXG4gIGZvcm1hdENoYW5nZXNUb0h0bWwoY2hhbmdlcywgc2hhbGxvdz8pIHtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gW107XG5cbiAgICBpZiAoY2hhbmdlcy5jaGFuZ2VkID09PSAnZXF1YWwnKSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuXG4gICAgY29uc3QgZGlmZiA9IGNoYW5nZXMudmFsdWU7XG5cbiAgICBmb3IgKGNvbnN0IGtleSBpbiBkaWZmKSB7XG4gICAgICBjb25zdCBjaGFuZ2VkID0gZGlmZltrZXldLmNoYW5nZWQ7XG4gICAgICBpZiAoY2hhbmdlZCAhPT0gJ2VxdWFsJylcbiAgICAgICAgcHJvcGVydGllcy5wdXNoKHRoaXMuZm9ybWF0Q2hhbmdlKGtleSwgZGlmZltrZXldLCBzaGFsbG93LCB0cnVlKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuICc8c3Bhbj4nICsgdGhpcy5vcGVuQ2hhciArICc8L3NwYW4+XFxuPGRpdiBjbGFzcz1cImRpZmYtbGV2ZWxcIj4nICsgcHJvcGVydGllcy5qb2luKCc8c3Bhbj4sPC9zcGFuPlxcbicpICsgJ1xcbjwvZGl2PjxzcGFuPicgKyB0aGlzLmNsb3NlQ2hhciArICc8L3NwYW4+JztcblxuICB9XG5cbiAgZXF1YWxPYmoob2JqKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNoYW5nZWQ6ICdlcXVhbCcsXG4gICAgICB2YWx1ZTogb2JqXG4gICAgfTtcbiAgfVxuXG4gIGlzVmFsaWRBdHRyKGEsIGIpIHtcbiAgICBjb25zdCB0eXBlQSA9IHR5cGVvZiBhO1xuICAgIGNvbnN0IHR5cGVCID0gdHlwZW9mIGI7XG4gICAgcmV0dXJuIChhICYmIGIgJiYgKHR5cGVBID09PSAnb2JqZWN0JyB8fCB0eXBlQSA9PT0gJ2Z1bmN0aW9uJykgJiYgKHR5cGVCID09PSAnb2JqZWN0JyB8fCB0eXBlQiA9PT0gJ2Z1bmN0aW9uJykpO1xuICB9XG5cbiAgZm9ybWF0Q2hhbmdlKGtleSwgZGlmZkl0ZW0sIHNoYWxsb3csIGRpZmZPbmx5Pykge1xuICAgIGNvbnN0IGNoYW5nZWQgPSBkaWZmSXRlbS5jaGFuZ2VkO1xuICAgIGxldCBwcm9wZXJ0eTtcbiAgICBzd2l0Y2ggKGNoYW5nZWQpIHtcbiAgICAgIGNhc2UgJ2VxdWFsJzpcbiAgICAgICAgcHJvcGVydHkgPSAodGhpcy5zdHJpbmdpZnlPYmplY3RLZXkodGhpcy5lc2NhcGVIVE1MKGtleSkpICsgJzxzcGFuPjogPC9zcGFuPicgKyB0aGlzLmluc3BlY3QoZGlmZkl0ZW0udmFsdWUpKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ3JlbW92ZWQnOlxuICAgICAgICBwcm9wZXJ0eSA9ICgnPGRlbCBjbGFzcz1cImRpZmZcIj4nICsgdGhpcy5zdHJpbmdpZnlPYmplY3RLZXkodGhpcy5lc2NhcGVIVE1MKGtleSkpICsgJzxzcGFuPjogPC9zcGFuPicgKyB0aGlzLmluc3BlY3QoZGlmZkl0ZW0udmFsdWUpICsgJzwvZGVsPicpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnYWRkZWQnOlxuICAgICAgICBwcm9wZXJ0eSA9ICgnPGlucyBjbGFzcz1cImRpZmZcIj4nICsgdGhpcy5zdHJpbmdpZnlPYmplY3RLZXkodGhpcy5lc2NhcGVIVE1MKGtleSkpICsgJzxzcGFuPjogPC9zcGFuPicgKyB0aGlzLmluc3BlY3QoZGlmZkl0ZW0udmFsdWUpICsgJzwvaW5zPicpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAncHJpbWl0aXZlIGNoYW5nZSc6XG4gICAgICAgIGNvbnN0IHByZWZpeCA9IHRoaXMuc3RyaW5naWZ5T2JqZWN0S2V5KHRoaXMuZXNjYXBlSFRNTChrZXkpKSArICc8c3Bhbj46IDwvc3Bhbj4nO1xuICAgICAgICBwcm9wZXJ0eSA9IChcbiAgICAgICAgICAnPGRlbCBjbGFzcz1cImRpZmYgZGlmZi1rZXlcIj4nICsgcHJlZml4ICsgdGhpcy5pbnNwZWN0KGRpZmZJdGVtLnJlbW92ZWQpICsgJzwvZGVsPjxzcGFuPiw8L3NwYW4+XFxuJyArXG4gICAgICAgICAgJzxpbnMgY2xhc3M9XCJkaWZmIGRpZmYta2V5XCI+JyArIHByZWZpeCArIHRoaXMuaW5zcGVjdChkaWZmSXRlbS5hZGRlZCkgKyAnPC9pbnM+Jyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdvYmplY3QgY2hhbmdlJzpcbiAgICAgICAgcHJvcGVydHkgPSBzaGFsbG93ID8gJycgOiAodGhpcy5zdHJpbmdpZnlPYmplY3RLZXkoa2V5KSArICc8c3Bhbj46IDwvc3Bhbj4nICsgKGRpZmZPbmx5ID8gdGhpcy5mb3JtYXRDaGFuZ2VzVG9IdG1sKGRpZmZJdGVtKSA6IHRoaXMuZm9ybWF0VG9Kc29uWE1MU3RyaW5nKGRpZmZJdGVtKSkpO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gcHJvcGVydHk7XG4gIH1cblxuICBzdHJpbmdpZnlPYmplY3RLZXkoa2V5KSB7XG4gICAgcmV0dXJuIC9eW2EtejAtOV8kXSokL2kudGVzdChrZXkpID9cbiAgICAgIGtleSA6XG4gICAgICBKU09OLnN0cmluZ2lmeShrZXkpO1xuICB9XG5cblxuICBlc2NhcGVIVE1MKHN0cmluZykge1xuICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgvJi9nLCAnJmFtcDsnKS5yZXBsYWNlKC88L2csICcmbHQ7JykucmVwbGFjZSgvPi9nLCAnJmd0OycpO1xuICB9XG5cbiAgaW5zcGVjdChvYmosIHNoYWxsb3c/KSB7XG5cbiAgICBjb25zdCB0aGF0ID0gdGhpcztcblxuICAgIHJldHVybiBfaW5zcGVjdCgnJywgb2JqLCBzaGFsbG93KTtcblxuICAgIGZ1bmN0aW9uIF9pbnNwZWN0KGFjY3VtdWxhdG9yLCBvYmosIHNoYWxsb3c/KSB7XG4gICAgICBzd2l0Y2ggKHR5cGVvZiBvYmopIHtcbiAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICBpZiAoIW9iaikge1xuICAgICAgICAgICAgYWNjdW11bGF0b3IgKz0gJ251bGwnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzaGFsbG93KSB7XG4gICAgICAgICAgICBhY2N1bXVsYXRvciArPSAnW29iamVjdF0nO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhvYmopO1xuICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IGtleXMubGVuZ3RoO1xuICAgICAgICAgIGlmIChsZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGFjY3VtdWxhdG9yICs9ICc8c3Bhbj4nICsgdGhhdC5vcGVuQ2hhciArIHRoYXQuY2xvc2VDaGFyICsgJzwvc3Bhbj4nO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhY2N1bXVsYXRvciArPSAnPHNwYW4+JyArIHRoYXQub3BlbkNoYXIgKyAnPC9zcGFuPlxcbjxkaXYgY2xhc3M9XCJkaWZmLWxldmVsXCI+JztcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgY29uc3Qga2V5ID0ga2V5c1tpXTtcbiAgICAgICAgICAgICAgYWNjdW11bGF0b3IgPSBfaW5zcGVjdChhY2N1bXVsYXRvciArIHRoYXQuc3RyaW5naWZ5T2JqZWN0S2V5KHRoYXQuZXNjYXBlSFRNTChrZXkpKSArICc8c3Bhbj46IDwvc3Bhbj4nLCBvYmpba2V5XSk7XG4gICAgICAgICAgICAgIGlmIChpIDwgbGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yICs9ICc8c3Bhbj4sPC9zcGFuPlxcbic7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFjY3VtdWxhdG9yICs9ICdcXG48L2Rpdj48c3Bhbj4nICsgdGhhdC5jbG9zZUNoYXIgKyAnPC9zcGFuPic7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgYWNjdW11bGF0b3IgKz0gSlNPTi5zdHJpbmdpZnkodGhhdC5lc2NhcGVIVE1MKG9iaikpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ3VuZGVmaW5lZCc6XG4gICAgICAgICAgYWNjdW11bGF0b3IgKz0gJ3VuZGVmaW5lZCc7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBhY2N1bXVsYXRvciArPSB0aGF0LmVzY2FwZUhUTUwoU3RyaW5nKG9iaikpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yO1xuICAgIH1cbiAgfVxufVxuIl19