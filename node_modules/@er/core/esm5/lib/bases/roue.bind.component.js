/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { CommonsUtils } from '@er/utils';
import { ComponentUtils } from '../utils/component';
import { LogUtils } from '../utils/log';
import { RouteUtils } from '../utils/nav';
import { BaseComponent } from './component';
var RouteBindComponent = /** @class */ (function (_super) {
    tslib_1.__extends(RouteBindComponent, _super);
    function RouteBindComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * @return {?}
     */
    RouteBindComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.$subscriptions = RouteUtils.getActiveRoute().url.subscribe(function (url) {
            /** @type {?} */
            var activeRoute = RouteUtils.getActiveRoute();
            if (!activeRoute) {
                return;
            }
            /** @type {?} */
            var data = CommonsUtils.copy(activeRoute.snapshot.data);
            /** @type {?} */
            var params = tslib_1.__assign({}, activeRoute.snapshot.params || {}, activeRoute.snapshot.queryParams || {});
            while (activeRoute && !activeRoute.snapshot.data['$props']) {
                activeRoute = activeRoute.parent;
            }
            /** @type {?} */
            var routeData = tslib_1.__assign({}, activeRoute.snapshot.data, data);
            /** @type {?} */
            var props = CommonsUtils.copy(routeData['$resolvedProps'] || routeData['$props']);
            if (data['$propsKey']) {
                props = CommonsUtils.get(props, data['$propsKey']);
            }
            Object.keys(data).forEach(function (key) {
                if (CommonsUtils.isFunction(data[key])) {
                    props[key] = ((/** @type {?} */ (data[key])))(props, params, data);
                }
                else if (CommonsUtils.isString(data[key]) && data[key].startsWith(':')) {
                    /** @type {?} */
                    var param = ((/** @type {?} */ (data[key]))).substring(1);
                    if (params[param]) {
                        props[key] = params[param];
                    }
                }
                else if (key !== '$propsKey' && key !== '$propsWrapperKey' && key !== '$props') {
                    props[key] = data[key];
                }
            });
            props['$routeParams'] = params;
            LogUtils.debug(_this, '路由数据', routeData);
            props = _this.beforeRoutePropsBind(props);
            ComponentUtils.bind(_this, props);
            _this.afterRoutePropsBind();
        });
    };
    /**
     * @param {?} props
     * @return {?}
     */
    RouteBindComponent.prototype.beforeRoutePropsBind = /**
     * @param {?} props
     * @return {?}
     */
    function (props) {
        return props;
    };
    /**
     * @return {?}
     */
    RouteBindComponent.prototype.afterRoutePropsBind = /**
     * @return {?}
     */
    function () {
    };
    return RouteBindComponent;
}(BaseComponent));
export { RouteBindComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91ZS5iaW5kLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Blci9jb3JlLyIsInNvdXJjZXMiOlsibGliL2Jhc2VzL3JvdWUuYmluZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQ3ZDLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQztBQUNsRCxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sY0FBYyxDQUFDO0FBQ3RDLE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxjQUFjLENBQUM7QUFDeEMsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLGFBQWEsQ0FBQztBQUcxQztJQUF3Qyw4Q0FBYTtJQUFyRDs7SUFzREEsQ0FBQzs7OztJQXBEQyxxQ0FBUTs7O0lBQVI7UUFBQSxpQkE0Q0M7UUEzQ0MsSUFBSSxDQUFDLGNBQWMsR0FBRyxVQUFVLENBQUMsY0FBYyxFQUFFLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxVQUFBLEdBQUc7O2dCQUM3RCxXQUFXLEdBQUcsVUFBVSxDQUFDLGNBQWMsRUFBRTtZQUM3QyxJQUFJLENBQUMsV0FBVyxFQUFFO2dCQUNoQixPQUFPO2FBQ1I7O2dCQUNLLElBQUksR0FBRyxZQUFZLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDOztnQkFDbkQsTUFBTSx3QkFDUCxXQUFXLENBQUMsUUFBUSxDQUFDLE1BQU0sSUFBSSxFQUFFLEVBQ2pDLFdBQVcsQ0FBQyxRQUFRLENBQUMsV0FBVyxJQUFJLEVBQUUsQ0FDMUM7WUFDRCxPQUFPLFdBQVcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUMxRCxXQUFXLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQzthQUNsQzs7Z0JBQ0ssU0FBUyx3QkFDVixXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksRUFDekIsSUFBSSxDQUNSOztnQkFDRyxLQUFLLEdBQUcsWUFBWSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDakYsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUU7Z0JBQ3JCLEtBQUssR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQzthQUNwRDtZQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQUEsR0FBRztnQkFDM0IsSUFBSSxZQUFZLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO29CQUN0QyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxtQkFBVSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUEsQ0FBQyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7aUJBQ3pEO3FCQUFNLElBQUksWUFBWSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxFQUFFOzt3QkFDbEUsS0FBSyxHQUFHLENBQUMsbUJBQVEsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFBLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO29CQUM5QyxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRTt3QkFDakIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztxQkFDNUI7aUJBQ0Y7cUJBQU0sSUFBSSxHQUFHLEtBQUssV0FBVyxJQUFJLEdBQUcsS0FBSyxrQkFBa0IsSUFBSSxHQUFHLEtBQUssUUFBUSxFQUFFO29CQUNoRixLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUN4QjtZQUNILENBQUMsQ0FBQyxDQUFDO1lBQ0gsS0FBSyxDQUFDLGNBQWMsQ0FBQyxHQUFHLE1BQU0sQ0FBQztZQUUvQixRQUFRLENBQUMsS0FBSyxDQUFDLEtBQUksRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFFeEMsS0FBSyxHQUFHLEtBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUV6QyxjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztZQUVqQyxLQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUM3QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7Ozs7O0lBRUQsaURBQW9COzs7O0lBQXBCLFVBQXFCLEtBQUs7UUFDeEIsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDOzs7O0lBRUQsZ0RBQW1COzs7SUFBbkI7SUFDQSxDQUFDO0lBQ0gseUJBQUM7QUFBRCxDQUFDLEFBdERELENBQXdDLGFBQWEsR0FzRHBEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtPbkluaXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtDb21tb25zVXRpbHN9IGZyb20gJ0Blci91dGlscyc7XG5pbXBvcnQge0NvbXBvbmVudFV0aWxzfSBmcm9tICcuLi91dGlscy9jb21wb25lbnQnO1xuaW1wb3J0IHtMb2dVdGlsc30gZnJvbSAnLi4vdXRpbHMvbG9nJztcbmltcG9ydCB7Um91dGVVdGlsc30gZnJvbSAnLi4vdXRpbHMvbmF2JztcbmltcG9ydCB7QmFzZUNvbXBvbmVudH0gZnJvbSAnLi9jb21wb25lbnQnO1xuXG5cbmV4cG9ydCBjbGFzcyBSb3V0ZUJpbmRDb21wb25lbnQgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLiRzdWJzY3JpcHRpb25zID0gUm91dGVVdGlscy5nZXRBY3RpdmVSb3V0ZSgpLnVybC5zdWJzY3JpYmUodXJsID0+IHtcbiAgICAgIGxldCBhY3RpdmVSb3V0ZSA9IFJvdXRlVXRpbHMuZ2V0QWN0aXZlUm91dGUoKTtcbiAgICAgIGlmICghYWN0aXZlUm91dGUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgZGF0YSA9IENvbW1vbnNVdGlscy5jb3B5KGFjdGl2ZVJvdXRlLnNuYXBzaG90LmRhdGEpO1xuICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICAuLi5hY3RpdmVSb3V0ZS5zbmFwc2hvdC5wYXJhbXMgfHwge30sXG4gICAgICAgIC4uLmFjdGl2ZVJvdXRlLnNuYXBzaG90LnF1ZXJ5UGFyYW1zIHx8IHt9XG4gICAgICB9O1xuICAgICAgd2hpbGUgKGFjdGl2ZVJvdXRlICYmICFhY3RpdmVSb3V0ZS5zbmFwc2hvdC5kYXRhWyckcHJvcHMnXSkge1xuICAgICAgICBhY3RpdmVSb3V0ZSA9IGFjdGl2ZVJvdXRlLnBhcmVudDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJvdXRlRGF0YSA9IHtcbiAgICAgICAgLi4uYWN0aXZlUm91dGUuc25hcHNob3QuZGF0YSxcbiAgICAgICAgLi4uZGF0YVxuICAgICAgfTtcbiAgICAgIGxldCBwcm9wcyA9IENvbW1vbnNVdGlscy5jb3B5KHJvdXRlRGF0YVsnJHJlc29sdmVkUHJvcHMnXSB8fCByb3V0ZURhdGFbJyRwcm9wcyddKTtcbiAgICAgIGlmIChkYXRhWyckcHJvcHNLZXknXSkge1xuICAgICAgICBwcm9wcyA9IENvbW1vbnNVdGlscy5nZXQocHJvcHMsIGRhdGFbJyRwcm9wc0tleSddKTtcbiAgICAgIH1cbiAgICAgIE9iamVjdC5rZXlzKGRhdGEpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgaWYgKENvbW1vbnNVdGlscy5pc0Z1bmN0aW9uKGRhdGFba2V5XSkpIHtcbiAgICAgICAgICBwcm9wc1trZXldID0gKDxGdW5jdGlvbj5kYXRhW2tleV0pKHByb3BzLCBwYXJhbXMsIGRhdGEpO1xuICAgICAgICB9IGVsc2UgaWYgKENvbW1vbnNVdGlscy5pc1N0cmluZyhkYXRhW2tleV0pICYmIGRhdGFba2V5XS5zdGFydHNXaXRoKCc6JykpIHtcbiAgICAgICAgICBjb25zdCBwYXJhbSA9ICg8c3RyaW5nPmRhdGFba2V5XSkuc3Vic3RyaW5nKDEpO1xuICAgICAgICAgIGlmIChwYXJhbXNbcGFyYW1dKSB7XG4gICAgICAgICAgICBwcm9wc1trZXldID0gcGFyYW1zW3BhcmFtXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoa2V5ICE9PSAnJHByb3BzS2V5JyAmJiBrZXkgIT09ICckcHJvcHNXcmFwcGVyS2V5JyAmJiBrZXkgIT09ICckcHJvcHMnKSB7XG4gICAgICAgICAgcHJvcHNba2V5XSA9IGRhdGFba2V5XTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBwcm9wc1snJHJvdXRlUGFyYW1zJ10gPSBwYXJhbXM7XG5cbiAgICAgIExvZ1V0aWxzLmRlYnVnKHRoaXMsICfot6/nlLHmlbDmja4nLCByb3V0ZURhdGEpO1xuXG4gICAgICBwcm9wcyA9IHRoaXMuYmVmb3JlUm91dGVQcm9wc0JpbmQocHJvcHMpO1xuXG4gICAgICBDb21wb25lbnRVdGlscy5iaW5kKHRoaXMsIHByb3BzKTtcblxuICAgICAgdGhpcy5hZnRlclJvdXRlUHJvcHNCaW5kKCk7XG4gICAgfSk7XG4gIH1cblxuICBiZWZvcmVSb3V0ZVByb3BzQmluZChwcm9wcyk6IHt9IHtcbiAgICByZXR1cm4gcHJvcHM7XG4gIH1cblxuICBhZnRlclJvdXRlUHJvcHNCaW5kKCkge1xuICB9XG59XG4iXX0=