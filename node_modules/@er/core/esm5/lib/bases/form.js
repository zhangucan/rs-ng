/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { EventEmitter, Input, Output } from '@angular/core';
import { FormControl, FormGroup } from '@angular/forms';
import { CommonsUtils, DialogUtils } from '@er/utils';
import { Observable } from 'rxjs';
import { first } from 'rxjs/operators';
import { ApiUtils } from '../utils/api';
import { BaseComponent } from './component';
/**
 * @abstract
 */
var BaseFormComponent = /** @class */ (function (_super) {
    tslib_1.__extends(BaseFormComponent, _super);
    function BaseFormComponent(cd) {
        var _this = _super.call(this) || this;
        _this.cd = cd;
        _this.options = {};
        _this.buttonsStyleClass = 'text-center my-5';
        _this.submitBtnStyleClass = 'btn btn-success';
        _this.resetBtnStyleClass = 'btn btn-danger';
        _this.initBtnStyleClass = 'btn btn-alert';
        _this.onSubmit = new EventEmitter();
        _this.onSubmitted = new EventEmitter();
        _this.onModel = new EventEmitter();
        _this.onFormValueChanges = new EventEmitter();
        _this.form = new FormGroup({});
        _this.templateNames = {
            header: 'header',
            buttons: 'buttons',
            footer: 'footer'
        };
        _this.runtimeData = {};
        _this.hasUpdated = false;
        return _this;
    }
    Object.defineProperty(BaseFormComponent.prototype, "model", {
        get: /**
         * @return {?}
         */
        function () {
            return this._model;
        },
        set: /**
         * @param {?} model
         * @return {?}
         */
        function (model) {
            this._model = CommonsUtils.omitBy(model, CommonsUtils.lodash().isUndefined);
            this.refresh();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    BaseFormComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        _super.prototype.ngOnInit.call(this);
        this.$subscriptions = this.form.valueChanges.subscribe(function (event) { return _this.onFormValueChanges.emit(event); });
    };
    Object.defineProperty(BaseFormComponent.prototype, "modelId", {
        get: /**
         * @return {?}
         */
        function () {
            return this._modelId;
        },
        set: /**
         * @param {?} modelId
         * @return {?}
         */
        function (modelId) {
            var _this = this;
            if (modelId !== this.modelId) {
                this._modelId = modelId;
                if (!modelId || modelId === '') {
                    this.resetModel();
                }
                else if (this.apiEntry) {
                    ApiUtils.getById(this.apiEntry, modelId, this.getModelOptions)
                        .subscribe(function (result) {
                        _this.model = result;
                        _this.form.updateValueAndValidity({ onlySelf: false, emitEvent: true });
                    });
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BaseFormComponent.prototype, "isFormValid", {
        get: /**
         * @return {?}
         */
        function () {
            if (!this.hasUpdated) {
                this.updateControls();
            }
            return this.form.valid;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BaseFormComponent.prototype, "httpTag", {
        get: /**
         * @return {?}
         */
        function () {
            return "http" + ('-' + this.formId || '');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BaseFormComponent.prototype, "formId", {
        get: /**
         * @return {?}
         */
        function () {
            return this.$id;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BaseFormComponent.prototype, "submitModel", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var model = tslib_1.__assign({}, this.model);
            if (this.submitRootKey) {
                model = this.model[this.submitRootKey];
            }
            if (this.submitExcludeKeys) {
                model = CommonsUtils.removeKeys.apply(CommonsUtils, tslib_1.__spread([model], CommonsUtils.getArrayValue(this.submitExcludeKeys)));
            }
            Object.keys(model).forEach(function (key) {
                if (key.startsWith('$_')) {
                    delete model[key];
                }
            });
            return model;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} fieldName
     * @return {?}
     */
    BaseFormComponent.prototype.formControl = /**
     * @param {?} fieldName
     * @return {?}
     */
    function (fieldName) {
        return this.form.controls[fieldName];
    };
    /**
     * @param {?} fieldName
     * @return {?}
     */
    BaseFormComponent.prototype.fieldComponent = /**
     * @param {?} fieldName
     * @return {?}
     */
    function (fieldName) {
        return this.form['components'][fieldName];
    };
    /**
     * @return {?}
     */
    BaseFormComponent.prototype.getFormErrorFields = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var errors = [];
        Object.keys(this.form.controls).forEach(function (key) {
            /** @type {?} */
            var controlErrors = _this.form.get(key).errors;
            if (controlErrors != null) {
                Object.keys(controlErrors).forEach(function (keyError) {
                    errors.push(key); // + ', err value: ', controlErrors[keyError]);
                });
            }
        });
        return errors;
    };
    /**
     * @param {?} model
     * @return {?}
     */
    BaseFormComponent.prototype.patchModel = /**
     * @param {?} model
     * @return {?}
     */
    function (model) {
        this.model = Object.assign({}, this.model || {}, model);
    };
    /**
     * @param {?} data
     * @return {?}
     */
    BaseFormComponent.prototype.patchRuntimeData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        Object.assign(this.runtimeData, data);
    };
    /**
     * @param {?} path
     * @return {?}
     */
    BaseFormComponent.prototype.isFieldValid = /**
     * @param {?} path
     * @return {?}
     */
    function (path) {
        /** @type {?} */
        var field = this.field(path);
        if (field) {
            return field.valid;
        }
        else {
            return undefined;
        }
    };
    /**
     * @param {?} fieldNamePath
     * @return {?}
     */
    BaseFormComponent.prototype.isFieldTouched = /**
     * @param {?} fieldNamePath
     * @return {?}
     */
    function (fieldNamePath) {
        /** @type {?} */
        var field = this.field(fieldNamePath);
        if (field) {
            return field.touched;
        }
        else {
            return undefined;
        }
    };
    /**
     * @param {?=} form
     * @return {?}
     */
    BaseFormComponent.prototype.updateControls = /**
     * @param {?=} form
     * @return {?}
     */
    function (form) {
        var _this = this;
        if (!form) {
            form = this.form;
        }
        Object.keys(form.controls).forEach(function (field) {
            /** @type {?} */
            var control = form.get(field);
            if (control instanceof FormControl) {
                control.markAsTouched({ onlySelf: true });
                // control.updateValueAndValidity({onlySelf: true});
            }
            else if (control instanceof FormGroup) {
                _this.updateControls(control);
            }
        });
        this.hasUpdated = true;
    };
    /**
     * @param {?} path
     * @return {?}
     */
    BaseFormComponent.prototype.field = /**
     * @param {?} path
     * @return {?}
     */
    function (path) {
        return this.form.get(path);
    };
    /**
     * @return {?}
     */
    BaseFormComponent.prototype.resetForm = /**
     * @return {?}
     */
    function () {
        this.form.reset({});
    };
    /**
     * @param {?=} reset
     * @return {?}
     */
    BaseFormComponent.prototype.resetModel = /**
     * @param {?=} reset
     * @return {?}
     */
    function (reset) {
        if (this.initModel) {
            this.model = CommonsUtils.copy(this.initModel);
        }
        else if (CommonsUtils.isJson(reset)) {
            this.model = tslib_1.__assign({}, reset);
        }
        else if (this.options['resetModel']) {
            this.options['resetModel']();
        }
        else {
            this.model = {};
        }
        this.form.reset(this.model, { emitEvent: true });
    };
    /**
     * @return {?}
     */
    BaseFormComponent.prototype.setInitModel = /**
     * @return {?}
     */
    function () {
        this.initModel = CommonsUtils.copy(this.model);
        if (this.options['updateInitialValue']) {
            this.options['updateInitialValue']();
        }
    };
    /**
     * @return {?}
     */
    BaseFormComponent.prototype.refresh = /**
     * @return {?}
     */
    function () {
        this.cd.detectChanges();
    };
    /**
     * @return {?}
     */
    BaseFormComponent.prototype.submit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.isFormValid) {
            DialogUtils.error('操作失败', '请填写完整信息后，再执行本操作！');
            return;
        }
        /** @type {?} */
        var result;
        if (this.beforeSubmit) {
            result = this.beforeSubmit(this.getEventContext());
            if (result instanceof Observable) {
                ((/** @type {?} */ (result)))
                    .pipe(first())
                    .subscribe(function (data) {
                    _this.submitAfterBefore(data);
                });
            }
            else {
                this.submitAfterBefore(result);
            }
        }
        else {
            this.doSubmit();
        }
    };
    /**
     * @param {?=} submitModel
     * @return {?}
     */
    BaseFormComponent.prototype.defaultSubmit = /**
     * @param {?=} submitModel
     * @return {?}
     */
    function (submitModel) {
        var _this = this;
        this.$subscriptions = ApiUtils.save.call(this, this.apiEntry, submitModel || this.submitModel, tslib_1.__assign({ tag: this.formId }, this.submitOptions || {}))
            .subscribe(function (data) {
            if (data.id && data.id !== _this.model['id']) {
                _this.model['id'] = data.id;
            }
            _this.onSubmitted.emit(_this.getEventContext({ response: data, model: _this.model, submitted: submitModel || _this.submitModel }));
            if (_this.afterSubmit) {
                /** @type {?} */
                var result = _this.afterSubmit(_this.getEventContext({ submitModel: submitModel || _this.submitModel, id: data.id }));
                if (result instanceof Observable) {
                    ((/** @type {?} */ (result)))
                        .pipe(first())
                        .subscribe(function (dat) {
                        _this.doPostSubmit(dat);
                    });
                }
                else {
                    _this.doPostSubmit(result);
                }
            }
            else {
                _this.doPostSubmit();
            }
        });
    };
    /**
     * @param {?=} other
     * @return {?}
     */
    BaseFormComponent.prototype.getEventContext = /**
     * @param {?=} other
     * @return {?}
     */
    function (other) {
        return (tslib_1.__assign({ formlyForm: this, form: (/** @type {?} */ (this.form)), model: this.model, modelId: this.modelId, entry: this.apiEntry, entity: (/** @type {?} */ (this.entity)) }, other || {}));
    };
    /**
     * @private
     * @param {?} result
     * @return {?}
     */
    BaseFormComponent.prototype.submitAfterBefore = /**
     * @private
     * @param {?} result
     * @return {?}
     */
    function (result) {
        if (result !== false) {
            if (CommonsUtils.isJson(result) && !CommonsUtils.isEmpty(result)) {
                this.doSubmit(result);
            }
            else {
                this.doSubmit();
            }
        }
    };
    /**
     * @private
     * @param {?=} submitModel
     * @return {?}
     */
    BaseFormComponent.prototype.doSubmit = /**
     * @private
     * @param {?=} submitModel
     * @return {?}
     */
    function (submitModel) {
        if (this.onSubmit.observers.length > 0) {
            this.onSubmit.emit(this.getEventContext({ submitModel: submitModel }));
        }
        else {
            this.defaultSubmit(submitModel);
        }
    };
    /**
     * @private
     * @param {?=} model
     * @return {?}
     */
    BaseFormComponent.prototype.doPostSubmit = /**
     * @private
     * @param {?=} model
     * @return {?}
     */
    function (model) {
        var _this = this;
        if (model) {
            this.resetModel(model);
        }
        else if (this.resetKeys) {
            /** @type {?} */
            var keys = CommonsUtils.getArrayValue(this.resetKeys);
            keys.forEach(function (key) { return delete _this.model[key]; });
            delete this.model['id'];
            this.form.reset(this.model, { emitEvent: true });
        }
        else if (this.resetAfterSubmit !== false) {
            this.resetModel(this.entity && this.entity.initValue || {});
        }
    };
    BaseFormComponent.propDecorators = {
        $id: [{ type: Input }],
        entity: [{ type: Input }],
        apiEntry: [{ type: Input }],
        options: [{ type: Input }],
        submitRootKey: [{ type: Input }],
        submitExcludeKeys: [{ type: Input }],
        resetKeys: [{ type: Input }],
        styleClass: [{ type: Input }],
        style: [{ type: Input }],
        formStyleClass: [{ type: Input }],
        formStyle: [{ type: Input }],
        buttonsStyleClass: [{ type: Input }],
        submitBtnStyleClass: [{ type: Input }],
        resetBtnStyleClass: [{ type: Input }],
        initBtnStyleClass: [{ type: Input }],
        header: [{ type: Input }],
        footer: [{ type: Input }],
        buttons: [{ type: Input }],
        getModelOptions: [{ type: Input }],
        submitOptions: [{ type: Input }],
        beforeSubmit: [{ type: Input }],
        afterSubmit: [{ type: Input }],
        valueChanges: [{ type: Input }],
        resetAfterSubmit: [{ type: Input }],
        onSubmit: [{ type: Output }],
        onSubmitted: [{ type: Output }],
        onModel: [{ type: Output }],
        onFormValueChanges: [{ type: Output }],
        model: [{ type: Input }],
        modelId: [{ type: Input }]
    };
    return BaseFormComponent;
}(BaseComponent));
export { BaseFormComponent };
if (false) {
    /** @type {?} */
    BaseFormComponent.prototype.$id;
    /** @type {?} */
    BaseFormComponent.prototype.entity;
    /** @type {?} */
    BaseFormComponent.prototype.apiEntry;
    /** @type {?} */
    BaseFormComponent.prototype.options;
    /** @type {?} */
    BaseFormComponent.prototype.submitRootKey;
    /** @type {?} */
    BaseFormComponent.prototype.submitExcludeKeys;
    /** @type {?} */
    BaseFormComponent.prototype.resetKeys;
    /** @type {?} */
    BaseFormComponent.prototype.styleClass;
    /** @type {?} */
    BaseFormComponent.prototype.style;
    /** @type {?} */
    BaseFormComponent.prototype.formStyleClass;
    /** @type {?} */
    BaseFormComponent.prototype.formStyle;
    /** @type {?} */
    BaseFormComponent.prototype.buttonsStyleClass;
    /** @type {?} */
    BaseFormComponent.prototype.submitBtnStyleClass;
    /** @type {?} */
    BaseFormComponent.prototype.resetBtnStyleClass;
    /** @type {?} */
    BaseFormComponent.prototype.initBtnStyleClass;
    /** @type {?} */
    BaseFormComponent.prototype.header;
    /** @type {?} */
    BaseFormComponent.prototype.footer;
    /** @type {?} */
    BaseFormComponent.prototype.buttons;
    /** @type {?} */
    BaseFormComponent.prototype.getModelOptions;
    /** @type {?} */
    BaseFormComponent.prototype.submitOptions;
    /** @type {?} */
    BaseFormComponent.prototype.beforeSubmit;
    /** @type {?} */
    BaseFormComponent.prototype.afterSubmit;
    /** @type {?} */
    BaseFormComponent.prototype.valueChanges;
    /** @type {?} */
    BaseFormComponent.prototype.resetAfterSubmit;
    /** @type {?} */
    BaseFormComponent.prototype.onSubmit;
    /** @type {?} */
    BaseFormComponent.prototype.onSubmitted;
    /** @type {?} */
    BaseFormComponent.prototype.onModel;
    /** @type {?} */
    BaseFormComponent.prototype.onFormValueChanges;
    /** @type {?} */
    BaseFormComponent.prototype.form;
    /** @type {?} */
    BaseFormComponent.prototype.templateNames;
    /**
     * @type {?}
     * @private
     */
    BaseFormComponent.prototype.initModel;
    /** @type {?} */
    BaseFormComponent.prototype.runtimeData;
    /**
     * @type {?}
     * @private
     */
    BaseFormComponent.prototype.hasUpdated;
    /**
     * @type {?}
     * @private
     */
    BaseFormComponent.prototype._model;
    /**
     * @type {?}
     * @private
     */
    BaseFormComponent.prototype._modelId;
    /**
     * @type {?}
     * @protected
     */
    BaseFormComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Blci9jb3JlLyIsInNvdXJjZXMiOlsibGliL2Jhc2VzL2Zvcm0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQW9CLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQzdFLE9BQU8sRUFBa0IsV0FBVyxFQUFFLFNBQVMsRUFBbUIsTUFBTSxnQkFBZ0IsQ0FBQztBQUV6RixPQUFPLEVBQUMsWUFBWSxFQUFFLFdBQVcsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUNwRCxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ2hDLE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sY0FBYyxDQUFDO0FBQ3RDLE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSxhQUFhLENBQUM7Ozs7QUFFMUM7SUFBZ0QsNkNBQWE7SUF3RTNELDJCQUFzQixFQUFxQjtRQUEzQyxZQUNFLGlCQUFPLFNBQ1I7UUFGcUIsUUFBRSxHQUFGLEVBQUUsQ0FBbUI7UUFoRWxDLGFBQU8sR0FBRyxFQUFFLENBQUM7UUFnQmIsdUJBQWlCLEdBQVEsa0JBQWtCLENBQUM7UUFFNUMseUJBQW1CLEdBQVEsaUJBQWlCLENBQUM7UUFFN0Msd0JBQWtCLEdBQVEsZ0JBQWdCLENBQUM7UUFFM0MsdUJBQWlCLEdBQVEsZUFBZSxDQUFDO1FBb0J4QyxjQUFRLEdBQXFCLElBQUksWUFBWSxFQUFFLENBQUM7UUFFaEQsaUJBQVcsR0FBcUIsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUVuRCxhQUFPLEdBQXFCLElBQUksWUFBWSxFQUFFLENBQUM7UUFFL0Msd0JBQWtCLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFFckUsVUFBSSxHQUFjLElBQUksU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRXBDLG1CQUFhLEdB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Qjs7SUFFbkIsbUNBQTRCOztJQUU1QixxQ0FBMEI7O0lBRTFCLG9DQUFzQjs7SUFFdEIsMENBQStCOztJQUUvQiw4Q0FBOEM7O0lBRTlDLHNDQUFzQzs7SUFFdEMsdUNBQXlCOztJQUV6QixrQ0FBb0I7O0lBRXBCLDJDQUE2Qjs7SUFFN0Isc0NBQXdCOztJQUV4Qiw4Q0FBcUQ7O0lBRXJELGdEQUFzRDs7SUFFdEQsK0NBQW9EOztJQUVwRCw4Q0FBa0Q7O0lBRWxELG1DQUE2Qjs7SUFFN0IsbUNBQTZCOztJQUU3QixvQ0FBaUM7O0lBRWpDLDRDQUE0Qzs7SUFFNUMsMENBQTBDOztJQUUxQyx5Q0FBa0U7O0lBRWxFLHdDQUErRDs7SUFFL0QseUNBQXlDOztJQUV6Qyw2Q0FBbUM7O0lBRW5DLHFDQUEwRDs7SUFFMUQsd0NBQTZEOztJQUU3RCxvQ0FBeUQ7O0lBRXpELCtDQUFxRTs7SUFFckUsaUNBQW9DOztJQUVwQywwQ0FJRTs7Ozs7SUFFRixzQ0FBc0I7O0lBRXRCLHdDQUFpQjs7Ozs7SUFFakIsdUNBQTJCOzs7OztJQU0zQixtQ0FBbUI7Ozs7O0lBWW5CLHFDQUFzQjs7Ozs7SUFoQlYsK0JBQStCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDaGFuZ2VEZXRlY3RvclJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7QWJzdHJhY3RDb250cm9sLCBGb3JtQ29udHJvbCwgRm9ybUdyb3VwLCBWYWxpZGF0aW9uRXJyb3JzfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQge0FwaVJlcXVlc3RPcHRpb25zLCBCdXR0b25Qcm9wcywgRGF0YUVudGl0eSwgRHluYUNvbnRlbnR9IGZyb20gJ0Blci90eXBlcyc7XG5pbXBvcnQge0NvbW1vbnNVdGlscywgRGlhbG9nVXRpbHN9IGZyb20gJ0Blci91dGlscyc7XG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtmaXJzdH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtBcGlVdGlsc30gZnJvbSAnLi4vdXRpbHMvYXBpJztcbmltcG9ydCB7QmFzZUNvbXBvbmVudH0gZnJvbSAnLi9jb21wb25lbnQnO1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmFzZUZvcm1Db21wb25lbnQgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcblxuICBASW5wdXQoKSAkaWQ/OiBhbnk7XG5cbiAgQElucHV0KCkgZW50aXR5OiBEYXRhRW50aXR5O1xuXG4gIEBJbnB1dCgpIGFwaUVudHJ5OiBzdHJpbmc7XG5cbiAgQElucHV0KCkgb3B0aW9ucyA9IHt9O1xuXG4gIEBJbnB1dCgpIHN1Ym1pdFJvb3RLZXk6IHN0cmluZztcblxuICBASW5wdXQoKSBzdWJtaXRFeGNsdWRlS2V5czogc3RyaW5nIHwgc3RyaW5nW107XG5cbiAgQElucHV0KCkgcmVzZXRLZXlzOiBzdHJpbmcgfCBzdHJpbmdbXTtcblxuICBASW5wdXQoKSBzdHlsZUNsYXNzOiBhbnk7XG5cbiAgQElucHV0KCkgc3R5bGU6IGFueTtcblxuICBASW5wdXQoKSBmb3JtU3R5bGVDbGFzczogYW55O1xuXG4gIEBJbnB1dCgpIGZvcm1TdHlsZTogYW55O1xuXG4gIEBJbnB1dCgpIGJ1dHRvbnNTdHlsZUNsYXNzOiBhbnkgPSAndGV4dC1jZW50ZXIgbXktNSc7XG5cbiAgQElucHV0KCkgc3VibWl0QnRuU3R5bGVDbGFzczogYW55ID0gJ2J0biBidG4tc3VjY2Vzcyc7XG5cbiAgQElucHV0KCkgcmVzZXRCdG5TdHlsZUNsYXNzOiBhbnkgPSAnYnRuIGJ0bi1kYW5nZXInO1xuXG4gIEBJbnB1dCgpIGluaXRCdG5TdHlsZUNsYXNzOiBhbnkgPSAnYnRuIGJ0bi1hbGVydCc7XG5cbiAgQElucHV0KCkgaGVhZGVyOiBEeW5hQ29udGVudDtcblxuICBASW5wdXQoKSBmb290ZXI6IER5bmFDb250ZW50O1xuXG4gIEBJbnB1dCgpIGJ1dHRvbnM/OiBCdXR0b25Qcm9wc1tdO1xuXG4gIEBJbnB1dCgpIGdldE1vZGVsT3B0aW9uczogQXBpUmVxdWVzdE9wdGlvbnM7XG5cbiAgQElucHV0KCkgc3VibWl0T3B0aW9uczogQXBpUmVxdWVzdE9wdGlvbnM7XG5cbiAgQElucHV0KCkgYmVmb3JlU3VibWl0OiAoY29udGV4dCkgPT4gYm9vbGVhbiB8IE9ic2VydmFibGU8Ym9vbGVhbj47XG5cbiAgQElucHV0KCkgYWZ0ZXJTdWJtaXQ6IChjb250ZXh0KSA9PiB2b2lkIHwge30gfCBPYnNlcnZhYmxlPGFueT47XG5cbiAgQElucHV0KCkgdmFsdWVDaGFuZ2VzOiAoY29udGV4dCkgPT4gdm9pZDtcblxuICBASW5wdXQoKSByZXNldEFmdGVyU3VibWl0OiBib29sZWFuO1xuXG4gIEBPdXRwdXQoKSBvblN1Ym1pdDogRXZlbnRFbWl0dGVyPHt9PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBAT3V0cHV0KCkgb25TdWJtaXR0ZWQ6IEV2ZW50RW1pdHRlcjx7fT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQE91dHB1dCgpIG9uTW9kZWw6IEV2ZW50RW1pdHRlcjx7fT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQE91dHB1dCgpIG9uRm9ybVZhbHVlQ2hhbmdlczogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgZm9ybTogRm9ybUdyb3VwID0gbmV3IEZvcm1Hcm91cCh7fSk7XG5cbiAgdGVtcGxhdGVOYW1lcyA9IHtcbiAgICBoZWFkZXI6ICdoZWFkZXInLFxuICAgIGJ1dHRvbnM6ICdidXR0b25zJyxcbiAgICBmb290ZXI6ICdmb290ZXInXG4gIH07XG5cbiAgcHJpdmF0ZSBpbml0TW9kZWw6IHt9O1xuXG4gIHJ1bnRpbWVEYXRhID0ge307XG5cbiAgcHJpdmF0ZSBoYXNVcGRhdGVkID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGNkOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBwcml2YXRlIF9tb2RlbDoge307XG5cbiAgQElucHV0KClcbiAgZ2V0IG1vZGVsKCkge1xuICAgIHJldHVybiB0aGlzLl9tb2RlbDtcbiAgfVxuXG4gIHNldCBtb2RlbChtb2RlbCkge1xuICAgIHRoaXMuX21vZGVsID0gQ29tbW9uc1V0aWxzLm9taXRCeShtb2RlbCwgQ29tbW9uc1V0aWxzLmxvZGFzaCgpLmlzVW5kZWZpbmVkKTtcbiAgICB0aGlzLnJlZnJlc2goKTtcbiAgfVxuXG4gIHByaXZhdGUgX21vZGVsSWQ6IGFueTtcblxuICBuZ09uSW5pdCgpIHtcbiAgICBzdXBlci5uZ09uSW5pdCgpO1xuICAgIHRoaXMuJHN1YnNjcmlwdGlvbnMgPSB0aGlzLmZvcm0udmFsdWVDaGFuZ2VzLnN1YnNjcmliZShldmVudCA9PiB0aGlzLm9uRm9ybVZhbHVlQ2hhbmdlcy5lbWl0KGV2ZW50KSk7XG4gIH1cblxuICBASW5wdXQoKVxuICBnZXQgbW9kZWxJZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fbW9kZWxJZDtcbiAgfVxuXG4gIHNldCBtb2RlbElkKG1vZGVsSWQpIHtcbiAgICBpZiAobW9kZWxJZCAhPT0gdGhpcy5tb2RlbElkKSB7XG4gICAgICB0aGlzLl9tb2RlbElkID0gbW9kZWxJZDtcbiAgICAgIGlmICghbW9kZWxJZCB8fCBtb2RlbElkID09PSAnJykge1xuICAgICAgICB0aGlzLnJlc2V0TW9kZWwoKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlFbnRyeSkge1xuICAgICAgICBBcGlVdGlscy5nZXRCeUlkKHRoaXMuYXBpRW50cnksIG1vZGVsSWQsIHRoaXMuZ2V0TW9kZWxPcHRpb25zKVxuICAgICAgICAgIC5zdWJzY3JpYmUocmVzdWx0ID0+IHtcbiAgICAgICAgICAgIHRoaXMubW9kZWwgPSByZXN1bHQ7XG4gICAgICAgICAgICB0aGlzLmZvcm0udXBkYXRlVmFsdWVBbmRWYWxpZGl0eSh7b25seVNlbGY6IGZhbHNlLCBlbWl0RXZlbnQ6IHRydWV9KTtcbiAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBnZXQgaXNGb3JtVmFsaWQoKSB7XG4gICAgaWYgKCF0aGlzLmhhc1VwZGF0ZWQpIHtcbiAgICAgIHRoaXMudXBkYXRlQ29udHJvbHMoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZm9ybS52YWxpZDtcbiAgfVxuXG4gIGdldCBodHRwVGFnKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBodHRwJHsnLScgKyB0aGlzLmZvcm1JZCB8fCAnJ31gO1xuICB9XG5cbiAgZ2V0IGZvcm1JZCgpIHtcbiAgICByZXR1cm4gdGhpcy4kaWQ7XG4gIH1cblxuICBnZXQgc3VibWl0TW9kZWwoKSB7XG4gICAgbGV0IG1vZGVsID0gey4uLnRoaXMubW9kZWx9O1xuICAgIGlmICh0aGlzLnN1Ym1pdFJvb3RLZXkpIHtcbiAgICAgIG1vZGVsID0gdGhpcy5tb2RlbFt0aGlzLnN1Ym1pdFJvb3RLZXldO1xuICAgIH1cbiAgICBpZiAodGhpcy5zdWJtaXRFeGNsdWRlS2V5cykge1xuICAgICAgbW9kZWwgPSBDb21tb25zVXRpbHMucmVtb3ZlS2V5cyhtb2RlbCwgLi4uQ29tbW9uc1V0aWxzLmdldEFycmF5VmFsdWUodGhpcy5zdWJtaXRFeGNsdWRlS2V5cykpO1xuICAgIH1cbiAgICBPYmplY3Qua2V5cyhtb2RlbCkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgaWYgKGtleS5zdGFydHNXaXRoKCckXycpKSB7XG4gICAgICAgIGRlbGV0ZSBtb2RlbFtrZXldO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBtb2RlbDtcbiAgfVxuXG4gIGZvcm1Db250cm9sKGZpZWxkTmFtZSk6IEFic3RyYWN0Q29udHJvbCB7XG4gICAgcmV0dXJuIHRoaXMuZm9ybS5jb250cm9sc1tmaWVsZE5hbWVdO1xuICB9XG5cbiAgZmllbGRDb21wb25lbnQoZmllbGROYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMuZm9ybVsnY29tcG9uZW50cyddW2ZpZWxkTmFtZV07XG4gIH1cblxuICBnZXRGb3JtRXJyb3JGaWVsZHMoKSB7XG4gICAgY29uc3QgZXJyb3JzID0gW107XG4gICAgT2JqZWN0LmtleXModGhpcy5mb3JtLmNvbnRyb2xzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBjb25zdCBjb250cm9sRXJyb3JzOiBWYWxpZGF0aW9uRXJyb3JzID0gdGhpcy5mb3JtLmdldChrZXkpLmVycm9ycztcbiAgICAgIGlmIChjb250cm9sRXJyb3JzICE9IG51bGwpIHtcbiAgICAgICAgT2JqZWN0LmtleXMoY29udHJvbEVycm9ycykuZm9yRWFjaChrZXlFcnJvciA9PiB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goa2V5KTsgLy8gKyAnLCBlcnIgdmFsdWU6ICcsIGNvbnRyb2xFcnJvcnNba2V5RXJyb3JdKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGVycm9ycztcbiAgfVxuXG4gIHBhdGNoTW9kZWwobW9kZWwpIHtcbiAgICB0aGlzLm1vZGVsID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5tb2RlbCB8fCB7fSwgbW9kZWwpO1xuICB9XG5cbiAgcGF0Y2hSdW50aW1lRGF0YShkYXRhKSB7XG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLnJ1bnRpbWVEYXRhLCBkYXRhKTtcbiAgfVxuXG4gIGlzRmllbGRWYWxpZChwYXRoOiBzdHJpbmcgfCBzdHJpbmdbXSkge1xuICAgIGNvbnN0IGZpZWxkID0gdGhpcy5maWVsZChwYXRoKTtcbiAgICBpZiAoZmllbGQpIHtcbiAgICAgIHJldHVybiBmaWVsZC52YWxpZDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBpc0ZpZWxkVG91Y2hlZChmaWVsZE5hbWVQYXRoOiBzdHJpbmcpIHtcbiAgICBjb25zdCBmaWVsZCA9IHRoaXMuZmllbGQoZmllbGROYW1lUGF0aCk7XG4gICAgaWYgKGZpZWxkKSB7XG4gICAgICByZXR1cm4gZmllbGQudG91Y2hlZDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVDb250cm9scyhmb3JtPzogRm9ybUdyb3VwKSB7XG4gICAgaWYgKCFmb3JtKSB7XG4gICAgICBmb3JtID0gdGhpcy5mb3JtO1xuICAgIH1cbiAgICBPYmplY3Qua2V5cyhmb3JtLmNvbnRyb2xzKS5mb3JFYWNoKGZpZWxkID0+IHtcbiAgICAgIGNvbnN0IGNvbnRyb2wgPSBmb3JtLmdldChmaWVsZCk7XG4gICAgICBpZiAoY29udHJvbCBpbnN0YW5jZW9mIEZvcm1Db250cm9sKSB7XG4gICAgICAgIGNvbnRyb2wubWFya0FzVG91Y2hlZCh7b25seVNlbGY6IHRydWV9KTtcbiAgICAgICAgLy8gY29udHJvbC51cGRhdGVWYWx1ZUFuZFZhbGlkaXR5KHtvbmx5U2VsZjogdHJ1ZX0pO1xuICAgICAgfSBlbHNlIGlmIChjb250cm9sIGluc3RhbmNlb2YgRm9ybUdyb3VwKSB7XG4gICAgICAgIHRoaXMudXBkYXRlQ29udHJvbHMoY29udHJvbCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5oYXNVcGRhdGVkID0gdHJ1ZTtcbiAgfVxuXG4gIGZpZWxkKHBhdGg6IHN0cmluZyB8IHN0cmluZ1tdKTogQWJzdHJhY3RDb250cm9sIHtcbiAgICByZXR1cm4gdGhpcy5mb3JtLmdldChwYXRoKTtcbiAgfVxuXG4gIHJlc2V0Rm9ybSgpIHtcbiAgICB0aGlzLmZvcm0ucmVzZXQoe30pO1xuICB9XG5cbiAgcmVzZXRNb2RlbChyZXNldD8pIHtcbiAgICBpZiAodGhpcy5pbml0TW9kZWwpIHtcbiAgICAgIHRoaXMubW9kZWwgPSBDb21tb25zVXRpbHMuY29weSh0aGlzLmluaXRNb2RlbCk7XG4gICAgfSBlbHNlIGlmIChDb21tb25zVXRpbHMuaXNKc29uKHJlc2V0KSkge1xuICAgICAgdGhpcy5tb2RlbCA9IHsuLi5yZXNldH07XG4gICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnNbJ3Jlc2V0TW9kZWwnXSkge1xuICAgICAgdGhpcy5vcHRpb25zWydyZXNldE1vZGVsJ10oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tb2RlbCA9IHt9O1xuICAgIH1cbiAgICB0aGlzLmZvcm0ucmVzZXQodGhpcy5tb2RlbCwge2VtaXRFdmVudDogdHJ1ZX0pO1xuICB9XG5cbiAgc2V0SW5pdE1vZGVsKCkge1xuICAgIHRoaXMuaW5pdE1vZGVsID0gQ29tbW9uc1V0aWxzLmNvcHkodGhpcy5tb2RlbCk7XG4gICAgaWYgKHRoaXMub3B0aW9uc1sndXBkYXRlSW5pdGlhbFZhbHVlJ10pIHtcbiAgICAgIHRoaXMub3B0aW9uc1sndXBkYXRlSW5pdGlhbFZhbHVlJ10oKTtcbiAgICB9XG4gIH1cblxuICByZWZyZXNoKCkge1xuICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgc3VibWl0KCkge1xuICAgIGlmICghdGhpcy5pc0Zvcm1WYWxpZCkge1xuICAgICAgRGlhbG9nVXRpbHMuZXJyb3IoJ+aTjeS9nOWksei0pScsICfor7floavlhpnlrozmlbTkv6Hmga/lkI7vvIzlho3miafooYzmnKzmk43kvZzvvIEnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IHJlc3VsdDtcbiAgICBpZiAodGhpcy5iZWZvcmVTdWJtaXQpIHtcbiAgICAgIHJlc3VsdCA9IHRoaXMuYmVmb3JlU3VibWl0KHRoaXMuZ2V0RXZlbnRDb250ZXh0KCkpO1xuICAgICAgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIE9ic2VydmFibGUpIHtcbiAgICAgICAgKDxPYnNlcnZhYmxlPGJvb2xlYW4+PnJlc3VsdClcbiAgICAgICAgICAucGlwZShmaXJzdCgpKVxuICAgICAgICAgIC5zdWJzY3JpYmUoZGF0YSA9PiB7XG4gICAgICAgICAgICB0aGlzLnN1Ym1pdEFmdGVyQmVmb3JlKGRhdGEpO1xuICAgICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zdWJtaXRBZnRlckJlZm9yZShyZXN1bHQpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRvU3VibWl0KCk7XG4gICAgfVxuICB9XG5cbiAgZGVmYXVsdFN1Ym1pdChzdWJtaXRNb2RlbD8pIHtcbiAgICB0aGlzLiRzdWJzY3JpcHRpb25zID0gQXBpVXRpbHMuc2F2ZS5jYWxsKHRoaXMsIHRoaXMuYXBpRW50cnksIHN1Ym1pdE1vZGVsIHx8IHRoaXMuc3VibWl0TW9kZWwsIHtcbiAgICAgIHRhZzogdGhpcy5mb3JtSWQsXG4gICAgICAuLi50aGlzLnN1Ym1pdE9wdGlvbnMgfHwge31cbiAgICB9KVxuICAgICAgLnN1YnNjcmliZShkYXRhID0+IHtcbiAgICAgICAgaWYgKGRhdGEuaWQgJiYgZGF0YS5pZCAhPT0gdGhpcy5tb2RlbFsnaWQnXSkge1xuICAgICAgICAgIHRoaXMubW9kZWxbJ2lkJ10gPSBkYXRhLmlkO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub25TdWJtaXR0ZWQuZW1pdCh0aGlzLmdldEV2ZW50Q29udGV4dCh7cmVzcG9uc2U6IGRhdGEsIG1vZGVsOiB0aGlzLm1vZGVsLCBzdWJtaXR0ZWQ6IHN1Ym1pdE1vZGVsIHx8IHRoaXMuc3VibWl0TW9kZWx9KSk7XG4gICAgICAgIGlmICh0aGlzLmFmdGVyU3VibWl0KSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5hZnRlclN1Ym1pdCh0aGlzLmdldEV2ZW50Q29udGV4dCh7c3VibWl0TW9kZWw6IHN1Ym1pdE1vZGVsIHx8IHRoaXMuc3VibWl0TW9kZWwsIGlkOiBkYXRhLmlkfSkpO1xuICAgICAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBPYnNlcnZhYmxlKSB7XG4gICAgICAgICAgICAoPE9ic2VydmFibGU8YW55Pj5yZXN1bHQpXG4gICAgICAgICAgICAgIC5waXBlKGZpcnN0KCkpXG4gICAgICAgICAgICAgIC5zdWJzY3JpYmUoZGF0ID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmRvUG9zdFN1Ym1pdChkYXQpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5kb1Bvc3RTdWJtaXQocmVzdWx0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5kb1Bvc3RTdWJtaXQoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH1cblxuICBnZXRFdmVudENvbnRleHQob3RoZXI/KSB7XG4gICAgcmV0dXJuICh7XG4gICAgICBmb3JtbHlGb3JtOiB0aGlzLFxuICAgICAgZm9ybTogPEZvcm1Hcm91cD50aGlzLmZvcm0sXG4gICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgIG1vZGVsSWQ6IHRoaXMubW9kZWxJZCxcbiAgICAgIGVudHJ5OiB0aGlzLmFwaUVudHJ5LFxuICAgICAgZW50aXR5OiA8RGF0YUVudGl0eT50aGlzLmVudGl0eSxcbiAgICAgIC4uLm90aGVyIHx8IHt9XG4gICAgfSk7XG4gIH1cblxuXG4gIHByaXZhdGUgc3VibWl0QWZ0ZXJCZWZvcmUocmVzdWx0KSB7XG4gICAgaWYgKHJlc3VsdCAhPT0gZmFsc2UpIHtcbiAgICAgIGlmIChDb21tb25zVXRpbHMuaXNKc29uKHJlc3VsdCkgJiYgIUNvbW1vbnNVdGlscy5pc0VtcHR5KHJlc3VsdCkpIHtcbiAgICAgICAgdGhpcy5kb1N1Ym1pdChyZXN1bHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5kb1N1Ym1pdCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZG9TdWJtaXQoc3VibWl0TW9kZWw/KSB7XG4gICAgaWYgKHRoaXMub25TdWJtaXQub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMub25TdWJtaXQuZW1pdCh0aGlzLmdldEV2ZW50Q29udGV4dCh7c3VibWl0TW9kZWx9KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZGVmYXVsdFN1Ym1pdChzdWJtaXRNb2RlbCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBkb1Bvc3RTdWJtaXQobW9kZWw/KSB7XG4gICAgaWYgKG1vZGVsKSB7XG4gICAgICB0aGlzLnJlc2V0TW9kZWwobW9kZWwpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5yZXNldEtleXMpIHtcbiAgICAgIGNvbnN0IGtleXMgPSBDb21tb25zVXRpbHMuZ2V0QXJyYXlWYWx1ZSh0aGlzLnJlc2V0S2V5cyk7XG4gICAgICBrZXlzLmZvckVhY2goa2V5ID0+IGRlbGV0ZSB0aGlzLm1vZGVsW2tleV0pO1xuICAgICAgZGVsZXRlIHRoaXMubW9kZWxbJ2lkJ107XG4gICAgICB0aGlzLmZvcm0ucmVzZXQodGhpcy5tb2RlbCwge2VtaXRFdmVudDogdHJ1ZX0pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5yZXNldEFmdGVyU3VibWl0ICE9PSBmYWxzZSkge1xuICAgICAgdGhpcy5yZXNldE1vZGVsKHRoaXMuZW50aXR5ICYmIHRoaXMuZW50aXR5LmluaXRWYWx1ZSB8fCB7fSk7XG4gICAgfVxuICB9XG59XG4iXX0=