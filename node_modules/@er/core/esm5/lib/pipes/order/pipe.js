/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Pipe } from '@angular/core';
var OrderByPipe = /** @class */ (function () {
    function OrderByPipe() {
    }
    /**
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    OrderByPipe._orderByComparator = /**
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    function (a, b) {
        try { // HACK cuz error when delete entire textbox of number and it compares
            if ((isNaN(parseFloat(a)) || !isFinite(a)) || (isNaN(parseFloat(b)) || !isFinite(b))) {
                //Isn't a number so lowercase the string to properly compare
                if (a.toLowerCase() < b.toLowerCase()) {
                    return -1;
                }
                if (a.toLowerCase() > b.toLowerCase()) {
                    return 1;
                }
            }
            else {
                // Parse strings as numbers to compare properly
                if (parseFloat(a) < parseFloat(b)) {
                    return -1;
                }
                if (parseFloat(a) > parseFloat(b)) {
                    return 1;
                }
            }
        }
        catch (e) {
            return 1;
        }
        return 0; //equal each other
    };
    /* filter property by string 'parent.child.item.orderKey' */
    /* filter property by string 'parent.child.item.orderKey' */
    /**
     * @param {?} obj
     * @param {?} propertyPath
     * @return {?}
     */
    OrderByPipe._getDeepValue = /* filter property by string 'parent.child.item.orderKey' */
    /**
     * @param {?} obj
     * @param {?} propertyPath
     * @return {?}
     */
    function (obj, propertyPath) {
        /** @type {?} */
        var pathList = propertyPath.split('??');
        if (pathList.length > 0) {
            /** @type {?} */
            var index = 0;
            /** @type {?} */
            var flag = false;
            /** @type {?} */
            var result = '';
            while (!flag) {
                result = getDeepValueByPath(obj, pathList[index]);
                if (result !== undefined) {
                    flag = true;
                }
                else {
                    index++;
                    if (pathList.length === index) {
                        flag = true;
                    }
                }
            }
            return result;
        }
        else {
            return getDeepValueByPath(obj, propertyPath);
        }
        /**
         * @param {?} obj
         * @param {?} path
         * @return {?}
         */
        function getDeepValueByPath(obj, path) {
            path = path.split('.');
            if (path.length > 0) {
                for (var i = 0; i < path.length; i++) {
                    if (obj[path[i]] !== undefined) {
                        obj = obj[path[i]];
                    }
                    else {
                        obj = undefined;
                        break;
                    }
                }
                return obj;
            }
            else {
                return obj[path];
            }
        }
    };
    /**
     * @param {?} input
     * @param {?} __1
     * @return {?}
     */
    OrderByPipe.prototype.transform = /**
     * @param {?} input
     * @param {?} __1
     * @return {?}
     */
    function (input, _a) {
        var _b = tslib_1.__read(_a, 1), _c = _b[0], config = _c === void 0 ? '+' : _c;
        if (!Array.isArray(input)) {
            return input;
        }
        if (!Array.isArray(config) || (Array.isArray(config) && config.length === 1)) {
            /** @type {?} */
            var propertyToCheck = !Array.isArray(config) ? config : config[0];
            /** @type {?} */
            var desc_1 = propertyToCheck.substr(0, 1) === '-';
            //Basic array
            if (!propertyToCheck || propertyToCheck === '-' || propertyToCheck === '+') {
                return !desc_1 ? input.sort() : input.sort().reverse();
            }
            else {
                /** @type {?} */
                var property_1 = propertyToCheck.substr(0, 1) === '+' || propertyToCheck.substr(0, 1) === '-'
                    ? propertyToCheck.substr(1)
                    : propertyToCheck;
                return input.sort(function (a, b) {
                    return !desc_1
                        ? OrderByPipe._orderByComparator(OrderByPipe._getDeepValue(a, property_1), OrderByPipe._getDeepValue(b, property_1))
                        : -OrderByPipe._orderByComparator(OrderByPipe._getDeepValue(a, property_1), OrderByPipe._getDeepValue(b, property_1));
                });
            }
        }
        else {
            //Loop over property of the array in order and sort
            return input.sort(function (a, b) {
                for (var i = 0; i < config.length; i++) {
                    /** @type {?} */
                    var desc = config[i].substr(0, 1) === '-';
                    /** @type {?} */
                    var property = config[i].substr(0, 1) === '+' || config[i].substr(0, 1) === '-'
                        ? config[i].substr(1)
                        : config[i];
                    /** @type {?} */
                    var comparison = !desc
                        ? OrderByPipe._orderByComparator(OrderByPipe._getDeepValue(a, property), OrderByPipe._getDeepValue(b, property))
                        : -OrderByPipe._orderByComparator(OrderByPipe._getDeepValue(a, property), OrderByPipe._getDeepValue(b, property));
                    //Don't return 0 yet in case of needing to sort by next property
                    if (comparison !== 0) {
                        return comparison;
                    }
                }
                return 0; //equal each other
            });
        }
    };
    OrderByPipe.decorators = [
        { type: Pipe, args: [{ name: 'orderBy', pure: false },] }
    ];
    return OrderByPipe;
}());
export { OrderByPipe };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGlwZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Blci9jb3JlLyIsInNvdXJjZXMiOlsibGliL3BpcGVzL29yZGVyL3BpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUMsSUFBSSxFQUFnQixNQUFNLGVBQWUsQ0FBQztBQUVsRDtJQUFBO0lBa0hBLENBQUM7Ozs7OztJQS9HUSw4QkFBa0I7Ozs7O0lBQXpCLFVBQTBCLENBQU0sRUFBRSxDQUFNO1FBRXRDLElBQUksRUFBRSxzRUFBc0U7WUFDMUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQ3BGLDREQUE0RDtnQkFDNUQsSUFBSSxDQUFDLENBQUMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFFO29CQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7aUJBQUU7Z0JBQ3JELElBQUksQ0FBQyxDQUFDLFdBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQyxXQUFXLEVBQUUsRUFBRTtvQkFBRSxPQUFPLENBQUMsQ0FBQztpQkFBRTthQUNyRDtpQkFBTTtnQkFDTCwrQ0FBK0M7Z0JBQy9DLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRTtvQkFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO2lCQUFFO2dCQUNqRCxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUU7b0JBQUUsT0FBTyxDQUFDLENBQUM7aUJBQUU7YUFDakQ7U0FDRjtRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsT0FBTyxDQUFDLENBQUM7U0FDVjtRQUVELE9B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QUFHO3dCQUMvRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7d0JBQ3JCLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDOzt3QkFFUCxVQUFVLEdBQUcsQ0FBQyxJQUFJO3dCQUN0QixDQUFDLENBQUMsV0FBVyxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO3dCQUNoSCxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLEVBQUUsV0FBVyxDQUFDLGFBQWEsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7b0JBRW5ILGdFQUFnRTtvQkFDaEUsSUFBSSxVQUFVLEtBQUssQ0FBQyxFQUFFO3dCQUFFLE9BQU8sVUFBVSxDQUFDO3FCQUFFO2lCQUM3QztnQkFFRCxPQUFPLENBQUMsQ0FBQyxDQUFDLGtCQUFrQjtZQUM5QixDQUFDLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQzs7Z0JBakhGLElBQUksU0FBQyxFQUFDLElBQUksRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBQzs7SUFrSHBDLGtCQUFDO0NBQUEsQUFsSEQsSUFrSEM7U0FqSFksV0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7UGlwZSwgUGlwZVRyYW5zZm9ybX0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBQaXBlKHtuYW1lOiAnb3JkZXJCeScsIHB1cmU6IGZhbHNlfSlcbmV4cG9ydCBjbGFzcyBPcmRlckJ5UGlwZSBpbXBsZW1lbnRzIFBpcGVUcmFuc2Zvcm0ge1xuXG4gIHN0YXRpYyBfb3JkZXJCeUNvbXBhcmF0b3IoYTogYW55LCBiOiBhbnkpOiBudW1iZXIge1xuXG4gICAgdHJ5IHsgLy8gSEFDSyBjdXogZXJyb3Igd2hlbiBkZWxldGUgZW50aXJlIHRleHRib3ggb2YgbnVtYmVyIGFuZCBpdCBjb21wYXJlc1xuICAgICAgaWYgKChpc05hTihwYXJzZUZsb2F0KGEpKSB8fCAhaXNGaW5pdGUoYSkpIHx8IChpc05hTihwYXJzZUZsb2F0KGIpKSB8fCAhaXNGaW5pdGUoYikpKSB7XG4gICAgICAgIC8vSXNuJ3QgYSBudW1iZXIgc28gbG93ZXJjYXNlIHRoZSBzdHJpbmcgdG8gcHJvcGVybHkgY29tcGFyZVxuICAgICAgICBpZiAoYS50b0xvd2VyQ2FzZSgpIDwgYi50b0xvd2VyQ2FzZSgpKSB7IHJldHVybiAtMTsgfVxuICAgICAgICBpZiAoYS50b0xvd2VyQ2FzZSgpID4gYi50b0xvd2VyQ2FzZSgpKSB7IHJldHVybiAxOyB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBQYXJzZSBzdHJpbmdzIGFzIG51bWJlcnMgdG8gY29tcGFyZSBwcm9wZXJseVxuICAgICAgICBpZiAocGFyc2VGbG9hdChhKSA8IHBhcnNlRmxvYXQoYikpIHsgcmV0dXJuIC0xOyB9XG4gICAgICAgIGlmIChwYXJzZUZsb2F0KGEpID4gcGFyc2VGbG9hdChiKSkgeyByZXR1cm4gMTsgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiAxO1xuICAgIH1cblxuICAgIHJldHVybiAwOyAvL2VxdWFsIGVhY2ggb3RoZXJcbiAgfVxuXG4gIC8qIGZpbHRlciBwcm9wZXJ0eSBieSBzdHJpbmcgJ3BhcmVudC5jaGlsZC5pdGVtLm9yZGVyS2V5JyAqL1xuICBzdGF0aWMgX2dldERlZXBWYWx1ZShvYmo6IGFueSwgcHJvcGVydHlQYXRoOiBzdHJpbmcpIHtcblxuICAgIGNvbnN0IHBhdGhMaXN0ID0gcHJvcGVydHlQYXRoLnNwbGl0KCc/PycpO1xuXG4gICAgaWYgKHBhdGhMaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBpbmRleCA9IDAsXG4gICAgICAgIGZsYWcgPSBmYWxzZSxcbiAgICAgICAgcmVzdWx0ID0gJyc7XG5cbiAgICAgIHdoaWxlICghZmxhZykge1xuICAgICAgICByZXN1bHQgPSBnZXREZWVwVmFsdWVCeVBhdGgob2JqLCBwYXRoTGlzdFtpbmRleF0pO1xuXG4gICAgICAgIGlmIChyZXN1bHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGZsYWcgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGluZGV4Kys7XG5cbiAgICAgICAgICBpZiAocGF0aExpc3QubGVuZ3RoID09PSBpbmRleCkge1xuICAgICAgICAgICAgZmxhZyA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBnZXREZWVwVmFsdWVCeVBhdGgob2JqLCBwcm9wZXJ0eVBhdGgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldERlZXBWYWx1ZUJ5UGF0aChvYmosIHBhdGgpIHtcbiAgICAgIHBhdGggPSBwYXRoLnNwbGl0KCcuJyk7XG5cbiAgICAgIGlmIChwYXRoLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYgKG9ialtwYXRoW2ldXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBvYmogPSBvYmpbcGF0aFtpXV07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG9iaiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG5cbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBvYmpbcGF0aF07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgdHJhbnNmb3JtKGlucHV0OiBhbnksIFtjb25maWcgPSAnKyddKTogYW55IHtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoaW5wdXQpKSB7IHJldHVybiBpbnB1dDsgfVxuXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGNvbmZpZykgfHwgKEFycmF5LmlzQXJyYXkoY29uZmlnKSAmJiBjb25maWcubGVuZ3RoID09PSAxKSkge1xuICAgICAgY29uc3QgcHJvcGVydHlUb0NoZWNrOiBzdHJpbmcgPSAhQXJyYXkuaXNBcnJheShjb25maWcpID8gY29uZmlnIDogY29uZmlnWzBdO1xuICAgICAgY29uc3QgZGVzYyA9IHByb3BlcnR5VG9DaGVjay5zdWJzdHIoMCwgMSkgPT09ICctJztcblxuICAgICAgLy9CYXNpYyBhcnJheVxuICAgICAgaWYgKCFwcm9wZXJ0eVRvQ2hlY2sgfHwgcHJvcGVydHlUb0NoZWNrID09PSAnLScgfHwgcHJvcGVydHlUb0NoZWNrID09PSAnKycpIHtcbiAgICAgICAgcmV0dXJuICFkZXNjID8gaW5wdXQuc29ydCgpIDogaW5wdXQuc29ydCgpLnJldmVyc2UoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHByb3BlcnR5OiBzdHJpbmcgPSBwcm9wZXJ0eVRvQ2hlY2suc3Vic3RyKDAsIDEpID09PSAnKycgfHwgcHJvcGVydHlUb0NoZWNrLnN1YnN0cigwLCAxKSA9PT0gJy0nXG4gICAgICAgICAgPyBwcm9wZXJ0eVRvQ2hlY2suc3Vic3RyKDEpXG4gICAgICAgICAgOiBwcm9wZXJ0eVRvQ2hlY2s7XG5cbiAgICAgICAgcmV0dXJuIGlucHV0LnNvcnQoZnVuY3Rpb24gKGE6IGFueSwgYjogYW55KSB7XG4gICAgICAgICAgcmV0dXJuICFkZXNjXG4gICAgICAgICAgICA/IE9yZGVyQnlQaXBlLl9vcmRlckJ5Q29tcGFyYXRvcihPcmRlckJ5UGlwZS5fZ2V0RGVlcFZhbHVlKGEsIHByb3BlcnR5KSwgT3JkZXJCeVBpcGUuX2dldERlZXBWYWx1ZShiLCBwcm9wZXJ0eSkpXG4gICAgICAgICAgICA6IC1PcmRlckJ5UGlwZS5fb3JkZXJCeUNvbXBhcmF0b3IoT3JkZXJCeVBpcGUuX2dldERlZXBWYWx1ZShhLCBwcm9wZXJ0eSksIE9yZGVyQnlQaXBlLl9nZXREZWVwVmFsdWUoYiwgcHJvcGVydHkpKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vTG9vcCBvdmVyIHByb3BlcnR5IG9mIHRoZSBhcnJheSBpbiBvcmRlciBhbmQgc29ydFxuICAgICAgcmV0dXJuIGlucHV0LnNvcnQoZnVuY3Rpb24gKGE6IGFueSwgYjogYW55KSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29uZmlnLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgY29uc3QgZGVzYyA9IGNvbmZpZ1tpXS5zdWJzdHIoMCwgMSkgPT09ICctJztcbiAgICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IGNvbmZpZ1tpXS5zdWJzdHIoMCwgMSkgPT09ICcrJyB8fCBjb25maWdbaV0uc3Vic3RyKDAsIDEpID09PSAnLSdcbiAgICAgICAgICAgID8gY29uZmlnW2ldLnN1YnN0cigxKVxuICAgICAgICAgICAgOiBjb25maWdbaV07XG5cbiAgICAgICAgICBjb25zdCBjb21wYXJpc29uID0gIWRlc2NcbiAgICAgICAgICAgID8gT3JkZXJCeVBpcGUuX29yZGVyQnlDb21wYXJhdG9yKE9yZGVyQnlQaXBlLl9nZXREZWVwVmFsdWUoYSwgcHJvcGVydHkpLCBPcmRlckJ5UGlwZS5fZ2V0RGVlcFZhbHVlKGIsIHByb3BlcnR5KSlcbiAgICAgICAgICAgIDogLU9yZGVyQnlQaXBlLl9vcmRlckJ5Q29tcGFyYXRvcihPcmRlckJ5UGlwZS5fZ2V0RGVlcFZhbHVlKGEsIHByb3BlcnR5KSwgT3JkZXJCeVBpcGUuX2dldERlZXBWYWx1ZShiLCBwcm9wZXJ0eSkpO1xuXG4gICAgICAgICAgLy9Eb24ndCByZXR1cm4gMCB5ZXQgaW4gY2FzZSBvZiBuZWVkaW5nIHRvIHNvcnQgYnkgbmV4dCBwcm9wZXJ0eVxuICAgICAgICAgIGlmIChjb21wYXJpc29uICE9PSAwKSB7IHJldHVybiBjb21wYXJpc29uOyB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gMDsgLy9lcXVhbCBlYWNoIG90aGVyXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==