/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, forwardRef, Input } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { THEME_COLORS } from '@er/types';
import { CommonsUtils } from '@er/utils';
import { ControlComponent } from '../../bases/control';
import { LogUtils } from '../../utils/log';
import { DEFAULT_QUERY_BUILDER_PROPS, EMPTY_QUERY_RULE_SET } from './defaults';
/** @type {?} */
var CONTROL_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(function () { return QueryBuilderComponent; }),
    multi: true
};
/** @type {?} */
var VALIDATOR = {
    provide: NG_VALIDATORS,
    useExisting: forwardRef(function () { return QueryBuilderComponent; }),
    multi: true
};
var QueryBuilderComponent = /** @class */ (function (_super) {
    tslib_1.__extends(QueryBuilderComponent, _super);
    function QueryBuilderComponent(changeDetectorRef) {
        var _this = _super.call(this) || this;
        _this.changeDetectorRef = changeDetectorRef;
        _this.ruleSet = { condition: 'AND', rules: [] };
        _this.defaultValue = EMPTY_QUERY_RULE_SET;
        _this.templateNames = {
            buttonGroup: 'buttonGroup',
            switchGroup: 'switchGroup',
            removeButton: 'removeButton',
            entity: 'entity',
            field: 'field',
            operator: 'operator',
            input: 'input',
            empty: 'empty'
        };
        _this._config = {};
        return _this;
    }
    Object.defineProperty(QueryBuilderComponent.prototype, "config", {
        get: /**
         * @return {?}
         */
        function () {
            return this._config;
        },
        set: /**
         * @param {?} config
         * @return {?}
         */
        function (config) {
            CommonsUtils.defaults(this._config, config, DEFAULT_QUERY_BUILDER_PROPS);
            LogUtils.debug(this, '查询构造器配置', this._config);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(QueryBuilderComponent.prototype, "value", {
        get: /**
         * @return {?}
         */
        function () {
            return this.ruleSet;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.ruleSet = value || { condition: 'AND', rules: [] };
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} control
     * @return {?}
     */
    QueryBuilderComponent.prototype.validate = /**
     * @param {?} control
     * @return {?}
     */
    function (control) {
        /** @type {?} */
        var errors = {};
        /** @type {?} */
        var ruleErrorStore = [];
        /** @type {?} */
        var hasErrors = false;
        if (!this.config.allowEmptyRuleSet && this.checkEmptyRuleInRuleSet(this.value)) {
            errors.empty = '查询定义不能为空.';
            hasErrors = true;
        }
        this.validateRulesInRuleSet(this.value, ruleErrorStore);
        if (ruleErrorStore.length) {
            errors.rules = ruleErrorStore;
            hasErrors = true;
        }
        return hasErrors ? errors : null;
    };
    /**
     * @param {?=} index
     * @return {?}
     */
    QueryBuilderComponent.prototype.ruleSetStyle = /**
     * @param {?=} index
     * @return {?}
     */
    function (index) {
        if (index === void 0) { index = 0; }
        /** @type {?} */
        var bgColor = Object.keys(THEME_COLORS).filter(function (color, i) { return i === index; });
        if (bgColor.length === 0) {
            bgColor[0] = 'blue';
        }
        return {
            'border-left-width': '5px',
            'border-left-style': 'solid',
            'border-left-color': THEME_COLORS[bgColor[0]]
        };
    };
    /**
     * @param {?} field
     * @return {?}
     */
    QueryBuilderComponent.prototype.getOperators = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        var _this = this;
        if (CommonsUtils.isFunction(this.config.operators)) {
            return ((/** @type {?} */ (this.config.operators)))(field);
        }
        else {
            /** @type {?} */
            var operators_1 = [];
            Object.keys(this.config.operators).forEach(function (key) {
                if (key === field.key) {
                    operators_1.push(_this.config.operators[key]);
                }
            });
            return operators_1;
        }
    };
    /**
     * @param {?=} entityKey
     * @return {?}
     */
    QueryBuilderComponent.prototype.getFields = /**
     * @param {?=} entityKey
     * @return {?}
     */
    function (entityKey) {
        if (this.config.entities && entityKey) {
            return this.config.fields.filter(function (field) {
                return field && field['entityKey'] === entityKey;
            });
        }
        else {
            return this.config.fields;
        }
    };
    /**
     * @param {?} rule
     * @return {?}
     */
    QueryBuilderComponent.prototype.getField = /**
     * @param {?} rule
     * @return {?}
     */
    function (rule) {
        /** @type {?} */
        var fields = this.getFields(rule.entity);
        if (fields) {
            /** @type {?} */
            var matched = fields.filter(function (field) { return field.key === rule.field; });
            if (matched && matched.length > 0) {
                return matched[0];
            }
        }
        return undefined;
    };
    /**
     * @param {...?} args
     * @return {?}
     */
    QueryBuilderComponent.prototype.getClassNames = /**
     * @param {...?} args
     * @return {?}
     */
    function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        /** @type {?} */
        var styleClasses = this.config.styleClasses;
        /** @type {?} */
        var classNames = args.map(function (id) { return styleClasses[id]; }).filter(function (c) { return !!c; });
        return classNames.length ? classNames.join(' ') : null;
    };
    /**
     * @param {?} rule
     * @return {?}
     */
    QueryBuilderComponent.prototype.isInValidRule = /**
     * @param {?} rule
     * @return {?}
     */
    function (rule) {
        return this.config.allowRuleSet && rule.rules && rule.rules.length === 0;
    };
    /**
     * @param {?} rule
     * @return {?}
     */
    QueryBuilderComponent.prototype.getRuleClassName = /**
     * @param {?} rule
     * @return {?}
     */
    function (rule) {
        /** @type {?} */
        var cls = this.getClassNames('row', 'connector', 'transition');
        cls += ' ' + this.getClassNames(rule['condition'] ? 'ruleSet' : 'rule');
        // if (ruleMeta.invalid) {
        // cls += ' ' + this.getClassNames('invalidRuleSet');
        // }
        return cls;
    };
    /**
     * @param {?} entity
     * @return {?}
     */
    QueryBuilderComponent.prototype.getDefaultDataField = /**
     * @param {?} entity
     * @return {?}
     */
    function (entity) {
        if (!entity) {
            return null;
        }
        else if (entity.defaultField !== undefined) {
            return this.getDefaultValue(entity.defaultField);
        }
        else {
            /** @type {?} */
            var entityDataFields = this.config.fields.filter(function (field) {
                return field && field['entityKey'] === entity.key;
            });
            if (entityDataFields && entityDataFields.length) {
                return entityDataFields[0];
            }
        }
    };
    /**
     * @param {?} field
     * @return {?}
     */
    QueryBuilderComponent.prototype.getDefaultOperator = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        if (field && field['defaultOperator'] !== undefined) {
            return this.getDefaultValue(field['defaultOperator']);
        }
        else {
            /** @type {?} */
            var operators = this.getOperators(field);
            if (operators && operators.length) {
                //  return operators[0];
            }
        }
    };
    /**
     * @return {?}
     */
    QueryBuilderComponent.prototype.addRule = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var parent = this.ruleSet;
        if (this.config.addRule) {
            this.config.addRule(parent);
        }
        else {
            /** @type {?} */
            var field = this.config.fields[0];
            parent.rules = tslib_1.__spread(parent.rules, [
                {
                    field: field.key,
                    entity: field['entityKey'],
                    operator: this.getDefaultOperator(field),
                    value: this.getDefaultValue(field.defaultValue)
                }
            ]);
        }
    };
    /**
     * @return {?}
     */
    QueryBuilderComponent.prototype.addRuleSet = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var parent = this.ruleSet;
        if (this.config.addRuleSet) {
            this.config.addRuleSet(parent);
        }
        else {
            parent.rules = tslib_1.__spread(parent.rules, [
                { condition: 'AND', rules: [] }
            ]);
        }
    };
    /**
     * @param {?} rule
     * @return {?}
     */
    QueryBuilderComponent.prototype.removeRule = /**
     * @param {?} rule
     * @return {?}
     */
    function (rule) {
        /** @type {?} */
        var parent = this.ruleSet;
        if (this.config.removeRule) {
            this.config.removeRule(rule, parent);
        }
        else {
            parent.rules = parent.rules.filter(function (r) { return r !== rule; });
        }
    };
    /**
     * @param {?=} ruleSet
     * @return {?}
     */
    QueryBuilderComponent.prototype.removeRuleSet = /**
     * @param {?=} ruleSet
     * @return {?}
     */
    function (ruleSet) {
        ruleSet = ruleSet || this.ruleSet;
        /** @type {?} */
        var parent = this.parentRuleSet;
        if (this.config.removeRuleSet) {
            this.config.removeRuleSet(ruleSet, parent);
        }
        else {
            parent.rules = parent.rules.filter(function (r) { return r !== ruleSet; });
        }
    };
    /**
     * @param {?} value
     * @return {?}
     */
    QueryBuilderComponent.prototype.changeCondition = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.ruleSet.condition = value;
    };
    /**
     * @param {?} key
     * @param {?} rule
     * @return {?}
     */
    QueryBuilderComponent.prototype.changeField = /**
     * @param {?} key
     * @param {?} rule
     * @return {?}
     */
    function (key, rule) {
        /** @type {?} */
        var field = this.config.fields[key];
        if (field && field.defaultValue !== undefined) {
            rule.value = this.getDefaultValue(field.defaultValue);
        }
        else {
            delete rule.value;
        }
        rule.operator = this.getDefaultOperator(field);
    };
    /**
     * @param {?} entityValue
     * @param {?} rule
     * @return {?}
     */
    QueryBuilderComponent.prototype.changeEntity = /**
     * @param {?} entityValue
     * @param {?} rule
     * @return {?}
     */
    function (entityValue, rule) {
        if (this.disabled) {
            return;
        }
        // const currentEntity: DataEntity = this.config.entities.find((e) => e.value === entityValue);
        // const defaultDataField: DataField = this.getDefaultDataField(currentEntity);
        // if (defaultDataField) {
        //   this.changeDataField(defaultDataField.key, rule);
        // }
    };
    /**
     * @param {?} defaultValue
     * @return {?}
     */
    QueryBuilderComponent.prototype.getDefaultValue = /**
     * @param {?} defaultValue
     * @return {?}
     */
    function (defaultValue) {
        switch (typeof defaultValue) {
            case 'function':
                return defaultValue();
            default:
                return defaultValue;
        }
    };
    /**
     * @param {?=} context
     * @return {?}
     */
    QueryBuilderComponent.prototype.context = /**
     * @param {?=} context
     * @return {?}
     */
    function (context) {
        return tslib_1.__assign({ qb: (/** @type {?} */ (this)) }, context);
    };
    /**
     * @private
     * @param {?} ruleSet
     * @return {?}
     */
    QueryBuilderComponent.prototype.checkEmptyRuleInRuleSet = /**
     * @private
     * @param {?} ruleSet
     * @return {?}
     */
    function (ruleSet) {
        var _this = this;
        if (!ruleSet || !ruleSet.rules || ruleSet.rules.length === 0) {
            return true;
        }
        else {
            return ruleSet.rules.some(function (item) {
                if (item.rules) {
                    return _this.checkEmptyRuleInRuleSet(item);
                }
                else {
                    return false;
                }
            });
        }
    };
    /**
     * @private
     * @param {?} ruleSet
     * @param {?} errorStore
     * @return {?}
     */
    QueryBuilderComponent.prototype.validateRulesInRuleSet = /**
     * @private
     * @param {?} ruleSet
     * @param {?} errorStore
     * @return {?}
     */
    function (ruleSet, errorStore) {
        var _this = this;
        if (ruleSet && ruleSet.rules && ruleSet.rules.length > 0) {
            ruleSet.rules.forEach(function (item) {
                if (((/** @type {?} */ (item))).rules) {
                    return _this.validateRulesInRuleSet((/** @type {?} */ (item)), errorStore);
                }
                else if (((/** @type {?} */ (item))).field) {
                    /** @type {?} */
                    var field = _this.config.fields[((/** @type {?} */ (item))).field];
                    if (field && field['validator'] && field['validator'].apply) {
                        /** @type {?} */
                        var error = field['validator']((/** @type {?} */ (item)), ruleSet);
                        if (error != null) {
                            errorStore.push(error);
                        }
                    }
                }
            });
        }
    };
    QueryBuilderComponent.decorators = [
        { type: Component, args: [{
                    selector: 'er-query-builder',
                    template: "<div [ngStyle]=\"ruleSetStyle(index)\" class=\"ruleSet\">\n  <div [ngClass]=\"getClassNames('switchRow')\">\n    <ng-container *ngIf=\"templates[templateNames.buttonGroup] as customer; else defaultButtonGroup\">\n      <div [ngClass]=\"getClassNames('buttonGroup', 'rightAlign')\">\n        <ng-container *ngTemplateOutlet=\"customer; context: context()\"></ng-container>\n      </div>\n    </ng-container>\n\n    <ng-container *ngIf=\"templates[templateNames.switchGroup] as customer; else defaultSwitchGroup\">\n      <ng-container *ngTemplateOutlet=\"customer; context: context()\"></ng-container>\n    </ng-container>\n  </div>\n  <ul [ngClass]=\"getClassNames('tree')\" *ngIf=\"ruleSet && ruleSet.rules\">\n    <ng-container *ngFor=\"let rule of ruleSet.rules; let index = index\">\n\n      <li [ngClass]=\"getRuleClassName(rule)\">\n\n        <ng-container *ngIf=\"!rule['condition']\">\n          <er-query-builder-rule [rule]=\"rule\" [ruleIndex]=\"index\"></er-query-builder-rule>\n        </ng-container>\n\n        <ng-container *ngIf=\"rule['condition']\">\n          <er-query-builder [config]=\"config\" [ruleSet]=\"rule\" [parentRuleSet]=\"ruleSet\" [index]=\"index\">\n          </er-query-builder>\n        </ng-container>\n\n        <ng-container *ngIf=\"templates[templateNames.empty] as customer; else defaultEmptyWarning\">\n          <ng-container *ngIf=\"isInValidRule(rule)\">\n            <ng-container *ngTemplateOutlet=\"customer; context: context()\"></ng-container>\n          </ng-container>\n        </ng-container>\n\n        <ng-template #defaultEmptyWarning>\n          <p [ngClass]=\"getClassNames('emptyWarning')\" *ngIf=\"isInValidRule(rule)\"\n             [innerHTML]=\"config.emptyMessage|erSafeHtml\">\n          </p>\n        </ng-template>\n\n      </li>\n    </ng-container>\n  </ul>\n</div>\n<ng-template #defaultButtonGroup>\n  <div [ngClass]=\"getClassNames('buttonGroup', 'rightAlign')\">\n    <button (click)=\"addRule()\" [ngClass]=\"getClassNames('button')\" [disabled]=disabled>\n      <i [ngClass]=\"getClassNames('addIcon')\"></i> \u6761\u4EF6\n    </button>\n    <button (click)=\"addRuleSet()\" [ngClass]=\"getClassNames('button')\" *ngIf=\"config.allowRuleSet\"\n            [disabled]=disabled>\n      <i [ngClass]=\"getClassNames('addIcon')\"></i> \u6761\u4EF6\u7EC4\n    </button>\n    <ng-container *ngIf=\"!!parentRuleSet && config.allowRuleSet\">\n      <button (click)=\"removeRuleSet()\" [ngClass]=\"getClassNames('button', 'removeButton')\"\n              [disabled]=disabled>\n        <i [ngClass]=\"getClassNames('removeIcon')\"></i>\n      </button>\n    </ng-container>\n  </div>\n</ng-template>\n\n<ng-template #defaultSwitchGroup>\n  <div [ngClass]=\"getClassNames('switchGroup', 'transition')\" *ngIf=\"ruleSet\">\n    <div [ngClass]=\"getClassNames('switchControl')\">\n      <input type=\"radio\" [ngClass]=\"getClassNames('switchRadio')\" [(ngModel)]=\"ruleSet.condition\"\n             [disabled]=disabled\n             value=\"and\" #andOption/>\n      <label (click)=\"changeCondition(andOption.value)\" [ngClass]=\"getClassNames('switchLabel')\">\u5E76\u4E14</label>\n    </div>\n    <div [ngClass]=\"getClassNames('switchControl')\">\n      <input type=\"radio\" [ngClass]=\"getClassNames('switchRadio')\" [(ngModel)]=\"ruleSet.condition\"\n             [disabled]=disabled\n             value=\"or\" #orOption/>\n      <label (click)=\"changeCondition(orOption.value)\" [ngClass]=\"getClassNames('switchLabel')\">\u6216\u8005</label>\n    </div>\n    <div [ngClass]=\"getClassNames('switchControl')\">\n      <input type=\"radio\" [ngClass]=\"getClassNames('switchRadio')\" [(ngModel)]=\"ruleSet.condition\"\n             [disabled]=disabled\n             value=\"not\" #notOption/>\n      <label (click)=\"changeCondition(notOption.value)\" [ngClass]=\"getClassNames('switchLabel')\">\u4E0D\u662F</label>\n    </div>\n  </div>\n</ng-template>\n\n\n",
                    providers: [CONTROL_VALUE_ACCESSOR, VALIDATOR],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    styles: ["@charset \"UTF-8\";:host::ng-deep{display:block;width:100%;font-size:.8em}:host::ng-deep .q-icon{font-style:normal;font-size:12px}:host::ng-deep .q-remove-icon::before{content:'\u274C'}:host::ng-deep .q-add-icon{color:#555}:host::ng-deep .q-add-icon::before{content:'\u2795'}:host::ng-deep .q-remove-button{color:#b3415d;width:31px}:host::ng-deep .q-button-group,:host::ng-deep .q-switch-group{overflow:hidden}:host::ng-deep .q-right-align{float:right}:host::ng-deep .q-button{margin-left:8px;padding:0 8px;background-color:#fff}:host::ng-deep .q-button:disabled{display:none}:host::ng-deep .q-control-size{display:inline-block;vertical-align:top;padding-right:10px}:host::ng-deep .q-entity-control,:host::ng-deep .q-field-control,:host::ng-deep .q-input-control,:host::ng-deep .q-operator-control{display:inline-block;padding:5px 8px;color:#555;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;box-sizing:border-box;width:auto}:host::ng-deep .q-entity-control:disabled,:host::ng-deep .q-field-control:disabled,:host::ng-deep .q-input-control:disabled,:host::ng-deep .q-operator-control:disabled{border-color:transparent}:host::ng-deep .q-entity-control,:host::ng-deep .q-field-control,:host::ng-deep .q-input-control:not([type=checkbox]),:host::ng-deep .q-operator-control{min-height:32px;-webkit-appearance:none}:host::ng-deep .q-button,:host::ng-deep .q-switch-label{float:left;margin-bottom:0;font-size:14px;line-height:30px;font-weight:400;text-align:center;text-shadow:none;border:1px solid rgba(0,0,0,.2);box-sizing:border-box}:host::ng-deep .q-button:hover,:host::ng-deep .q-switch-label:hover{cursor:pointer;background-color:#f0f0f0}:host::ng-deep .q-switch-label{background-color:#e4e4e4;padding:0 8px}:host::ng-deep .q-switch-radio{position:absolute;clip:rect(0,0,0,0);height:1px;width:1px;border:0;overflow:hidden}:host::ng-deep .q-switch-radio:checked+.q-switch-label{border:1px solid #619ed7;background:#fff;color:#3176b3}:host::ng-deep .q-switch-radio:disabled+.q-switch-label{display:none}:host::ng-deep .q-switch-radio:checked:disabled+.q-switch-label{display:initial;color:initial;cursor:default;border-color:transparent}:host::ng-deep .q-invalid-ruleset{border:1px solid rgba(179,65,93,.5)!important;background:rgba(179,65,93,.1)!important}:host::ng-deep .q-empty-warning{color:#8d252e;text-align:center}:host::ng-deep .q-ruleset{border:1px solid #ccc}:host::ng-deep .q-rule{border:1px solid #ccc;background:#fff}:host::ng-deep .q-transition{transition:.1s ease-in-out}:host::ng-deep .q-tree{list-style:none;margin:4px 0 2px}:host::ng-deep .q-row{padding:6px 8px;margin-top:6px}:host::ng-deep .q-connector{position:relative}:host::ng-deep .q-connector::before{top:-5px;border-width:0 0 2px 2px}:host::ng-deep .q-connector::after{border-width:0 0 0 2px;top:50%}:host::ng-deep .q-connector::after,:host::ng-deep .q-connector::before{content:'';left:-12px;border-color:#ccc;border-style:solid;width:9px;height:calc(50% + 6px);position:absolute}:host::ng-deep .q-connector:last-child::after{content:none}:host::ng-deep .q-inline-block-display{display:inline-block;vertical-align:top}"]
                }] }
    ];
    /** @nocollapse */
    QueryBuilderComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    QueryBuilderComponent.propDecorators = {
        ruleSet: [{ type: Input }],
        index: [{ type: Input }],
        parentRuleSet: [{ type: Input }],
        config: [{ type: Input }],
        value: [{ type: Input }]
    };
    return QueryBuilderComponent;
}(ControlComponent));
export { QueryBuilderComponent };
if (false) {
    /** @type {?} */
    QueryBuilderComponent.prototype.ruleSet;
    /** @type {?} */
    QueryBuilderComponent.prototype.index;
    /** @type {?} */
    QueryBuilderComponent.prototype.parentRuleSet;
    /** @type {?} */
    QueryBuilderComponent.prototype.defaultValue;
    /** @type {?} */
    QueryBuilderComponent.prototype.templateNames;
    /**
     * @type {?}
     * @private
     */
    QueryBuilderComponent.prototype._config;
    /**
     * @type {?}
     * @private
     */
    QueryBuilderComponent.prototype.changeDetectorRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL2NvcmUvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9xdWVyeS1idWlsZGVyL2NvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyx1QkFBdUIsRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUN2RyxPQUFPLEVBQWtCLGFBQWEsRUFBRSxpQkFBaUIsRUFBOEIsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5RyxPQUFPLEVBQThFLFlBQVksRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUNwSCxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQ3ZDLE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQ3JELE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QyxPQUFPLEVBQUMsMkJBQTJCLEVBQUUsb0JBQW9CLEVBQUMsTUFBTSxZQUFZLENBQUM7O0lBR3ZFLHNCQUFzQixHQUFRO0lBQ2xDLE9BQU8sRUFBRSxpQkFBaUI7SUFDMUIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxjQUFNLE9BQUEscUJBQXFCLEVBQXJCLENBQXFCLENBQUM7SUFDcEQsS0FBSyxFQUFFLElBQUk7Q0FDWjs7SUFFSyxTQUFTLEdBQVE7SUFDckIsT0FBTyxFQUFFLGFBQWE7SUFDdEIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxjQUFNLE9BQUEscUJBQXFCLEVBQXJCLENBQXFCLENBQUM7SUFDcEQsS0FBSyxFQUFFLElBQUk7Q0FDWjtBQUVEO0lBTzJDLGlEQUFnQjtJQW1CekQsK0JBQW9CLGlCQUFvQztRQUF4RCxZQUNFLGlCQUFPLFNBQ1I7UUFGbUIsdUJBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQWpCL0MsYUFBTyxHQUFpQixFQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBQyxDQUFDO1FBSS9ELGtCQUFZLEdBQUcsb0JBQW9CLENBQUM7UUFFcEMsbUJBQWEsR0FBRztZQUNkLFdBQVcsRUFBRSxhQUFhO1lBQzFCLFdBQVcsRUFBRSxhQUFhO1lBQzFCLFlBQVksRUFBRSxjQUFjO1lBQzVCLE1BQU0sRUFBRSxRQUFRO1lBQ2hCLEtBQUssRUFBRSxPQUFPO1lBQ2QsUUFBUSxFQUFFLFVBQVU7WUFDcEIsS0FBSyxFQUFFLE9BQU87WUFDZCxLQUFLLEVBQUUsT0FBTztTQUNmLENBQUM7UUFNTSxhQUFPLEdBQXNCLEVBQUUsQ0FBQzs7SUFGeEMsQ0FBQztJQUlELHNCQUNJLHlDQUFNOzs7O1FBRFY7WUFFRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDdEIsQ0FBQzs7Ozs7UUFFRCxVQUFXLE1BQU07WUFDZixZQUFZLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLDJCQUEyQixDQUFDLENBQUM7WUFDekUsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNoRCxDQUFDOzs7T0FMQTtJQU9ELHNCQUNJLHdDQUFLOzs7O1FBRFQ7WUFFRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDdEIsQ0FBQzs7Ozs7UUFFRCxVQUFVLEtBQW1CO1lBQzNCLElBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxJQUFJLEVBQUMsU0FBUyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFDLENBQUM7UUFDeEQsQ0FBQzs7O09BSkE7Ozs7O0lBTUQsd0NBQVE7Ozs7SUFBUixVQUFTLE9BQXdCOztZQUN6QixNQUFNLEdBQTJCLEVBQUU7O1lBQ25DLGNBQWMsR0FBRyxFQUFFOztZQUNyQixTQUFTLEdBQUcsS0FBSztRQUVyQixJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsSUFBSSxJQUFJLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQzlFLE1BQU0sQ0FBQyxLQUFLLEdBQUcsV0FBVyxDQUFDO1lBQzNCLFNBQVMsR0FBRyxJQUFJLENBQUM7U0FDbEI7UUFFRCxJQUFJLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxjQUFjLENBQUMsQ0FBQztRQUV4RCxJQUFJLGNBQWMsQ0FBQyxNQUFNLEVBQUU7WUFDekIsTUFBTSxDQUFDLEtBQUssR0FBRyxjQUFjLENBQUM7WUFDOUIsU0FBUyxHQUFHLElBQUksQ0FBQztTQUNsQjtRQUNELE9BQU8sU0FBUyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNuQyxDQUFDOzs7OztJQUVELDRDQUFZOzs7O0lBQVosVUFBYSxLQUFTO1FBQVQsc0JBQUEsRUFBQSxTQUFTOztZQUNkLE9BQU8sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFDLEtBQUssRUFBRSxDQUFDLElBQUssT0FBQSxDQUFDLEtBQUssS0FBSyxFQUFYLENBQVcsQ0FBQztRQUMzRSxJQUFJLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3hCLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUM7U0FDckI7UUFDRCxPQUFPO1lBQ0wsbUJBQW1CLEVBQUUsS0FBSztZQUMxQixtQkFBbUIsRUFBRSxPQUFPO1lBQzVCLG1CQUFtQixFQUFFLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDOUMsQ0FBQztJQUNKLENBQUM7Ozs7O0lBRUQsNENBQVk7Ozs7SUFBWixVQUFhLEtBQWdCO1FBQTdCLGlCQVlDO1FBWEMsSUFBSSxZQUFZLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLEVBQUU7WUFDbEQsT0FBTyxDQUFDLG1CQUFVLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFBLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNqRDthQUFNOztnQkFDQyxXQUFTLEdBQUcsRUFBRTtZQUNwQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQUEsR0FBRztnQkFDNUMsSUFBSSxHQUFHLEtBQUssS0FBSyxDQUFDLEdBQUcsRUFBRTtvQkFDckIsV0FBUyxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2lCQUM1QztZQUNILENBQUMsQ0FBQyxDQUFDO1lBQ0gsT0FBTyxXQUFTLENBQUM7U0FDbEI7SUFDSCxDQUFDOzs7OztJQUVELHlDQUFTOzs7O0lBQVQsVUFBVSxTQUFrQjtRQUMxQixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxJQUFJLFNBQVMsRUFBRTtZQUNyQyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFDLEtBQUs7Z0JBQ3JDLE9BQU8sS0FBSyxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsS0FBSyxTQUFTLENBQUM7WUFDbkQsQ0FBQyxDQUFDLENBQUM7U0FDSjthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztTQUMzQjtJQUNILENBQUM7Ozs7O0lBRUQsd0NBQVE7Ozs7SUFBUixVQUFTLElBQWU7O1lBQ2hCLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDMUMsSUFBSSxNQUFNLEVBQUU7O2dCQUNKLE9BQU8sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSyxDQUFDLEdBQUcsS0FBSyxJQUFJLENBQUMsS0FBSyxFQUF4QixDQUF3QixDQUFDO1lBQ2hFLElBQUksT0FBTyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUNqQyxPQUFPLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNuQjtTQUNGO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQzs7Ozs7SUFFRCw2Q0FBYTs7OztJQUFiO1FBQWMsY0FBTzthQUFQLFVBQU8sRUFBUCxxQkFBTyxFQUFQLElBQU87WUFBUCx5QkFBTzs7O1lBQ2IsWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWTs7WUFDdkMsVUFBVSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBQyxFQUFFLElBQUssT0FBQSxZQUFZLENBQUMsRUFBRSxDQUFDLEVBQWhCLENBQWdCLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQyxDQUFDLElBQUssT0FBQSxDQUFDLENBQUMsQ0FBQyxFQUFILENBQUcsQ0FBQztRQUN4RSxPQUFPLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUN6RCxDQUFDOzs7OztJQUVELDZDQUFhOzs7O0lBQWIsVUFBYyxJQUFJO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7SUFDM0UsQ0FBQzs7Ozs7SUFFRCxnREFBZ0I7Ozs7SUFBaEIsVUFBaUIsSUFBSTs7WUFDZixHQUFHLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsV0FBVyxFQUFFLFlBQVksQ0FBQztRQUM5RCxHQUFHLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3hFLDBCQUEwQjtRQUMxQixxREFBcUQ7UUFDckQsSUFBSTtRQUNKLE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQzs7Ozs7SUFFRCxtREFBbUI7Ozs7SUFBbkIsVUFBb0IsTUFBa0I7UUFDcEMsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNYLE9BQU8sSUFBSSxDQUFDO1NBQ2I7YUFBTSxJQUFJLE1BQU0sQ0FBQyxZQUFZLEtBQUssU0FBUyxFQUFFO1lBQzVDLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7U0FDbEQ7YUFBTTs7Z0JBQ0MsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQUMsS0FBSztnQkFDdkQsT0FBTyxLQUFLLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxLQUFLLE1BQU0sQ0FBQyxHQUFHLENBQUM7WUFDcEQsQ0FBQyxDQUFDO1lBQ0YsSUFBSSxnQkFBZ0IsSUFBSSxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUU7Z0JBQy9DLE9BQU8sZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDNUI7U0FDRjtJQUNILENBQUM7Ozs7O0lBRUQsa0RBQWtCOzs7O0lBQWxCLFVBQW1CLEtBQWdCO1FBQ2pDLElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLFNBQVMsRUFBRTtZQUNuRCxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQztTQUN2RDthQUFNOztnQkFDQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUM7WUFDMUMsSUFBSSxTQUFTLElBQUksU0FBUyxDQUFDLE1BQU0sRUFBRTtnQkFDakMsd0JBQXdCO2FBQ3pCO1NBQ0Y7SUFDSCxDQUFDOzs7O0lBRUQsdUNBQU87OztJQUFQOztZQUNRLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTztRQUMzQixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQzdCO2FBQU07O2dCQUNDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDbkMsTUFBTSxDQUFDLEtBQUssb0JBQ1AsTUFBTSxDQUFDLEtBQUs7Z0JBQ2Y7b0JBQ0UsS0FBSyxFQUFFLEtBQUssQ0FBQyxHQUFHO29CQUNoQixNQUFNLEVBQUUsS0FBSyxDQUFDLFdBQVcsQ0FBQztvQkFDMUIsUUFBUSxFQUFFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUM7b0JBQ3hDLEtBQUssRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUM7aUJBQ2hEO2NBQ0YsQ0FBQztTQUNIO0lBQ0gsQ0FBQzs7OztJQUVELDBDQUFVOzs7SUFBVjs7WUFDUSxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU87UUFDM0IsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRTtZQUMxQixJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNoQzthQUFNO1lBQ0wsTUFBTSxDQUFDLEtBQUssb0JBQ1AsTUFBTSxDQUFDLEtBQUs7Z0JBQ2YsRUFBQyxTQUFTLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUM7Y0FDOUIsQ0FBQztTQUNIO0lBQ0gsQ0FBQzs7Ozs7SUFFRCwwQ0FBVTs7OztJQUFWLFVBQVcsSUFBZTs7WUFDbEIsTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPO1FBQzNCLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUU7WUFDMUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQ3RDO2FBQU07WUFDTCxNQUFNLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxLQUFLLElBQUksRUFBVixDQUFVLENBQUMsQ0FBQztTQUN2RDtJQUNILENBQUM7Ozs7O0lBRUQsNkNBQWE7Ozs7SUFBYixVQUFjLE9BQXNCO1FBQ2xDLE9BQU8sR0FBRyxPQUFPLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQzs7WUFDNUIsTUFBTSxHQUFHLElBQUksQ0FBQyxhQUFhO1FBQ2pDLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUU7WUFDN0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQzVDO2FBQU07WUFDTCxNQUFNLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxLQUFLLE9BQU8sRUFBYixDQUFhLENBQUMsQ0FBQztTQUMxRDtJQUNILENBQUM7Ozs7O0lBRUQsK0NBQWU7Ozs7SUFBZixVQUFnQixLQUFLO1FBQ25CLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztJQUNqQyxDQUFDOzs7Ozs7SUFFRCwyQ0FBVzs7Ozs7SUFBWCxVQUFZLEdBQVcsRUFBRSxJQUFlOztZQUVoQyxLQUFLLEdBQWMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDO1FBRWhELElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxZQUFZLEtBQUssU0FBUyxFQUFFO1lBQzdDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7U0FDdkQ7YUFBTTtZQUNMLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztTQUNuQjtRQUVELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2pELENBQUM7Ozs7OztJQUVELDRDQUFZOzs7OztJQUFaLFVBQWEsV0FBbUIsRUFBRSxJQUFlO1FBQy9DLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixPQUFPO1NBQ1I7UUFFRCwrRkFBK0Y7UUFDL0YsK0VBQStFO1FBRS9FLDBCQUEwQjtRQUMxQixzREFBc0Q7UUFDdEQsSUFBSTtJQUNOLENBQUM7Ozs7O0lBRUQsK0NBQWU7Ozs7SUFBZixVQUFnQixZQUFpQjtRQUMvQixRQUFRLE9BQU8sWUFBWSxFQUFFO1lBQzNCLEtBQUssVUFBVTtnQkFDYixPQUFPLFlBQVksRUFBRSxDQUFDO1lBQ3hCO2dCQUNFLE9BQU8sWUFBWSxDQUFDO1NBQ3ZCO0lBQ0gsQ0FBQzs7Ozs7SUFFRCx1Q0FBTzs7OztJQUFQLFVBQVEsT0FBWTtRQUNsQiwwQkFDRSxFQUFFLEVBQUUsbUJBQXVCLElBQUksRUFBQSxJQUM1QixPQUFPLEVBQ1Y7SUFDSixDQUFDOzs7Ozs7SUFFTyx1REFBdUI7Ozs7O0lBQS9CLFVBQWdDLE9BQXFCO1FBQXJELGlCQVlDO1FBWEMsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQzVELE9BQU8sSUFBSSxDQUFDO1NBQ2I7YUFBTTtZQUNMLE9BQU8sT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBQyxJQUFrQjtnQkFDM0MsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO29CQUNkLE9BQU8sS0FBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksQ0FBQyxDQUFDO2lCQUMzQztxQkFBTTtvQkFDTCxPQUFPLEtBQUssQ0FBQztpQkFDZDtZQUNILENBQUMsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDOzs7Ozs7O0lBRU8sc0RBQXNCOzs7Ozs7SUFBOUIsVUFBK0IsT0FBcUIsRUFBRSxVQUFpQjtRQUF2RSxpQkFnQkM7UUFmQyxJQUFJLE9BQU8sSUFBSSxPQUFPLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUN4RCxPQUFPLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFDLElBQUk7Z0JBQ3pCLElBQUksQ0FBQyxtQkFBQSxJQUFJLEVBQWdCLENBQUMsQ0FBQyxLQUFLLEVBQUU7b0JBQ2hDLE9BQU8sS0FBSSxDQUFDLHNCQUFzQixDQUFDLG1CQUFBLElBQUksRUFBZ0IsRUFBRSxVQUFVLENBQUMsQ0FBQztpQkFDdEU7cUJBQU0sSUFBSSxDQUFDLG1CQUFBLElBQUksRUFBYSxDQUFDLENBQUMsS0FBSyxFQUFFOzt3QkFDOUIsS0FBSyxHQUFHLEtBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsbUJBQUEsSUFBSSxFQUFhLENBQUMsQ0FBQyxLQUFLLENBQUM7b0JBQzNELElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsSUFBSSxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsS0FBSyxFQUFFOzs0QkFDckQsS0FBSyxHQUFHLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxtQkFBQSxJQUFJLEVBQWEsRUFBRSxPQUFPLENBQUM7d0JBQzVELElBQUksS0FBSyxJQUFJLElBQUksRUFBRTs0QkFDakIsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQzt5QkFDeEI7cUJBQ0Y7aUJBQ0Y7WUFDSCxDQUFDLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQzs7Z0JBL1JGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsa0JBQWtCO29CQUM1Qix1MkhBQXVCO29CQUV2QixTQUFTLEVBQUUsQ0FBQyxzQkFBc0IsRUFBRSxTQUFTLENBQUM7b0JBQzlDLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNOztpQkFDaEQ7Ozs7Z0JBM0JnQyxpQkFBaUI7OzswQkE4Qi9DLEtBQUs7d0JBQ0wsS0FBSztnQ0FDTCxLQUFLO3lCQXFCTCxLQUFLO3dCQVVMLEtBQUs7O0lBdVBSLDRCQUFDO0NBQUEsQUFqU0QsQ0FPMkMsZ0JBQWdCLEdBMFIxRDtTQTFSWSxxQkFBcUI7OztJQUVoQyx3Q0FBK0Q7O0lBQy9ELHNDQUF1Qjs7SUFDdkIsOENBQXFDOztJQUVyQyw2Q0FBb0M7O0lBRXBDLDhDQVNFOzs7OztJQU1GLHdDQUF3Qzs7Ozs7SUFKNUIsa0RBQTRDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgZm9yd2FyZFJlZiwgSW5wdXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtBYnN0cmFjdENvbnRyb2wsIE5HX1ZBTElEQVRPUlMsIE5HX1ZBTFVFX0FDQ0VTU09SLCBWYWxpZGF0aW9uRXJyb3JzLCBWYWxpZGF0b3J9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7RGF0YUVudGl0eSwgRGF0YUZpZWxkLCBEYXRhSXRlbSwgUXVlcnlCdWlsZGVyUHJvcHMsIFF1ZXJ5UnVsZSwgUXVlcnlSdWxlU2V0LCBUSEVNRV9DT0xPUlN9IGZyb20gJ0Blci90eXBlcyc7XG5pbXBvcnQge0NvbW1vbnNVdGlsc30gZnJvbSAnQGVyL3V0aWxzJztcbmltcG9ydCB7Q29udHJvbENvbXBvbmVudH0gZnJvbSAnLi4vLi4vYmFzZXMvY29udHJvbCc7XG5pbXBvcnQge0xvZ1V0aWxzfSBmcm9tICcuLi8uLi91dGlscy9sb2cnO1xuaW1wb3J0IHtERUZBVUxUX1FVRVJZX0JVSUxERVJfUFJPUFMsIEVNUFRZX1FVRVJZX1JVTEVfU0VUfSBmcm9tICcuL2RlZmF1bHRzJztcblxuXG5jb25zdCBDT05UUk9MX1ZBTFVFX0FDQ0VTU09SOiBhbnkgPSB7XG4gIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBRdWVyeUJ1aWxkZXJDb21wb25lbnQpLFxuICBtdWx0aTogdHJ1ZVxufTtcblxuY29uc3QgVkFMSURBVE9SOiBhbnkgPSB7XG4gIHByb3ZpZGU6IE5HX1ZBTElEQVRPUlMsXG4gIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFF1ZXJ5QnVpbGRlckNvbXBvbmVudCksXG4gIG11bHRpOiB0cnVlXG59O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdlci1xdWVyeS1idWlsZGVyJyxcbiAgdGVtcGxhdGVVcmw6ICd0cGwuaHRtbCcsXG4gIHN0eWxlVXJsczogWydzdHlsZXMuc2NzcyddLFxuICBwcm92aWRlcnM6IFtDT05UUk9MX1ZBTFVFX0FDQ0VTU09SLCBWQUxJREFUT1JdLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBRdWVyeUJ1aWxkZXJDb21wb25lbnQgZXh0ZW5kcyBDb250cm9sQ29tcG9uZW50IGltcGxlbWVudHMgVmFsaWRhdG9yIHtcblxuICBASW5wdXQoKSBydWxlU2V0OiBRdWVyeVJ1bGVTZXQgPSB7Y29uZGl0aW9uOiAnQU5EJywgcnVsZXM6IFtdfTtcbiAgQElucHV0KCkgaW5kZXg6IG51bWJlcjtcbiAgQElucHV0KCkgcGFyZW50UnVsZVNldDogUXVlcnlSdWxlU2V0O1xuXG4gIGRlZmF1bHRWYWx1ZSA9IEVNUFRZX1FVRVJZX1JVTEVfU0VUO1xuXG4gIHRlbXBsYXRlTmFtZXMgPSB7XG4gICAgYnV0dG9uR3JvdXA6ICdidXR0b25Hcm91cCcsXG4gICAgc3dpdGNoR3JvdXA6ICdzd2l0Y2hHcm91cCcsXG4gICAgcmVtb3ZlQnV0dG9uOiAncmVtb3ZlQnV0dG9uJyxcbiAgICBlbnRpdHk6ICdlbnRpdHknLFxuICAgIGZpZWxkOiAnZmllbGQnLFxuICAgIG9wZXJhdG9yOiAnb3BlcmF0b3InLFxuICAgIGlucHV0OiAnaW5wdXQnLFxuICAgIGVtcHR5OiAnZW1wdHknXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgcHJpdmF0ZSBfY29uZmlnOiBRdWVyeUJ1aWxkZXJQcm9wcyA9IHt9O1xuXG4gIEBJbnB1dCgpXG4gIGdldCBjb25maWcoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbmZpZztcbiAgfVxuXG4gIHNldCBjb25maWcoY29uZmlnKSB7XG4gICAgQ29tbW9uc1V0aWxzLmRlZmF1bHRzKHRoaXMuX2NvbmZpZywgY29uZmlnLCBERUZBVUxUX1FVRVJZX0JVSUxERVJfUFJPUFMpO1xuICAgIExvZ1V0aWxzLmRlYnVnKHRoaXMsICfmn6Xor6LmnoTpgKDlmajphY3nva4nLCB0aGlzLl9jb25maWcpO1xuICB9XG5cbiAgQElucHV0KClcbiAgZ2V0IHZhbHVlKCk6IFF1ZXJ5UnVsZVNldCB7XG4gICAgcmV0dXJuIHRoaXMucnVsZVNldDtcbiAgfVxuXG4gIHNldCB2YWx1ZSh2YWx1ZTogUXVlcnlSdWxlU2V0KSB7XG4gICAgdGhpcy5ydWxlU2V0ID0gdmFsdWUgfHwge2NvbmRpdGlvbjogJ0FORCcsIHJ1bGVzOiBbXX07XG4gIH1cblxuICB2YWxpZGF0ZShjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzIHwgbnVsbCB7XG4gICAgY29uc3QgZXJyb3JzOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0ge307XG4gICAgY29uc3QgcnVsZUVycm9yU3RvcmUgPSBbXTtcbiAgICBsZXQgaGFzRXJyb3JzID0gZmFsc2U7XG5cbiAgICBpZiAoIXRoaXMuY29uZmlnLmFsbG93RW1wdHlSdWxlU2V0ICYmIHRoaXMuY2hlY2tFbXB0eVJ1bGVJblJ1bGVTZXQodGhpcy52YWx1ZSkpIHtcbiAgICAgIGVycm9ycy5lbXB0eSA9ICfmn6Xor6LlrprkuYnkuI3og73kuLrnqbouJztcbiAgICAgIGhhc0Vycm9ycyA9IHRydWU7XG4gICAgfVxuXG4gICAgdGhpcy52YWxpZGF0ZVJ1bGVzSW5SdWxlU2V0KHRoaXMudmFsdWUsIHJ1bGVFcnJvclN0b3JlKTtcblxuICAgIGlmIChydWxlRXJyb3JTdG9yZS5sZW5ndGgpIHtcbiAgICAgIGVycm9ycy5ydWxlcyA9IHJ1bGVFcnJvclN0b3JlO1xuICAgICAgaGFzRXJyb3JzID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGhhc0Vycm9ycyA/IGVycm9ycyA6IG51bGw7XG4gIH1cblxuICBydWxlU2V0U3R5bGUoaW5kZXggPSAwKSB7XG4gICAgY29uc3QgYmdDb2xvciA9IE9iamVjdC5rZXlzKFRIRU1FX0NPTE9SUykuZmlsdGVyKChjb2xvciwgaSkgPT4gaSA9PT0gaW5kZXgpO1xuICAgIGlmIChiZ0NvbG9yLmxlbmd0aCA9PT0gMCkge1xuICAgICAgYmdDb2xvclswXSA9ICdibHVlJztcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICdib3JkZXItbGVmdC13aWR0aCc6ICc1cHgnLFxuICAgICAgJ2JvcmRlci1sZWZ0LXN0eWxlJzogJ3NvbGlkJyxcbiAgICAgICdib3JkZXItbGVmdC1jb2xvcic6IFRIRU1FX0NPTE9SU1tiZ0NvbG9yWzBdXVxuICAgIH07XG4gIH1cblxuICBnZXRPcGVyYXRvcnMoZmllbGQ6IERhdGFGaWVsZCk6IERhdGFJdGVtW10ge1xuICAgIGlmIChDb21tb25zVXRpbHMuaXNGdW5jdGlvbih0aGlzLmNvbmZpZy5vcGVyYXRvcnMpKSB7XG4gICAgICByZXR1cm4gKDxGdW5jdGlvbj50aGlzLmNvbmZpZy5vcGVyYXRvcnMpKGZpZWxkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgb3BlcmF0b3JzID0gW107XG4gICAgICBPYmplY3Qua2V5cyh0aGlzLmNvbmZpZy5vcGVyYXRvcnMpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgaWYgKGtleSA9PT0gZmllbGQua2V5KSB7XG4gICAgICAgICAgb3BlcmF0b3JzLnB1c2godGhpcy5jb25maWcub3BlcmF0b3JzW2tleV0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBvcGVyYXRvcnM7XG4gICAgfVxuICB9XG5cbiAgZ2V0RmllbGRzKGVudGl0eUtleT86IHN0cmluZyk6IERhdGFGaWVsZFtdIHtcbiAgICBpZiAodGhpcy5jb25maWcuZW50aXRpZXMgJiYgZW50aXR5S2V5KSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25maWcuZmllbGRzLmZpbHRlcigoZmllbGQpID0+IHtcbiAgICAgICAgcmV0dXJuIGZpZWxkICYmIGZpZWxkWydlbnRpdHlLZXknXSA9PT0gZW50aXR5S2V5O1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5maWVsZHM7XG4gICAgfVxuICB9XG5cbiAgZ2V0RmllbGQocnVsZTogUXVlcnlSdWxlKTogRGF0YUZpZWxkIHtcbiAgICBjb25zdCBmaWVsZHMgPSB0aGlzLmdldEZpZWxkcyhydWxlLmVudGl0eSk7XG4gICAgaWYgKGZpZWxkcykge1xuICAgICAgY29uc3QgbWF0Y2hlZCA9IGZpZWxkcy5maWx0ZXIoZmllbGQgPT4gZmllbGQua2V5ID09PSBydWxlLmZpZWxkKTtcbiAgICAgIGlmIChtYXRjaGVkICYmIG1hdGNoZWQubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gbWF0Y2hlZFswXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGdldENsYXNzTmFtZXMoLi4uYXJncyk6IHN0cmluZyB7XG4gICAgY29uc3Qgc3R5bGVDbGFzc2VzID0gdGhpcy5jb25maWcuc3R5bGVDbGFzc2VzO1xuICAgIGNvbnN0IGNsYXNzTmFtZXMgPSBhcmdzLm1hcCgoaWQpID0+IHN0eWxlQ2xhc3Nlc1tpZF0pLmZpbHRlcigoYykgPT4gISFjKTtcbiAgICByZXR1cm4gY2xhc3NOYW1lcy5sZW5ndGggPyBjbGFzc05hbWVzLmpvaW4oJyAnKSA6IG51bGw7XG4gIH1cblxuICBpc0luVmFsaWRSdWxlKHJ1bGUpIHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcuYWxsb3dSdWxlU2V0ICYmIHJ1bGUucnVsZXMgJiYgcnVsZS5ydWxlcy5sZW5ndGggPT09IDA7XG4gIH1cblxuICBnZXRSdWxlQ2xhc3NOYW1lKHJ1bGUpOiBzdHJpbmcge1xuICAgIGxldCBjbHMgPSB0aGlzLmdldENsYXNzTmFtZXMoJ3JvdycsICdjb25uZWN0b3InLCAndHJhbnNpdGlvbicpO1xuICAgIGNscyArPSAnICcgKyB0aGlzLmdldENsYXNzTmFtZXMocnVsZVsnY29uZGl0aW9uJ10gPyAncnVsZVNldCcgOiAncnVsZScpO1xuICAgIC8vIGlmIChydWxlTWV0YS5pbnZhbGlkKSB7XG4gICAgLy8gY2xzICs9ICcgJyArIHRoaXMuZ2V0Q2xhc3NOYW1lcygnaW52YWxpZFJ1bGVTZXQnKTtcbiAgICAvLyB9XG4gICAgcmV0dXJuIGNscztcbiAgfVxuXG4gIGdldERlZmF1bHREYXRhRmllbGQoZW50aXR5OiBEYXRhRW50aXR5KTogRGF0YUZpZWxkIHtcbiAgICBpZiAoIWVudGl0eSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIGlmIChlbnRpdHkuZGVmYXVsdEZpZWxkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldERlZmF1bHRWYWx1ZShlbnRpdHkuZGVmYXVsdEZpZWxkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZW50aXR5RGF0YUZpZWxkcyA9IHRoaXMuY29uZmlnLmZpZWxkcy5maWx0ZXIoKGZpZWxkKSA9PiB7XG4gICAgICAgIHJldHVybiBmaWVsZCAmJiBmaWVsZFsnZW50aXR5S2V5J10gPT09IGVudGl0eS5rZXk7XG4gICAgICB9KTtcbiAgICAgIGlmIChlbnRpdHlEYXRhRmllbGRzICYmIGVudGl0eURhdGFGaWVsZHMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBlbnRpdHlEYXRhRmllbGRzWzBdO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdldERlZmF1bHRPcGVyYXRvcihmaWVsZDogRGF0YUZpZWxkKTogc3RyaW5nIHtcbiAgICBpZiAoZmllbGQgJiYgZmllbGRbJ2RlZmF1bHRPcGVyYXRvciddICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldERlZmF1bHRWYWx1ZShmaWVsZFsnZGVmYXVsdE9wZXJhdG9yJ10pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBvcGVyYXRvcnMgPSB0aGlzLmdldE9wZXJhdG9ycyhmaWVsZCk7XG4gICAgICBpZiAob3BlcmF0b3JzICYmIG9wZXJhdG9ycy5sZW5ndGgpIHtcbiAgICAgICAgLy8gIHJldHVybiBvcGVyYXRvcnNbMF07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYWRkUnVsZSgpOiB2b2lkIHtcbiAgICBjb25zdCBwYXJlbnQgPSB0aGlzLnJ1bGVTZXQ7XG4gICAgaWYgKHRoaXMuY29uZmlnLmFkZFJ1bGUpIHtcbiAgICAgIHRoaXMuY29uZmlnLmFkZFJ1bGUocGFyZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZmllbGQgPSB0aGlzLmNvbmZpZy5maWVsZHNbMF07XG4gICAgICBwYXJlbnQucnVsZXMgPSBbXG4gICAgICAgIC4uLnBhcmVudC5ydWxlcyxcbiAgICAgICAge1xuICAgICAgICAgIGZpZWxkOiBmaWVsZC5rZXksXG4gICAgICAgICAgZW50aXR5OiBmaWVsZFsnZW50aXR5S2V5J10sXG4gICAgICAgICAgb3BlcmF0b3I6IHRoaXMuZ2V0RGVmYXVsdE9wZXJhdG9yKGZpZWxkKSxcbiAgICAgICAgICB2YWx1ZTogdGhpcy5nZXREZWZhdWx0VmFsdWUoZmllbGQuZGVmYXVsdFZhbHVlKVxuICAgICAgICB9XG4gICAgICBdO1xuICAgIH1cbiAgfVxuXG4gIGFkZFJ1bGVTZXQoKTogdm9pZCB7XG4gICAgY29uc3QgcGFyZW50ID0gdGhpcy5ydWxlU2V0O1xuICAgIGlmICh0aGlzLmNvbmZpZy5hZGRSdWxlU2V0KSB7XG4gICAgICB0aGlzLmNvbmZpZy5hZGRSdWxlU2V0KHBhcmVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhcmVudC5ydWxlcyA9IFtcbiAgICAgICAgLi4ucGFyZW50LnJ1bGVzLFxuICAgICAgICB7Y29uZGl0aW9uOiAnQU5EJywgcnVsZXM6IFtdfVxuICAgICAgXTtcbiAgICB9XG4gIH1cblxuICByZW1vdmVSdWxlKHJ1bGU6IFF1ZXJ5UnVsZSk6IHZvaWQge1xuICAgIGNvbnN0IHBhcmVudCA9IHRoaXMucnVsZVNldDtcbiAgICBpZiAodGhpcy5jb25maWcucmVtb3ZlUnVsZSkge1xuICAgICAgdGhpcy5jb25maWcucmVtb3ZlUnVsZShydWxlLCBwYXJlbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXJlbnQucnVsZXMgPSBwYXJlbnQucnVsZXMuZmlsdGVyKChyKSA9PiByICE9PSBydWxlKTtcbiAgICB9XG4gIH1cblxuICByZW1vdmVSdWxlU2V0KHJ1bGVTZXQ/OiBRdWVyeVJ1bGVTZXQpOiB2b2lkIHtcbiAgICBydWxlU2V0ID0gcnVsZVNldCB8fCB0aGlzLnJ1bGVTZXQ7XG4gICAgY29uc3QgcGFyZW50ID0gdGhpcy5wYXJlbnRSdWxlU2V0O1xuICAgIGlmICh0aGlzLmNvbmZpZy5yZW1vdmVSdWxlU2V0KSB7XG4gICAgICB0aGlzLmNvbmZpZy5yZW1vdmVSdWxlU2V0KHJ1bGVTZXQsIHBhcmVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhcmVudC5ydWxlcyA9IHBhcmVudC5ydWxlcy5maWx0ZXIoKHIpID0+IHIgIT09IHJ1bGVTZXQpO1xuICAgIH1cbiAgfVxuXG4gIGNoYW5nZUNvbmRpdGlvbih2YWx1ZSk6IHZvaWQge1xuICAgIHRoaXMucnVsZVNldC5jb25kaXRpb24gPSB2YWx1ZTtcbiAgfVxuXG4gIGNoYW5nZUZpZWxkKGtleTogc3RyaW5nLCBydWxlOiBRdWVyeVJ1bGUpOiB2b2lkIHtcblxuICAgIGNvbnN0IGZpZWxkOiBEYXRhRmllbGQgPSB0aGlzLmNvbmZpZy5maWVsZHNba2V5XTtcblxuICAgIGlmIChmaWVsZCAmJiBmaWVsZC5kZWZhdWx0VmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcnVsZS52YWx1ZSA9IHRoaXMuZ2V0RGVmYXVsdFZhbHVlKGZpZWxkLmRlZmF1bHRWYWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlbGV0ZSBydWxlLnZhbHVlO1xuICAgIH1cblxuICAgIHJ1bGUub3BlcmF0b3IgPSB0aGlzLmdldERlZmF1bHRPcGVyYXRvcihmaWVsZCk7XG4gIH1cblxuICBjaGFuZ2VFbnRpdHkoZW50aXR5VmFsdWU6IHN0cmluZywgcnVsZTogUXVlcnlSdWxlKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBjb25zdCBjdXJyZW50RW50aXR5OiBEYXRhRW50aXR5ID0gdGhpcy5jb25maWcuZW50aXRpZXMuZmluZCgoZSkgPT4gZS52YWx1ZSA9PT0gZW50aXR5VmFsdWUpO1xuICAgIC8vIGNvbnN0IGRlZmF1bHREYXRhRmllbGQ6IERhdGFGaWVsZCA9IHRoaXMuZ2V0RGVmYXVsdERhdGFGaWVsZChjdXJyZW50RW50aXR5KTtcblxuICAgIC8vIGlmIChkZWZhdWx0RGF0YUZpZWxkKSB7XG4gICAgLy8gICB0aGlzLmNoYW5nZURhdGFGaWVsZChkZWZhdWx0RGF0YUZpZWxkLmtleSwgcnVsZSk7XG4gICAgLy8gfVxuICB9XG5cbiAgZ2V0RGVmYXVsdFZhbHVlKGRlZmF1bHRWYWx1ZTogYW55KTogYW55IHtcbiAgICBzd2l0Y2ggKHR5cGVvZiBkZWZhdWx0VmFsdWUpIHtcbiAgICAgIGNhc2UgJ2Z1bmN0aW9uJzpcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZSgpO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICB9XG4gIH1cblxuICBjb250ZXh0KGNvbnRleHQ/OiB7fSkge1xuICAgIHJldHVybiB7XG4gICAgICBxYjogPFF1ZXJ5QnVpbGRlckNvbXBvbmVudD50aGlzLFxuICAgICAgLi4uY29udGV4dFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGNoZWNrRW1wdHlSdWxlSW5SdWxlU2V0KHJ1bGVTZXQ6IFF1ZXJ5UnVsZVNldCk6IGJvb2xlYW4ge1xuICAgIGlmICghcnVsZVNldCB8fCAhcnVsZVNldC5ydWxlcyB8fCBydWxlU2V0LnJ1bGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBydWxlU2V0LnJ1bGVzLnNvbWUoKGl0ZW06IFF1ZXJ5UnVsZVNldCkgPT4ge1xuICAgICAgICBpZiAoaXRlbS5ydWxlcykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmNoZWNrRW1wdHlSdWxlSW5SdWxlU2V0KGl0ZW0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB2YWxpZGF0ZVJ1bGVzSW5SdWxlU2V0KHJ1bGVTZXQ6IFF1ZXJ5UnVsZVNldCwgZXJyb3JTdG9yZTogYW55W10pIHtcbiAgICBpZiAocnVsZVNldCAmJiBydWxlU2V0LnJ1bGVzICYmIHJ1bGVTZXQucnVsZXMubGVuZ3RoID4gMCkge1xuICAgICAgcnVsZVNldC5ydWxlcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgIGlmICgoaXRlbSBhcyBRdWVyeVJ1bGVTZXQpLnJ1bGVzKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRhdGVSdWxlc0luUnVsZVNldChpdGVtIGFzIFF1ZXJ5UnVsZVNldCwgZXJyb3JTdG9yZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoKGl0ZW0gYXMgUXVlcnlSdWxlKS5maWVsZCkge1xuICAgICAgICAgIGNvbnN0IGZpZWxkID0gdGhpcy5jb25maWcuZmllbGRzWyhpdGVtIGFzIFF1ZXJ5UnVsZSkuZmllbGRdO1xuICAgICAgICAgIGlmIChmaWVsZCAmJiBmaWVsZFsndmFsaWRhdG9yJ10gJiYgZmllbGRbJ3ZhbGlkYXRvciddLmFwcGx5KSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IGZpZWxkWyd2YWxpZGF0b3InXShpdGVtIGFzIFF1ZXJ5UnVsZSwgcnVsZVNldCk7XG4gICAgICAgICAgICBpZiAoZXJyb3IgIT0gbnVsbCkge1xuICAgICAgICAgICAgICBlcnJvclN0b3JlLnB1c2goZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==