/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, Input, TemplateRef } from '@angular/core';
import { ContentType } from '@er/types';
import { CommonsUtils } from '@er/utils';
import { dynamicDirectiveDef } from 'ng-dynamic-component';
import { Observable } from 'rxjs';
import { BehaviorSubject } from 'rxjs/internal/BehaviorSubject';
import { BaseComponent } from '../../bases/component';
import { PropsBindDirective } from '../../directives/props-bind/directive';
var DynaContentComponent = /** @class */ (function (_super) {
    tslib_1.__extends(DynaContentComponent, _super);
    function DynaContentComponent(cd) {
        var _this = _super.call(this) || this;
        _this.cd = cd;
        _this.CONTENT_TYPE = ContentType;
        _this.parsedContent$ = new BehaviorSubject(undefined);
        return _this;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    DynaContentComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        this.parse();
    };
    /**
     * @return {?}
     */
    DynaContentComponent.prototype.refresh = /**
     * @return {?}
     */
    function () {
        this.parse();
        this.cd.markForCheck();
    };
    /**
     * @private
     * @return {?}
     */
    DynaContentComponent.prototype.parse = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (CommonsUtils.isJson(this.content)) {
            if (this.content['content']) {
                if (this.content['styleClass']) {
                    this.styleClass = this.content['styleClass'];
                }
                if (this.content['style']) {
                    this.style = this.content['style'];
                }
                this.content = this.content['content'];
            }
            if (this.content['data']) {
                this.contentType = ContentType.DATA;
                this.parsedContent = [];
                Object.keys(this.content['data']).forEach(function (key) {
                    _this.parsedContent.push({
                        key: key,
                        value: CommonsUtils.getText(_this.content['data'][key])
                    });
                });
                return;
            }
            else if (this.content['type']) {
                this.contentType = ContentType.COMPONENT;
                this.dynaComponent = (/** @type {?} */ (this.content));
                /** @type {?} */
                var directives = this.dynaComponent.directives;
                /** @type {?} */
                var dynaDirectives_1 = [];
                if (directives) {
                    directives = CommonsUtils.getArrayValue(directives);
                    directives.filter(function (direct) { return !!direct.type; }).forEach(function (direct) {
                        dynaDirectives_1.push(dynamicDirectiveDef(direct.type, direct.inputs, direct.outputs));
                    });
                }
                if (this.dynaComponent.props || this.context) {
                    dynaDirectives_1.push(dynamicDirectiveDef(PropsBindDirective, Object.assign({}, this.dynaComponent.props || {}, this.context || {})));
                }
                this.dynaComponent.directives = dynaDirectives_1;
                return;
            }
            else {
                this.parsedContent = ((/** @type {?} */ (this.content))).content;
                this.parsedContext = tslib_1.__assign({}, ((/** @type {?} */ (this.content))).context || {}, this.context || {});
            }
        }
        else {
            this.parsedContent = this.content;
            this.parsedContext = this.context;
        }
        if (CommonsUtils.isString(this.parsedContent)) {
            if (CommonsUtils.isTemplateStr(this.parsedContent)) {
                this.parsedContent = CommonsUtils.templateStr(this.parsedContent, this.context) || '<span></span>';
                this.contentType = ContentType.TEMPLATE_STR;
            }
            else {
                this.contentType = ContentType.STRING;
            }
        }
        else if (this.parsedContent instanceof TemplateRef) {
            this.contentType = ContentType.TEMPLATE;
        }
        else if (CommonsUtils.isFunction(this.parsedContent)) {
            this.parsedContextFn = this.parsedContent;
            /** @type {?} */
            var rtn = this.parsedContextFn(this.parsedContext);
            if (rtn instanceof Observable) {
                ((/** @type {?} */ (rtn))).subscribe(function (result) { return _this.parsedContent$.next(CommonsUtils.toString(result)); });
            }
            else {
                this.parsedContent$.next(rtn);
            }
            this.contentType = ContentType.FUNCTION;
        }
    };
    DynaContentComponent.decorators = [
        { type: Component, args: [{
                    selector: 'er-dyna-content',
                    template: "\n    <ng-container [ngSwitch]=\"contentType\">\n      <div *ngSwitchCase=\"CONTENT_TYPE.STRING\" [ngClass]=\"styleClass\" [ngStyle]=\"style\" [innerHTML]=\"parsedContent|erSafeHtml\"></div>\n      <div *ngSwitchCase=\"CONTENT_TYPE.DATA\" class=\"d-flex\" [ngClass]=\"styleClass\" [ngStyle]=\"style\">\n        <div *ngFor=\"let item of parsedContent\" class=\"d-flex justify-content-center m-3\">\n          <span class=\"mr-2 font-weight-bold\">{{item.key}}</span>\n          <span [innerHTML]=\"item.value|erSafeHtml\"></span>\n        </div>\n      </div>\n      <span *ngSwitchCase=\"CONTENT_TYPE.TEMPLATE_STR\" [innerHTML]=\"parsedContent\" [ngClass]=\"styleClass\"\n            [ngStyle]=\"style\"></span>\n      <ng-container *ngSwitchCase=\"CONTENT_TYPE.FUNCTION\">\n        <ng-container *ngIf=\"parsedContent$|async as asyncContent\">\n          <span [innerHTML]=\"asyncContent\" [ngClass]=\"styleClass\" [ngStyle]=\"style\"></span>\n        </ng-container>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"CONTENT_TYPE.TEMPLATE\">\n        <ng-container *ngTemplateOutlet=\"parsedContent;context:parsedContext\"></ng-container>\n      </ng-container>\n      <ng-container *ngSwitchCase=\"CONTENT_TYPE.COMPONENT\">\n        <ndc-dynamic [ndcDynamicComponent]=\"dynaComponent.type\"\n                     [ndcDynamicDirectives]=\"dynaComponent.directives\"\n                     [ndcDynamicAttributes]=\"dynaComponent.attrs\"\n        >\n        </ndc-dynamic>\n      </ng-container>\n    </ng-container>\n  ",
                    changeDetection: ChangeDetectionStrategy.OnPush
                }] }
    ];
    /** @nocollapse */
    DynaContentComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    DynaContentComponent.propDecorators = {
        content: [{ type: Input }],
        context: [{ type: Input }],
        styleClass: [{ type: Input }],
        style: [{ type: Input }]
    };
    return DynaContentComponent;
}(BaseComponent));
export { DynaContentComponent };
if (false) {
    /** @type {?} */
    DynaContentComponent.prototype.CONTENT_TYPE;
    /** @type {?} */
    DynaContentComponent.prototype.content;
    /** @type {?} */
    DynaContentComponent.prototype.context;
    /** @type {?} */
    DynaContentComponent.prototype.styleClass;
    /** @type {?} */
    DynaContentComponent.prototype.style;
    /** @type {?} */
    DynaContentComponent.prototype.parsedContent;
    /** @type {?} */
    DynaContentComponent.prototype.parsedContent$;
    /** @type {?} */
    DynaContentComponent.prototype.contentType;
    /** @type {?} */
    DynaContentComponent.prototype.parsedContext;
    /** @type {?} */
    DynaContentComponent.prototype.parsedContextFn;
    /** @type {?} */
    DynaContentComponent.prototype.dynaComponent;
    /** @type {?} */
    DynaContentComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL2NvcmUvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9keW5hLWNvbnRlbnQvY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFDLHVCQUF1QixFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQW9DLFdBQVcsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUMxSSxPQUFPLEVBQUMsV0FBVyxFQUF3RCxNQUFNLFdBQVcsQ0FBQztBQUM3RixPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQ3ZDLE9BQU8sRUFBQyxtQkFBbUIsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQ3pELE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFDaEMsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLCtCQUErQixDQUFDO0FBQzlELE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUNwRCxPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSx1Q0FBdUMsQ0FBQztBQUV6RTtJQWdDMEMsZ0RBQWE7SUF3QnJELDhCQUFtQixFQUFxQjtRQUF4QyxZQUNFLGlCQUFPLFNBQ1I7UUFGa0IsUUFBRSxHQUFGLEVBQUUsQ0FBbUI7UUF0QnhDLGtCQUFZLEdBQUcsV0FBVyxDQUFDO1FBWTNCLG9CQUFjLEdBQTRCLElBQUksZUFBZSxDQUFTLFNBQVMsQ0FBQyxDQUFDOztJQVlqRixDQUFDOzs7OztJQUVELDBDQUFXOzs7O0lBQVgsVUFBWSxPQUFzQjtRQUNoQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDZixDQUFDOzs7O0lBRUQsc0NBQU87OztJQUFQO1FBQ0UsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2IsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN6QixDQUFDOzs7OztJQUVPLG9DQUFL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Q0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQXZELENBQXVELENBQUMsQ0FBQzthQUN4RztpQkFBTTtnQkFDTCxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUMvQjtZQUNELElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQztTQUN6QztJQUNILENBQUM7O2dCQXpJRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLGlCQUFpQjtvQkFDM0IsUUFBUSxFQUFFLDQvQ0EyQlQ7b0JBQ0QsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07aUJBQ2hEOzs7O2dCQXhDZ0MsaUJBQWlCOzs7MEJBNkMvQyxLQUFLOzBCQUVMLEtBQUs7NkJBRUwsS0FBSzt3QkFFTCxLQUFLOztJQWdHUiwyQkFBQztDQUFBLEFBMUlELENBZ0MwQyxhQUFhLEdBMEd0RDtTQTFHWSxvQkFBb0I7OztJQUUvQiw0Q0FBMkI7O0lBRTNCLHVDQUE4Qjs7SUFFOUIsdUNBQTBCOztJQUUxQiwwQ0FBeUI7O0lBRXpCLHFDQUFvQjs7SUFFcEIsNkNBQW1COztJQUVuQiw4Q0FBaUY7O0lBRWpGLDJDQUF5Qjs7SUFFekIsNkNBQXVCOztJQUV2QiwrQ0FBMEQ7O0lBRTFELDZDQUE2Qjs7SUFFakIsa0NBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBTaW1wbGVDaGFuZ2VzLCBUZW1wbGF0ZVJlZn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0NvbnRlbnRUeXBlLCBDb250ZXh0LCBDb250ZXh0ZWRDb250ZW50LCBEeW5hQ29tcG9uZW50LCBEeW5hQ29udGVudH0gZnJvbSAnQGVyL3R5cGVzJztcbmltcG9ydCB7Q29tbW9uc1V0aWxzfSBmcm9tICdAZXIvdXRpbHMnO1xuaW1wb3J0IHtkeW5hbWljRGlyZWN0aXZlRGVmfSBmcm9tICduZy1keW5hbWljLWNvbXBvbmVudCc7XG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtCZWhhdmlvclN1YmplY3R9IGZyb20gJ3J4anMvaW50ZXJuYWwvQmVoYXZpb3JTdWJqZWN0JztcbmltcG9ydCB7QmFzZUNvbXBvbmVudH0gZnJvbSAnLi4vLi4vYmFzZXMvY29tcG9uZW50JztcbmltcG9ydCB7UHJvcHNCaW5kRGlyZWN0aXZlfSBmcm9tICcuLi8uLi9kaXJlY3RpdmVzL3Byb3BzLWJpbmQvZGlyZWN0aXZlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZXItZHluYS1jb250ZW50JyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8bmctY29udGFpbmVyIFtuZ1N3aXRjaF09XCJjb250ZW50VHlwZVwiPlxuICAgICAgPGRpdiAqbmdTd2l0Y2hDYXNlPVwiQ09OVEVOVF9UWVBFLlNUUklOR1wiIFtuZ0NsYXNzXT1cInN0eWxlQ2xhc3NcIiBbbmdTdHlsZV09XCJzdHlsZVwiIFtpbm5lckhUTUxdPVwicGFyc2VkQ29udGVudHxlclNhZmVIdG1sXCI+PC9kaXY+XG4gICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XCJDT05URU5UX1RZUEUuREFUQVwiIGNsYXNzPVwiZC1mbGV4XCIgW25nQ2xhc3NdPVwic3R5bGVDbGFzc1wiIFtuZ1N0eWxlXT1cInN0eWxlXCI+XG4gICAgICAgIDxkaXYgKm5nRm9yPVwibGV0IGl0ZW0gb2YgcGFyc2VkQ29udGVudFwiIGNsYXNzPVwiZC1mbGV4IGp1c3RpZnktY29udGVudC1jZW50ZXIgbS0zXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJtci0yIGZvbnQtd2VpZ2h0LWJvbGRcIj57e2l0ZW0ua2V5fX08L3NwYW4+XG4gICAgICAgICAgPHNwYW4gW2lubmVySFRNTF09XCJpdGVtLnZhbHVlfGVyU2FmZUh0bWxcIj48L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICA8c3BhbiAqbmdTd2l0Y2hDYXNlPVwiQ09OVEVOVF9UWVBFLlRFTVBMQVRFX1NUUlwiIFtpbm5lckhUTUxdPVwicGFyc2VkQ29udGVudFwiIFtuZ0NsYXNzXT1cInN0eWxlQ2xhc3NcIlxuICAgICAgICAgICAgW25nU3R5bGVdPVwic3R5bGVcIj48L3NwYW4+XG4gICAgICA8bmctY29udGFpbmVyICpuZ1N3aXRjaENhc2U9XCJDT05URU5UX1RZUEUuRlVOQ1RJT05cIj5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInBhcnNlZENvbnRlbnQkfGFzeW5jIGFzIGFzeW5jQ29udGVudFwiPlxuICAgICAgICAgIDxzcGFuIFtpbm5lckhUTUxdPVwiYXN5bmNDb250ZW50XCIgW25nQ2xhc3NdPVwic3R5bGVDbGFzc1wiIFtuZ1N0eWxlXT1cInN0eWxlXCI+PC9zcGFuPlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdTd2l0Y2hDYXNlPVwiQ09OVEVOVF9UWVBFLlRFTVBMQVRFXCI+XG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJwYXJzZWRDb250ZW50O2NvbnRleHQ6cGFyc2VkQ29udGV4dFwiPjwvbmctY29udGFpbmVyPlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8bmctY29udGFpbmVyICpuZ1N3aXRjaENhc2U9XCJDT05URU5UX1RZUEUuQ09NUE9ORU5UXCI+XG4gICAgICAgIDxuZGMtZHluYW1pYyBbbmRjRHluYW1pY0NvbXBvbmVudF09XCJkeW5hQ29tcG9uZW50LnR5cGVcIlxuICAgICAgICAgICAgICAgICAgICAgW25kY0R5bmFtaWNEaXJlY3RpdmVzXT1cImR5bmFDb21wb25lbnQuZGlyZWN0aXZlc1wiXG4gICAgICAgICAgICAgICAgICAgICBbbmRjRHluYW1pY0F0dHJpYnV0ZXNdPVwiZHluYUNvbXBvbmVudC5hdHRyc1wiXG4gICAgICAgID5cbiAgICAgICAgPC9uZGMtZHluYW1pYz5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgIDwvbmctY29udGFpbmVyPlxuICBgLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBEeW5hQ29udGVudENvbXBvbmVudCBleHRlbmRzIEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG5cbiAgQ09OVEVOVF9UWVBFID0gQ29udGVudFR5cGU7XG5cbiAgQElucHV0KCkgY29udGVudDogRHluYUNvbnRlbnQ7XG5cbiAgQElucHV0KCkgY29udGV4dDogQ29udGV4dDtcblxuICBASW5wdXQoKSBzdHlsZUNsYXNzOiBhbnk7XG5cbiAgQElucHV0KCkgc3R5bGU6IGFueTtcblxuICBwYXJzZWRDb250ZW50OiBhbnk7XG5cbiAgcGFyc2VkQ29udGVudCQ6IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+KHVuZGVmaW5lZCk7XG5cbiAgY29udGVudFR5cGU6IENvbnRlbnRUeXBlO1xuXG4gIHBhcnNlZENvbnRleHQ6IENvbnRleHQ7XG5cbiAgcGFyc2VkQ29udGV4dEZuOiAoY29udGV4dCkgPT4gc3RyaW5nIHwgT2JzZXJ2YWJsZTxzdHJpbmc+O1xuXG4gIGR5bmFDb21wb25lbnQ6IER5bmFDb21wb25lbnQ7XG5cbiAgY29uc3RydWN0b3IocHVibGljIGNkOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgdGhpcy5wYXJzZSgpO1xuICB9XG5cbiAgcmVmcmVzaCgpIHtcbiAgICB0aGlzLnBhcnNlKCk7XG4gICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2UoKSB7XG4gICAgaWYgKENvbW1vbnNVdGlscy5pc0pzb24odGhpcy5jb250ZW50KSkge1xuICAgICAgaWYgKHRoaXMuY29udGVudFsnY29udGVudCddKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRbJ3N0eWxlQ2xhc3MnXSkge1xuICAgICAgICAgIHRoaXMuc3R5bGVDbGFzcyA9IHRoaXMuY29udGVudFsnc3R5bGVDbGFzcyddO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRbJ3N0eWxlJ10pIHtcbiAgICAgICAgICB0aGlzLnN0eWxlID0gdGhpcy5jb250ZW50WydzdHlsZSddO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29udGVudCA9IHRoaXMuY29udGVudFsnY29udGVudCddO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY29udGVudFsnZGF0YSddKSB7XG4gICAgICAgIHRoaXMuY29udGVudFR5cGUgPSBDb250ZW50VHlwZS5EQVRBO1xuICAgICAgICB0aGlzLnBhcnNlZENvbnRlbnQgPSBbXTtcbiAgICAgICAgT2JqZWN0LmtleXModGhpcy5jb250ZW50WydkYXRhJ10pLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICB0aGlzLnBhcnNlZENvbnRlbnQucHVzaCh7XG4gICAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgIHZhbHVlOiBDb21tb25zVXRpbHMuZ2V0VGV4dCh0aGlzLmNvbnRlbnRbJ2RhdGEnXVtrZXldKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuY29udGVudFsndHlwZSddKSB7XG4gICAgICAgIHRoaXMuY29udGVudFR5cGUgPSBDb250ZW50VHlwZS5DT01QT05FTlQ7XG4gICAgICAgIHRoaXMuZHluYUNvbXBvbmVudCA9IDxEeW5hQ29tcG9uZW50PnRoaXMuY29udGVudDtcbiAgICAgICAgbGV0IGRpcmVjdGl2ZXMgPSB0aGlzLmR5bmFDb21wb25lbnQuZGlyZWN0aXZlcztcbiAgICAgICAgY29uc3QgZHluYURpcmVjdGl2ZXMgPSBbXTtcbiAgICAgICAgaWYgKGRpcmVjdGl2ZXMpIHtcbiAgICAgICAgICBkaXJlY3RpdmVzID0gQ29tbW9uc1V0aWxzLmdldEFycmF5VmFsdWUoZGlyZWN0aXZlcyk7XG4gICAgICAgICAgZGlyZWN0aXZlcy5maWx0ZXIoZGlyZWN0ID0+ICEhZGlyZWN0LnR5cGUpLmZvckVhY2goZGlyZWN0ID0+IHtcbiAgICAgICAgICAgIGR5bmFEaXJlY3RpdmVzLnB1c2goZHluYW1pY0RpcmVjdGl2ZURlZihkaXJlY3QudHlwZSwgZGlyZWN0LmlucHV0cywgZGlyZWN0Lm91dHB1dHMpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5keW5hQ29tcG9uZW50LnByb3BzIHx8IHRoaXMuY29udGV4dCkge1xuICAgICAgICAgIGR5bmFEaXJlY3RpdmVzLnB1c2goZHluYW1pY0RpcmVjdGl2ZURlZihQcm9wc0JpbmREaXJlY3RpdmUsIE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZHluYUNvbXBvbmVudC5wcm9wcyB8fCB7fSwgdGhpcy5jb250ZXh0IHx8IHt9KSkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZHluYUNvbXBvbmVudC5kaXJlY3RpdmVzID0gZHluYURpcmVjdGl2ZXM7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucGFyc2VkQ29udGVudCA9ICg8Q29udGV4dGVkQ29udGVudD50aGlzLmNvbnRlbnQpLmNvbnRlbnQ7XG4gICAgICAgIHRoaXMucGFyc2VkQ29udGV4dCA9IHtcbiAgICAgICAgICAuLi4oPENvbnRleHRlZENvbnRlbnQ+dGhpcy5jb250ZW50KS5jb250ZXh0IHx8IHt9LFxuICAgICAgICAgIC4uLnRoaXMuY29udGV4dCB8fCB7fVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnBhcnNlZENvbnRlbnQgPSB0aGlzLmNvbnRlbnQ7XG4gICAgICB0aGlzLnBhcnNlZENvbnRleHQgPSB0aGlzLmNvbnRleHQ7XG4gICAgfVxuICAgIGlmIChDb21tb25zVXRpbHMuaXNTdHJpbmcodGhpcy5wYXJzZWRDb250ZW50KSkge1xuICAgICAgaWYgKENvbW1vbnNVdGlscy5pc1RlbXBsYXRlU3RyKHRoaXMucGFyc2VkQ29udGVudCkpIHtcbiAgICAgICAgdGhpcy5wYXJzZWRDb250ZW50ID0gQ29tbW9uc1V0aWxzLnRlbXBsYXRlU3RyKHRoaXMucGFyc2VkQ29udGVudCwgdGhpcy5jb250ZXh0KSB8fCAnPHNwYW4+PC9zcGFuPic7XG4gICAgICAgIHRoaXMuY29udGVudFR5cGUgPSBDb250ZW50VHlwZS5URU1QTEFURV9TVFI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmNvbnRlbnRUeXBlID0gQ29udGVudFR5cGUuU1RSSU5HO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5wYXJzZWRDb250ZW50IGluc3RhbmNlb2YgVGVtcGxhdGVSZWYpIHtcbiAgICAgIHRoaXMuY29udGVudFR5cGUgPSBDb250ZW50VHlwZS5URU1QTEFURTtcbiAgICB9IGVsc2UgaWYgKENvbW1vbnNVdGlscy5pc0Z1bmN0aW9uKHRoaXMucGFyc2VkQ29udGVudCkpIHtcbiAgICAgIHRoaXMucGFyc2VkQ29udGV4dEZuID0gdGhpcy5wYXJzZWRDb250ZW50O1xuICAgICAgY29uc3QgcnRuOiBzdHJpbmcgfCBPYnNlcnZhYmxlPHN0cmluZz4gPSB0aGlzLnBhcnNlZENvbnRleHRGbih0aGlzLnBhcnNlZENvbnRleHQpO1xuICAgICAgaWYgKHJ0biBpbnN0YW5jZW9mIE9ic2VydmFibGUpIHtcbiAgICAgICAgKDxPYnNlcnZhYmxlPHN0cmluZz4+cnRuKS5zdWJzY3JpYmUocmVzdWx0ID0+IHRoaXMucGFyc2VkQ29udGVudCQubmV4dChDb21tb25zVXRpbHMudG9TdHJpbmcocmVzdWx0KSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5wYXJzZWRDb250ZW50JC5uZXh0KHJ0bik7XG4gICAgICB9XG4gICAgICB0aGlzLmNvbnRlbnRUeXBlID0gQ29udGVudFR5cGUuRlVOQ1RJT047XG4gICAgfVxuICB9XG59XG5cbiJdfQ==