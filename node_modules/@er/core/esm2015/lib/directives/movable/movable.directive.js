/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, ContentChildren, Directive, ElementRef, HostBinding, HostListener, Input, QueryList } from '@angular/core';
import { MovableHandleDirective } from './movable-handle.directive';
/**
 * @record
 */
export function Coordinates() { }
if (false) {
    /** @type {?} */
    Coordinates.prototype.top;
    /** @type {?} */
    Coordinates.prototype.left;
}
/**
 * @record
 */
export function Rects() { }
if (false) {
    /** @type {?} */
    Rects.prototype.top;
    /** @type {?} */
    Rects.prototype.left;
    /** @type {?} */
    Rects.prototype.height;
    /** @type {?} */
    Rects.prototype.width;
}
/**
 * @record
 */
export function ITouchEvent() { }
if (false) {
    /** @type {?} */
    ITouchEvent.prototype.changedTouches;
}
export class Position {
    /**
     * @param {?} pos
     */
    constructor(pos) {
        this.height = null;
        this.width = null;
        if (this.containsNumberProp(pos, ['top', 'left'])) {
            this.top = ((/** @type {?} */ (pos))).top;
            this.left = ((/** @type {?} */ (pos))).left;
            if (this.containsNumberProp(pos, ['height', 'width'])) {
                this.height = ((/** @type {?} */ (pos))).height;
                this.width = ((/** @type {?} */ (pos))).width;
            }
        }
        else if (this.containsNumberProp(pos, ['clientY', 'clientX'])) {
            this.top = ((/** @type {?} */ (pos))).clientY;
            this.left = ((/** @type {?} */ (pos))).clientX;
        }
        else if (((/** @type {?} */ (pos))).changedTouches
            && ((/** @type {?} */ (pos))).changedTouches.length > 0
            && ((/** @type {?} */ (pos))).changedTouches[0]
            && this.containsNumberProp(((/** @type {?} */ (pos))).changedTouches[0], ['clientY', 'clientX'])) {
            this.top = ((/** @type {?} */ (pos))).changedTouches[0].clientY;
            this.left = ((/** @type {?} */ (pos))).changedTouches[0].clientX;
        }
    }
    /**
     * @return {?}
     */
    get bottom() {
        return (this.height === null) ? null : this.top + this.height;
    }
    /**
     * @return {?}
     */
    get right() {
        return (this.width === null) ? null : this.left + this.width;
    }
    /**
     * @param {?} position
     * @return {?}
     */
    minus(position) {
        return new Position({
            top: (this.top - position.top),
            left: (this.left - position.left),
            height: this.height,
            width: this.width
        });
    }
    /**
     * @param {?} position
     * @return {?}
     */
    plus(position) {
        return new Position({
            top: (this.top + position.top),
            left: (this.left + position.left),
            height: this.height,
            width: this.width
        });
    }
    /**
     * @protected
     * @param {?} object
     * @param {?} props
     * @return {?}
     */
    containsNumberProp(object, props) {
        return props.every(prop => prop in object && typeof object[prop] === 'number');
    }
}
if (false) {
    /** @type {?} */
    Position.prototype.top;
    /** @type {?} */
    Position.prototype.left;
    /** @type {?} */
    Position.prototype.height;
    /** @type {?} */
    Position.prototype.width;
}
export class MovableDirective {
    /**
     * @param {?} element
     * @param {?} cd
     */
    constructor(element, cd) {
        this.element = element;
        this.cd = cd;
        this.movableConstrained = true;
        /**
         * true if moving is in progress.
         */
        this.isMoving = false;
        this.isHandle = false;
        /**
         * set class on host to indicate movable support.
         */
        this.isMovable = true;
        this.handles = [];
        /**
         * set class depending on the status.
         */
        this._movableEnabled = true;
    }
    /**
     * @protected
     * @return {?}
     */
    get movableEnabled() {
        return this._movableEnabled;
    }
    /**
     * optional input to toggle movable status.
     * @protected
     * @param {?} value
     * @return {?}
     */
    set movableEnabled(value) {
        this._movableEnabled = value;
        // propagate enabled status to handles
        if (this.handles.length > 0) {
            this.handles.forEach(handle => handle.movableEnabled = value);
        }
    }
    /**
     * @protected
     * @param {?} value
     * @return {?}
     */
    set movable(value) {
        this.movableName = value;
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        /** @type {?} */
        const position = this.getStyle(this.element.nativeElement, 'position');
        if (position === 'static') {
            this.positionStyle = 'relative';
            this.cd.detectChanges();
        }
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.allHandles.changes.subscribe((handles) => this.updateQuery(handles));
        // TODO: workaround for https://github.com/angular/angular/issues/12818 and https://github.com/angular/angular/issues/9689
        // manually trigger first update.
        this.updateQuery(this.allHandles);
    }
    /**
     * @protected
     * @param {?} handles
     * @return {?}
     */
    updateQuery(handles) {
        this.handles = handles.filter(handle => handle.movableHandle === this.movableName);
        // fallback to this as handle if not specified
        if (this.handles.length === 0) {
            this.isHandle = true;
        }
        // propagate enabled status to handles
        if (this.handles.length > 0) {
            this.handles.forEach(handle => handle.movableEnabled = this.movableEnabled);
        }
    }
    /**
     * @protected
     * @param {?} event
     * @return {?}
     */
    onMouseDown(event) {
        this.startMoving(event);
    }
    /**
     * @protected
     * @param {?} event
     * @return {?}
     */
    onMouseUp(event) {
        this.stopMoving();
    }
    // using document to move even pointer leaves the host (fast moving)
    /**
     * @protected
     * @param {?} event
     * @return {?}
     */
    onMouseMove(event) {
        this.moveElement(event);
    }
    /**
     * @protected
     * @param {?} event
     * @return {?}
     */
    onTouchStart(event) {
        this.startMoving(event);
    }
    /**
     * @protected
     * @param {?} event
     * @return {?}
     */
    onTouchEnd(event) {
        this.stopMoving();
    }
    // using document to move even pointer leaves the host (fast moving)
    /**
     * @protected
     * @param {?} event
     * @return {?}
     */
    onTouchMove(event) {
        this.moveElement(event);
    }
    /**
     * @protected
     * @param {?} event
     * @return {?}
     */
    startMoving(event) {
        if (this.isEventInHandle(event) && this.movableEnabled) {
            this.startPosition = new Position(event).minus(this.getRelativeRect(this.element.nativeElement));
            this.isMoving = true;
            if (this.handles.length > 0) {
                this.handles.forEach(handle => handle.isMoving = true);
            }
            this.cd.detectChanges();
        }
    }
    /**
     * @protected
     * @return {?}
     */
    stopMoving() {
        this.isMoving = false;
        if (this.handles.length > 0) {
            this.handles.forEach(handle => handle.isMoving = false);
        }
        this.cd.detectChanges();
    }
    /**
     * @protected
     * @param {?} event
     * @return {?}
     */
    moveElement(event) {
        if (this.isMoving) {
            /** @type {?} */
            let moved = false;
            /** @type {?} */
            const newPosition = new Position(event).minus(this.startPosition);
            if (!this.movableConstrained) {
                this.positionTop = newPosition.top;
                this.positionLeft = newPosition.left;
                moved = true;
            }
            else {
                /** @type {?} */
                const constainedByElement = this.element.nativeElement.ownerDocument.getElementById(this.movableConstraint);
                /** @type {?} */
                let constainedByAbsPos;
                if (constainedByElement) {
                    constainedByAbsPos = new Position(constainedByElement.getBoundingClientRect());
                }
                else {
                    constainedByAbsPos = this.getViewPos(this.element.nativeElement);
                }
                /** @type {?} */
                const elementAbsPos = new Position(this.element.nativeElement.getBoundingClientRect());
                /** @type {?} */
                const diffAbsToRel = elementAbsPos.minus(this.getRelativeRect(this.element.nativeElement));
                /** @type {?} */
                const newAbsPos = diffAbsToRel.plus(newPosition);
                if (newAbsPos.top >= constainedByAbsPos.top && newAbsPos.bottom <= constainedByAbsPos.bottom) {
                    this.positionTop = newPosition.top;
                    moved = true;
                }
                else {
                    if (newAbsPos.top < constainedByAbsPos.top) {
                        // max to top limit, to prevent sticking of the movable on fast move
                        this.positionTop = constainedByAbsPos.minus(diffAbsToRel).top;
                        moved = true;
                    }
                    if (newAbsPos.bottom > constainedByAbsPos.bottom) {
                        // max to bottom limit, to prevent sticking of the movable on fast move
                        this.positionTop = constainedByAbsPos.minus(diffAbsToRel).bottom - elementAbsPos.height;
                        moved = true;
                    }
                }
                if (newAbsPos.left >= constainedByAbsPos.left && newAbsPos.right <= constainedByAbsPos.right) {
                    this.positionLeft = newPosition.left;
                    moved = true;
                }
                else {
                    if (newAbsPos.left < constainedByAbsPos.left) {
                        // max to left limit, to prevent sticking of the movable on fast move
                        this.positionLeft = constainedByAbsPos.minus(diffAbsToRel).left;
                        moved = true;
                    }
                    if (newAbsPos.right > constainedByAbsPos.right) {
                        // max to right limit, to prevent sticking of the movable on fast move
                        this.positionLeft = constainedByAbsPos.minus(diffAbsToRel).right - elementAbsPos.width;
                        moved = true;
                    }
                }
            }
            if (moved) {
                // prevent selection and other side effects during moving, only when position moved, i.e. to allow buttons to be clicked
                event.preventDefault();
                event.stopPropagation();
                this.cd.detectChanges();
            }
        }
    }
    /**
     * @protected
     * @param {?} event
     * @return {?}
     */
    isEventInHandle(event) {
        /** @type {?} */
        let srcElement = event.target || event.srcElement;
        if (this.isHandle) {
            // check parent elements too.
            while (srcElement instanceof HTMLElement && srcElement !== this.element.nativeElement && srcElement.parentElement) {
                srcElement = srcElement.parentElement;
            }
            return this.element.nativeElement === srcElement;
        }
        else {
            return this.handles.some(handle => {
                // check parent elements too.
                while (srcElement instanceof HTMLElement && srcElement !== handle.element.nativeElement && srcElement.parentElement) {
                    srcElement = srcElement.parentElement;
                }
                return handle.element.nativeElement === srcElement;
            });
        }
    }
    /**
     * @protected
     * @param {?} element
     * @return {?}
     */
    getRelativeRect(element) {
        return new Position({
            top: this.parseStyleInt(this.getStyle(element, 'top')) || 0,
            left: this.parseStyleInt(this.getStyle(element, 'left')) || 0,
            height: this.parseStyleInt(this.getStyle(element, 'height')) || 0,
            width: this.parseStyleInt(this.getStyle(element, 'width')) || 0
        });
    }
    /**
     * @protected
     * @param {?} value
     * @return {?}
     */
    parseStyleInt(value) {
        return parseInt(value, 10);
    }
    /**
     * @protected
     * @param {?} element
     * @param {?} property
     * @return {?}
     */
    getStyle(element, property) {
        /** @type {?} */
        const view = this.getView(element);
        return view.getComputedStyle(element, null).getPropertyValue(property);
    }
    /**
     * @protected
     * @param {?} element
     * @return {?}
     */
    getView(element) {
        /** @type {?} */
        let view = element.ownerDocument.defaultView;
        if (!view || view.opener) {
            view = window;
        }
        return view;
    }
    /**
     * @protected
     * @param {?} element
     * @return {?}
     */
    getViewPos(element) {
        /** @type {?} */
        const view = this.getView(element);
        return new Position({
            top: 0,
            left: 0,
            height: view.innerHeight || element.ownerDocument.documentElement.clientHeight,
            width: view.innerWidth || element.ownerDocument.documentElement.clientWidth
        });
    }
}
MovableDirective.decorators = [
    { type: Directive, args: [{
                selector: '[movable]'
            },] }
];
/** @nocollapse */
MovableDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: ChangeDetectorRef }
];
MovableDirective.propDecorators = {
    movableConstrained: [{ type: Input }],
    movableConstraint: [{ type: Input }],
    isMoving: [{ type: HostBinding, args: ['class.movable-moving',] }],
    isHandle: [{ type: HostBinding, args: ['class.movable-handle',] }],
    positionStyle: [{ type: HostBinding, args: ['style.position',] }],
    positionTop: [{ type: HostBinding, args: ['style.top.px',] }],
    positionLeft: [{ type: HostBinding, args: ['style.left.px',] }],
    isMovable: [{ type: HostBinding, args: ['class.movable',] }],
    allHandles: [{ type: ContentChildren, args: [MovableHandleDirective, { descendants: true },] }],
    _movableEnabled: [{ type: HostBinding, args: ['class.movable-enabled',] }],
    movableEnabled: [{ type: Input }],
    movable: [{ type: Input }],
    onMouseDown: [{ type: HostListener, args: ['mousedown', ['$event'],] }],
    onMouseUp: [{ type: HostListener, args: ['document:mouseup', ['$event'],] }],
    onMouseMove: [{ type: HostListener, args: ['document:mousemove', ['$event'],] }],
    onTouchStart: [{ type: HostListener, args: ['touchstart', ['$event'],] }],
    onTouchEnd: [{ type: HostListener, args: ['document:touchend', ['$event'],] }],
    onTouchMove: [{ type: HostListener, args: ['document:touchmove', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    MovableDirective.prototype.movableConstrained;
    /** @type {?} */
    MovableDirective.prototype.movableConstraint;
    /**
     * saved start position when moving starts.
     * @type {?}
     * @protected
     */
    MovableDirective.prototype.startPosition;
    /**
     * true if moving is in progress.
     * @type {?}
     * @protected
     */
    MovableDirective.prototype.isMoving;
    /**
     * @type {?}
     * @protected
     */
    MovableDirective.prototype.isHandle;
    /**
     * set position style on host to relative.
     * @type {?}
     * @protected
     */
    MovableDirective.prototype.positionStyle;
    /**
     * current Y position of the native element.
     * @type {?}
     * @protected
     */
    MovableDirective.prototype.positionTop;
    /**
     * current X position of the native element.
     * @type {?}
     * @protected
     */
    MovableDirective.prototype.positionLeft;
    /**
     * set class on host to indicate movable support.
     * @type {?}
     * @protected
     */
    MovableDirective.prototype.isMovable;
    /**
     * @type {?}
     * @protected
     */
    MovableDirective.prototype.movableName;
    /**
     * @type {?}
     * @protected
     */
    MovableDirective.prototype.allHandles;
    /**
     * @type {?}
     * @protected
     */
    MovableDirective.prototype.handles;
    /**
     * set class depending on the status.
     * @type {?}
     * @protected
     */
    MovableDirective.prototype._movableEnabled;
    /** @type {?} */
    MovableDirective.prototype.element;
    /**
     * @type {?}
     * @protected
     */
    MovableDirective.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW92YWJsZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZXIvY29yZS8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL21vdmFibGUvbW92YWJsZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFHTCxpQkFBaUIsRUFDakIsZUFBZSxFQUNmLFNBQVMsRUFDVCxVQUFVLEVBQ1YsV0FBVyxFQUNYLFlBQVksRUFDWixLQUFLLEVBQ0wsU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQyxzQkFBc0IsRUFBQyxNQUFNLDRCQUE0QixDQUFDOzs7O0FBRWxFLGlDQUdDOzs7SUFGQywwQkFBWTs7SUFDWiwyQkFBYTs7Ozs7QUFHZiwyQkFLQzs7O0lBSkMsb0JBQVk7O0lBQ1oscUJBQWE7O0lBQ2IsdUJBQWU7O0lBQ2Ysc0JBQWM7Ozs7O0FBSWhCLGlDQUVDOzs7SUFEQyxxQ0FBOEI7O0FBS2hDLE1BQU0sT0FBTyxRQUFROzs7O0lBTW5CLFlBQVksR0FBYztRQUhuQixXQUFNLEdBQVcsSUFBSSxDQUFDO1FBQ3RCLFVBQUssR0FBVyxJQUFJLENBQUM7UUFHMUIsSUFBSSxJQUFJLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDLEVBQUU7WUFDakQsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLG1CQUFLLEdBQUcsRUFBQSxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQzFCLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxtQkFBSyxHQUFHLEVBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUM1QixJQUFJLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUMsRUFBRTtnQkFDckQsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLG1CQUFLLEdBQUcsRUFBQSxDQUFDLENBQUMsTUFBTSxDQUFD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QUFRLENBQUM7Ozs7SUE1RzlDLDhDQUNpQzs7SUFDakMsNkNBQ2lDOzs7Ozs7SUFFakMseUNBQWtDOzs7Ozs7SUFFbEMsb0NBQzJCOzs7OztJQUMzQixvQ0FDMkI7Ozs7OztJQUUzQix5Q0FDZ0M7Ozs7OztJQUVoQyx1Q0FDOEI7Ozs7OztJQUU5Qix3Q0FDK0I7Ozs7OztJQUUvQixxQ0FDMkI7Ozs7O0lBQzNCLHVDQUE4Qjs7Ozs7SUFDOUIsc0NBQ3dEOzs7OztJQUN4RCxtQ0FBaUQ7Ozs7OztJQU1qRCwyQ0FDaUM7O0lBTHJCLG1DQUEwQjs7Ozs7SUFBRSw4QkFBK0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlckNvbnRlbnRJbml0LFxuICBBZnRlclZpZXdJbml0LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29udGVudENoaWxkcmVuLFxuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIEhvc3RCaW5kaW5nLFxuICBIb3N0TGlzdGVuZXIsXG4gIElucHV0LFxuICBRdWVyeUxpc3Rcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge01vdmFibGVIYW5kbGVEaXJlY3RpdmV9IGZyb20gJy4vbW92YWJsZS1oYW5kbGUuZGlyZWN0aXZlJztcblxuZXhwb3J0IGludGVyZmFjZSBDb29yZGluYXRlcyB7XG4gIHRvcDogbnVtYmVyO1xuICBsZWZ0OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjdHMge1xuICB0b3A6IG51bWJlcjtcbiAgbGVmdDogbnVtYmVyO1xuICBoZWlnaHQ6IG51bWJlcjtcbiAgd2lkdGg6IG51bWJlcjtcbn1cblxuLy8gd29ya2Fyb3VuZCB0byBwcmV2ZW50IGVycm9yIGluIE1TIEVkZ2VcbmV4cG9ydCBpbnRlcmZhY2UgSVRvdWNoRXZlbnQgZXh0ZW5kcyBVSUV2ZW50IHtcbiAgY2hhbmdlZFRvdWNoZXM6IENvb3JkaW5hdGVzW107XG59XG5cbmV4cG9ydCB0eXBlIFBvc2l0aW9ucyA9IENvb3JkaW5hdGVzIHwgUmVjdHMgfCBJVG91Y2hFdmVudCB8IE1vdXNlRXZlbnQ7XG5cbmV4cG9ydCBjbGFzcyBQb3NpdGlvbiB7XG4gIHB1YmxpYyB0b3A6IG51bWJlcjtcbiAgcHVibGljIGxlZnQ6IG51bWJlcjtcbiAgcHVibGljIGhlaWdodDogbnVtYmVyID0gbnVsbDtcbiAgcHVibGljIHdpZHRoOiBudW1iZXIgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKHBvczogUG9zaXRpb25zKSB7XG4gICAgaWYgKHRoaXMuY29udGFpbnNOdW1iZXJQcm9wKHBvcywgWyd0b3AnLCAnbGVmdCddKSkge1xuICAgICAgdGhpcy50b3AgPSAoPGFueT5wb3MpLnRvcDtcbiAgICAgIHRoaXMubGVmdCA9ICg8YW55PnBvcykubGVmdDtcbiAgICAgIGlmICh0aGlzLmNvbnRhaW5zTnVtYmVyUHJvcChwb3MsIFsnaGVpZ2h0JywgJ3dpZHRoJ10pKSB7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gKDxhbnk+cG9zKS5oZWlnaHQ7XG4gICAgICAgIHRoaXMud2lkdGggPSAoPGFueT5wb3MpLndpZHRoO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5jb250YWluc051bWJlclByb3AocG9zLCBbJ2NsaWVudFknLCAnY2xpZW50WCddKSkge1xuICAgICAgdGhpcy50b3AgPSAoPGFueT5wb3MpLmNsaWVudFk7XG4gICAgICB0aGlzLmxlZnQgPSAoPGFueT5wb3MpLmNsaWVudFg7XG4gICAgfSBlbHNlIGlmICgoPGFueT5wb3MpLmNoYW5nZWRUb3VjaGVzXG4gICAgICAmJiAoPGFueT5wb3MpLmNoYW5nZWRUb3VjaGVzLmxlbmd0aCA+IDBcbiAgICAgICYmICg8YW55PnBvcykuY2hhbmdlZFRvdWNoZXNbMF1cbiAgICAgICYmIHRoaXMuY29udGFpbnNOdW1iZXJQcm9wKCg8YW55PnBvcykuY2hhbmdlZFRvdWNoZXNbMF0sIFsnY2xpZW50WScsICdjbGllbnRYJ10pXG4gICAgKSB7XG4gICAgICB0aGlzLnRvcCA9ICg8YW55PnBvcykuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WTtcbiAgICAgIHRoaXMubGVmdCA9ICg8YW55PnBvcykuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WDtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0IGJvdHRvbSgpIHtcbiAgICByZXR1cm4gKHRoaXMuaGVpZ2h0ID09PSBudWxsKSA/IG51bGwgOiB0aGlzLnRvcCArIHRoaXMuaGVpZ2h0O1xuICB9XG5cbiAgcHVibGljIGdldCByaWdodCgpIHtcbiAgICByZXR1cm4gKHRoaXMud2lkdGggPT09IG51bGwpID8gbnVsbCA6IHRoaXMubGVmdCArIHRoaXMud2lkdGg7XG4gIH1cblxuICBwdWJsaWMgbWludXMocG9zaXRpb246IENvb3JkaW5hdGVzKSB7XG4gICAgcmV0dXJuIG5ldyBQb3NpdGlvbih7XG4gICAgICB0b3A6ICh0aGlzLnRvcCAtIHBvc2l0aW9uLnRvcCksXG4gICAgICBsZWZ0OiAodGhpcy5sZWZ0IC0gcG9zaXRpb24ubGVmdCksXG4gICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0LFxuICAgICAgd2lkdGg6IHRoaXMud2lkdGhcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBwbHVzKHBvc2l0aW9uOiBDb29yZGluYXRlcykge1xuICAgIHJldHVybiBuZXcgUG9zaXRpb24oe1xuICAgICAgdG9wOiAodGhpcy50b3AgKyBwb3NpdGlvbi50b3ApLFxuICAgICAgbGVmdDogKHRoaXMubGVmdCArIHBvc2l0aW9uLmxlZnQpLFxuICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodCxcbiAgICAgIHdpZHRoOiB0aGlzLndpZHRoXG4gICAgfSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgY29udGFpbnNOdW1iZXJQcm9wKG9iamVjdDogYW55LCBwcm9wczogc3RyaW5nW10pIHtcbiAgICByZXR1cm4gcHJvcHMuZXZlcnkocHJvcCA9PiBwcm9wIGluIG9iamVjdCAmJiB0eXBlb2Ygb2JqZWN0W3Byb3BdID09PSAnbnVtYmVyJyk7XG4gIH1cbn1cblxuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbbW92YWJsZV0nXG59KVxuZXhwb3J0IGNsYXNzIE1vdmFibGVEaXJlY3RpdmUgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBBZnRlckNvbnRlbnRJbml0IHtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgbW92YWJsZUNvbnN0cmFpbmVkID0gdHJ1ZTtcbiAgQElucHV0KClcbiAgcHVibGljIG1vdmFibGVDb25zdHJhaW50OiBzdHJpbmc7XG4gIC8qKiBzYXZlZCBzdGFydCBwb3NpdGlvbiB3aGVuIG1vdmluZyBzdGFydHMuICovXG4gIHByb3RlY3RlZCBzdGFydFBvc2l0aW9uOiBQb3NpdGlvbjtcbiAgLyoqIHRydWUgaWYgbW92aW5nIGlzIGluIHByb2dyZXNzLiAqL1xuICBASG9zdEJpbmRpbmcoJ2NsYXNzLm1vdmFibGUtbW92aW5nJylcbiAgcHJvdGVjdGVkIGlzTW92aW5nID0gZmFsc2U7XG4gIEBIb3N0QmluZGluZygnY2xhc3MubW92YWJsZS1oYW5kbGUnKVxuICBwcm90ZWN0ZWQgaXNIYW5kbGUgPSBmYWxzZTtcbiAgLyoqIHNldCBwb3NpdGlvbiBzdHlsZSBvbiBob3N0IHRvIHJlbGF0aXZlLiAqL1xuICBASG9zdEJpbmRpbmcoJ3N0eWxlLnBvc2l0aW9uJylcbiAgcHJvdGVjdGVkIHBvc2l0aW9uU3R5bGU6IHN0cmluZztcbiAgLyoqIGN1cnJlbnQgWSBwb3NpdGlvbiBvZiB0aGUgbmF0aXZlIGVsZW1lbnQuICovXG4gIEBIb3N0QmluZGluZygnc3R5bGUudG9wLnB4JylcbiAgcHJvdGVjdGVkIHBvc2l0aW9uVG9wOiBudW1iZXI7XG4gIC8qKiBjdXJyZW50IFggcG9zaXRpb24gb2YgdGhlIG5hdGl2ZSBlbGVtZW50LiAqL1xuICBASG9zdEJpbmRpbmcoJ3N0eWxlLmxlZnQucHgnKVxuICBwcm90ZWN0ZWQgcG9zaXRpb25MZWZ0OiBudW1iZXI7XG4gIC8qKiBzZXQgY2xhc3Mgb24gaG9zdCB0byBpbmRpY2F0ZSBtb3ZhYmxlIHN1cHBvcnQuICovXG4gIEBIb3N0QmluZGluZygnY2xhc3MubW92YWJsZScpXG4gIHByb3RlY3RlZCBpc01vdmFibGUgPSB0cnVlO1xuICBwcm90ZWN0ZWQgbW92YWJsZU5hbWU6IHN0cmluZztcbiAgQENvbnRlbnRDaGlsZHJlbihNb3ZhYmxlSGFuZGxlRGlyZWN0aXZlLCB7ZGVzY2VuZGFudHM6IHRydWV9KVxuICBwcm90ZWN0ZWQgYWxsSGFuZGxlczogUXVlcnlMaXN0PE1vdmFibGVIYW5kbGVEaXJlY3RpdmU+O1xuICBwcm90ZWN0ZWQgaGFuZGxlczogTW92YWJsZUhhbmRsZURpcmVjdGl2ZVtdID0gW107XG5cbiAgY29uc3RydWN0b3IocHVibGljIGVsZW1lbnQ6IEVsZW1lbnRSZWYsIHByb3RlY3RlZCBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgfVxuXG4gIC8qKiBzZXQgY2xhc3MgZGVwZW5kaW5nIG9uIHRoZSBzdGF0dXMuICovXG4gIEBIb3N0QmluZGluZygnY2xhc3MubW92YWJsZS1lbmFibGVkJylcbiAgcHJvdGVjdGVkIF9tb3ZhYmxlRW5hYmxlZCA9IHRydWU7XG5cbiAgcHJvdGVjdGVkIGdldCBtb3ZhYmxlRW5hYmxlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fbW92YWJsZUVuYWJsZWQ7XG4gIH1cblxuICAvKiogb3B0aW9uYWwgaW5wdXQgdG8gdG9nZ2xlIG1vdmFibGUgc3RhdHVzLiAqL1xuICBASW5wdXQoKVxuICBwcm90ZWN0ZWQgc2V0IG1vdmFibGVFbmFibGVkKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5fbW92YWJsZUVuYWJsZWQgPSB2YWx1ZTtcbiAgICAvLyBwcm9wYWdhdGUgZW5hYmxlZCBzdGF0dXMgdG8gaGFuZGxlc1xuICAgIGlmICh0aGlzLmhhbmRsZXMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5oYW5kbGVzLmZvckVhY2goaGFuZGxlID0+IGhhbmRsZS5tb3ZhYmxlRW5hYmxlZCA9IHZhbHVlKTtcbiAgICB9XG4gIH1cblxuICBASW5wdXQoKVxuICBwcm90ZWN0ZWQgc2V0IG1vdmFibGUodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMubW92YWJsZU5hbWUgPSB2YWx1ZTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMuZ2V0U3R5bGUodGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQsICdwb3NpdGlvbicpO1xuICAgIGlmIChwb3NpdGlvbiA9PT0gJ3N0YXRpYycpIHtcbiAgICAgIHRoaXMucG9zaXRpb25TdHlsZSA9ICdyZWxhdGl2ZSc7XG4gICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgdGhpcy5hbGxIYW5kbGVzLmNoYW5nZXMuc3Vic2NyaWJlKChoYW5kbGVzOiBRdWVyeUxpc3Q8TW92YWJsZUhhbmRsZURpcmVjdGl2ZT4pID0+IHRoaXMudXBkYXRlUXVlcnkoaGFuZGxlcykpO1xuICAgIC8vIFRPRE86IHdvcmthcm91bmQgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyL2FuZ3VsYXIvaXNzdWVzLzEyODE4IGFuZCBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9hbmd1bGFyL2lzc3Vlcy85Njg5XG4gICAgLy8gbWFudWFsbHkgdHJpZ2dlciBmaXJzdCB1cGRhdGUuXG4gICAgdGhpcy51cGRhdGVRdWVyeSh0aGlzLmFsbEhhbmRsZXMpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHVwZGF0ZVF1ZXJ5KGhhbmRsZXM6IFF1ZXJ5TGlzdDxNb3ZhYmxlSGFuZGxlRGlyZWN0aXZlPikge1xuICAgIHRoaXMuaGFuZGxlcyA9IGhhbmRsZXMuZmlsdGVyKGhhbmRsZSA9PiBoYW5kbGUubW92YWJsZUhhbmRsZSA9PT0gdGhpcy5tb3ZhYmxlTmFtZSk7XG4gICAgLy8gZmFsbGJhY2sgdG8gdGhpcyBhcyBoYW5kbGUgaWYgbm90IHNwZWNpZmllZFxuICAgIGlmICh0aGlzLmhhbmRsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLmlzSGFuZGxlID0gdHJ1ZTtcbiAgICB9XG4gICAgLy8gcHJvcGFnYXRlIGVuYWJsZWQgc3RhdHVzIHRvIGhhbmRsZXNcbiAgICBpZiAodGhpcy5oYW5kbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuaGFuZGxlcy5mb3JFYWNoKGhhbmRsZSA9PiBoYW5kbGUubW92YWJsZUVuYWJsZWQgPSB0aGlzLm1vdmFibGVFbmFibGVkKTtcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdtb3VzZWRvd24nLCBbJyRldmVudCddKVxuICBwcm90ZWN0ZWQgb25Nb3VzZURvd24oZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICB0aGlzLnN0YXJ0TW92aW5nKGV2ZW50KTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50Om1vdXNldXAnLCBbJyRldmVudCddKVxuICBwcm90ZWN0ZWQgb25Nb3VzZVVwKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgdGhpcy5zdG9wTW92aW5nKCk7XG4gIH1cblxuICAvLyB1c2luZyBkb2N1bWVudCB0byBtb3ZlIGV2ZW4gcG9pbnRlciBsZWF2ZXMgdGhlIGhvc3QgKGZhc3QgbW92aW5nKVxuICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDptb3VzZW1vdmUnLCBbJyRldmVudCddKVxuICBwcm90ZWN0ZWQgb25Nb3VzZU1vdmUoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICB0aGlzLm1vdmVFbGVtZW50KGV2ZW50KTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBbJyRldmVudCddKVxuICBwcm90ZWN0ZWQgb25Ub3VjaFN0YXJ0KGV2ZW50OiBJVG91Y2hFdmVudCkge1xuICAgIHRoaXMuc3RhcnRNb3ZpbmcoZXZlbnQpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6dG91Y2hlbmQnLCBbJyRldmVudCddKVxuICBwcm90ZWN0ZWQgb25Ub3VjaEVuZChldmVudDogSVRvdWNoRXZlbnQpIHtcbiAgICB0aGlzLnN0b3BNb3ZpbmcoKTtcbiAgfVxuXG4gIC8vIHVzaW5nIGRvY3VtZW50IHRvIG1vdmUgZXZlbiBwb2ludGVyIGxlYXZlcyB0aGUgaG9zdCAoZmFzdCBtb3ZpbmcpXG4gIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50OnRvdWNobW92ZScsIFsnJGV2ZW50J10pXG4gIHByb3RlY3RlZCBvblRvdWNoTW92ZShldmVudDogYW55KSB7XG4gICAgdGhpcy5tb3ZlRWxlbWVudChldmVudCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc3RhcnRNb3ZpbmcoZXZlbnQ6IElUb3VjaEV2ZW50IHwgTW91c2VFdmVudCkge1xuICAgIGlmICh0aGlzLmlzRXZlbnRJbkhhbmRsZShldmVudCkgJiYgdGhpcy5tb3ZhYmxlRW5hYmxlZCkge1xuICAgICAgdGhpcy5zdGFydFBvc2l0aW9uID0gbmV3IFBvc2l0aW9uKGV2ZW50KS5taW51cyh0aGlzLmdldFJlbGF0aXZlUmVjdCh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCkpO1xuICAgICAgdGhpcy5pc01vdmluZyA9IHRydWU7XG4gICAgICBpZiAodGhpcy5oYW5kbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpcy5oYW5kbGVzLmZvckVhY2goaGFuZGxlID0+IGhhbmRsZS5pc01vdmluZyA9IHRydWUpO1xuICAgICAgfVxuICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIHN0b3BNb3ZpbmcoKSB7XG4gICAgdGhpcy5pc01vdmluZyA9IGZhbHNlO1xuICAgIGlmICh0aGlzLmhhbmRsZXMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5oYW5kbGVzLmZvckVhY2goaGFuZGxlID0+IGhhbmRsZS5pc01vdmluZyA9IGZhbHNlKTtcbiAgICB9XG4gICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgbW92ZUVsZW1lbnQoZXZlbnQ6IElUb3VjaEV2ZW50IHwgTW91c2VFdmVudCkge1xuICAgIGlmICh0aGlzLmlzTW92aW5nKSB7XG4gICAgICBsZXQgbW92ZWQgPSBmYWxzZTtcbiAgICAgIGNvbnN0IG5ld1Bvc2l0aW9uID0gbmV3IFBvc2l0aW9uKGV2ZW50KS5taW51cyh0aGlzLnN0YXJ0UG9zaXRpb24pO1xuICAgICAgaWYgKCF0aGlzLm1vdmFibGVDb25zdHJhaW5lZCkge1xuICAgICAgICB0aGlzLnBvc2l0aW9uVG9wID0gbmV3UG9zaXRpb24udG9wO1xuICAgICAgICB0aGlzLnBvc2l0aW9uTGVmdCA9IG5ld1Bvc2l0aW9uLmxlZnQ7XG4gICAgICAgIG1vdmVkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGNvbnN0YWluZWRCeUVsZW1lbnQ6IEhUTUxFbGVtZW50ID0gdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQub3duZXJEb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLm1vdmFibGVDb25zdHJhaW50KTtcbiAgICAgICAgbGV0IGNvbnN0YWluZWRCeUFic1BvczogUG9zaXRpb247XG4gICAgICAgIGlmIChjb25zdGFpbmVkQnlFbGVtZW50KSB7XG4gICAgICAgICAgY29uc3RhaW5lZEJ5QWJzUG9zID0gbmV3IFBvc2l0aW9uKGNvbnN0YWluZWRCeUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0YWluZWRCeUFic1BvcyA9IHRoaXMuZ2V0Vmlld1Bvcyh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZWxlbWVudEFic1BvcyA9IG5ldyBQb3NpdGlvbih0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSk7XG4gICAgICAgIGNvbnN0IGRpZmZBYnNUb1JlbCA9IGVsZW1lbnRBYnNQb3MubWludXModGhpcy5nZXRSZWxhdGl2ZVJlY3QodGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQpKTtcbiAgICAgICAgY29uc3QgbmV3QWJzUG9zID0gZGlmZkFic1RvUmVsLnBsdXMobmV3UG9zaXRpb24pO1xuICAgICAgICBpZiAobmV3QWJzUG9zLnRvcCA+PSBjb25zdGFpbmVkQnlBYnNQb3MudG9wICYmIG5ld0Fic1Bvcy5ib3R0b20gPD0gY29uc3RhaW5lZEJ5QWJzUG9zLmJvdHRvbSkge1xuICAgICAgICAgIHRoaXMucG9zaXRpb25Ub3AgPSBuZXdQb3NpdGlvbi50b3A7XG4gICAgICAgICAgbW92ZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChuZXdBYnNQb3MudG9wIDwgY29uc3RhaW5lZEJ5QWJzUG9zLnRvcCkge1xuICAgICAgICAgICAgLy8gbWF4IHRvIHRvcCBsaW1pdCwgdG8gcHJldmVudCBzdGlja2luZyBvZiB0aGUgbW92YWJsZSBvbiBmYXN0IG1vdmVcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb25Ub3AgPSBjb25zdGFpbmVkQnlBYnNQb3MubWludXMoZGlmZkFic1RvUmVsKS50b3A7XG4gICAgICAgICAgICBtb3ZlZCA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChuZXdBYnNQb3MuYm90dG9tID4gY29uc3RhaW5lZEJ5QWJzUG9zLmJvdHRvbSkge1xuICAgICAgICAgICAgLy8gbWF4IHRvIGJvdHRvbSBsaW1pdCwgdG8gcHJldmVudCBzdGlja2luZyBvZiB0aGUgbW92YWJsZSBvbiBmYXN0IG1vdmVcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb25Ub3AgPSBjb25zdGFpbmVkQnlBYnNQb3MubWludXMoZGlmZkFic1RvUmVsKS5ib3R0b20gLSBlbGVtZW50QWJzUG9zLmhlaWdodDtcbiAgICAgICAgICAgIG1vdmVkID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld0Fic1Bvcy5sZWZ0ID49IGNvbnN0YWluZWRCeUFic1Bvcy5sZWZ0ICYmIG5ld0Fic1Bvcy5yaWdodCA8PSBjb25zdGFpbmVkQnlBYnNQb3MucmlnaHQpIHtcbiAgICAgICAgICB0aGlzLnBvc2l0aW9uTGVmdCA9IG5ld1Bvc2l0aW9uLmxlZnQ7XG4gICAgICAgICAgbW92ZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChuZXdBYnNQb3MubGVmdCA8IGNvbnN0YWluZWRCeUFic1Bvcy5sZWZ0KSB7XG4gICAgICAgICAgICAvLyBtYXggdG8gbGVmdCBsaW1pdCwgdG8gcHJldmVudCBzdGlja2luZyBvZiB0aGUgbW92YWJsZSBvbiBmYXN0IG1vdmVcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb25MZWZ0ID0gY29uc3RhaW5lZEJ5QWJzUG9zLm1pbnVzKGRpZmZBYnNUb1JlbCkubGVmdDtcbiAgICAgICAgICAgIG1vdmVkID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG5ld0Fic1Bvcy5yaWdodCA+IGNvbnN0YWluZWRCeUFic1Bvcy5yaWdodCkge1xuICAgICAgICAgICAgLy8gbWF4IHRvIHJpZ2h0IGxpbWl0LCB0byBwcmV2ZW50IHN0aWNraW5nIG9mIHRoZSBtb3ZhYmxlIG9uIGZhc3QgbW92ZVxuICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkxlZnQgPSBjb25zdGFpbmVkQnlBYnNQb3MubWludXMoZGlmZkFic1RvUmVsKS5yaWdodCAtIGVsZW1lbnRBYnNQb3Mud2lkdGg7XG4gICAgICAgICAgICBtb3ZlZCA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAobW92ZWQpIHtcbiAgICAgICAgLy8gcHJldmVudCBzZWxlY3Rpb24gYW5kIG90aGVyIHNpZGUgZWZmZWN0cyBkdXJpbmcgbW92aW5nLCBvbmx5IHdoZW4gcG9zaXRpb24gbW92ZWQsIGkuZS4gdG8gYWxsb3cgYnV0dG9ucyB0byBiZSBjbGlja2VkXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgaXNFdmVudEluSGFuZGxlKGV2ZW50OiBJVG91Y2hFdmVudCB8IE1vdXNlRXZlbnQpOiBib29sZWFuIHtcbiAgICBsZXQgc3JjRWxlbWVudCA9IGV2ZW50LnRhcmdldCB8fCBldmVudC5zcmNFbGVtZW50O1xuICAgIGlmICh0aGlzLmlzSGFuZGxlKSB7XG4gICAgICAvLyBjaGVjayBwYXJlbnQgZWxlbWVudHMgdG9vLlxuICAgICAgd2hpbGUgKHNyY0VsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCAmJiBzcmNFbGVtZW50ICE9PSB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCAmJiBzcmNFbGVtZW50LnBhcmVudEVsZW1lbnQpIHtcbiAgICAgICAgc3JjRWxlbWVudCA9IHNyY0VsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCA9PT0gc3JjRWxlbWVudDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlcy5zb21lKGhhbmRsZSA9PiB7XG4gICAgICAgIC8vIGNoZWNrIHBhcmVudCBlbGVtZW50cyB0b28uXG4gICAgICAgIHdoaWxlIChzcmNFbGVtZW50IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgJiYgc3JjRWxlbWVudCAhPT0gaGFuZGxlLmVsZW1lbnQubmF0aXZlRWxlbWVudCAmJiBzcmNFbGVtZW50LnBhcmVudEVsZW1lbnQpIHtcbiAgICAgICAgICBzcmNFbGVtZW50ID0gc3JjRWxlbWVudC5wYXJlbnRFbGVtZW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBoYW5kbGUuZWxlbWVudC5uYXRpdmVFbGVtZW50ID09PSBzcmNFbGVtZW50O1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGdldFJlbGF0aXZlUmVjdChlbGVtZW50OiBIVE1MRWxlbWVudCk6IFBvc2l0aW9uIHtcbiAgICByZXR1cm4gbmV3IFBvc2l0aW9uKHtcbiAgICAgIHRvcDogdGhpcy5wYXJzZVN0eWxlSW50KHRoaXMuZ2V0U3R5bGUoZWxlbWVudCwgJ3RvcCcpKSB8fCAwLFxuICAgICAgbGVmdDogdGhpcy5wYXJzZVN0eWxlSW50KHRoaXMuZ2V0U3R5bGUoZWxlbWVudCwgJ2xlZnQnKSkgfHwgMCxcbiAgICAgIGhlaWdodDogdGhpcy5wYXJzZVN0eWxlSW50KHRoaXMuZ2V0U3R5bGUoZWxlbWVudCwgJ2hlaWdodCcpKSB8fCAwLFxuICAgICAgd2lkdGg6IHRoaXMucGFyc2VTdHlsZUludCh0aGlzLmdldFN0eWxlKGVsZW1lbnQsICd3aWR0aCcpKSB8fCAwXG4gICAgfSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgcGFyc2VTdHlsZUludCh2YWx1ZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHBhcnNlSW50KHZhbHVlLCAxMCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0U3R5bGUoZWxlbWVudDogSFRNTEVsZW1lbnQsIHByb3BlcnR5OiBzdHJpbmcpIHtcbiAgICBjb25zdCB2aWV3ID0gdGhpcy5nZXRWaWV3KGVsZW1lbnQpO1xuICAgIHJldHVybiB2aWV3LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShwcm9wZXJ0eSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0VmlldyhlbGVtZW50OiBIVE1MRWxlbWVudCkge1xuICAgIGxldCB2aWV3ID0gZWxlbWVudC5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3O1xuICAgIGlmICghdmlldyB8fCB2aWV3Lm9wZW5lcikge1xuICAgICAgdmlldyA9IHdpbmRvdztcbiAgICB9XG4gICAgcmV0dXJuIHZpZXc7XG4gIH1cblxuXG4gIHByb3RlY3RlZCBnZXRWaWV3UG9zKGVsZW1lbnQ6IEhUTUxFbGVtZW50KSB7XG4gICAgY29uc3QgdmlldyA9IHRoaXMuZ2V0VmlldyhlbGVtZW50KTtcbiAgICByZXR1cm4gbmV3IFBvc2l0aW9uKHtcbiAgICAgIHRvcDogMCxcbiAgICAgIGxlZnQ6IDAsXG4gICAgICBoZWlnaHQ6IHZpZXcuaW5uZXJIZWlnaHQgfHwgZWxlbWVudC5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsXG4gICAgICB3aWR0aDogdmlldy5pbm5lcldpZHRoIHx8IGVsZW1lbnQub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGhcbiAgICB9KTtcbiAgfVxuXG59XG4iXX0=