/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Directive, ElementRef, Input } from '@angular/core';
import JSONFormatter from 'json-formatter-js';
import { BehaviorSubject, Observable } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { BaseDirective } from '../../bases/directive';
import { ObjectDiff } from './diff';
export { ObjectDiff } from './diff';
export class JsonViewerDirective extends BaseDirective {
    /**
     * @param {?} el
     * @param {?} cd
     */
    constructor(el, cd) {
        super();
        this.el = el;
        this.cd = cd;
        this.showCurrent = true;
        this.openLevel = 2;
        this.showDiff = false;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.model) {
            this.model = changes.model.currentValue;
            if (this.model) {
                Object.keys(this.model).forEach(key => {
                    if (this.model[key] instanceof BehaviorSubject) {
                        this.model[key] = this.model[key].value;
                    }
                    else if (this.model[key] instanceof Observable) {
                        ((/** @type {?} */ (this.model[key])))
                            .pipe(takeUntil(this.destroyed$))
                            .subscribe(v => this.model[key] = v);
                    }
                    else if (this.showDiff) {
                        try {
                            this.diff = ObjectDiff.diff(changes.model.previousValue, changes.model.currentValue);
                        }
                        catch (e) {
                        }
                    }
                });
            }
            this.showJson();
        }
    }
    /**
     * @return {?}
     */
    showJson() {
        this.el.nativeElement.innerHTML = '';
        if (this.showCurrent) {
            /** @type {?} */
            const formatter = new JSONFormatter(this.model || {}, this.openLevel, {
                hoverPreviewEnabled: true
            });
            try {
                /** @type {?} */
                const divEle = formatter.render();
                divEle.classList.add('json-viewer');
                this.el.nativeElement.appendChild(divEle);
            }
            catch (e) {
            }
        }
        if (this.showDiff) {
            /** @type {?} */
            const divEle = document.createElement('div');
            divEle.classList.add('diff-viewer');
            divEle.innerHTML = this.diff;
            this.el.nativeElement.appendChild(divEle);
        }
    }
}
JsonViewerDirective.decorators = [
    { type: Directive, args: [{
                selector: '[erJsonViewer]'
            },] }
];
/** @nocollapse */
JsonViewerDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: ChangeDetectorRef }
];
JsonViewerDirective.propDecorators = {
    model: [{ type: Input, args: ['erJsonViewer',] }],
    showCurrent: [{ type: Input, args: ['current',] }],
    openLevel: [{ type: Input }],
    showDiff: [{ type: Input, args: ['diff',] }]
};
if (false) {
    /** @type {?} */
    JsonViewerDirective.prototype.model;
    /** @type {?} */
    JsonViewerDirective.prototype.showCurrent;
    /** @type {?} */
    JsonViewerDirective.prototype.openLevel;
    /** @type {?} */
    JsonViewerDirective.prototype.showDiff;
    /**
     * @type {?}
     * @private
     */
    JsonViewerDirective.prototype.diff;
    /**
     * @type {?}
     * @private
     */
    JsonViewerDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    JsonViewerDirective.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL2NvcmUvIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9qc29uLXZpZXdlci9kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBQyxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBMkIsTUFBTSxlQUFlLENBQUM7QUFDeEcsT0FBTyxhQUFhLE1BQU0sbUJBQW1CLENBQUM7QUFDOUMsT0FBTyxFQUFDLGVBQWUsRUFBRSxVQUFVLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFDakQsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ3pDLE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUNwRCxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sUUFBUSxDQUFDO0FBRWxDLE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxRQUFRLENBQUM7QUFLbEMsTUFBTSxPQUFPLG1CQUFvQixTQUFRLGFBQWE7Ozs7O0lBWXBELFlBQW9CLEVBQWMsRUFBVSxFQUFxQjtRQUMvRCxLQUFLLEVBQUUsQ0FBQztRQURVLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQVIvQyxnQkFBVyxHQUFHLElBQUksQ0FBQztRQUU1QixjQUFTLEdBQUcsQ0FBQyxDQUFDO1FBRVIsYUFBUSxHQUFHLEtBQUssQ0FBQztJQU1oQyxDQUFDOzs7OztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUNoQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUU7WUFDakIsSUFBSSxDQUFDLEtBQUssR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQztZQUN4QyxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7Z0JBQ2QsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO29CQUNwQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFlBQVksZUFBZSxFQUFFO3dCQUM5QyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDO3FCQUN6Qzt5QkFBTSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFlBQVksVUFBVSxFQUFFO3dCQUNoRCxDQUFDLG1CQUFBLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQW1CLENBQUM7NkJBQ2pDLElBQUksQ0FDSCxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUMzQjs2QkFDQSxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3FCQUN4Qzt5QkFBTSxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7d0JBQ3hCLElBQUk7NEJBQ0YsSUFBSSxDQUFDLElBQUksR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsYUFBYSxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7eUJBQ3RGO3dCQUFDLE9BQU8sQ0FBQyxFQUFFO3lCQUNYO3FCQUNGO2dCQUNILENBQUMsQ0FBQyxDQUFDO2FBQ0o7WUFDRCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7U0FDakI7SUFDSCxDQUFDOzs7O0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDckMsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFOztrQkFDZCxTQUFTLEdBQUcsSUFBSSxhQUFhLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxFQUFFLEVBQUUsSUFBSSxDQUFDLFNBQVMsRUFBRTtnQkFDcEUsbUJBQW1CLEVBQUUsSUFBSTthQUMxQixDQUFDO1lBQ0YsSUFBSTs7c0JBQ0ksTUFBTSxHQUFtQixTQUFTLENBQUMsTUFBTSxFQUFFO2dCQUNqRCxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQztnQkFDcEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQzNDO1lBQUMsT0FBTyxDQUFDLEVBQUU7YUFDWDtTQUNGO1FBQ0QsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFOztrQkFDWCxNQUFNLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUM7WUFDNUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDcEMsTUFBTSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQzdCLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUMzQztJQUNILENBQUM7OztZQS9ERixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGdCQUFnQjthQUMzQjs7OztZQVhxQyxVQUFVO1lBQXhDLGlCQUFpQjs7O29CQWN0QixLQUFLLFNBQUMsY0FBYzswQkFFcEIsS0FBSyxTQUFDLFNBQVM7d0JBRWYsS0FBSzt1QkFFTCxLQUFLLFNBQUMsTUFBTTs7OztJQU5iLG9DQUFpQzs7SUFFakMsMENBQXFDOztJQUVyQyx3Q0FBdUI7O0lBRXZCLHVDQUFnQzs7Ozs7SUFFaEMsbUNBQXFCOzs7OztJQUVULGlDQUFzQjs7Ozs7SUFBRSxpQ0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NoYW5nZURldGVjdG9yUmVmLCBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIElucHV0LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXN9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IEpTT05Gb3JtYXR0ZXIgZnJvbSAnanNvbi1mb3JtYXR0ZXItanMnO1xuaW1wb3J0IHtCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHt0YWtlVW50aWx9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7QmFzZURpcmVjdGl2ZX0gZnJvbSAnLi4vLi4vYmFzZXMvZGlyZWN0aXZlJztcbmltcG9ydCB7T2JqZWN0RGlmZn0gZnJvbSAnLi9kaWZmJztcblxuZXhwb3J0IHtPYmplY3REaWZmfSBmcm9tICcuL2RpZmYnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbZXJKc29uVmlld2VyXSdcbn0pXG5leHBvcnQgY2xhc3MgSnNvblZpZXdlckRpcmVjdGl2ZSBleHRlbmRzIEJhc2VEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuXG4gIEBJbnB1dCgnZXJKc29uVmlld2VyJykgbW9kZWw6IHt9O1xuXG4gIEBJbnB1dCgnY3VycmVudCcpIHNob3dDdXJyZW50ID0gdHJ1ZTtcblxuICBASW5wdXQoKSBvcGVuTGV2ZWwgPSAyO1xuXG4gIEBJbnB1dCgnZGlmZicpIHNob3dEaWZmID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBkaWZmOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChjaGFuZ2VzLm1vZGVsKSB7XG4gICAgICB0aGlzLm1vZGVsID0gY2hhbmdlcy5tb2RlbC5jdXJyZW50VmFsdWU7XG4gICAgICBpZiAodGhpcy5tb2RlbCkge1xuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLm1vZGVsKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMubW9kZWxba2V5XSBpbnN0YW5jZW9mIEJlaGF2aW9yU3ViamVjdCkge1xuICAgICAgICAgICAgdGhpcy5tb2RlbFtrZXldID0gdGhpcy5tb2RlbFtrZXldLnZhbHVlO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5tb2RlbFtrZXldIGluc3RhbmNlb2YgT2JzZXJ2YWJsZSkge1xuICAgICAgICAgICAgKHRoaXMubW9kZWxba2V5XSBhcyBPYnNlcnZhYmxlPGFueT4pXG4gICAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3llZCQpXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgLnN1YnNjcmliZSh2ID0+IHRoaXMubW9kZWxba2V5XSA9IHYpO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zaG93RGlmZikge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgdGhpcy5kaWZmID0gT2JqZWN0RGlmZi5kaWZmKGNoYW5nZXMubW9kZWwucHJldmlvdXNWYWx1ZSwgY2hhbmdlcy5tb2RlbC5jdXJyZW50VmFsdWUpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLnNob3dKc29uKCk7XG4gICAgfVxuICB9XG5cbiAgc2hvd0pzb24oKSB7XG4gICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmlubmVySFRNTCA9ICcnO1xuICAgIGlmICh0aGlzLnNob3dDdXJyZW50KSB7XG4gICAgICBjb25zdCBmb3JtYXR0ZXIgPSBuZXcgSlNPTkZvcm1hdHRlcih0aGlzLm1vZGVsIHx8IHt9LCB0aGlzLm9wZW5MZXZlbCwge1xuICAgICAgICBob3ZlclByZXZpZXdFbmFibGVkOiB0cnVlXG4gICAgICB9KTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGRpdkVsZTogSFRNTERpdkVsZW1lbnQgPSBmb3JtYXR0ZXIucmVuZGVyKCk7XG4gICAgICAgIGRpdkVsZS5jbGFzc0xpc3QuYWRkKCdqc29uLXZpZXdlcicpO1xuICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuYXBwZW5kQ2hpbGQoZGl2RWxlKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMuc2hvd0RpZmYpIHtcbiAgICAgIGNvbnN0IGRpdkVsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgZGl2RWxlLmNsYXNzTGlzdC5hZGQoJ2RpZmYtdmlld2VyJyk7XG4gICAgICBkaXZFbGUuaW5uZXJIVE1MID0gdGhpcy5kaWZmO1xuICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmFwcGVuZENoaWxkKGRpdkVsZSk7XG4gICAgfVxuICB9XG59XG4iXX0=