/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter } from '@angular/core';
import { CommonsUtils } from '@er/utils';
import { takeUntil } from 'rxjs/operators';
import { LogUtils } from '../log/index';
export class ComponentUtils {
    /**
     * @param {?} compInstance
     * @param {?} props
     * @return {?}
     */
    static resolveProps(compInstance, props) {
        /** @type {?} */
        const result = {
            inputs: {},
            outputs: {}
        };
        if (compInstance && CommonsUtils.isJson(props)) {
            Object.keys(props).forEach(key => {
                if (compInstance[key] instanceof EventEmitter) {
                    result.outputs[key] = props[key];
                }
                else {
                    result.inputs[key] = props[key];
                }
            });
        }
        return result;
    }
    /**
     * @param {?} compInstance
     * @param {?} hooks
     * @param {?} constructor
     * @param {?} destructor
     * @return {?}
     */
    static bindLifeCycles(compInstance, hooks, constructor, destructor) {
        /** @type {?} */
        let originalLifeCycles;
        if (hooks) {
            originalLifeCycles = {};
            Object.keys(hooks).forEach(eventName => {
                /** @type {?} */
                const ngEventName = `ng${CommonsUtils.capitalize(eventName)}`;
                if (compInstance[`__${ngEventName}`] === true) {
                    ((/** @type {?} */ (hooks[eventName]))).call(compInstance, compInstance);
                }
                else {
                    /** @type {?} */
                    const original = constructor.prototype[ngEventName];
                    constructor.prototype[ngEventName] = function () {
                        CommonsUtils.isFunction(original) && original.apply(compInstance, arguments);
                        /** @type {?} */
                        const args = Array.prototype.slice.call(arguments);
                        ((/** @type {?} */ (hooks[eventName]))).call(compInstance, ...args, compInstance);
                    };
                    originalLifeCycles[ngEventName] = original;
                }
            });
            if (Object.keys(originalLifeCycles).length > 0) {
                /** @type {?} */
                const destroyLifeCycle = 'ngOnDestroy';
                constructor.prototype[destroyLifeCycle] = function () {
                    Object.keys(originalLifeCycles).forEach(lifeCycleName => {
                        constructor.prototype[lifeCycleName] = originalLifeCycles[lifeCycleName];
                    });
                    CommonsUtils.isFunction(destructor) && destructor.apply(compInstance);
                    constructor.prototype[destroyLifeCycle] = destructor;
                };
            }
        }
    }
    // static bindLifeCycles(compInstance, hooks) {
    //   if (!CommonsUtils.isEmpty(hooks)) {
    //     Object.keys(hooks).forEach(eventName => {
    //       const hookName = `ng${CommonsUtils.capitalize(eventName)}`;
    //       const original = compInstance.__proto__[hookName];
    //       compInstance.__proto__[hookName] = function () {
    //         CommonsUtils.isFunction(original) && original.apply(compInstance, arguments);
    //         const args = Array.prototype.slice.call(arguments);
    //         (<Function>hooks[eventName]).call(compInstance, ...args, compInstance);
    //       };
    //     });
    //   }
    // }
    /**
     * set component instance attributes and event from props object
     * @param {?} compInstance
     * @param {?} props
     * @param {?=} unSubscribe
     * @return {?}
     */
    static bind(compInstance, props, unSubscribe) {
        for (const prop in props) {
            if (prop === 'hooks') {
                /** @type {?} */
                const constructor = ComponentUtils.getConstructor(compInstance);
                /** @type {?} */
                const destructor = constructor.prototype['ngOnDestroy'];
                ComponentUtils.bindLifeCycles(compInstance, props[prop], constructor, destructor);
            }
            else if ((compInstance[prop] instanceof EventEmitter)) {
                ((/** @type {?} */ (compInstance[prop])))
                    .pipe(takeUntil(unSubscribe || compInstance['destroyed$']))
                    .subscribe(event => {
                    try {
                        if (CommonsUtils.isFunction(compInstance['getEventContext'])) {
                            event = compInstance.getEventContext(event);
                        }
                        props[prop].call(compInstance, event);
                    }
                    catch (e) {
                        LogUtils.error(compInstance, '操作失败', e);
                    }
                });
            }
            else {
                compInstance[prop] = props[prop];
            }
        }
    }
    /**
     * @param {?} compInstance
     * @param {?} methodName
     * @param {?} newFun
     * @param {?=} position
     * @return {?}
     */
    static reWriteMethod(compInstance, methodName, newFun, position = 'after') {
        /** @type {?} */
        const buildInFn = compInstance[methodName];
        Object.defineProperty(compInstance, methodName, {
            get: () => {
                return (args) => {
                    if (buildInFn && position === 'after') {
                        buildInFn.call(compInstance, args);
                    }
                    newFun.call(compInstance, args);
                    if (buildInFn && position === 'before') {
                        buildInFn.call(compInstance, args);
                    }
                };
            }
        });
    }
    /**
     * @param {?} viewContainer
     * @return {?}
     */
    static getHostComponentInst(viewContainer) {
        if (viewContainer) {
            /** @type {?} */
            const componentView = viewContainer['_data'].componentView;
            if (componentView) {
                return componentView.component;
            }
        }
        return null;
    }
    /**
     * @param {?} viewContainer
     * @return {?}
     */
    static getViewComponentRef(viewContainer) {
        if (viewContainer) {
            /** @type {?} */
            const view = viewContainer['_view'];
            if (view) {
                return view.component;
            }
        }
        return null;
    }
    /**
     * @param {?} component
     * @return {?}
     */
    static getConstructor(component) {
        return component.__proto__.constructor;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZXIvY29yZS8iLCJzb3VyY2VzIjpbImxpYi91dGlscy9jb21wb25lbnQvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBQyxZQUFZLEVBQW1CLE1BQU0sZUFBZSxDQUFDO0FBQzdELE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFDdkMsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ3pDLE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxjQUFjLENBQUM7QUFFdEMsTUFBTSxPQUFPLGNBQWM7Ozs7OztJQUV6QixNQUFNLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBRSxLQUFLOztjQUMvQixNQUFNLEdBQUc7WUFDYixNQUFNLEVBQUUsRUFBRTtZQUNWLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxJQUFJLFlBQVksSUFBSSxZQUFZLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQzlDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUMvQixJQUFJLFlBQVksQ0FBQyxHQUFHLENBQUMsWUFBWSxZQUFZLEVBQUU7b0JBQzdDLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUNsQztxQkFBTTtvQkFDTCxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztpQkFDakM7WUFDSCxDQUFDLENBQUMsQ0FBQztTQUNKO1FBQ0QsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQzs7Ozs7Ozs7SUFFRCxNQUFNLENBQUMsY0FBYyxDQUFDLFlBQVksRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLFVBQVU7O1lBQzVELGtCQUFzQjtRQUMxQixJQUFJLEtBQUss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O1FBQ3pELElBQUksYUFBYSxFQUFFOztrQkFDWCxhQUFhLEdBQUcsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGFBQWE7WUFDMUQsSUFBSSxhQUFhLEVBQUU7Z0JBQ2pCLE9BQU8sYUFBYSxDQUFDLFNBQVMsQ0FBQzthQUNoQztTQUNGO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDOzs7OztJQUVELE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxhQUErQjtRQUN4RCxJQUFJLGFBQWEsRUFBRTs7a0JBQ1gsSUFBSSxHQUFHLGFBQWEsQ0FBQyxPQUFPLENBQUM7WUFDbkMsSUFBSSxJQUFJLEVBQUU7Z0JBQ1IsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO2FBQ3ZCO1NBQ0Y7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7Ozs7O0lBRUQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFTO1FBQzdCLE9BQU8sU0FBUyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUM7SUFDekMsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtFdmVudEVtaXR0ZXIsIFZpZXdDb250YWluZXJSZWZ9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtDb21tb25zVXRpbHN9IGZyb20gJ0Blci91dGlscyc7XG5pbXBvcnQge3Rha2VVbnRpbH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtMb2dVdGlsc30gZnJvbSAnLi4vbG9nL2luZGV4JztcblxuZXhwb3J0IGNsYXNzIENvbXBvbmVudFV0aWxzIHtcblxuICBzdGF0aWMgcmVzb2x2ZVByb3BzKGNvbXBJbnN0YW5jZSwgcHJvcHMpIHtcbiAgICBjb25zdCByZXN1bHQgPSB7XG4gICAgICBpbnB1dHM6IHt9LFxuICAgICAgb3V0cHV0czoge31cbiAgICB9O1xuICAgIGlmIChjb21wSW5zdGFuY2UgJiYgQ29tbW9uc1V0aWxzLmlzSnNvbihwcm9wcykpIHtcbiAgICAgIE9iamVjdC5rZXlzKHByb3BzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgIGlmIChjb21wSW5zdGFuY2Vba2V5XSBpbnN0YW5jZW9mIEV2ZW50RW1pdHRlcikge1xuICAgICAgICAgIHJlc3VsdC5vdXRwdXRzW2tleV0gPSBwcm9wc1trZXldO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdC5pbnB1dHNba2V5XSA9IHByb3BzW2tleV07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgc3RhdGljIGJpbmRMaWZlQ3ljbGVzKGNvbXBJbnN0YW5jZSwgaG9va3MsIGNvbnN0cnVjdG9yLCBkZXN0cnVjdG9yKSB7XG4gICAgbGV0IG9yaWdpbmFsTGlmZUN5Y2xlczoge307XG4gICAgaWYgKGhvb2tzKSB7XG4gICAgICBvcmlnaW5hbExpZmVDeWNsZXMgPSB7fTtcbiAgICAgIE9iamVjdC5rZXlzKGhvb2tzKS5mb3JFYWNoKGV2ZW50TmFtZSA9PiB7XG4gICAgICAgIGNvbnN0IG5nRXZlbnROYW1lID0gYG5nJHtDb21tb25zVXRpbHMuY2FwaXRhbGl6ZShldmVudE5hbWUpfWA7XG5cbiAgICAgICAgaWYgKGNvbXBJbnN0YW5jZVtgX18ke25nRXZlbnROYW1lfWBdID09PSB0cnVlKSB7XG4gICAgICAgICAgKDxGdW5jdGlvbj5ob29rc1tldmVudE5hbWVdKS5jYWxsKGNvbXBJbnN0YW5jZSwgY29tcEluc3RhbmNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBvcmlnaW5hbCA9IGNvbnN0cnVjdG9yLnByb3RvdHlwZVtuZ0V2ZW50TmFtZV07XG4gICAgICAgICAgY29uc3RydWN0b3IucHJvdG90eXBlW25nRXZlbnROYW1lXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIENvbW1vbnNVdGlscy5pc0Z1bmN0aW9uKG9yaWdpbmFsKSAmJiBvcmlnaW5hbC5hcHBseShjb21wSW5zdGFuY2UsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICBjb25zdCBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcbiAgICAgICAgICAgICg8RnVuY3Rpb24+aG9va3NbZXZlbnROYW1lXSkuY2FsbChjb21wSW5zdGFuY2UsIC4uLmFyZ3MsIGNvbXBJbnN0YW5jZSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBvcmlnaW5hbExpZmVDeWNsZXNbbmdFdmVudE5hbWVdID0gb3JpZ2luYWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKE9iamVjdC5rZXlzKG9yaWdpbmFsTGlmZUN5Y2xlcykubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBkZXN0cm95TGlmZUN5Y2xlID0gJ25nT25EZXN0cm95JztcbiAgICAgICAgY29uc3RydWN0b3IucHJvdG90eXBlW2Rlc3Ryb3lMaWZlQ3ljbGVdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIE9iamVjdC5rZXlzKG9yaWdpbmFsTGlmZUN5Y2xlcykuZm9yRWFjaChsaWZlQ3ljbGVOYW1lID0+IHtcbiAgICAgICAgICAgIGNvbnN0cnVjdG9yLnByb3RvdHlwZVtsaWZlQ3ljbGVOYW1lXSA9IG9yaWdpbmFsTGlmZUN5Y2xlc1tsaWZlQ3ljbGVOYW1lXTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBDb21tb25zVXRpbHMuaXNGdW5jdGlvbihkZXN0cnVjdG9yKSAmJiBkZXN0cnVjdG9yLmFwcGx5KGNvbXBJbnN0YW5jZSk7XG4gICAgICAgICAgY29uc3RydWN0b3IucHJvdG90eXBlW2Rlc3Ryb3lMaWZlQ3ljbGVdID0gZGVzdHJ1Y3RvcjtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBzdGF0aWMgYmluZExpZmVDeWNsZXMoY29tcEluc3RhbmNlLCBob29rcykge1xuICAvLyAgIGlmICghQ29tbW9uc1V0aWxzLmlzRW1wdHkoaG9va3MpKSB7XG4gIC8vICAgICBPYmplY3Qua2V5cyhob29rcykuZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAvLyAgICAgICBjb25zdCBob29rTmFtZSA9IGBuZyR7Q29tbW9uc1V0aWxzLmNhcGl0YWxpemUoZXZlbnROYW1lKX1gO1xuICAvLyAgICAgICBjb25zdCBvcmlnaW5hbCA9IGNvbXBJbnN0YW5jZS5fX3Byb3RvX19baG9va05hbWVdO1xuICAvLyAgICAgICBjb21wSW5zdGFuY2UuX19wcm90b19fW2hvb2tOYW1lXSA9IGZ1bmN0aW9uICgpIHtcbiAgLy8gICAgICAgICBDb21tb25zVXRpbHMuaXNGdW5jdGlvbihvcmlnaW5hbCkgJiYgb3JpZ2luYWwuYXBwbHkoY29tcEluc3RhbmNlLCBhcmd1bWVudHMpO1xuICAvLyAgICAgICAgIGNvbnN0IGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICAvLyAgICAgICAgICg8RnVuY3Rpb24+aG9va3NbZXZlbnROYW1lXSkuY2FsbChjb21wSW5zdGFuY2UsIC4uLmFyZ3MsIGNvbXBJbnN0YW5jZSk7XG4gIC8vICAgICAgIH07XG4gIC8vICAgICB9KTtcbiAgLy8gICB9XG4gIC8vIH1cblxuICAvKipcbiAgICogc2V0IGNvbXBvbmVudCBpbnN0YW5jZSBhdHRyaWJ1dGVzIGFuZCBldmVudCBmcm9tIHByb3BzIG9iamVjdFxuICAgKi9cbiAgc3RhdGljIGJpbmQoY29tcEluc3RhbmNlLCBwcm9wcywgdW5TdWJzY3JpYmU/KSB7XG4gICAgZm9yIChjb25zdCBwcm9wIGluIHByb3BzKSB7XG4gICAgICBpZiAocHJvcCA9PT0gJ2hvb2tzJykge1xuICAgICAgICBjb25zdCBjb25zdHJ1Y3RvciA9IENvbXBvbmVudFV0aWxzLmdldENvbnN0cnVjdG9yKGNvbXBJbnN0YW5jZSk7XG4gICAgICAgIGNvbnN0IGRlc3RydWN0b3IgPSBjb25zdHJ1Y3Rvci5wcm90b3R5cGVbJ25nT25EZXN0cm95J107XG4gICAgICAgIENvbXBvbmVudFV0aWxzLmJpbmRMaWZlQ3ljbGVzKGNvbXBJbnN0YW5jZSwgcHJvcHNbcHJvcF0sIGNvbnN0cnVjdG9yLCBkZXN0cnVjdG9yKTtcbiAgICAgIH0gZWxzZSBpZiAoKGNvbXBJbnN0YW5jZVtwcm9wXSBpbnN0YW5jZW9mIEV2ZW50RW1pdHRlcikpIHtcbiAgICAgICAgKGNvbXBJbnN0YW5jZVtwcm9wXSBhcyBFdmVudEVtaXR0ZXI8YW55PilcbiAgICAgICAgICAucGlwZSh0YWtlVW50aWwodW5TdWJzY3JpYmUgfHwgY29tcEluc3RhbmNlWydkZXN0cm95ZWQkJ10pKVxuICAgICAgICAgIC5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgaWYgKENvbW1vbnNVdGlscy5pc0Z1bmN0aW9uKGNvbXBJbnN0YW5jZVsnZ2V0RXZlbnRDb250ZXh0J10pKSB7XG4gICAgICAgICAgICAgICAgZXZlbnQgPSBjb21wSW5zdGFuY2UuZ2V0RXZlbnRDb250ZXh0KGV2ZW50KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBwcm9wc1twcm9wXS5jYWxsKGNvbXBJbnN0YW5jZSwgZXZlbnQpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICBMb2dVdGlscy5lcnJvcihjb21wSW5zdGFuY2UsICfmk43kvZzlpLHotKUnLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbXBJbnN0YW5jZVtwcm9wXSA9IHByb3BzW3Byb3BdO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyByZVdyaXRlTWV0aG9kKGNvbXBJbnN0YW5jZSwgbWV0aG9kTmFtZTogc3RyaW5nLCBuZXdGdW46IEZ1bmN0aW9uLCBwb3NpdGlvbjogJ2JlZm9yZScgfCAnYWZ0ZXInIHwgJ292ZXJyaWRlJyA9ICdhZnRlcicpIHtcbiAgICBjb25zdCBidWlsZEluRm4gPSBjb21wSW5zdGFuY2VbbWV0aG9kTmFtZV07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvbXBJbnN0YW5jZSwgbWV0aG9kTmFtZSwge1xuICAgICAgZ2V0OiAoKSA9PiB7XG4gICAgICAgIHJldHVybiAoYXJncykgPT4ge1xuICAgICAgICAgIGlmIChidWlsZEluRm4gJiYgcG9zaXRpb24gPT09ICdhZnRlcicpIHtcbiAgICAgICAgICAgIGJ1aWxkSW5Gbi5jYWxsKGNvbXBJbnN0YW5jZSwgYXJncyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbmV3RnVuLmNhbGwoY29tcEluc3RhbmNlLCBhcmdzKTtcblxuICAgICAgICAgIGlmIChidWlsZEluRm4gJiYgcG9zaXRpb24gPT09ICdiZWZvcmUnKSB7XG4gICAgICAgICAgICBidWlsZEluRm4uY2FsbChjb21wSW5zdGFuY2UsIGFyZ3MpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRIb3N0Q29tcG9uZW50SW5zdCh2aWV3Q29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmKSB7XG4gICAgaWYgKHZpZXdDb250YWluZXIpIHtcbiAgICAgIGNvbnN0IGNvbXBvbmVudFZpZXcgPSB2aWV3Q29udGFpbmVyWydfZGF0YSddLmNvbXBvbmVudFZpZXc7XG4gICAgICBpZiAoY29tcG9uZW50Vmlldykge1xuICAgICAgICByZXR1cm4gY29tcG9uZW50Vmlldy5jb21wb25lbnQ7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgc3RhdGljIGdldFZpZXdDb21wb25lbnRSZWYodmlld0NvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZikge1xuICAgIGlmICh2aWV3Q29udGFpbmVyKSB7XG4gICAgICBjb25zdCB2aWV3ID0gdmlld0NvbnRhaW5lclsnX3ZpZXcnXTtcbiAgICAgIGlmICh2aWV3KSB7XG4gICAgICAgIHJldHVybiB2aWV3LmNvbXBvbmVudDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBzdGF0aWMgZ2V0Q29uc3RydWN0b3IoY29tcG9uZW50KSB7XG4gICAgcmV0dXJuIGNvbXBvbmVudC5fX3Byb3RvX18uY29uc3RydWN0b3I7XG4gIH1cbn1cbiJdfQ==