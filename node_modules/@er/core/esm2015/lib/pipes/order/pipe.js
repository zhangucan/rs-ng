/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Pipe } from '@angular/core';
export class OrderByPipe {
    /**
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    static _orderByComparator(a, b) {
        try { // HACK cuz error when delete entire textbox of number and it compares
            if ((isNaN(parseFloat(a)) || !isFinite(a)) || (isNaN(parseFloat(b)) || !isFinite(b))) {
                //Isn't a number so lowercase the string to properly compare
                if (a.toLowerCase() < b.toLowerCase()) {
                    return -1;
                }
                if (a.toLowerCase() > b.toLowerCase()) {
                    return 1;
                }
            }
            else {
                // Parse strings as numbers to compare properly
                if (parseFloat(a) < parseFloat(b)) {
                    return -1;
                }
                if (parseFloat(a) > parseFloat(b)) {
                    return 1;
                }
            }
        }
        catch (e) {
            return 1;
        }
        return 0; //equal each other
    }
    /* filter property by string 'parent.child.item.orderKey' */
    /**
     * @param {?} obj
     * @param {?} propertyPath
     * @return {?}
     */
    static _getDeepValue(obj, propertyPath) {
        /** @type {?} */
        const pathList = propertyPath.split('??');
        if (pathList.length > 0) {
            /** @type {?} */
            let index = 0;
            /** @type {?} */
            let flag = false;
            /** @type {?} */
            let result = '';
            while (!flag) {
                result = getDeepValueByPath(obj, pathList[index]);
                if (result !== undefined) {
                    flag = true;
                }
                else {
                    index++;
                    if (pathList.length === index) {
                        flag = true;
                    }
                }
            }
            return result;
        }
        else {
            return getDeepValueByPath(obj, propertyPath);
        }
        /**
         * @param {?} obj
         * @param {?} path
         * @return {?}
         */
        function getDeepValueByPath(obj, path) {
            path = path.split('.');
            if (path.length > 0) {
                for (let i = 0; i < path.length; i++) {
                    if (obj[path[i]] !== undefined) {
                        obj = obj[path[i]];
                    }
                    else {
                        obj = undefined;
                        break;
                    }
                }
                return obj;
            }
            else {
                return obj[path];
            }
        }
    }
    /**
     * @param {?} input
     * @param {?} __1
     * @return {?}
     */
    transform(input, [config = '+']) {
        if (!Array.isArray(input)) {
            return input;
        }
        if (!Array.isArray(config) || (Array.isArray(config) && config.length === 1)) {
            /** @type {?} */
            const propertyToCheck = !Array.isArray(config) ? config : config[0];
            /** @type {?} */
            const desc = propertyToCheck.substr(0, 1) === '-';
            //Basic array
            if (!propertyToCheck || propertyToCheck === '-' || propertyToCheck === '+') {
                return !desc ? input.sort() : input.sort().reverse();
            }
            else {
                /** @type {?} */
                const property = propertyToCheck.substr(0, 1) === '+' || propertyToCheck.substr(0, 1) === '-'
                    ? propertyToCheck.substr(1)
                    : propertyToCheck;
                return input.sort(function (a, b) {
                    return !desc
                        ? OrderByPipe._orderByComparator(OrderByPipe._getDeepValue(a, property), OrderByPipe._getDeepValue(b, property))
                        : -OrderByPipe._orderByComparator(OrderByPipe._getDeepValue(a, property), OrderByPipe._getDeepValue(b, property));
                });
            }
        }
        else {
            //Loop over property of the array in order and sort
            return input.sort(function (a, b) {
                for (let i = 0; i < config.length; i++) {
                    /** @type {?} */
                    const desc = config[i].substr(0, 1) === '-';
                    /** @type {?} */
                    const property = config[i].substr(0, 1) === '+' || config[i].substr(0, 1) === '-'
                        ? config[i].substr(1)
                        : config[i];
                    /** @type {?} */
                    const comparison = !desc
                        ? OrderByPipe._orderByComparator(OrderByPipe._getDeepValue(a, property), OrderByPipe._getDeepValue(b, property))
                        : -OrderByPipe._orderByComparator(OrderByPipe._getDeepValue(a, property), OrderByPipe._getDeepValue(b, property));
                    //Don't return 0 yet in case of needing to sort by next property
                    if (comparison !== 0) {
                        return comparison;
                    }
                }
                return 0; //equal each other
            });
        }
    }
}
OrderByPipe.decorators = [
    { type: Pipe, args: [{ name: 'orderBy', pure: false },] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGlwZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Blci9jb3JlLyIsInNvdXJjZXMiOlsibGliL3BpcGVzL29yZGVyL3BpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBQyxJQUFJLEVBQWdCLE1BQU0sZUFBZSxDQUFDO0FBR2xELE1BQU0sT0FBTyxXQUFXOzs7Ozs7SUFFdEIsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQU0sRUFBRSxDQUFNO1FBRXRDLElBQUksRUFBRSxzRUFBc0U7WUFDMUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQ3BGLDREQUE0RDtnQkFDNUQsSUFBSSxDQUFDLENBQUMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFFO29CQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7aUJBQUU7Z0JBQ3JELElBQUksQ0FBQyxDQUFDLFdBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQyxXQUFXLEVBQUUsRUFBRTtvQkFBRSxPQUFPLENBQUMsQ0FBQztpQkFBRTthQUNyRDtpQkFBTTtnQkFDTCwrQ0FBK0M7Z0JBQy9DLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRTtvQkFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO2lCQUFFO2dCQUNqRCxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUU7b0JBQUUsT0FBTyxDQUFDLENBQUM7aUJBQUU7YUFDakQ7U0FDRjtRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsT0FBTyxDQUFDLENBQUM7U0FDVjtRQUVELE9BQU8s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Q0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO3dCQUNyQixDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQzs7MEJBRVAsVUFBVSxHQUFHLENBQUMsSUFBSTt3QkFDdEIsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsRUFBRSxXQUFXLENBQUMsYUFBYSxDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQzt3QkFDaEgsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO29CQUVuSCxnRUFBZ0U7b0JBQ2hFLElBQUksVUFBVSxLQUFLLENBQUMsRUFBRTt3QkFBRSxPQUFPLFVBQVUsQ0FBQztxQkFBRTtpQkFDN0M7Z0JBRUQsT0FBTyxDQUFDLENBQUMsQ0FBQyxrQkFBa0I7WUFDOUIsQ0FBQyxDQUFDLENBQUM7U0FDSjtJQUNILENBQUM7OztZQWpIRixJQUFJLFNBQUMsRUFBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1BpcGUsIFBpcGVUcmFuc2Zvcm19IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5AUGlwZSh7bmFtZTogJ29yZGVyQnknLCBwdXJlOiBmYWxzZX0pXG5leHBvcnQgY2xhc3MgT3JkZXJCeVBpcGUgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcblxuICBzdGF0aWMgX29yZGVyQnlDb21wYXJhdG9yKGE6IGFueSwgYjogYW55KTogbnVtYmVyIHtcblxuICAgIHRyeSB7IC8vIEhBQ0sgY3V6IGVycm9yIHdoZW4gZGVsZXRlIGVudGlyZSB0ZXh0Ym94IG9mIG51bWJlciBhbmQgaXQgY29tcGFyZXNcbiAgICAgIGlmICgoaXNOYU4ocGFyc2VGbG9hdChhKSkgfHwgIWlzRmluaXRlKGEpKSB8fCAoaXNOYU4ocGFyc2VGbG9hdChiKSkgfHwgIWlzRmluaXRlKGIpKSkge1xuICAgICAgICAvL0lzbid0IGEgbnVtYmVyIHNvIGxvd2VyY2FzZSB0aGUgc3RyaW5nIHRvIHByb3Blcmx5IGNvbXBhcmVcbiAgICAgICAgaWYgKGEudG9Mb3dlckNhc2UoKSA8IGIudG9Mb3dlckNhc2UoKSkgeyByZXR1cm4gLTE7IH1cbiAgICAgICAgaWYgKGEudG9Mb3dlckNhc2UoKSA+IGIudG9Mb3dlckNhc2UoKSkgeyByZXR1cm4gMTsgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUGFyc2Ugc3RyaW5ncyBhcyBudW1iZXJzIHRvIGNvbXBhcmUgcHJvcGVybHlcbiAgICAgICAgaWYgKHBhcnNlRmxvYXQoYSkgPCBwYXJzZUZsb2F0KGIpKSB7IHJldHVybiAtMTsgfVxuICAgICAgICBpZiAocGFyc2VGbG9hdChhKSA+IHBhcnNlRmxvYXQoYikpIHsgcmV0dXJuIDE7IH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gMTtcbiAgICB9XG5cbiAgICByZXR1cm4gMDsgLy9lcXVhbCBlYWNoIG90aGVyXG4gIH1cblxuICAvKiBmaWx0ZXIgcHJvcGVydHkgYnkgc3RyaW5nICdwYXJlbnQuY2hpbGQuaXRlbS5vcmRlcktleScgKi9cbiAgc3RhdGljIF9nZXREZWVwVmFsdWUob2JqOiBhbnksIHByb3BlcnR5UGF0aDogc3RyaW5nKSB7XG5cbiAgICBjb25zdCBwYXRoTGlzdCA9IHByb3BlcnR5UGF0aC5zcGxpdCgnPz8nKTtcblxuICAgIGlmIChwYXRoTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICBsZXQgaW5kZXggPSAwLFxuICAgICAgICBmbGFnID0gZmFsc2UsXG4gICAgICAgIHJlc3VsdCA9ICcnO1xuXG4gICAgICB3aGlsZSAoIWZsYWcpIHtcbiAgICAgICAgcmVzdWx0ID0gZ2V0RGVlcFZhbHVlQnlQYXRoKG9iaiwgcGF0aExpc3RbaW5kZXhdKTtcblxuICAgICAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBmbGFnID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpbmRleCsrO1xuXG4gICAgICAgICAgaWYgKHBhdGhMaXN0Lmxlbmd0aCA9PT0gaW5kZXgpIHtcbiAgICAgICAgICAgIGZsYWcgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZ2V0RGVlcFZhbHVlQnlQYXRoKG9iaiwgcHJvcGVydHlQYXRoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXREZWVwVmFsdWVCeVBhdGgob2JqLCBwYXRoKSB7XG4gICAgICBwYXRoID0gcGF0aC5zcGxpdCgnLicpO1xuXG4gICAgICBpZiAocGF0aC5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmIChvYmpbcGF0aFtpXV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgb2JqID0gb2JqW3BhdGhbaV1dO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvYmogPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuXG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gb2JqW3BhdGhdO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHRyYW5zZm9ybShpbnB1dDogYW55LCBbY29uZmlnID0gJysnXSk6IGFueSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGlucHV0KSkgeyByZXR1cm4gaW5wdXQ7IH1cblxuICAgIGlmICghQXJyYXkuaXNBcnJheShjb25maWcpIHx8IChBcnJheS5pc0FycmF5KGNvbmZpZykgJiYgY29uZmlnLmxlbmd0aCA9PT0gMSkpIHtcbiAgICAgIGNvbnN0IHByb3BlcnR5VG9DaGVjazogc3RyaW5nID0gIUFycmF5LmlzQXJyYXkoY29uZmlnKSA/IGNvbmZpZyA6IGNvbmZpZ1swXTtcbiAgICAgIGNvbnN0IGRlc2MgPSBwcm9wZXJ0eVRvQ2hlY2suc3Vic3RyKDAsIDEpID09PSAnLSc7XG5cbiAgICAgIC8vQmFzaWMgYXJyYXlcbiAgICAgIGlmICghcHJvcGVydHlUb0NoZWNrIHx8IHByb3BlcnR5VG9DaGVjayA9PT0gJy0nIHx8IHByb3BlcnR5VG9DaGVjayA9PT0gJysnKSB7XG4gICAgICAgIHJldHVybiAhZGVzYyA/IGlucHV0LnNvcnQoKSA6IGlucHV0LnNvcnQoKS5yZXZlcnNlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBwcm9wZXJ0eTogc3RyaW5nID0gcHJvcGVydHlUb0NoZWNrLnN1YnN0cigwLCAxKSA9PT0gJysnIHx8IHByb3BlcnR5VG9DaGVjay5zdWJzdHIoMCwgMSkgPT09ICctJ1xuICAgICAgICAgID8gcHJvcGVydHlUb0NoZWNrLnN1YnN0cigxKVxuICAgICAgICAgIDogcHJvcGVydHlUb0NoZWNrO1xuXG4gICAgICAgIHJldHVybiBpbnB1dC5zb3J0KGZ1bmN0aW9uIChhOiBhbnksIGI6IGFueSkge1xuICAgICAgICAgIHJldHVybiAhZGVzY1xuICAgICAgICAgICAgPyBPcmRlckJ5UGlwZS5fb3JkZXJCeUNvbXBhcmF0b3IoT3JkZXJCeVBpcGUuX2dldERlZXBWYWx1ZShhLCBwcm9wZXJ0eSksIE9yZGVyQnlQaXBlLl9nZXREZWVwVmFsdWUoYiwgcHJvcGVydHkpKVxuICAgICAgICAgICAgOiAtT3JkZXJCeVBpcGUuX29yZGVyQnlDb21wYXJhdG9yKE9yZGVyQnlQaXBlLl9nZXREZWVwVmFsdWUoYSwgcHJvcGVydHkpLCBPcmRlckJ5UGlwZS5fZ2V0RGVlcFZhbHVlKGIsIHByb3BlcnR5KSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvL0xvb3Agb3ZlciBwcm9wZXJ0eSBvZiB0aGUgYXJyYXkgaW4gb3JkZXIgYW5kIHNvcnRcbiAgICAgIHJldHVybiBpbnB1dC5zb3J0KGZ1bmN0aW9uIChhOiBhbnksIGI6IGFueSkge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbmZpZy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGNvbnN0IGRlc2MgPSBjb25maWdbaV0uc3Vic3RyKDAsIDEpID09PSAnLSc7XG4gICAgICAgICAgY29uc3QgcHJvcGVydHkgPSBjb25maWdbaV0uc3Vic3RyKDAsIDEpID09PSAnKycgfHwgY29uZmlnW2ldLnN1YnN0cigwLCAxKSA9PT0gJy0nXG4gICAgICAgICAgICA/IGNvbmZpZ1tpXS5zdWJzdHIoMSlcbiAgICAgICAgICAgIDogY29uZmlnW2ldO1xuXG4gICAgICAgICAgY29uc3QgY29tcGFyaXNvbiA9ICFkZXNjXG4gICAgICAgICAgICA/IE9yZGVyQnlQaXBlLl9vcmRlckJ5Q29tcGFyYXRvcihPcmRlckJ5UGlwZS5fZ2V0RGVlcFZhbHVlKGEsIHByb3BlcnR5KSwgT3JkZXJCeVBpcGUuX2dldERlZXBWYWx1ZShiLCBwcm9wZXJ0eSkpXG4gICAgICAgICAgICA6IC1PcmRlckJ5UGlwZS5fb3JkZXJCeUNvbXBhcmF0b3IoT3JkZXJCeVBpcGUuX2dldERlZXBWYWx1ZShhLCBwcm9wZXJ0eSksIE9yZGVyQnlQaXBlLl9nZXREZWVwVmFsdWUoYiwgcHJvcGVydHkpKTtcblxuICAgICAgICAgIC8vRG9uJ3QgcmV0dXJuIDAgeWV0IGluIGNhc2Ugb2YgbmVlZGluZyB0byBzb3J0IGJ5IG5leHQgcHJvcGVydHlcbiAgICAgICAgICBpZiAoY29tcGFyaXNvbiAhPT0gMCkgeyByZXR1cm4gY29tcGFyaXNvbjsgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIDA7IC8vZXF1YWwgZWFjaCBvdGhlclxuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG4iXX0=