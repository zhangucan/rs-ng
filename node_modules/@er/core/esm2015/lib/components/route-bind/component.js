/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component } from '@angular/core';
import { CommonsUtils } from '@er/utils';
import { BaseComponent } from '../../bases/component';
import { ComponentUtils } from '../../utils/component';
import { LogUtils } from '../../utils/log';
import { RouteUtils } from '../../utils/nav';
/**
 * 不能多次创建组件，不能用
 */
export class RouteDataPropsBindComponent extends BaseComponent {
    /**
     * @param {?} cd
     */
    constructor(cd) {
        super();
        this.cd = cd;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.$subscriptions = RouteUtils.getActiveRoute().data.subscribe(data => {
            if (!data['$component']) {
                LogUtils.error(this, '没有定义组件类型', data);
                return;
            }
            /** @type {?} */
            let activeRoute = RouteUtils.getActiveRoute();
            /** @type {?} */
            const params = Object.assign({}, activeRoute.snapshot.params || {}, activeRoute.snapshot.queryParams || {});
            while (activeRoute && !activeRoute.snapshot.data['$props']) {
                activeRoute = activeRoute.parent;
            }
            /** @type {?} */
            const routeData = Object.assign({}, activeRoute.snapshot.data, data);
            LogUtils.debug(this, '路由数据', routeData);
            /** @type {?} */
            let props = routeData['$resolvedProps'] || routeData['$props'];
            if (routeData['$propsKey']) {
                props = CommonsUtils.get(props, routeData['$propsKey']);
            }
            /** @type {?} */
            const component = routeData['$component'];
            Object.keys(data).forEach(key => {
                if (CommonsUtils.isFunction(data[key])) {
                    data[key] = ((/** @type {?} */ (data[key])))(props, params, data);
                }
                else if (CommonsUtils.isString(data[key]) && data[key].startsWith(':')) {
                    /** @type {?} */
                    const param = ((/** @type {?} */ (data[key]))).substring(1);
                    if (param === 'USER_ID') {
                    }
                    else if (params[param]) {
                        props[key] = params[param];
                    }
                }
                else if (key !== '$component' && key !== '$propsKey') {
                    props[key] = data[key];
                }
            });
            this.type = component;
            this.props = props;
            this.inputs = props['inputs'] || props || {};
            this.outputs = props['outputs'] || {};
            if (props['hooks']) {
                this.hooks = props['hooks'];
                delete props['hooks'];
            }
            if (!props['inputs'] && !props['outputs']) {
                props['$props'] = CommonsUtils.copy(props);
            }
            this.cd.detectChanges();
        });
    }
    /**
     * @param {?} componentRef
     * @return {?}
     */
    created(componentRef) {
        if (!CommonsUtils.isEmpty(this.hooks)) {
            /** @type {?} */
            const constructor = ComponentUtils.getConstructor(componentRef);
            /** @type {?} */
            const destructor = constructor.prototype['ngOnDestroy'];
            ComponentUtils.bindLifeCycles(componentRef.instance, this.hooks, constructor, destructor);
        }
    }
}
RouteDataPropsBindComponent.decorators = [
    { type: Component, args: [{
                selector: 'er-route-bind',
                template: `
    <ndc-dynamic [ndcDynamicComponent]="type"
                 [ndcDynamicInputs]="inputs"
                 [ndcDynamicOutputs]="outputs"
                 (ndcDynamicCreated)="created($event)"
    >
    </ndc-dynamic>
  `,
                changeDetection: ChangeDetectionStrategy.OnPush
            }] }
];
/** @nocollapse */
RouteDataPropsBindComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
if (false) {
    /** @type {?} */
    RouteDataPropsBindComponent.prototype.props;
    /** @type {?} */
    RouteDataPropsBindComponent.prototype.type;
    /** @type {?} */
    RouteDataPropsBindComponent.prototype.inputs;
    /** @type {?} */
    RouteDataPropsBindComponent.prototype.outputs;
    /** @type {?} */
    RouteDataPropsBindComponent.prototype.hooks;
    /**
     * @type {?}
     * @private
     */
    RouteDataPropsBindComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL2NvcmUvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9yb3V0ZS1iaW5kL2NvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLHVCQUF1QixFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBdUIsTUFBTSxlQUFlLENBQUM7QUFDMUcsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUN2QyxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sdUJBQXVCLENBQUM7QUFDcEQsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLHVCQUF1QixDQUFDO0FBQ3JELE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QyxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0saUJBQWlCLENBQUM7Ozs7QUFrQjNDLE1BQU0sT0FBTywyQkFBNEIsU0FBUSxhQUFhOzs7O0lBWTVELFlBQW9CLEVBQXFCO1FBQ3ZDLEtBQUssRUFBRSxDQUFDO1FBRFUsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7SUFFekMsQ0FBQzs7OztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsY0FBYyxHQUFHLFVBQVUsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3RFLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUU7Z0JBQ3ZCLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQztnQkFDdkMsT0FBTzthQUNSOztnQkFDRyxXQUFXLEdBQUcsVUFBVSxDQUFDLGNBQWMsRUFBRTs7a0JBQ3ZDLE1BQU0scUJBQ1AsV0FBVyxDQUFDLFFBQVEsQ0FBQyxNQUFNLElBQUksRUFBRSxFQUNqQyxXQUFXLENBQUMsUUFBUSxDQUFDLFdBQVcsSUFBSSxFQUFFLENBQzFDO1lBQ0Qs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RUFBRTs7a0JBQy9CLFdBQVcsR0FBRyxjQUFjLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQzs7a0JBQ3pELFVBQVUsR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQztZQUN2RCxjQUFjLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxXQUFXLEVBQUUsVUFBVSxDQUFDLENBQUM7U0FDM0Y7SUFDSCxDQUFDOzs7WUE3RkYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxlQUFlO2dCQUN6QixRQUFRLEVBQUU7Ozs7Ozs7R0FPVDtnQkFDRCxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTthQUNoRDs7OztZQXRCZ0MsaUJBQWlCOzs7O0lBeUJoRCw0Q0FBVTs7SUFFViwyQ0FBVTs7SUFFViw2Q0FBVzs7SUFFWCw4Q0FBWTs7SUFFWiw0Q0FBVTs7Ozs7SUFFRSx5Q0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBDb21wb25lbnRSZWYsIE9uSW5pdH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0NvbW1vbnNVdGlsc30gZnJvbSAnQGVyL3V0aWxzJztcbmltcG9ydCB7QmFzZUNvbXBvbmVudH0gZnJvbSAnLi4vLi4vYmFzZXMvY29tcG9uZW50JztcbmltcG9ydCB7Q29tcG9uZW50VXRpbHN9IGZyb20gJy4uLy4uL3V0aWxzL2NvbXBvbmVudCc7XG5pbXBvcnQge0xvZ1V0aWxzfSBmcm9tICcuLi8uLi91dGlscy9sb2cnO1xuaW1wb3J0IHtSb3V0ZVV0aWxzfSBmcm9tICcuLi8uLi91dGlscy9uYXYnO1xuXG5cbi8qKlxuICog5LiN6IO95aSa5qyh5Yib5bu657uE5Lu277yM5LiN6IO955SoXG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2VyLXJvdXRlLWJpbmQnLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxuZGMtZHluYW1pYyBbbmRjRHluYW1pY0NvbXBvbmVudF09XCJ0eXBlXCJcbiAgICAgICAgICAgICAgICAgW25kY0R5bmFtaWNJbnB1dHNdPVwiaW5wdXRzXCJcbiAgICAgICAgICAgICAgICAgW25kY0R5bmFtaWNPdXRwdXRzXT1cIm91dHB1dHNcIlxuICAgICAgICAgICAgICAgICAobmRjRHluYW1pY0NyZWF0ZWQpPVwiY3JlYXRlZCgkZXZlbnQpXCJcbiAgICA+XG4gICAgPC9uZGMtZHluYW1pYz5cbiAgYCxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgUm91dGVEYXRhUHJvcHNCaW5kQ29tcG9uZW50IGV4dGVuZHMgQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgcHJvcHM6IHt9O1xuXG4gIHR5cGU6IGFueTtcblxuICBpbnB1dHM6IHt9O1xuXG4gIG91dHB1dHM6IHt9O1xuXG4gIGhvb2tzOiB7fTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLiRzdWJzY3JpcHRpb25zID0gUm91dGVVdGlscy5nZXRBY3RpdmVSb3V0ZSgpLmRhdGEuc3Vic2NyaWJlKGRhdGEgPT4ge1xuICAgICAgaWYgKCFkYXRhWyckY29tcG9uZW50J10pIHtcbiAgICAgICAgTG9nVXRpbHMuZXJyb3IodGhpcywgJ+ayoeacieWumuS5iee7hOS7tuexu+WeiycsIGRhdGEpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsZXQgYWN0aXZlUm91dGUgPSBSb3V0ZVV0aWxzLmdldEFjdGl2ZVJvdXRlKCk7XG4gICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgIC4uLmFjdGl2ZVJvdXRlLnNuYXBzaG90LnBhcmFtcyB8fCB7fSxcbiAgICAgICAgLi4uYWN0aXZlUm91dGUuc25hcHNob3QucXVlcnlQYXJhbXMgfHwge31cbiAgICAgIH07XG4gICAgICB3aGlsZSAoYWN0aXZlUm91dGUgJiYgIWFjdGl2ZVJvdXRlLnNuYXBzaG90LmRhdGFbJyRwcm9wcyddKSB7XG4gICAgICAgIGFjdGl2ZVJvdXRlID0gYWN0aXZlUm91dGUucGFyZW50O1xuICAgICAgfVxuICAgICAgY29uc3Qgcm91dGVEYXRhID0ge1xuICAgICAgICAuLi5hY3RpdmVSb3V0ZS5zbmFwc2hvdC5kYXRhLFxuICAgICAgICAuLi5kYXRhXG4gICAgICB9O1xuICAgICAgTG9nVXRpbHMuZGVidWcodGhpcywgJ+i3r+eUseaVsOaNricsIHJvdXRlRGF0YSk7XG4gICAgICBsZXQgcHJvcHMgPSByb3V0ZURhdGFbJyRyZXNvbHZlZFByb3BzJ10gfHwgcm91dGVEYXRhWyckcHJvcHMnXTtcbiAgICAgIGlmIChyb3V0ZURhdGFbJyRwcm9wc0tleSddKSB7XG4gICAgICAgIHByb3BzID0gQ29tbW9uc1V0aWxzLmdldChwcm9wcywgcm91dGVEYXRhWyckcHJvcHNLZXknXSk7XG4gICAgICB9XG4gICAgICBjb25zdCBjb21wb25lbnQgPSByb3V0ZURhdGFbJyRjb21wb25lbnQnXTtcbiAgICAgIE9iamVjdC5rZXlzKGRhdGEpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgaWYgKENvbW1vbnNVdGlscy5pc0Z1bmN0aW9uKGRhdGFba2V5XSkpIHtcbiAgICAgICAgICBkYXRhW2tleV0gPSAoPEZ1bmN0aW9uPmRhdGFba2V5XSkocHJvcHMsIHBhcmFtcywgZGF0YSk7XG4gICAgICAgIH0gZWxzZSBpZiAoQ29tbW9uc1V0aWxzLmlzU3RyaW5nKGRhdGFba2V5XSkgJiYgZGF0YVtrZXldLnN0YXJ0c1dpdGgoJzonKSkge1xuICAgICAgICAgIGNvbnN0IHBhcmFtID0gKDxzdHJpbmc+ZGF0YVtrZXldKS5zdWJzdHJpbmcoMSk7XG4gICAgICAgICAgaWYgKHBhcmFtID09PSAnVVNFUl9JRCcpIHtcbiAgICAgICAgICB9IGVsc2UgaWYgKHBhcmFtc1twYXJhbV0pIHtcbiAgICAgICAgICAgIHByb3BzW2tleV0gPSBwYXJhbXNbcGFyYW1dO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChrZXkgIT09ICckY29tcG9uZW50JyAmJiBrZXkgIT09ICckcHJvcHNLZXknKSB7XG4gICAgICAgICAgcHJvcHNba2V5XSA9IGRhdGFba2V5XTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMudHlwZSA9IGNvbXBvbmVudDtcblxuICAgICAgdGhpcy5wcm9wcyA9IHByb3BzO1xuXG4gICAgICB0aGlzLmlucHV0cyA9IHByb3BzWydpbnB1dHMnXSB8fCBwcm9wcyB8fCB7fTtcblxuICAgICAgdGhpcy5vdXRwdXRzID0gcHJvcHNbJ291dHB1dHMnXSB8fCB7fTtcblxuICAgICAgaWYgKHByb3BzWydob29rcyddKSB7XG4gICAgICAgIHRoaXMuaG9va3MgPSBwcm9wc1snaG9va3MnXTtcbiAgICAgICAgZGVsZXRlIHByb3BzWydob29rcyddO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXByb3BzWydpbnB1dHMnXSAmJiAhcHJvcHNbJ291dHB1dHMnXSkge1xuICAgICAgICBwcm9wc1snJHByb3BzJ10gPSBDb21tb25zVXRpbHMuY29weShwcm9wcyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH0pO1xuICB9XG5cbiAgY3JlYXRlZChjb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxhbnk+KSB7XG4gICAgaWYgKCFDb21tb25zVXRpbHMuaXNFbXB0eSh0aGlzLmhvb2tzKSkge1xuICAgICAgY29uc3QgY29uc3RydWN0b3IgPSBDb21wb25lbnRVdGlscy5nZXRDb25zdHJ1Y3Rvcihjb21wb25lbnRSZWYpO1xuICAgICAgY29uc3QgZGVzdHJ1Y3RvciA9IGNvbnN0cnVjdG9yLnByb3RvdHlwZVsnbmdPbkRlc3Ryb3knXTtcbiAgICAgIENvbXBvbmVudFV0aWxzLmJpbmRMaWZlQ3ljbGVzKGNvbXBvbmVudFJlZi5pbnN0YW5jZSwgdGhpcy5ob29rcywgY29uc3RydWN0b3IsIGRlc3RydWN0b3IpO1xuICAgIH1cbiAgfVxufVxuIl19