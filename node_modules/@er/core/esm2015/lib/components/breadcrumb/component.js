/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, Component, Input } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { StateNames } from '@er/types';
import { CommonsUtils, ConfigUtils, RegUtils, StatesUtils } from '@er/utils';
import { filter, map } from 'rxjs/operators';
import { BaseComponent } from '../../bases/component';
/** @type {?} */
const ROUTE_DATA_BREADCRUMB_KEY = 'breadcrumb';
export class BreadcrumbsComponent extends BaseComponent {
    /**
     * @param {?} router
     * @param {?} route
     */
    constructor(router, route) {
        super();
        this.router = router;
        this.route = route;
        this.outlet = 'primary';
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.breadcrumbs$ = StatesUtils.observe(StateNames.nav)
            .pipe(filter(state => state && state.status === 'success'), map(() => this.resolveRoute()));
    }
    /**
     * @param {?} breadcrumb
     * @return {?}
     */
    getRouterLink(breadcrumb) {
        if (breadcrumb.params) {
            return [breadcrumb.url, breadcrumb.params];
        }
        else {
            return [breadcrumb.url];
        }
    }
    /**
     * @private
     * @return {?}
     */
    resolveRoute() {
        /** @type {?} */
        const breadcrumbs = [];
        /** @type {?} */
        let currentRoute = this.route.root;
        /** @type {?} */
        const menus = StatesUtils.getValue(StateNames.rootMenu);
        /** @type {?} */
        let url;
        /** @type {?} */
        const prefix = CommonsUtils.get(ConfigUtils.getConfig(), 'breadcrumb.prefix');
        /** @type {?} */
        const excludes = CommonsUtils.get(ConfigUtils.getConfig(), 'breadcrumb.excludes');
        /** @type {?} */
        let lastLabel = '';
        do {
            /** @type {?} */
            const childrenRoutes = currentRoute.children;
            currentRoute = null;
            childrenRoutes.forEach(route => {
                if (route.outlet === this.outlet) {
                    /** @type {?} */
                    const routeSnapshot = route.snapshot;
                    /** @type {?} */
                    let label = null;
                    if (routeSnapshot.routeConfig && routeSnapshot.routeConfig.data && routeSnapshot.routeConfig.data[ROUTE_DATA_BREADCRUMB_KEY]) {
                        label = routeSnapshot.routeConfig.data[ROUTE_DATA_BREADCRUMB_KEY];
                    }
                    if (!label) {
                        /** @type {?} */
                        const currentUrl = routeSnapshot.url.join('/');
                        if (currentUrl && currentUrl.trim().length > 0) {
                            if (!url) {
                                url = currentUrl;
                            }
                            else {
                                url = url + '/' + currentUrl;
                            }
                        }
                        if (url && !RegUtils.test(url, excludes)) {
                            /** @type {?} */
                            const parts = url.split('/');
                            /** @type {?} */
                            const menu = CommonsUtils.deepFind(menus, { routerLink: url }, { routerLink: `/${url}` }, { name: parts[parts.length - 1] });
                            if (menu && menu.length > 0) {
                                label = ((/** @type {?} */ (menu[0]))).label;
                            }
                        }
                    }
                    if (label && label.length !== 0 && label !== lastLabel) {
                        if (url.length === 0) {
                            routeSnapshot.params = {};
                        }
                        breadcrumbs.push((/** @type {?} */ ({
                            label: label,
                            url: url,
                            params: routeSnapshot.params
                        })));
                    }
                    currentRoute = route;
                    lastLabel = label;
                }
            });
        } while (currentRoute);
        if (prefix) {
            return prefix.concat(breadcrumbs);
        }
        else {
            return breadcrumbs;
        }
    }
}
BreadcrumbsComponent.decorators = [
    { type: Component, args: [{
                selector: 'er-breadcrumbs',
                template: "<ol class=\"breadcrumb\">\n    <ng-container *ngTemplateOutlet=\"templates?.before\"></ng-container>\n    <ng-container *ngFor=\"let breadcrumb of breadcrumbs$|async;let last=last\">\n        <li class=\"breadcrumb-item\" [ngClass]=\"{active: last}\">\n            <a *ngIf=\"!last\" [routerLink]=\"getRouterLink(breadcrumb)\">{{breadcrumb.label}}</a>\n            <span *ngIf=\"last\">{{breadcrumb.label}}</span>\n        </li>\n    </ng-container>\n    <ng-container *ngTemplateOutlet=\"templates?.after\"></ng-container>\n</ol>\n",
                changeDetection: ChangeDetectionStrategy.OnPush
            }] }
];
/** @nocollapse */
BreadcrumbsComponent.ctorParameters = () => [
    { type: Router },
    { type: ActivatedRoute }
];
BreadcrumbsComponent.propDecorators = {
    outlet: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    BreadcrumbsComponent.prototype.outlet;
    /** @type {?} */
    BreadcrumbsComponent.prototype.breadcrumbs$;
    /**
     * @type {?}
     * @private
     */
    BreadcrumbsComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    BreadcrumbsComponent.prototype.route;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL2NvcmUvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9icmVhZGNydW1iL2NvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLHVCQUF1QixFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQVMsTUFBTSxlQUFlLENBQUM7QUFDaEYsT0FBTyxFQUFDLGNBQWMsRUFBRSxNQUFNLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUN2RCxPQUFPLEVBQTZCLFVBQVUsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUNqRSxPQUFPLEVBQUMsWUFBWSxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBRTNFLE9BQU8sRUFBQyxNQUFNLEVBQUUsR0FBRyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLHVCQUF1QixDQUFDOztNQUU5Qyx5QkFBeUIsR0FBRyxZQUFZO0FBTzlDLE1BQU0sT0FBTyxvQkFBcUIsU0FBUSxhQUFhOzs7OztJQU1yRCxZQUFvQixNQUFjLEVBQ2QsS0FBcUI7UUFDdkMsS0FBSyxFQUFFLENBQUM7UUFGVSxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFMaEMsV0FBTSxHQUFHLFNBQVMsQ0FBQztJQU81QixDQUFDOzs7O0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxZQUFZLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDO2FBQ3BELElBQUksQ0FDSCxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLE1BQU0sS0FBSyxTQUFTLENBQUMsRUFDcEQsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUMvQixDQUFDO0lB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QUksQ0FBQyxtQkFBWTs0QkFDM0IsS0FBSyxFQUFFLEtBQUs7NEJBQ1osR0FBRyxFQUFFLEdBQUc7NEJBQ1IsTUFBTSxFQUFFLGFBQWEsQ0FBQyxNQUFNO3lCQUM3QixFQUFBLENBQUMsQ0FBQztxQkFDSjtvQkFDRCxZQUFZLEdBQUcsS0FBSyxDQUFDO29CQUNyQixTQUFTLEdBQUcsS0FBSyxDQUFDO2lCQUNuQjtZQUNILENBQUMsQ0FBQyxDQUFDO1NBQ0osUUFBUSxZQUFZLEVBQUU7UUFFdkIsSUFBSSxNQUFNLEVBQUU7WUFDVixPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDbkM7YUFBTTtZQUNMLE9BQU8sV0FBVyxDQUFDO1NBQ3BCO0lBQ0gsQ0FBQzs7O1lBdEZGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsZ0JBQWdCO2dCQUMxQixnaUJBQXVCO2dCQUN2QixlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTthQUNoRDs7OztZQWJ1QixNQUFNO1lBQXRCLGNBQWM7OztxQkFnQm5CLEtBQUs7Ozs7SUFBTixzQ0FBNEI7O0lBRTVCLDRDQUF1Qzs7Ozs7SUFFM0Isc0NBQXNCOzs7OztJQUN0QixxQ0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIElucHV0LCBPbkluaXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtBY3RpdmF0ZWRSb3V0ZSwgUm91dGVyfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHtCcmVhZGNydW1iLCBNZW51LCBNZW51SXRlbSwgU3RhdGVOYW1lc30gZnJvbSAnQGVyL3R5cGVzJztcbmltcG9ydCB7Q29tbW9uc1V0aWxzLCBDb25maWdVdGlscywgUmVnVXRpbHMsIFN0YXRlc1V0aWxzfSBmcm9tICdAZXIvdXRpbHMnO1xuaW1wb3J0IHtPYnNlcnZhYmxlfSBmcm9tICdyeGpzJztcbmltcG9ydCB7ZmlsdGVyLCBtYXB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7QmFzZUNvbXBvbmVudH0gZnJvbSAnLi4vLi4vYmFzZXMvY29tcG9uZW50JztcblxuY29uc3QgUk9VVEVfREFUQV9CUkVBRENSVU1CX0tFWSA9ICdicmVhZGNydW1iJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZXItYnJlYWRjcnVtYnMnLFxuICB0ZW1wbGF0ZVVybDogJ3RwbC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIEJyZWFkY3J1bWJzQ29tcG9uZW50IGV4dGVuZHMgQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgQElucHV0KCkgb3V0bGV0ID0gJ3ByaW1hcnknO1xuXG4gIGJyZWFkY3J1bWJzJDogT2JzZXJ2YWJsZTxCcmVhZGNydW1iW10+O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgICAgICAgICAgIHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuYnJlYWRjcnVtYnMkID0gU3RhdGVzVXRpbHMub2JzZXJ2ZShTdGF0ZU5hbWVzLm5hdilcbiAgICAgIC5waXBlKFxuICAgICAgICBmaWx0ZXIoc3RhdGUgPT4gc3RhdGUgJiYgc3RhdGUuc3RhdHVzID09PSAnc3VjY2VzcycpLFxuICAgICAgICBtYXAoKCkgPT4gdGhpcy5yZXNvbHZlUm91dGUoKSlcbiAgICAgICk7XG4gIH1cblxuICBnZXRSb3V0ZXJMaW5rKGJyZWFkY3J1bWI6IEJyZWFkY3J1bWIpIHtcbiAgICBpZiAoYnJlYWRjcnVtYi5wYXJhbXMpIHtcbiAgICAgIHJldHVybiBbYnJlYWRjcnVtYi51cmwsIGJyZWFkY3J1bWIucGFyYW1zXTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFticmVhZGNydW1iLnVybF07XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZXNvbHZlUm91dGUoKSB7XG4gICAgY29uc3QgYnJlYWRjcnVtYnMgPSBbXTtcbiAgICBsZXQgY3VycmVudFJvdXRlID0gdGhpcy5yb3V0ZS5yb290O1xuICAgIGNvbnN0IG1lbnVzOiBNZW51ID0gU3RhdGVzVXRpbHMuZ2V0VmFsdWUoU3RhdGVOYW1lcy5yb290TWVudSk7XG4gICAgbGV0IHVybDtcbiAgICBjb25zdCBwcmVmaXggPSBDb21tb25zVXRpbHMuZ2V0KENvbmZpZ1V0aWxzLmdldENvbmZpZygpLCAnYnJlYWRjcnVtYi5wcmVmaXgnKTtcbiAgICBjb25zdCBleGNsdWRlcyA9IENvbW1vbnNVdGlscy5nZXQoQ29uZmlnVXRpbHMuZ2V0Q29uZmlnKCksICdicmVhZGNydW1iLmV4Y2x1ZGVzJyk7XG4gICAgbGV0IGxhc3RMYWJlbCA9ICcnO1xuICAgIGRvIHtcbiAgICAgIGNvbnN0IGNoaWxkcmVuUm91dGVzID0gY3VycmVudFJvdXRlLmNoaWxkcmVuO1xuICAgICAgY3VycmVudFJvdXRlID0gbnVsbDtcbiAgICAgIGNoaWxkcmVuUm91dGVzLmZvckVhY2gocm91dGUgPT4ge1xuICAgICAgICBpZiAocm91dGUub3V0bGV0ID09PSB0aGlzLm91dGxldCkge1xuICAgICAgICAgIGNvbnN0IHJvdXRlU25hcHNob3QgPSByb3V0ZS5zbmFwc2hvdDtcbiAgICAgICAgICBsZXQgbGFiZWwgPSBudWxsO1xuICAgICAgICAgIGlmIChyb3V0ZVNuYXBzaG90LnJvdXRlQ29uZmlnICYmIHJvdXRlU25hcHNob3Qucm91dGVDb25maWcuZGF0YSAmJiByb3V0ZVNuYXBzaG90LnJvdXRlQ29uZmlnLmRhdGFbUk9VVEVfREFUQV9CUkVBRENSVU1CX0tFWV0pIHtcbiAgICAgICAgICAgIGxhYmVsID0gcm91dGVTbmFwc2hvdC5yb3V0ZUNvbmZpZy5kYXRhW1JPVVRFX0RBVEFfQlJFQURDUlVNQl9LRVldO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWxhYmVsKSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50VXJsID0gcm91dGVTbmFwc2hvdC51cmwuam9pbignLycpO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRVcmwgJiYgY3VycmVudFVybC50cmltKCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICBpZiAoIXVybCkge1xuICAgICAgICAgICAgICAgIHVybCA9IGN1cnJlbnRVcmw7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdXJsID0gdXJsICsgJy8nICsgY3VycmVudFVybDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHVybCAmJiAhUmVnVXRpbHMudGVzdCh1cmwsIGV4Y2x1ZGVzKSkge1xuICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IHVybC5zcGxpdCgnLycpO1xuICAgICAgICAgICAgICBjb25zdCBtZW51ID0gQ29tbW9uc1V0aWxzLmRlZXBGaW5kKG1lbnVzLCB7cm91dGVyTGluazogdXJsfSwge3JvdXRlckxpbms6IGAvJHt1cmx9YH0sIHtuYW1lOiBwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXX0pO1xuICAgICAgICAgICAgICBpZiAobWVudSAmJiBtZW51Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBsYWJlbCA9ICg8TWVudUl0ZW0+bWVudVswXSkubGFiZWw7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGxhYmVsICYmIGxhYmVsLmxlbmd0aCAhPT0gMCAmJiBsYWJlbCAhPT0gbGFzdExhYmVsKSB7XG4gICAgICAgICAgICBpZiAodXJsLmxlbmd0aCA9PT0gMCkgeyByb3V0ZVNuYXBzaG90LnBhcmFtcyA9IHt9OyB9XG4gICAgICAgICAgICBicmVhZGNydW1icy5wdXNoKDxCcmVhZGNydW1iPntcbiAgICAgICAgICAgICAgbGFiZWw6IGxhYmVsLFxuICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgcGFyYW1zOiByb3V0ZVNuYXBzaG90LnBhcmFtc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGN1cnJlbnRSb3V0ZSA9IHJvdXRlO1xuICAgICAgICAgIGxhc3RMYWJlbCA9IGxhYmVsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IHdoaWxlIChjdXJyZW50Um91dGUpO1xuXG4gICAgaWYgKHByZWZpeCkge1xuICAgICAgcmV0dXJuIHByZWZpeC5jb25jYXQoYnJlYWRjcnVtYnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYnJlYWRjcnVtYnM7XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==