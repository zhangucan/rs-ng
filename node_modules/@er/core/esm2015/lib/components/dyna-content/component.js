/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, Input, TemplateRef } from '@angular/core';
import { ContentType } from '@er/types';
import { CommonsUtils } from '@er/utils';
import { dynamicDirectiveDef } from 'ng-dynamic-component';
import { Observable } from 'rxjs';
import { BehaviorSubject } from 'rxjs/internal/BehaviorSubject';
import { BaseComponent } from '../../bases/component';
import { PropsBindDirective } from '../../directives/props-bind/directive';
export class DynaContentComponent extends BaseComponent {
    /**
     * @param {?} cd
     */
    constructor(cd) {
        super();
        this.cd = cd;
        this.CONTENT_TYPE = ContentType;
        this.parsedContent$ = new BehaviorSubject(undefined);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        this.parse();
    }
    /**
     * @return {?}
     */
    refresh() {
        this.parse();
        this.cd.markForCheck();
    }
    /**
     * @private
     * @return {?}
     */
    parse() {
        if (CommonsUtils.isJson(this.content)) {
            if (this.content['content']) {
                if (this.content['styleClass']) {
                    this.styleClass = this.content['styleClass'];
                }
                if (this.content['style']) {
                    this.style = this.content['style'];
                }
                this.content = this.content['content'];
            }
            if (this.content['data']) {
                this.contentType = ContentType.DATA;
                this.parsedContent = [];
                Object.keys(this.content['data']).forEach(key => {
                    this.parsedContent.push({
                        key,
                        value: CommonsUtils.getText(this.content['data'][key])
                    });
                });
                return;
            }
            else if (this.content['type']) {
                this.contentType = ContentType.COMPONENT;
                this.dynaComponent = (/** @type {?} */ (this.content));
                /** @type {?} */
                let directives = this.dynaComponent.directives;
                /** @type {?} */
                const dynaDirectives = [];
                if (directives) {
                    directives = CommonsUtils.getArrayValue(directives);
                    directives.filter(direct => !!direct.type).forEach(direct => {
                        dynaDirectives.push(dynamicDirectiveDef(direct.type, direct.inputs, direct.outputs));
                    });
                }
                if (this.dynaComponent.props || this.context) {
                    dynaDirectives.push(dynamicDirectiveDef(PropsBindDirective, Object.assign({}, this.dynaComponent.props || {}, this.context || {})));
                }
                this.dynaComponent.directives = dynaDirectives;
                return;
            }
            else {
                this.parsedContent = ((/** @type {?} */ (this.content))).content;
                this.parsedContext = Object.assign({}, ((/** @type {?} */ (this.content))).context || {}, this.context || {});
            }
        }
        else {
            this.parsedContent = this.content;
            this.parsedContext = this.context;
        }
        if (CommonsUtils.isString(this.parsedContent)) {
            if (CommonsUtils.isTemplateStr(this.parsedContent)) {
                this.parsedContent = CommonsUtils.templateStr(this.parsedContent, this.context) || '<span></span>';
                this.contentType = ContentType.TEMPLATE_STR;
            }
            else {
                this.contentType = ContentType.STRING;
            }
        }
        else if (this.parsedContent instanceof TemplateRef) {
            this.contentType = ContentType.TEMPLATE;
        }
        else if (CommonsUtils.isFunction(this.parsedContent)) {
            this.parsedContextFn = this.parsedContent;
            /** @type {?} */
            const rtn = this.parsedContextFn(this.parsedContext);
            if (rtn instanceof Observable) {
                ((/** @type {?} */ (rtn))).subscribe(result => this.parsedContent$.next(CommonsUtils.toString(result)));
            }
            else {
                this.parsedContent$.next(rtn);
            }
            this.contentType = ContentType.FUNCTION;
        }
    }
}
DynaContentComponent.decorators = [
    { type: Component, args: [{
                selector: 'er-dyna-content',
                template: `
    <ng-container [ngSwitch]="contentType">
      <div *ngSwitchCase="CONTENT_TYPE.STRING" [ngClass]="styleClass" [ngStyle]="style" [innerHTML]="parsedContent|erSafeHtml"></div>
      <div *ngSwitchCase="CONTENT_TYPE.DATA" class="d-flex" [ngClass]="styleClass" [ngStyle]="style">
        <div *ngFor="let item of parsedContent" class="d-flex justify-content-center m-3">
          <span class="mr-2 font-weight-bold">{{item.key}}</span>
          <span [innerHTML]="item.value|erSafeHtml"></span>
        </div>
      </div>
      <span *ngSwitchCase="CONTENT_TYPE.TEMPLATE_STR" [innerHTML]="parsedContent" [ngClass]="styleClass"
            [ngStyle]="style"></span>
      <ng-container *ngSwitchCase="CONTENT_TYPE.FUNCTION">
        <ng-container *ngIf="parsedContent$|async as asyncContent">
          <span [innerHTML]="asyncContent" [ngClass]="styleClass" [ngStyle]="style"></span>
        </ng-container>
      </ng-container>
      <ng-container *ngSwitchCase="CONTENT_TYPE.TEMPLATE">
        <ng-container *ngTemplateOutlet="parsedContent;context:parsedContext"></ng-container>
      </ng-container>
      <ng-container *ngSwitchCase="CONTENT_TYPE.COMPONENT">
        <ndc-dynamic [ndcDynamicComponent]="dynaComponent.type"
                     [ndcDynamicDirectives]="dynaComponent.directives"
                     [ndcDynamicAttributes]="dynaComponent.attrs"
        >
        </ndc-dynamic>
      </ng-container>
    </ng-container>
  `,
                changeDetection: ChangeDetectionStrategy.OnPush
            }] }
];
/** @nocollapse */
DynaContentComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
DynaContentComponent.propDecorators = {
    content: [{ type: Input }],
    context: [{ type: Input }],
    styleClass: [{ type: Input }],
    style: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    DynaContentComponent.prototype.CONTENT_TYPE;
    /** @type {?} */
    DynaContentComponent.prototype.content;
    /** @type {?} */
    DynaContentComponent.prototype.context;
    /** @type {?} */
    DynaContentComponent.prototype.styleClass;
    /** @type {?} */
    DynaContentComponent.prototype.style;
    /** @type {?} */
    DynaContentComponent.prototype.parsedContent;
    /** @type {?} */
    DynaContentComponent.prototype.parsedContent$;
    /** @type {?} */
    DynaContentComponent.prototype.contentType;
    /** @type {?} */
    DynaContentComponent.prototype.parsedContext;
    /** @type {?} */
    DynaContentComponent.prototype.parsedContextFn;
    /** @type {?} */
    DynaContentComponent.prototype.dynaComponent;
    /** @type {?} */
    DynaContentComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVyL2NvcmUvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9keW5hLWNvbnRlbnQvY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsdUJBQXVCLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBb0MsV0FBVyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQzFJLE9BQU8sRUFBQyxXQUFXLEVBQXdELE1BQU0sV0FBVyxDQUFDO0FBQzdGLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFDdkMsT0FBTyxFQUFDLG1CQUFtQixFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFDekQsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUNoQyxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sK0JBQStCLENBQUM7QUFDOUQsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLHVCQUF1QixDQUFDO0FBQ3BELE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLHVDQUF1QyxDQUFDO0FBa0N6RSxNQUFNLE9BQU8sb0JBQXFCLFNBQVEsYUFBYTs7OztJQXdCckQsWUFBbUIsRUFBcUI7UUFDdEMsS0FBSyxFQUFFLENBQUM7UUFEUyxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQXRCeEMsaUJBQVksR0FBRyxXQUFXLENBQUM7UUFZM0IsbUJBQWMsR0FBNEIsSUFBSSxlQUFlLENBQVMsU0FBUyxDQUFDLENBQUM7SUFZakYsQ0FBQzs7Ozs7SUFFRCxXQUFXLENBQUMsT0FBc0I7UUFDaEMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ2YsQ0FBQzs7OztJQUVELE9BQU87UUFDTCxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDYixJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3pCLENBQUM7Ozs7O0lBRU8sS0FBSztRQUNY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Q0FBQyxDQUFDLENBQUM7YUFDeEc7aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDL0I7WUFDRCxJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQyxRQUFRLENBQUM7U0FDekM7SUFDSCxDQUFDOzs7WUF6SUYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxpQkFBaUI7Z0JBQzNCLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBMkJUO2dCQUNELGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2FBQ2hEOzs7O1lBeENnQyxpQkFBaUI7OztzQkE2Qy9DLEtBQUs7c0JBRUwsS0FBSzt5QkFFTCxLQUFLO29CQUVMLEtBQUs7Ozs7SUFSTiw0Q0FBMkI7O0lBRTNCLHVDQUE4Qjs7SUFFOUIsdUNBQTBCOztJQUUxQiwwQ0FBeUI7O0lBRXpCLHFDQUFvQjs7SUFFcEIsNkNBQW1COztJQUVuQiw4Q0FBaUY7O0lBRWpGLDJDQUF5Qjs7SUFFekIsNkNBQXVCOztJQUV2QiwrQ0FBMEQ7O0lBRTFELDZDQUE2Qjs7SUFFakIsa0NBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBTaW1wbGVDaGFuZ2VzLCBUZW1wbGF0ZVJlZn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0NvbnRlbnRUeXBlLCBDb250ZXh0LCBDb250ZXh0ZWRDb250ZW50LCBEeW5hQ29tcG9uZW50LCBEeW5hQ29udGVudH0gZnJvbSAnQGVyL3R5cGVzJztcbmltcG9ydCB7Q29tbW9uc1V0aWxzfSBmcm9tICdAZXIvdXRpbHMnO1xuaW1wb3J0IHtkeW5hbWljRGlyZWN0aXZlRGVmfSBmcm9tICduZy1keW5hbWljLWNvbXBvbmVudCc7XG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtCZWhhdmlvclN1YmplY3R9IGZyb20gJ3J4anMvaW50ZXJuYWwvQmVoYXZpb3JTdWJqZWN0JztcbmltcG9ydCB7QmFzZUNvbXBvbmVudH0gZnJvbSAnLi4vLi4vYmFzZXMvY29tcG9uZW50JztcbmltcG9ydCB7UHJvcHNCaW5kRGlyZWN0aXZlfSBmcm9tICcuLi8uLi9kaXJlY3RpdmVzL3Byb3BzLWJpbmQvZGlyZWN0aXZlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZXItZHluYS1jb250ZW50JyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8bmctY29udGFpbmVyIFtuZ1N3aXRjaF09XCJjb250ZW50VHlwZVwiPlxuICAgICAgPGRpdiAqbmdTd2l0Y2hDYXNlPVwiQ09OVEVOVF9UWVBFLlNUUklOR1wiIFtuZ0NsYXNzXT1cInN0eWxlQ2xhc3NcIiBbbmdTdHlsZV09XCJzdHlsZVwiIFtpbm5lckhUTUxdPVwicGFyc2VkQ29udGVudHxlclNhZmVIdG1sXCI+PC9kaXY+XG4gICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XCJDT05URU5UX1RZUEUuREFUQVwiIGNsYXNzPVwiZC1mbGV4XCIgW25nQ2xhc3NdPVwic3R5bGVDbGFzc1wiIFtuZ1N0eWxlXT1cInN0eWxlXCI+XG4gICAgICAgIDxkaXYgKm5nRm9yPVwibGV0IGl0ZW0gb2YgcGFyc2VkQ29udGVudFwiIGNsYXNzPVwiZC1mbGV4IGp1c3RpZnktY29udGVudC1jZW50ZXIgbS0zXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJtci0yIGZvbnQtd2VpZ2h0LWJvbGRcIj57e2l0ZW0ua2V5fX08L3NwYW4+XG4gICAgICAgICAgPHNwYW4gW2lubmVySFRNTF09XCJpdGVtLnZhbHVlfGVyU2FmZUh0bWxcIj48L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICA8c3BhbiAqbmdTd2l0Y2hDYXNlPVwiQ09OVEVOVF9UWVBFLlRFTVBMQVRFX1NUUlwiIFtpbm5lckhUTUxdPVwicGFyc2VkQ29udGVudFwiIFtuZ0NsYXNzXT1cInN0eWxlQ2xhc3NcIlxuICAgICAgICAgICAgW25nU3R5bGVdPVwic3R5bGVcIj48L3NwYW4+XG4gICAgICA8bmctY29udGFpbmVyICpuZ1N3aXRjaENhc2U9XCJDT05URU5UX1RZUEUuRlVOQ1RJT05cIj5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInBhcnNlZENvbnRlbnQkfGFzeW5jIGFzIGFzeW5jQ29udGVudFwiPlxuICAgICAgICAgIDxzcGFuIFtpbm5lckhUTUxdPVwiYXN5bmNDb250ZW50XCIgW25nQ2xhc3NdPVwic3R5bGVDbGFzc1wiIFtuZ1N0eWxlXT1cInN0eWxlXCI+PC9zcGFuPlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdTd2l0Y2hDYXNlPVwiQ09OVEVOVF9UWVBFLlRFTVBMQVRFXCI+XG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJwYXJzZWRDb250ZW50O2NvbnRleHQ6cGFyc2VkQ29udGV4dFwiPjwvbmctY29udGFpbmVyPlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8bmctY29udGFpbmVyICpuZ1N3aXRjaENhc2U9XCJDT05URU5UX1RZUEUuQ09NUE9ORU5UXCI+XG4gICAgICAgIDxuZGMtZHluYW1pYyBbbmRjRHluYW1pY0NvbXBvbmVudF09XCJkeW5hQ29tcG9uZW50LnR5cGVcIlxuICAgICAgICAgICAgICAgICAgICAgW25kY0R5bmFtaWNEaXJlY3RpdmVzXT1cImR5bmFDb21wb25lbnQuZGlyZWN0aXZlc1wiXG4gICAgICAgICAgICAgICAgICAgICBbbmRjRHluYW1pY0F0dHJpYnV0ZXNdPVwiZHluYUNvbXBvbmVudC5hdHRyc1wiXG4gICAgICAgID5cbiAgICAgICAgPC9uZGMtZHluYW1pYz5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgIDwvbmctY29udGFpbmVyPlxuICBgLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBEeW5hQ29udGVudENvbXBvbmVudCBleHRlbmRzIEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG5cbiAgQ09OVEVOVF9UWVBFID0gQ29udGVudFR5cGU7XG5cbiAgQElucHV0KCkgY29udGVudDogRHluYUNvbnRlbnQ7XG5cbiAgQElucHV0KCkgY29udGV4dDogQ29udGV4dDtcblxuICBASW5wdXQoKSBzdHlsZUNsYXNzOiBhbnk7XG5cbiAgQElucHV0KCkgc3R5bGU6IGFueTtcblxuICBwYXJzZWRDb250ZW50OiBhbnk7XG5cbiAgcGFyc2VkQ29udGVudCQ6IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+KHVuZGVmaW5lZCk7XG5cbiAgY29udGVudFR5cGU6IENvbnRlbnRUeXBlO1xuXG4gIHBhcnNlZENvbnRleHQ6IENvbnRleHQ7XG5cbiAgcGFyc2VkQ29udGV4dEZuOiAoY29udGV4dCkgPT4gc3RyaW5nIHwgT2JzZXJ2YWJsZTxzdHJpbmc+O1xuXG4gIGR5bmFDb21wb25lbnQ6IER5bmFDb21wb25lbnQ7XG5cbiAgY29uc3RydWN0b3IocHVibGljIGNkOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgdGhpcy5wYXJzZSgpO1xuICB9XG5cbiAgcmVmcmVzaCgpIHtcbiAgICB0aGlzLnBhcnNlKCk7XG4gICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2UoKSB7XG4gICAgaWYgKENvbW1vbnNVdGlscy5pc0pzb24odGhpcy5jb250ZW50KSkge1xuICAgICAgaWYgKHRoaXMuY29udGVudFsnY29udGVudCddKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRbJ3N0eWxlQ2xhc3MnXSkge1xuICAgICAgICAgIHRoaXMuc3R5bGVDbGFzcyA9IHRoaXMuY29udGVudFsnc3R5bGVDbGFzcyddO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRbJ3N0eWxlJ10pIHtcbiAgICAgICAgICB0aGlzLnN0eWxlID0gdGhpcy5jb250ZW50WydzdHlsZSddO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29udGVudCA9IHRoaXMuY29udGVudFsnY29udGVudCddO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY29udGVudFsnZGF0YSddKSB7XG4gICAgICAgIHRoaXMuY29udGVudFR5cGUgPSBDb250ZW50VHlwZS5EQVRBO1xuICAgICAgICB0aGlzLnBhcnNlZENvbnRlbnQgPSBbXTtcbiAgICAgICAgT2JqZWN0LmtleXModGhpcy5jb250ZW50WydkYXRhJ10pLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICB0aGlzLnBhcnNlZENvbnRlbnQucHVzaCh7XG4gICAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgIHZhbHVlOiBDb21tb25zVXRpbHMuZ2V0VGV4dCh0aGlzLmNvbnRlbnRbJ2RhdGEnXVtrZXldKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuY29udGVudFsndHlwZSddKSB7XG4gICAgICAgIHRoaXMuY29udGVudFR5cGUgPSBDb250ZW50VHlwZS5DT01QT05FTlQ7XG4gICAgICAgIHRoaXMuZHluYUNvbXBvbmVudCA9IDxEeW5hQ29tcG9uZW50PnRoaXMuY29udGVudDtcbiAgICAgICAgbGV0IGRpcmVjdGl2ZXMgPSB0aGlzLmR5bmFDb21wb25lbnQuZGlyZWN0aXZlcztcbiAgICAgICAgY29uc3QgZHluYURpcmVjdGl2ZXMgPSBbXTtcbiAgICAgICAgaWYgKGRpcmVjdGl2ZXMpIHtcbiAgICAgICAgICBkaXJlY3RpdmVzID0gQ29tbW9uc1V0aWxzLmdldEFycmF5VmFsdWUoZGlyZWN0aXZlcyk7XG4gICAgICAgICAgZGlyZWN0aXZlcy5maWx0ZXIoZGlyZWN0ID0+ICEhZGlyZWN0LnR5cGUpLmZvckVhY2goZGlyZWN0ID0+IHtcbiAgICAgICAgICAgIGR5bmFEaXJlY3RpdmVzLnB1c2goZHluYW1pY0RpcmVjdGl2ZURlZihkaXJlY3QudHlwZSwgZGlyZWN0LmlucHV0cywgZGlyZWN0Lm91dHB1dHMpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5keW5hQ29tcG9uZW50LnByb3BzIHx8IHRoaXMuY29udGV4dCkge1xuICAgICAgICAgIGR5bmFEaXJlY3RpdmVzLnB1c2goZHluYW1pY0RpcmVjdGl2ZURlZihQcm9wc0JpbmREaXJlY3RpdmUsIE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZHluYUNvbXBvbmVudC5wcm9wcyB8fCB7fSwgdGhpcy5jb250ZXh0IHx8IHt9KSkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZHluYUNvbXBvbmVudC5kaXJlY3RpdmVzID0gZHluYURpcmVjdGl2ZXM7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucGFyc2VkQ29udGVudCA9ICg8Q29udGV4dGVkQ29udGVudD50aGlzLmNvbnRlbnQpLmNvbnRlbnQ7XG4gICAgICAgIHRoaXMucGFyc2VkQ29udGV4dCA9IHtcbiAgICAgICAgICAuLi4oPENvbnRleHRlZENvbnRlbnQ+dGhpcy5jb250ZW50KS5jb250ZXh0IHx8IHt9LFxuICAgICAgICAgIC4uLnRoaXMuY29udGV4dCB8fCB7fVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnBhcnNlZENvbnRlbnQgPSB0aGlzLmNvbnRlbnQ7XG4gICAgICB0aGlzLnBhcnNlZENvbnRleHQgPSB0aGlzLmNvbnRleHQ7XG4gICAgfVxuICAgIGlmIChDb21tb25zVXRpbHMuaXNTdHJpbmcodGhpcy5wYXJzZWRDb250ZW50KSkge1xuICAgICAgaWYgKENvbW1vbnNVdGlscy5pc1RlbXBsYXRlU3RyKHRoaXMucGFyc2VkQ29udGVudCkpIHtcbiAgICAgICAgdGhpcy5wYXJzZWRDb250ZW50ID0gQ29tbW9uc1V0aWxzLnRlbXBsYXRlU3RyKHRoaXMucGFyc2VkQ29udGVudCwgdGhpcy5jb250ZXh0KSB8fCAnPHNwYW4+PC9zcGFuPic7XG4gICAgICAgIHRoaXMuY29udGVudFR5cGUgPSBDb250ZW50VHlwZS5URU1QTEFURV9TVFI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmNvbnRlbnRUeXBlID0gQ29udGVudFR5cGUuU1RSSU5HO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5wYXJzZWRDb250ZW50IGluc3RhbmNlb2YgVGVtcGxhdGVSZWYpIHtcbiAgICAgIHRoaXMuY29udGVudFR5cGUgPSBDb250ZW50VHlwZS5URU1QTEFURTtcbiAgICB9IGVsc2UgaWYgKENvbW1vbnNVdGlscy5pc0Z1bmN0aW9uKHRoaXMucGFyc2VkQ29udGVudCkpIHtcbiAgICAgIHRoaXMucGFyc2VkQ29udGV4dEZuID0gdGhpcy5wYXJzZWRDb250ZW50O1xuICAgICAgY29uc3QgcnRuOiBzdHJpbmcgfCBPYnNlcnZhYmxlPHN0cmluZz4gPSB0aGlzLnBhcnNlZENvbnRleHRGbih0aGlzLnBhcnNlZENvbnRleHQpO1xuICAgICAgaWYgKHJ0biBpbnN0YW5jZW9mIE9ic2VydmFibGUpIHtcbiAgICAgICAgKDxPYnNlcnZhYmxlPHN0cmluZz4+cnRuKS5zdWJzY3JpYmUocmVzdWx0ID0+IHRoaXMucGFyc2VkQ29udGVudCQubmV4dChDb21tb25zVXRpbHMudG9TdHJpbmcocmVzdWx0KSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5wYXJzZWRDb250ZW50JC5uZXh0KHJ0bik7XG4gICAgICB9XG4gICAgICB0aGlzLmNvbnRlbnRUeXBlID0gQ29udGVudFR5cGUuRlVOQ1RJT047XG4gICAgfVxuICB9XG59XG5cbiJdfQ==