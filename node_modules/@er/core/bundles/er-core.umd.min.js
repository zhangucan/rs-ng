!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ngx-permissions"),require("@er/validate"),require("rxjs/internal/BehaviorSubject"),require("rxjs/index"),require("rxjs/internal/Observable"),require("json-formatter-js"),require("@angular/platform-browser"),require("reflect-metadata"),require("rxjs"),require("elastic-builder"),require("@angular/common"),require("@angular/common/http"),require("@angular/core"),require("@angular/forms"),require("@angular/router"),require("@er/types"),require("@er/utils"),require("@stomp/ng2-stompjs"),require("ng-dynamic-component"),require("ngx-pipes"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@er/core",["exports","ngx-permissions","@er/validate","rxjs/internal/BehaviorSubject","rxjs/index","rxjs/internal/Observable","json-formatter-js","@angular/platform-browser","reflect-metadata","rxjs","elastic-builder","@angular/common","@angular/common/http","@angular/core","@angular/forms","@angular/router","@er/types","@er/utils","@stomp/ng2-stompjs","ng-dynamic-component","ngx-pipes","rxjs/operators"],t):t((e.er=e.er||{},e.er.core={}),e.ngxPermissions,e.validate,e.rxjs["internal/BehaviorSubject"],e.rxjs.index,e.rxjs["internal/Observable"],e.JSONFormatter,e.ng.platformBrowser,null,e.rxjs,e.esb,e.ng.common,e.ng.common.http,e.ng.core,e.ng.forms,e.ng.router,e.types,e.utils,e.ng2Stompjs,e.ngDynamicComponent,e.ngxPipes,e.rxjs.operators)}(this,function(e,t,n,o,i,r,s,a,p,l,u,c,d,h,f,g,m,b,y,v,x,C){"use strict";s=s&&s.hasOwnProperty("default")?s["default"]:s;var S=function dn(){},w=function(e,t){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function I(e,t){function n(){this.constructor=e}w(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var E=function(){return(E=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function R(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,i,r=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(o=r.next()).done;)s.push(o.value)}catch(a){i={error:a}}finally{try{o&&!o.done&&(n=r["return"])&&n.call(r)}finally{if(i)throw i.error}}return s}function P(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(R(arguments[t]));return e}var T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new l.Subject,e._$subscriptions=[],e}return I(e,t),Object.defineProperty(e.prototype,"$subscriptions",{set:function(e){this._$subscriptions.push(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnDestroy=function(){for(var e in this.stopSubscribe(),this._$subscriptions.filter(function(e){return e}).map(function(e){return e.unsubscribe()}),this)if(this[e]){var t=this[e];t&&t instanceof l.Subscription&&t.unsubscribe()}},e.prototype.stopSubscribe=function(){this.destroyed$.next(),this.destroyed$.complete()},e}(S),k=function(t){function e(){var e=t.call(this)||this;return e.animations={},e.ctx={$from:e},e}return I(e,t),e.prototype.getContext=function(){var e;!this.$id&&this.$props&&this.$props.$id&&(e=this.$props.$id,this.$id=e);var t={$from:this};return e?E({$id:e},t):t},e.prototype.getEventContext=function(e){return E({},this.getContext(),e||{})},e.prototype.emitEvent=function(e,t){var n=this[e];if(n||(n=new h.EventEmitter,this[e]=n),n instanceof h.EventEmitter)return n.emit(this.getEventContext(t))},e.prototype.isFirstChanges=function(t){return Object.keys(t).every(function(e){return t[e].isFirstChange()})},e.prototype.animate=function(e){return!this.animations[e]},e}(T),U=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return I(t,e),t}(T),O=function(){function e(e){this.template=e}return e.prototype.getType=function(){return this.type},e.decorators=[{type:h.Directive,args:[{selector:"[erTypedTemplate]"}]}],e.ctorParameters=function(){return[{type:h.TemplateRef}]},e.propDecorators={type:[{type:h.Input,args:["erTypedTemplate"]}]},e}(),D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.templates={},e}return I(e,t),e.prototype.ngAfterContentInit=function(){var t=this;this.typedTemplates&&0<this.typedTemplates.length&&this.typedTemplates.forEach(function(e){e.type?b.CommonsUtils.set(t.templates,e.type,e.template):t.templates._=e.template})},e.prototype.eventHandler=function(e,t,n,o){return e&&e[t]?e[t].call(this,o):n(o)},e.prototype.template=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e||(e="_"),this.templates[e])return this.templates[e];if(0<t.length){var o=b.CommonsUtils.filter(t,function(e){return!!e});if(0<o.length)return o[0]}return undefined},e.prototype.getComponentBySelectorId=function(t){if(this.selectors){var e=this.selectors.toArray().filter(function(e){return e.id===t});if(1===e.length)return e[0].hostComponent}return undefined},e.prototype.hasTemplate=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.template.apply(this,P([e],t))!==undefined},e.prototype.hasChildren=function(e){return b.CommonsUtils.isJson(e)},e.prototype.ngAfterContentChecked=function(){},e.prototype.ngAfterViewInit=function(){this.__ngAfterViewInit=!0},e.prototype.ngAfterViewChecked=function(){},e.prototype.ngDoCheck=function(){},e.prototype.ngOnInit=function(){this.__ngOnInit=!0},e.prototype.ngOnChanges=function(e){},e.prototype.ngOnDestroy=function(){},e.propDecorators={customerTpl:[{type:h.Input}],typedTemplates:[{type:h.ContentChildren,args:[O]}]},e}(k),N="$rootInjectables",A=null,q=function(){function o(){}return o.get=function(e){var t=b.CacheUtils.get(N,e);if(!t){if(!o.injector)throw new Error("rootInjector 初始化失败");(t=o.injector.get(e))&&b.CacheUtils.put(N,e,t)}return t},o.getRootViewContainerRef=function(){if(!A){var e=o.get(h.ApplicationRef),t=e.components[0].instance;if(!t.rootViewContainerRef){var n=e.componentTypes[0].name;throw new Error(n+" constructor中未定义rootViewContainerRef")}A=t.rootViewContainerRef}return A},o.injector=null,o}(),j=function(){function s(){}return s.getHttpClient=function(){return s._httpClient||(s._httpClient=q.get(d.HttpClient)),s._httpClient},s.timeout=function(){return s._timeout&&(s._timeout=b.ConfigUtils.getConfig().httpTimeout||5e3),s._timeout},s.request=function(e){var o;if((o=b.CommonsUtils.isString(e)?b.CommonsUtils.getObjWhenStr(e,"uri"):e).stateName)return b.StatesUtils.get(o.stateName);if(o.onRequest){var t=o.onRequest(o);if(!1===t)return;o=t}var n=o.uri||"/";!n.startsWith("http")&&n.indexOf("assets/")<0&&(n.startsWith("/")||(n="/"+n),n=b.ConfigUtils.getConfig().api.servers[o.serverType||b.ConfigUtils.getConfig().api["default"]].uri+n);var i={};i.observe=o.observe||"body",i.responseType=o.responseType||m.HttpResponseType.JSON,i.headers=s.getRequestHeader(o);var r=o.method||(o.body||o.payload?m.HttpMethod.POST:m.HttpMethod.GET);return o.payload&&(o.payloadType===m.HttpRequestPayloadType.PARAMS?o.params=o.payload:o.payloadType===m.HttpRequestPayloadType.BODY?o.body=o.payload:r&&o.method!==m.HttpMethod.GET?o.body=o.payload:o.params=o.payload),o.params&&(i.params=s.getRequestParams(o)),o.body&&(i.body=s.getRequestBody(o)),o.context||(o.context=this),s.getHttpClient().request(r,n,E({},i,{observe:"events"})).pipe(b.RxUtils.retry(o.retry,s.timeout()),C.filter(function(e){return e.type===d.HttpEventType.Sent||e.type===d.HttpEventType.Response}),C.tap(function(e){e.type===d.HttpEventType.Sent&&s.updateHttpTagState(o.tag,!0,{url:n,opts:o})}),C.filter(function(e){return e.type===d.HttpEventType.Response}),C.map(function(e){var t=e;o.observe&&"body"!==o.observe||(t=e.body),s.updateHttpTagState(o.tag,!1,{status:"success",httpRequestOptions:o});var n=o.onResponse?o.onResponse.call(o.context,t,o):t;return o.stateName&&b.StatesUtils.update(o.stateName,n),n}),C.catchError(function(e){return s.updateHttpTagState(o.tag,!1,{status:"error",error:e}),o.onError&&o.onError.call(o.context,e,o),l.of("服务器请求失败，状态码:"+e.status)}))},s.updateHttpTagState=function(e,t,n){e&&b.StatesUtils.create([m.StateNames.http,e],E({start:t},n))},s.getRequestParams=function(e){var t;if("string"==typeof e.params)t=new d.HttpParams({fromString:e.params});else for(var n in t=new d.HttpParams,e.params)n&&(!e.params.hasOwnProperty(n)||null===e.params[n]&&e.params[n]===undefined||(t=t.append(n,b.CommonsUtils.toString(e.params[n]))));return t},s.getRequestBody=function(e){return e.body},s.getRequestHeader=function(e){var t=new d.HttpHeaders;if(t=e.contentType?t.append("Content-Type",e.contentType):t.append("Content-Type",m.HttpContentType.JSON),e.headers)for(var n in e.headers)n&&(t=t.append(n,e.headers[n]));return t},s.prototype.upload=function(e){var t=new FormData;t.append("file",e);var n=new d.HttpRequest("POST","upload",t,{reportProgress:!0,responseType:"text"});return s.getHttpClient().request(n)},s._httpClient=null,s._timeout=3e3,s}(),L=function(){function e(){}return e.prototype.debug=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];!b.ConfigUtils.getConfig().isProduction&&b.ConfigUtils.getConfig().log.enableApp&&b.ConfigUtils.getConfig().log.level<=m.LogLevel.DEBUG&&("string"!=typeof e&&e.constructor&&(e=e.constructor.name),b.ConfigUtils.getConfig().log.blackLList.indexOf(e)<0&&this.getLogger().log("["+b.DateUtils.getFormattedTime()+"] %c DEBUG ","color: white; background: green; font-size: 18px;",this.getLogData(P([e,t],n))))},e.prototype.info=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];b.ConfigUtils.getConfig().log.level<=m.LogLevel.INFO&&("string"!=typeof e&&e.constructor&&(e=e.constructor.name),b.ConfigUtils.getConfig().log.blackLList.indexOf(e)<0&&this.getLogger().log("["+b.DateUtils.getFormattedTime()+"] %c INFO ","color: white; background: blue; font-size: 18px;",this.getLogData(P([e,t],n))))},e.prototype.warn=function(e){b.ConfigUtils.getConfig().log.level<=m.LogLevel.WARN&&this.getLogger().log("["+b.DateUtils.getFormattedTime()+"] %c WARN ","color: white; background: blue; font-size: 18px;",this.getLogData(e))},e.prototype.error=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];b.DialogUtils.error("错误",t),b.ConfigUtils.getConfig().log.level<=m.LogLevel.ERROR&&(this.getLogger().log("["+b.DateUtils.getFormattedTime()+"] %c ERROR ","color: white; background: red; font-size: 18px;",this.getLogData(P([e,t],n))),b.ConfigUtils.getConfig().log.httpPost&&(b.CommonsUtils.isFunction(e)&&(e=e.constructor.name),this.getHttpLogger().log(b.DateUtils.getFormattedDateTime(),this.getLogData([e,t]))))},e.prototype.getLogger=function(){return console},e.prototype.getHttpLogger=function(){return{log:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];j.request(E({},b.ConfigUtils.getConfig().logHttpOptions,{body:E({message:e},t)}))}}},e.prototype.getLogData=function(e){return E({},e)},e.decorators=[{type:h.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=h.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),_=function(){function i(){}return i.debug=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];i.getLogService().debug(e,t,n)},i.info=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];i.getLogService().info(e,t,n)},i.warn=function(e){i.getLogService().warn(e)},i.error=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];i.getLogService().error(e,t,n)},i.getLogService=function(){return i._logService||(i._logService=q.get(L)),i._logService},i._logService=null,i}(),$=function(){function s(){}return s.resolveProps=function(t,n){var o={inputs:{},outputs:{}};return t&&b.CommonsUtils.isJson(n)&&Object.keys(n).forEach(function(e){t[e]instanceof h.EventEmitter?o.outputs[e]=n[e]:o.inputs[e]=n[e]}),o},s.bindLifeCycles=function(i,r,t,e){var s;if(r&&(s={},Object.keys(r).forEach(function(n){var e="ng"+b.CommonsUtils.capitalize(n);if(!0===i["__"+e])r[n].call(i,i);else{var o=t.prototype[e];t.prototype[e]=function(){var e;b.CommonsUtils.isFunction(o)&&o.apply(i,arguments);var t=Array.prototype.slice.call(arguments);(e=r[n]).call.apply(e,P([i],t,[i]))},s[e]=o}}),0<Object.keys(s).length)){var n="ngOnDestroy";t.prototype[n]=function(){Object.keys(s).forEach(function(e){t.prototype[e]=s[e]}),b.CommonsUtils.isFunction(e)&&e.apply(i),t.prototype[n]=e}}},s.bind=function(o,i,r){var e=function(n){if("hooks"===n){var e=s.getConstructor(o),t=e.prototype.ngOnDestroy;s.bindLifeCycles(o,i[n],e,t)}else o[n]instanceof h.EventEmitter?o[n].pipe(C.takeUntil(r||o.destroyed$)).subscribe(function(e){try{b.CommonsUtils.isFunction(o.getEventContext)&&(e=o.getEventContext(e)),i[n].call(o,e)}catch(t){_.error(o,"操作失败",t)}}):o[n]=i[n]};for(var t in i)e(t)},s.reWriteMethod=function(t,e,n,o){void 0===o&&(o="after");var i=t[e];Object.defineProperty(t,e,{get:function(){return function(e){i&&"after"===o&&i.call(t,e),n.call(t,e),i&&"before"===o&&i.call(t,e)}}})},s.getHostComponentInst=function(e){if(e){var t=e._data.componentView;if(t)return t.component}return null},s.getViewComponentRef=function(e){if(e){var t=e._view;if(t)return t.component}return null},s.getConstructor=function(e){return e.__proto__.constructor},s}(),H=function(){function i(){}return i.getActiveRoute=function(){for(var e=q.get(g.ActivatedRoute);e.firstChild;)e=e.firstChild;return e},i.getActiveRouteData=function(){var e=i.getActiveRoute();return e&&e.snapshot.data},i.clearOutlet=function(e,t){var n;void 0===e&&(e="primary"),void 0===t&&(t=!1);var o={};t||(o.relativeTo=i.getActiveRoute()),q.get(g.Router).navigate([{outlets:(n={},n[e]=null,n)}],o)},i.nav=function(e,t,n){b.CommonsUtils.isString(e)&&(e=[e]),n||(n={}),t&&0<Object.keys(t).length&&b.CommonsUtils.set(n,"queryParams",t),(b.CommonsUtils.isString(e)&&!e.startsWith("/")||!0===t)&&b.CommonsUtils.set(n,"relativeTo",i.getActiveRoute()),q.get(g.Router).navigate(e,n)},i.back=function(){q.get(c.Location).back()},i.forward=function(){q.get(c.Location).forward()},i.refresh=function(){i.navigate(b.StatesUtils.getValue(m.StateNames.nav).url)},i.navigate=function(e){e.startsWith("http")?window.location.href=e:q.get(g.Router).navigateByUrl(e)},i}(),M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return I(t,e),t.prototype.ngOnInit=function(){var s=this;this.$subscriptions=H.getActiveRoute().url.subscribe(function(e){var t=H.getActiveRoute();if(t){for(var n=b.CommonsUtils.copy(t.snapshot.data),o=E({},t.snapshot.params||{},t.snapshot.queryParams||{});t&&!t.snapshot.data.$props;)t=t.parent;var i=E({},t.snapshot.data,n),r=b.CommonsUtils.copy(i.$resolvedProps||i.$props);n.$propsKey&&(r=b.CommonsUtils.get(r,n.$propsKey)),Object.keys(n).forEach(function(e){if(b.CommonsUtils.isFunction(n[e]))r[e]=n[e](r,o,n);else if(b.CommonsUtils.isString(n[e])&&n[e].startsWith(":")){var t=n[e].substring(1);o[t]&&(r[e]=o[t])}else"$propsKey"!==e&&"$propsWrapperKey"!==e&&"$props"!==e&&(r[e]=n[e])}),r.$routeParams=o,_.debug(s,"路由数据",i),r=s.beforeRoutePropsBind(r),$.bind(s,r),s.afterRoutePropsBind()}})},t.prototype.beforeRoutePropsBind=function(e){return e},t.prototype.afterRoutePropsBind=function(){},t}(D),F=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.disabled=!1,e.disabled$=new l.BehaviorSubject(!1),e.onTouched=m.NO_OP,e.onChange=m.NO_OP,e}return I(e,t),Object.defineProperty(e.prototype,"opacity",{get:function(){return this.disabled?.25:1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cursor",{get:function(){return this.disabled?"not-allowed":"default"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.innerValue},set:function(e){if(!e||e!==this.innerValue){var t=this.parser?this.parser(e):e;this.innerValue=t,this.onChange(t)}},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.defaultValue&&(this.innerValue=this.defaultValue)},e.prototype.updateTouch=function(){this.onTouched()},e.prototype.writeValue=function(e){var t=this.formatter?this.formatter(e):e;t!==this.innerValue&&(this.innerValue=t)},e.prototype.registerOnChange=function(e){this.onChange=e},e.prototype.registerOnTouched=function(e){this.onTouched=e},e.prototype.setDisabledState=function(e){this.disabled=e,this.disabled$.next(e)},e.propDecorators={parser:[{type:h.Input}],formatter:[{type:h.Input}],disabled:[{type:h.Input}],opacity:[{type:h.HostBinding,args:["style.opacity"]}],cursor:[{type:h.HostBinding,args:["style.cursor"]}]},e}(D),V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return I(t,e),t.prototype._initProps=function(){this.$props=b.CommonsUtils.defaults({},this.$props||{},this.$defaultProps||{}),this.$props.$id||(this.$props.$id=b.IdUtils.getRandom()),this.$props.$ext||(this.$props.$ext={}),this.$props.$ext.apiDataProps&&(this.$props.$ext.apiDataProps.requestOptions||(this.$props.$ext.apiDataProps.requestOptions={}),b.CommonsUtils.defaults(this.$props.$ext.apiDataProps.requestOptions,{context:this,tag:this.$props.$id})),this.onPropsInit()},t.prototype._propsBind=function(){this.onPropsBind()},t.prototype.onPropsInit=function(){},t.prototype.onPropsBind=function(){},t.propDecorators={outputContext:[{type:h.Input}],attrs:[{type:h.Input}]},t}(D),B=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.resettable=!0,e.disabled=!1,e.onTouched=m.NO_OP,e.onChange=m.NO_OP,e}return I(e,t),Object.defineProperty(e.prototype,"opacity",{get:function(){return this.disabled?.25:1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cursor",{get:function(){return this.disabled?"not-allowed":"default"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.innerValue},set:function(e){var t=this.valueParser?this.valueParser(e):e;b.CommonsUtils.isEqual(t,this.innerValue)||(this.innerValue=t,this.onChange(t))},enumerable:!0,configurable:!0}),e.prototype.updateTouch=function(){this.onTouched()},e.prototype.writeValue=function(e){var t=this.modelFormatter?this.modelFormatter(e):e;t!==this.innerValue&&(this.innerValue=t)},e.prototype.registerOnChange=function(e){this.onChange=e},e.prototype.registerOnTouched=function(e){this.onTouched=e},e.prototype.setDisabledState=function(e){this.disabled=e},e.prototype.onPropsInit=function(){this.disabled&&(this.$props.disabled=this.disabled)},e.prototype.reset=function(){this.value=null},e.propDecorators={valueParser:[{type:h.Input}],modelFormatter:[{type:h.Input}],resettable:[{type:h.Input}],disabled:[{type:h.Input}],opacity:[{type:h.HostBinding,args:["style.opacity"]}],cursor:[{type:h.HostBinding,args:["style.cursor"]}]},e}(V),K={notifyFailure:!0},z=function(){function p(){}return p.getPresetApiOptions=function(e){return e||(e=b.CommonsUtils.get(b.ConfigUtils.getConfig(),"api.default")||m.ApiServerType.ES),p.presetApiOptions[e]=E({},K,b.CommonsUtils.get(b.ConfigUtils.getConfig(),"api.servers."+e,{})),p.presetApiOptions[e].actions||(p.presetApiOptions[e].actions={}),p.presetApiOptions[e]},p.login=function(e,t){void 0===t&&(t={});var n=p.getPresetApiOptions(t.serverType).actions.login||{};return p.doRequest(null,e,n,t)},p.logout=function(e){void 0===e&&(e={});var t=p.getPresetApiOptions(e.serverType).actions.logout||{};return p.doRequest(null,null,t,e)},p.changePwd=function(e,t){void 0===t&&(t={});var n=p.getPresetApiOptions(t.serverType).actions.changePwd||{};return p.doRequest(null,e,n,t)},p.register=function(e,t){void 0===t&&(t={});var n=p.getPresetApiOptions(t.serverType).actions.register||{};return p.doRequest(null,e,n,t)},p.save=function(e,t,n){if(void 0===n&&(n={}),t){var o=E({},t);if(o.id){var i=o.id;return delete o.id,p.patchById.call(this,e,i,o,n)}return p.create.call(this,e,o,n)}},p.create=function(e,t,n){void 0===n&&(n={});var o=p.getPresetApiOptions(n.serverType).actions.create||{};return p.setContext(n,this),p.doRequest(e,t,o,n)},p.getById=function(e,t,n){void 0===n&&(n={});var o=p.getPresetApiOptions(n.serverType).actions.getById||{};return p.setContext(n,this),p.doRequest(e,{id:t},o,n)},p.getByIds=function(e,t,n){void 0===n&&(n={});var o=p.getPresetApiOptions(n.serverType).actions.getByIds||{};return p.setContext(n,this),p.doRequest(e,t,o,n)},p.getByQuery=function(e,t,n){void 0===n&&(n={});var o=p.getPresetApiOptions(n.serverType).actions.getByQuery;return p.setContext(n,this),p.doRequest(e,t,o,n)},p.updateById=function(e,t,n,o){void 0===o&&(o={});var i=p.getPresetApiOptions(o.serverType).actions.updateById;return p.setContext(o,this),p.doRequest(e,E({id:t},n),i,o)},p.patchById=function(e,t,n,o){void 0===o&&(o={});var i=p.getPresetApiOptions(o.serverType).actions.patchById;return p.setContext(o,this),p.doRequest(e,E({id:t},n),i,o)},p.updateByQuery=function(e,t,n,o){void 0===o&&(o={});var i=p.getPresetApiOptions(o.serverType).actions.updateByQuery;return p.setContext(o,this),p.doRequest(e,t,i,o)},p.deleteById=function(n,o,i){return void 0===i&&(i={}),b.DialogUtils.confirm("操作确认","确认执行<b>删除</b>操作吗?").pipe(C.first(),C.filter(function(e){return e}),C.switchMap(function(e){var t=p.getPresetApiOptions(i.serverType).actions.deleteById;return p.doRequest(n,o,t,i)}))},p.deleteByQuery=function(e,t,n){void 0===n&&(n={});var o=p.getPresetApiOptions(n.serverType).actions.deleteByQuery;return p.setContext(n,this),p.doRequest(e,t,o,n)},p.batch=function(e,t,n){void 0===n&&(n={});var o=p.getPresetApiOptions(n.serverType).actions.batch;return p.setContext(n,this),p.doRequest(e,t,o,n)},p.batchFetch=function(i,t){if(i){var e=i;i.apiDataProps&&(e=i.apiDataProps),e=b.CommonsUtils.copy(e);var r=b.CommonsUtils.getArrayValue(e);if(b.CommonsUtils.isEmpty(r))return;return t||(t=i.id||r[0].id||""),r.forEach(function(e){if(i.query){var t=i.query,n=b.CommonsUtils.getArrayValue(e.query||[]);n.concat(b.CommonsUtils.getArrayValue(t)),e.query=n}var o=e.filter;b.CommonsUtils.isFunction(o)&&(i.queryValue?e.filter=e.filter(i.queryValue):delete e.filter),i.interval&&b.CommonsUtils.set(e,"aggProps.interval",i.interval),i.format&&b.CommonsUtils.set(e,"aggProps.format",i.format)}),l.zip.apply(void 0,P(r.map(function(e){return p.fetch(e,t)}))).pipe(C.map(function(e){var n,o;return e.forEach(function(e,t){r[t].id?(o||(o={}),o[r[t].id]=e):(n||(n=[]),n.push(e))}),n&&1===n.length&&(n=n[0]),o&&n?E({},o,{data:n}):o||n||[]}))}},p.fetch=function(o,e){if(!o.apiEntry)return _.error("apiUtil","没有定义apiEntry"),l.of([]);var t;(b.CommonsUtils.isFunction(o.payload)?t=o.payload.call(undefined,o):o.payload&&(t=o.payload),t)||(t=b.EsUtils.buildQueryBody(o));var n=o.requestOptions||{};return n.tag||(n.tag=e||""),_.debug("apiUtils","apiData数据查询",{apiDataProps:o,apiRequestBody:t}),p.getByQuery(o.apiEntry,t,n).pipe(C.map(function(e){var t;e&&e.aggs&&(t=b.EsUtils.resolveAggs(e.aggs),e.aggs=t),b.CommonsUtils.isEmpty(e.items)&&delete e.items,b.CommonsUtils.isEmpty(e.aggs)&&delete e.aggs;var n=o.dataPath||(o.aggProps?"aggs":undefined);return"/"===n&&(n=undefined),n?b.CommonsUtils.get(e,n):e}))},p.setContext=function(e,t){(e=e||{}).context=t},p.doRequest=function(e,t,n,o){var i=E({},n,o);delete i.actions;var r=t,s=E({},i,{uri:p.buildUri(e,r,i),payload:p.buildPayload(e,r,i)});if(delete s.paramsKeys,delete s.uriResolver,delete s.payloadResolver,!s.uri||!s.uri.startsWith("http")){var a=p.getPresetApiOptions(n.serverType).uri||"";s.uri=a+(s.uri.startsWith("/")?"":"/")+s.uri}return j.request(s).pipe(C.filter(function(e){return!!e}),C.map(function(e){return!0===e.success?(i.alertSuccess&&b.DialogUtils.info("操作完成",i.successMessage),i.notifySuccess&&b.StatesUtils.create(m.StateNames.notify,{title:"操作完成",message:i.successMessage}),i.onSuccess?i.onSuccess.call(s.context,e,s):i.dataPath?b.CommonsUtils.get(e.content,i.dataPath):e.content||e):!1==!e.success?(i.alertFailure&&b.DialogUtils.error("操作失败",e.message),i.notifyFailure&&b.StatesUtils.create(m.StateNames.notify,{level:m.NotifyLevel.ERROR,title:e.error,message:e.message}),i.onFailure?i.onFailure.call(s.context,e,s):e):e}),C.first())},p.buildUri=function(e,t,n){var o=e;if(b.CommonsUtils.isTemplateStr(e),b.CommonsUtils.isString(n.uriResolver)?o=n.uriResolver:b.CommonsUtils.isFunction(n.uriResolver)?o=n.uriResolver.call(n.context,e,t,n):o||(o=n.uri||""),!o.startsWith("http")){var i=p.getPresetApiOptions(n.serverType).uri;i&&(o=i+(o.startsWith("/")?o:"/"+o))}return o},p.buildPayload=function(e,t,n){var o=t;return b.CommonsUtils.isJson(o)&&(o=b.CommonsUtils.merge({},o||{},n.payload||{},n.body||n.params||{})),n.payloadResolver&&(o=n.payloadResolver.call(n.context,e,o,n)),b.CommonsUtils.isString(o)?o:b.CommonsUtils.isString(n.body)?n.body:b.CommonsUtils.isEmpty(o)?undefined:(o=b.ContextUtils.resolveVariables(o),o=p.resolveApiParamsName(n.paramsKeys||p.getPresetApiOptions(n.serverType).paramsKeys||{},o),b.CommonsUtils.isEmpty(o)?undefined:o)},p.resolveApiParamsName=function(e,t){if(!b.CommonsUtils.isJson(t))return t;var n={};for(var o in t)e.hasOwnProperty(o)?n[e[o]]=t[o]:n[o]=t[o];return n},p.presetApiOptions={},p}(),W=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onDataReady=new h.EventEmitter,e}return I(e,t),e.prototype.ngOnChanges=function(e){!e.apiDataProps||!e.apiDataProps.currentValue||!1===this.apiDataProps.autoFetch&&e.apiDataProps.isFirstChange()||this.fetchData()},e.prototype.fetchData=function(){var t=this;b.CommonsUtils.isEmpty(this.apiDataProps)?_.debug("apiDataDirective","没有定义apiDataProps"):z.fetch(this.apiDataProps).subscribe(function(e){_.debug(t,"apiData待订阅数据",e),t.apiDataProps.data$&&t.apiDataProps.data$.next(e),t.onDataReady.emit(e)})},e.decorators=[{type:h.Directive,args:[{selector:"[erApiData]"}]}],e.propDecorators={apiDataProps:[{type:h.Input,args:["erApiData"]}],onRequestData:[{type:h.Output}],onDataReady:[{type:h.Output}]},e}(k),J=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data$=new l.BehaviorSubject(undefined),e}return I(e,t),Object.defineProperty(e.prototype,"apiDataProps",{get:function(){return this._apiDataProps||{}},set:function(e){this._apiDataProps=e,this._apiDataProps&&!this._apiDataProps.data$&&(this._apiDataProps.data$=this.data$)},enumerable:!0,configurable:!0}),e.prototype.onPropsInit=function(){t.prototype.onPropsInit.call(this),this.initLocalDataItem()},e.prototype.parseValue=function(e){try{return e&&this.$props.$ext.dataItemProps&&!b.CommonsUtils.isString(e)?b.DataItemUtils.getItemValue(e,this.$props.$ext.dataItemProps.valueKey):e}catch(t){return _.error(this,"数据解析错误",t),undefined}},e.prototype.formatModel=function(e){try{return b.CommonsUtils.isJson(e)&&this.$props.$ext.dataItemProps?b.DataItemUtils.getItemLabel(e,this.$props.$ext.dataItemProps.labelKey):e}catch(t){return _.error(this,"数据解析错误",t),undefined}},e.prototype.initLocalDataItem=function(){if(this.$props.$ext&&this.$props.$ext.dataItems){var e=this.$props.$ext.dataItems;e=e.map(function(e){return e.data=e}),this.data$.next(e)}},e.propDecorators={apiData:[{type:h.ViewChild,args:[W]}],apiDataProps:[{type:h.Input}]},e}(B),G=function(n){function e(e){var t=n.call(this)||this;return t.cd=e,t.options={},t.buttonsStyleClass="text-center my-5",t.submitBtnStyleClass="btn btn-success",t.resetBtnStyleClass="btn btn-danger",t.initBtnStyleClass="btn btn-alert",t.onSubmit=new h.EventEmitter,t.onSubmitted=new h.EventEmitter,t.onModel=new h.EventEmitter,t.onFormValueChanges=new h.EventEmitter,t.form=new f.FormGroup({}),t.templateNames={header:"header",buttons:"buttons",footer:"footer"},t.runtimeData={},t.hasUpdated=!1,t}return I(e,n),Object.defineProperty(e.prototype,"model",{get:function(){return this._model},set:function(e){this._model=b.CommonsUtils.omitBy(e,b.CommonsUtils.lodash().isUndefined),this.refresh()},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;n.prototype.ngOnInit.call(this),this.$subscriptions=this.form.valueChanges.subscribe(function(e){return t.onFormValueChanges.emit(e)})},Object.defineProperty(e.prototype,"modelId",{get:function(){return this._modelId},set:function(e){var t=this;e!==this.modelId&&((this._modelId=e)&&""!==e?this.apiEntry&&z.getById(this.apiEntry,e,this.getModelOptions).subscribe(function(e){t.model=e,t.form.updateValueAndValidity({onlySelf:!1,emitEvent:!0})}):this.resetModel())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFormValid",{get:function(){return this.hasUpdated||this.updateControls(),this.form.valid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"httpTag",{get:function(){return"http"+("-"+this.formId||"")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formId",{get:function(){return this.$id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"submitModel",{get:function(){var t=E({},this.model);return this.submitRootKey&&(t=this.model[this.submitRootKey]),this.submitExcludeKeys&&(t=b.CommonsUtils.removeKeys.apply(b.CommonsUtils,P([t],b.CommonsUtils.getArrayValue(this.submitExcludeKeys)))),Object.keys(t).forEach(function(e){e.startsWith("$_")&&delete t[e]}),t},enumerable:!0,configurable:!0}),e.prototype.formControl=function(e){return this.form.controls[e]},e.prototype.fieldComponent=function(e){return this.form.components[e]},e.prototype.getFormErrorFields=function(){var n=this,o=[];return Object.keys(this.form.controls).forEach(function(t){var e=n.form.get(t).errors;null!=e&&Object.keys(e).forEach(function(e){o.push(t)})}),o},e.prototype.patchModel=function(e){this.model=Object.assign({},this.model||{},e)},e.prototype.patchRuntimeData=function(e){Object.assign(this.runtimeData,e)},e.prototype.isFieldValid=function(e){var t=this.field(e);return t?t.valid:undefined},e.prototype.isFieldTouched=function(e){var t=this.field(e);return t?t.touched:undefined},e.prototype.updateControls=function(n){var o=this;n||(n=this.form),Object.keys(n.controls).forEach(function(e){var t=n.get(e);t instanceof f.FormControl?t.markAsTouched({onlySelf:!0}):t instanceof f.FormGroup&&o.updateControls(t)}),this.hasUpdated=!0},e.prototype.field=function(e){return this.form.get(e)},e.prototype.resetForm=function(){this.form.reset({})},e.prototype.resetModel=function(e){this.initModel?this.model=b.CommonsUtils.copy(this.initModel):b.CommonsUtils.isJson(e)?this.model=E({},e):this.options.resetModel?this.options.resetModel():this.model={},this.form.reset(this.model,{emitEvent:!0})},e.prototype.setInitModel=function(){this.initModel=b.CommonsUtils.copy(this.model),this.options.updateInitialValue&&this.options.updateInitialValue()},e.prototype.refresh=function(){this.cd.detectChanges()},e.prototype.submit=function(){var e,t=this;this.isFormValid?this.beforeSubmit?(e=this.beforeSubmit(this.getEventContext()))instanceof l.Observable?e.pipe(C.first()).subscribe(function(e){t.submitAfterBefore(e)}):this.submitAfterBefore(e):this.doSubmit():b.DialogUtils.error("操作失败","请填写完整信息后，再执行本操作！")},e.prototype.defaultSubmit=function(n){var o=this;this.$subscriptions=z.save.call(this,this.apiEntry,n||this.submitModel,E({tag:this.formId},this.submitOptions||{})).subscribe(function(e){if(e.id&&e.id!==o.model.id&&(o.model.id=e.id),o.onSubmitted.emit(o.getEventContext({response:e,model:o.model,submitted:n||o.submitModel})),o.afterSubmit){var t=o.afterSubmit(o.getEventContext({submitModel:n||o.submitModel,id:e.id}));t instanceof l.Observable?t.pipe(C.first()).subscribe(function(e){o.doPostSubmit(e)}):o.doPostSubmit(t)}else o.doPostSubmit()})},e.prototype.getEventContext=function(e){return E({formlyForm:this,form:this.form,model:this.model,modelId:this.modelId,entry:this.apiEntry,entity:this.entity},e||{})},e.prototype.submitAfterBefore=function(e){!1!==e&&(b.CommonsUtils.isJson(e)&&!b.CommonsUtils.isEmpty(e)?this.doSubmit(e):this.doSubmit())},e.prototype.doSubmit=function(e){0<this.onSubmit.observers.length?this.onSubmit.emit(this.getEventContext({submitModel:e})):this.defaultSubmit(e)},e.prototype.doPostSubmit=function(e){var t=this;if(e)this.resetModel(e);else if(this.resetKeys){b.CommonsUtils.getArrayValue(this.resetKeys).forEach(function(e){return delete t.model[e]}),delete this.model.id,this.form.reset(this.model,{emitEvent:!0})}else!1!==this.resetAfterSubmit&&this.resetModel(this.entity&&this.entity.initValue||{})},e.propDecorators={$id:[{type:h.Input}],entity:[{type:h.Input}],apiEntry:[{type:h.Input}],options:[{type:h.Input}],submitRootKey:[{type:h.Input}],submitExcludeKeys:[{type:h.Input}],resetKeys:[{type:h.Input}],styleClass:[{type:h.Input}],style:[{type:h.Input}],formStyleClass:[{type:h.Input}],formStyle:[{type:h.Input}],buttonsStyleClass:[{type:h.Input}],submitBtnStyleClass:[{type:h.Input}],resetBtnStyleClass:[{type:h.Input}],initBtnStyleClass:[{type:h.Input}],header:[{type:h.Input}],footer:[{type:h.Input}],buttons:[{type:h.Input}],getModelOptions:[{type:h.Input}],submitOptions:[{type:h.Input}],beforeSubmit:[{type:h.Input}],afterSubmit:[{type:h.Input}],valueChanges:[{type:h.Input}],resetAfterSubmit:[{type:h.Input}],onSubmit:[{type:h.Output}],onSubmitted:[{type:h.Output}],onModel:[{type:h.Output}],onFormValueChanges:[{type:h.Output}],model:[{type:h.Input}],modelId:[{type:h.Input}]},e}(D),Q=b.StatesUtils.observe(m.StateNames.rootHttp).pipe(C.distinctUntilChanged(),C.map(function(e){return e&&e.inProcess&&0<e.inProcess})),Y=function(e){return b.StatesUtils.observe(m.StateNames.http,e).pipe(C.distinctUntilChanged(),C.filter(function(e){return!!e}),C.map(function(e){return e&&e.start}))},X=b.StatesUtils.observe(m.StateNames.nav).pipe(C.distinctUntilChanged(),C.filter(function(e){return!!e}),C.map(function(e){return e&&e.start&&"primary"===e.outlet})),Z=b.StatesUtils.observe(m.StateNames.socket).pipe(C.distinctUntilChanged(),C.filter(function(e){return!!e}),C.map(function(e){return e.state})),ee=function(){function o(){}return o.getPermissionsService=function(){return o._permissionsService||(o._permissionsService=q.get(t.NgxPermissionsService)),o._permissionsService},o.getRolesService=function(){return o._rolesService||(o._rolesService=q.get(t.NgxRolesService)),o._rolesService},o.getRolePermissions=function(e){return b.ConfigUtils.getConfig().auth.getRolePermissions&&b.ConfigUtils.getConfig().auth.getRolePermissions(e)||l.of([])},o.HasModulePermission=function(t){var e=o.getPermissionsService().getPermissions(),n=Object.keys(e).some(function(e){return e===t||e.startsWith(t+":")});return n&&0<Object.keys(n).length},o.addPermissions=function(e,t){o.getPermissionsService().addPermission(e,t)},o.addRole=function(e,t){t||(t=function(){return!0}),o.getRolesService().addRole(e,t)},o.addRoles=function(e){var t=b.CommonsUtils.getArrayValue(e);if(t){var n=o.getRolesService();t.filter(function(e){return!!e}).forEach(function(e){return n.addRole(e,function(){return!0})})}},o.hasRole=function(e){return o.getRolesService().getRoles().hasOwnProperty(e)},o.hasAnyRole=function(e){var t=b.CommonsUtils.getArrayValue(e),n=o.getRolesService().getRoles();return t.some(function(e){return n.hasOwnProperty(e)})},o.hasAllRoles=function(e){var t=b.CommonsUtils.getArrayValue(e),n=o.getRolesService().getRoles();return t.every(function(e){return n.hasOwnProperty(e)})},o.getPermissions=function(){return o.getPermissionsService().permissions$},o.getRoles=function(){return o.getRolesService().roles$},o.hasPermission=function(e){return o.getPermissionsService().getPermissions().hasOwnProperty(e)},o.hasAnyPermission=function(e){var t=b.CommonsUtils.getArrayValue(e),n=o.getPermissionsService().getPermissions();return t.some(function(e){return n.hasOwnProperty(e)})},o.hasAllPermissions=function(e){var t=b.CommonsUtils.getArrayValue(e),n=o.getPermissionsService().getPermissions();return t.every(function(e){return n.hasOwnProperty(e)})},o.hasAuth=function(e){return o.hasAnyRole(e)||o.hasAnyPermission(e)},o.hasAllAuths=function(e){return o.hasAllRoles(e)||o.hasAllPermissions(e)},o.clearRoles=function(){o.getRolesService().flushRoles()},o.clearPermission=function(){o.getPermissionsService().flushPermissions()},o._permissionsService=null,o._rolesService=null,o}();var te=function(){function i(){}return i.login=function(e,o){return z.login(E({},e,{rememberMe:o}),E({},b.ConfigUtils.getConfig().auth.loginApiOptions||{},{tag:m.StateNames.auth})).pipe(C.filter(function(e){return!!e}),C.tap(function(n){n.jwtToken&&(b.ConfigUtils.getConfig().auth.getUserInfo?b.ConfigUtils.getConfig().auth.getUserInfo(n).subscribe(function(e){var t=E({},n,e);i.onLoginSuccess(t,o)}):i.onLoginSuccess(n,o))}))},i.register=function(e){return z.register(e,E({},b.ConfigUtils.getConfig().auth.registerApiOptions||b.ConfigUtils.getConfig().auth.loginApiOptions,{tag:m.StateNames.auth}))},i.logout=function(){z.logout(E({},b.ConfigUtils.getConfig().auth.logoutApiOptions||b.ConfigUtils.getConfig().auth.loginApiOptions,{tag:m.StateNames.auth})).subscribe(function(e){if(e){i.updateUser({}),ee.clearRoles(),ee.clearPermission();var t=b.ConfigUtils.getConfig().auth.logoutSuccessRouter;H.nav(t)}})},i.changePwd=function(e){return z.changePwd(e,E({},b.ConfigUtils.getConfig().auth.changePwdApiOptions||b.ConfigUtils.getConfig().auth.loginApiOptions,{tag:m.StateNames.auth}))},i.getCurrentUser=function(){if(i.CURRENT_USER)return i.CURRENT_USER||{};var e=b.ConfigUtils.getConfig().auth.storageKey,t=JSON.parse(sessionStorage.getItem(e));return t||(t=JSON.parse(localStorage.getItem(e))),t&&t.isSu&&(t.isAdmin=!0),(i.CURRENT_USER=t)||{}},i.updateUser=function(e,t){i.CURRENT_USER=b.CommonsUtils.isEmpty(e)?{}:E({},i.CURRENT_USER,e),b.StatesUtils.update(m.StateNames.user,i.CURRENT_USER);var n=b.ConfigUtils.getConfig().auth.storageKey;sessionStorage.setItem(n,JSON.stringify(i.CURRENT_USER)),t&&(b.CommonsUtils.isEmpty(i.CURRENT_USER)?localStorage.removeItem(n):localStorage.setItem(n,JSON.stringify(i.CURRENT_USER)))},i.checkLogin=function(e){var t=i.getCurrentUser();if(t.jwtToken&&b.JwtUtils.isValid(t.jwtToken))return!0;if(!0===b.StatesUtils.getValue(m.StateNames.auth,"dialog"))b.StatesUtils.update(m.StateNames.popup,{content:b.ConfigUtils.getConfig().auth.component,header:b.ConfigUtils.getConfig().auth.title,visible:!0,minWidth:500,minHeight:300,contentMaxWidth:500,contentMaxHeight:300});else{var n=b.ConfigUtils.getConfig().auth.loginRouter;b.StatesUtils.update(m.StateNames.auth,{successUrl:e}),H.nav(n)}return!1},i.onLoginSuccess=function(e,t){b.ConfigUtils.getConfig().auth.onLoginSuccess&&b.ConfigUtils.getConfig().auth.onLoginSuccess(e),e.enabled=!0,i.updateUser(e,t),ee.addRoles(e.roles),b.ConfigUtils.getConfig().auth.defaultRules&&ee.addRoles(b.ConfigUtils.getConfig().auth.defaultRules),ee.addPermissions(e.permissions||[]);var n=b.ConfigUtils.getConfig().auth.requiredUserProps;if(n)if(b.CommonsUtils.get(e,n)){var o=b.ConfigUtils.getConfig().auth.loginSuccessRouter;H.nav(o)}else H.nav(b.ConfigUtils.getConfig().auth.failedPropsRouter);else{o=b.ConfigUtils.getConfig().auth.loginSuccessRouter;H.nav(o)}},i.CURRENT_USER=null,i}(),ne=function(){function e(e){this.rootViewContainerRef=e}return Object.defineProperty(e.prototype,"loadingClass",{get:function(){return b.ConfigUtils.getConfig().onLoading},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this,t=b.BrowserOsUtils.checkBrowser();this.resolveBrowserSupport(t),b.ConfigUtils.configApp(this.appConfig()),setTimeout(function(){e.httpState$=Q,e.routeState$=X},0);var n=te.getCurrentUser();b.CommonsUtils.isEmpty(n)||(ee.addPermissions(n.permissions),ee.addRoles(n.roles),n.roles&&b.ConfigUtils.getConfig().auth.defaultRules&&ee.addRoles(b.ConfigUtils.getConfig().auth.defaultRules))},e.prototype.resolveBrowserSupport=function(e){e.version?e.features||alert("当前浏览器功能不全，请更换浏览器!"):alert("当前浏览器版本太低，请升级浏览器!")},e}(),oe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return I(t,e),t.prototype.ngOnInit=function(){var e=q.get(g.Router);b.ConfigUtils.configModule(this.moduleConfig()||{},e.url)},t}(D),ie=function(t){function e(){var e=t.call(this)||this;return e.userToken=b.ConfigUtils.getConfig().auth.userTokenKey,e.password=b.ConfigUtils.getConfig().auth.passwordKey,e.rememberMe=b.ConfigUtils.getConfig().auth.rememberMeKey,e.appName=b.ConfigUtils.getConfig().appName,e.stateKey=m.StateNames.auth,e}return I(e,t),e.prototype.login=function(){var t=this;this.error=undefined,te.login(this.getSubmitData(this.form.value)).subscribe(function(e){!1===e.success&&(t.error=e.message)})},e.prototype.register=function(){var t=this;this.error=undefined,delete this.form.value.rePassword,te.register(this.getSubmitData(this.form.value)).subscribe(function(e){!1===e.success?t.error=e.message:H.nav(b.ConfigUtils.getConfig().auth.loginSuccessRouter)})},e.prototype.getSubmitData=function(e){return e},e}(D),re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return I(t,e),t.prototype.ngOnInit=function(){var e;this.form=q.get(f.FormBuilder).group(((e={})[this.userToken]=["",f.Validators.required],e[this.password]=["",f.Validators.required],e[this.rememberMe]=[""],e))},t}(ie),se=function(o,i){return function(e){var t=o;if(o.query&&b.CommonsUtils.isFunction(o.query)){var n=o.query(e.value);t=E({},t,{query:n})}return z.fetch(t).pipe(C.map(function(e){var t;return e?((t={})[i]=!0,t):null}))}},ae=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.checkExists=!1,e.inFocus=!1,e.errorMessage={duplicated:"该用户名已经被注册"},e}return I(e,t),Object.defineProperty(e.prototype,"isUserNameValidate",{get:function(){return!this.inFocus&&this.form.get(this.userToken).valid},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e;this.form=q.get(f.FormBuilder).group(((e={})[this.userToken]=new f.FormControl("",{validators:n.NgValidators.required,asyncValidators:se(this.userExistsApiOptions(),"duplicated"),updateOn:"blur"}),e[this.password]=["",[n.NgValidators.required,n.NgValidators.minLength(6)]],e.rePassword=["",[n.NgValidators.required,n.NgValidators.minLength(6),n.NgValidators.equalTo(this.password)]],e))},e.prototype.userExistsApiOptions=function(){return{requestOptions:{serverType:m.ApiServerType.ER},apiEntry:"user/exists",payload:function(e){return{userName:e}}}},e}(ie),pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return I(t,e),t.prototype.ngOnInit=function(){var e;this.form=q.get(f.FormBuilder).group(((e={})[this.oldPasswordKey]=["",f.Validators.required],e[this.newPasswordKey]=["",[n.NgValidators.required,n.NgValidators.minLength(6)]],e.reNewPassword=["",[n.NgValidators.required,n.NgValidators.minLength(6),n.NgValidators.equalTo(this.newPasswordKey)]],e))},t.prototype.changePwd=function(){var t=this;this.error=undefined;var e=this.form.value;delete e.reNewPassword,e.userPwdSetDate=b.DateUtils.getFormattedDateTime(),te.changePwd(this.getSubmitData(this.form.value)).subscribe(function(e){!0===e.success?H.nav(b.ConfigUtils.getConfig().auth.changePwdSuccessRouter):t.error=e.message||"密码修改失败"})},t}(ie),le=function(n){function e(e){var t=n.call(this)||this;return t.cd=e,t.currentNumber=0,t.fontSize=".8em",t.counter$=new l.Subject,t.$subscriptions=t.counter$.pipe(C.switchMap(function(e){return l.timer(1e3,200).pipe(C.mapTo(t.positiveOrNegative(e,t.currentNumber)),C.startWith(t.currentNumber),C.scan(function(e,t){return e+t}),C.takeWhile(t.takeUntil(e,t.currentNumber)))})).subscribe(function(e){t.currentNumber=e,t.currentNumber===t.end&&(t.fontSize="1em"),t.cd.detectChanges()}),t}return I(e,n),Object.defineProperty(e.prototype,"end",{get:function(){return this._end},set:function(e){this._end=e,this.currentNumber=e-b.CommonsUtils.getRandomNumber(20),this.counter$.next(e)},enumerable:!0,configurable:!0}),e.prototype.positiveOrNegative=function(e,t){return t<e?1:-1},e.prototype.takeUntil=function(t,e){return e<t?function(e){return e<=t}:function(e){return t<=e}},e.decorators=[{type:h.Component,args:[{selector:"animate-number",template:"\n    <span [ngStyle]=\"{'font-size': fontSize, 'font-weight': 'bold'}\">\n       {{currentNumber}}\n    </span>\n  ",changeDetection:h.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:h.ChangeDetectorRef}]},e.propDecorators={end:[{type:h.Input}]},e}(D),ue="breadcrumb",ce=function(o){function e(e,t){var n=o.call(this)||this;return n.router=e,n.route=t,n.outlet="primary",n}return I(e,o),e.prototype.ngOnInit=function(){var e=this;this.breadcrumbs$=b.StatesUtils.observe(m.StateNames.nav).pipe(C.filter(function(e){return e&&"success"===e.status}),C.map(function(){return e.resolveRoute()}))},e.prototype.getRouterLink=function(e){return e.params?[e.url,e.params]:[e.url]},e.prototype.resolveRoute=function(){var s,a=this,p=[],l=this.route.root,u=b.StatesUtils.getValue(m.StateNames.rootMenu),e=b.CommonsUtils.get(b.ConfigUtils.getConfig(),"breadcrumb.prefix"),c=b.CommonsUtils.get(b.ConfigUtils.getConfig(),"breadcrumb.excludes"),d="";do{var t=l.children;l=null,t.forEach(function(e){if(e.outlet===a.outlet){var t=e.snapshot,n=null;if(t.routeConfig&&t.routeConfig.data&&t.routeConfig.data[ue]&&(n=t.routeConfig.data[ue]),!n){var o=t.url.join("/");if(o&&0<o.trim().length&&(s=s?s+"/"+o:o),s&&!b.RegUtils.test(s,c)){var i=s.split("/"),r=b.CommonsUtils.deepFind(u,{routerLink:s},{routerLink:"/"+s},{name:i[i.length-1]});r&&0<r.length&&(n=r[0].label)}}n&&0!==n.length&&n!==d&&(0===s.length&&(t.params={}),p.push({label:n,url:s,params:t.params})),l=e,d=n}})}while(l);return e?e.concat(p):p},e.decorators=[{type:h.Component,args:[{selector:"er-breadcrumbs",template:'<ol class="breadcrumb">\n    <ng-container *ngTemplateOutlet="templates?.before"></ng-container>\n    <ng-container *ngFor="let breadcrumb of breadcrumbs$|async;let last=last">\n        <li class="breadcrumb-item" [ngClass]="{active: last}">\n            <a *ngIf="!last" [routerLink]="getRouterLink(breadcrumb)">{{breadcrumb.label}}</a>\n            <span *ngIf="last">{{breadcrumb.label}}</span>\n        </li>\n    </ng-container>\n    <ng-container *ngTemplateOutlet="templates?.after"></ng-container>\n</ol>\n',changeDetection:h.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:g.Router},{type:g.ActivatedRoute}]},e.propDecorators={outlet:[{type:h.Input}]},e}(D),de=function(n){function e(e){var t=n.call(this)||this;return t.cd=e,t.type="button",t.hint="",t.onClick=new h.EventEmitter,t.onFocus=new h.EventEmitter,t.onBlur=new h.EventEmitter,t.processIcon="fa fa-cog fa-spin",t.processing$=new l.Subject,t}return I(e,n),Object.defineProperty(e.prototype,"processing",{set:function(e){this.processing$.next(e),this.cd.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"btnLabel",{get:function(){return this.processing?this.stateLabel||this.label:this.label||""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"btnTitle",{get:function(){return this.processing?this.stateHint||"执行中...":this.hint||""},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;this.stateKey&&(this.$subscriptions=b.StatesUtils.observe(m.StateNames.http,this.stateKey).pipe(C.filter(function(e){return!!e}),C.map(function(e){return e.start})).subscribe(function(e){return t.processing$.next(e)}))},e.prototype.click=function(e){this.onClick.emit(E({},e,this.context||{}))},e.decorators=[{type:h.Component,args:[{selector:"er-button",template:'<button *ngIf="!hidden"\n        [attr.type]="type"\n        [ngClass]="styleClass"\n        [ngStyle]="style"\n        [disabled]="disabled || (processing$|async) "\n        [title]="hint"\n        (click)="click($event)"\n        (focus)="emitEvent(\'onFocus\',$event)"\n        (blur)="emitEvent(\'onBlur\',$event)"\n>\n  <i *ngIf="!iconRight && !(processing$|async)" [ngClass]="icon"></i> {{btnLabel}}\n  <ng-content></ng-content>\n  <i *ngIf="iconRight && !(processing$|async)" [ngClass]="icon"  ></i>\n  <i *ngIf="processing$|async" [ngClass]="processIcon" style="margin-left: 5px"></i>\n</button>\n',changeDetection:h.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:h.ChangeDetectorRef}]},e.propDecorators={type:[{type:h.Input}],hint:[{type:h.Input}],label:[{type:h.Input}],icon:[{type:h.Input}],style:[{type:h.Input}],hidden:[{type:h.Input}],styleClass:[{type:h.Input}],disabled:[{type:h.Input}],iconRight:[{type:h.Input}],stateKey:[{type:h.Input}],stateLabel:[{type:h.Input}],stateHint:[{type:h.Input}],context:[{type:h.Input}],onClick:[{type:h.Output}],onFocus:[{type:h.Output}],onBlur:[{type:h.Output}],processing:[{type:h.Input}]},e}(D),he=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return I(t,e),t.decorators=[{type:h.Component,args:[{selector:"er-buttons",template:"\n    \n  ",changeDetection:h.ChangeDetectionStrategy.OnPush}]}],t}(D),fe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return I(t,e),Object.defineProperty(t.prototype,"labels",{get:function(){var e=b.DataItemUtils.getItemLabel(this.item,this.labelKeys);return b.CommonsUtils.isArray(e)?e:[e]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelKeys",{get:function(){var e=this.props.dropDownOptionKey||this.props.labelKey;return e||(e=this.item.hasOwnProperty("label")?"label":Object.keys(this.item).filter(function(e){return!e.startsWith("_")&&"id"!==e})),e},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.props||(this.props={})},t.decorators=[{type:h.Component,args:[{selector:"er-data-item",template:'\n    <ng-container *ngIf="props.template;else default">\n      <er-dyna-content [content]="props.template" [context]="item"></er-dyna-content>\n    </ng-container>\n    <ng-template #default>\n      <div class="d-flex data-item" [ngClass]="props.itemStyleClass || \'ui-clearfix\'">\n        <span class="label mr-3 border-right" *ngFor="let label of labels" [ngClass]="props.labelStyleClass" [innerHTML]="label"></span>\n        <span class="pull-right count" *ngIf="props.showCounter && item[\'value\']">\n          <span [ngClass]="props.counterStyleClass || \'badge badge-pill badge-info\'">{{item[\'value\']}}</span>\n        </span>\n      </div>\n    </ng-template>\n  ',changeDetection:h.ChangeDetectionStrategy.OnPush,styles:["/deep/ .ui-autocomplete-list-item{border-bottom:1px solid #9f9f9f!important;font-size:.8em!important;color:#000!important}/deep/ .ui-autocomplete-list-item:hover{background-color:transparent!important;font-weight:700!important;color:red!important;font-size:1em!important}"]}]}],t.propDecorators={item:[{type:h.Input}],props:[{type:h.Input}]},t}(D),ge="$component-factory",me=function(){function i(){}return i.createComponentByType=function(e,t){if(t){var n=b.CacheUtils.get(ge,t);return n||(n=i.getComponentFactoryResolver().resolveComponentFactory(t),b.CacheUtils.put(ge,t,n)),i.createComponent(e,n)}},i.createComponentByTemplate=function(e,t){if(t){var n=b.CacheUtils.get(ge,t);if(!n){var o=i.createDecoratedComponent(null,t);n=i.createNgModule(o).componentFactories.find(function(e){return e.componentType===o}),b.CacheUtils.put(ge,t,n)}return i.createComponent(e,n)}},i.getComponentFactoryResolver=function(){return i._componentFactoryResolver||(i._componentFactoryResolver=q.get(h.ComponentFactoryResolver)),i._componentFactoryResolver},i.createDecoratedComponent=function(e,t){var n=e||function o(){};return h.Component({template:t})(n)},i.createNgModule=function(e){var t=h.NgModule({declarations:[e]})(function n(){});return q.get(h.Compiler).compileModuleAndAllComponentsSync(t)},i.createComponent=function(e,t){return e.clear(),e.createComponent(t)},i._componentFactoryResolver=null,i}(),be=function(){function e(e,t,n){this.viewContainerRef=e,this.el=t,this.renderer=n,this.onCreated=new h.EventEmitter}return e.prototype.ngOnChanges=function(e){e.type&&this.createComponent()},e.prototype.ngOnDestroy=function(){this.component&&(this.component.destroy(),this.component=null)},e.prototype.createComponent=function(){if(this.type){b.CommonsUtils.isString(this.type)?this.component=me.createComponentByTemplate(this.viewContainerRef,this.type):this.component=me.createComponentByType(this.viewContainerRef,this.type),$.bind(this.component.instance,this.props),this.onCreated.emit(this.component);var e=this.el.nativeElement.parentNode;this.renderer.removeChild(e,this.el.nativeElement)}},e.decorators=[{type:h.Component,args:[{selector:"er-dyna-component",template:"",changeDetection:h.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:h.ViewContainerRef},{type:h.ElementRef},{type:h.Renderer2}]},e.propDecorators={type:[{type:h.Input}],props:[{type:h.Input}],onCreated:[{type:h.Output}]},e}();function ye(e,t){return void 0===t&&(t=!1),t?function n(e){return new h.SimpleChange(undefined,e,!0)}(e.currentValue):new h.SimpleChange(e.previousValue,e.currentValue,!1)}function ve(t,n){return function(e){return n(e,ye(e,t))}}var xe={isFirstChanges:!1,onlyNewChanges:!1};function Ce(e){return void 0===e&&(e=xe),e.onlyNewChanges?function t(e){return function(n){return ve(e,function(e,t){n[e.key]||(n[e.key]=t)})}}(e.isFirstChanges):function n(e){return function(n){return ve(e,function(e,t){return n[e.key]=t})}}(e.isFirstChanges)}var Se=Ce({isFirstChanges:!0}),we=Ce({onlyNewChanges:!0}),Ie=function(r){function e(e,t,n,o){var i=r.call(this)||this;return i.differs=e,i.elementRef=t,i.renderer=n,i.viewContainerRef=o,i.autoBind=!0,i.differ=i.differs.find({}).create(),i._hostComponentInst=undefined,i._viewComponentRef=undefined,i}return I(e,r),Object.defineProperty(e.prototype,"hostComponentInst",{get:function(){return this._hostComponentInst===undefined&&(this._hostComponentInst=$.getHostComponentInst(this.viewContainerRef)),this._hostComponentInst},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewComponentRef",{get:function(){return this._viewComponentRef===undefined&&(this._viewComponentRef=$.getViewComponentRef(this.viewContainerRef)),this._viewComponentRef},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){if(this.autoBind){if(e.props&&!b.CommonsUtils.isEmpty(this.props)){if(this.resolveProps(),this.differs.find({}).create(),_.debug(this,"属性绑定",this.props,this.inputs,this.outputs,this.hooks),this.methods&&this.bindMethods(),this.inputs){var t=this.differ.diff(this.inputs);this.expInputs=this.getExpressionInputs(this.inputs),t&&(this.updateInputsChanges(t),this.updateInputs(!this.lastInputChanges))}if(this.outputs)this.differ.diff(this.outputs)&&this.bindOutputs();this.hooks&&this.bindLifeCycles(),e.props.isFirstChange()&&this.hostComponentInst._propsBind&&this.hostComponentInst._propsBind()}if(e.attrs&&this.attrs){this.resolveAttrs();var n=this.differ.diff(this.attrs);n&&(this.lastAttrChanges=this.changesToAttrChanges(n),this.updateAttributes(this.lastAttrChanges))}}},e.prototype.ngDoCheck=function(){var n=this;if(this.attrs&&this.autoBind){this.expAttrs&&0<Object.keys(this.expAttrs).length&&Object.keys(this.expAttrs).forEach(function(e){n.attrs[e]=n.expAttrs[e].call(n,n.getEventContext())});var e=this.differ.diff(this.attrs);e&&(this.lastAttrChanges=this.changesToAttrChanges(e),this.updateAttributes(this.lastAttrChanges))}if(this.inputs&&this.autoBind){this.expInputs&&0<Object.keys(this.expInputs).length&&Object.keys(this.expInputs).forEach(function(t){var e=n.expInputs[t](n.getEventContext());e instanceof l.Observable?n.$subscriptions=e.subscribe(function(e){n.inputs[t]=e}):n.inputs[t]=e});var t=this.differ.diff(this.inputs);if(t){var o=!!this.lastInputChanges;this.updateInputsChanges(t),o&&this.updateInputs()}}},e.prototype.getEventContext=function(e){return E({},e,{$from:this.hostComponentInst},this.context||{})},e.prototype.updateInputs=function(e){var t=this;void 0===e&&(e=!1),this.hostComponentInst&&this.inputs&&(Object.keys(this.inputs).forEach(function(e){return t.hostComponentInst[e]=t.inputs[e]}),this.notifyOnInputChanges(this.lastInputChanges,e))},e.prototype.bindOutputs=function(){var o=this;this.stopSubscribe(),this.outputs&&Object.keys(this.outputs).filter(function(e){return o.hostComponentInst[e]}).forEach(function(n){return o.$subscriptions=o.hostComponentInst[n].subscribe(function(e){try{o.outputs[n](o.getEventContext(e))}catch(t){_.error(o.hostComponentInst,"操作失败",t)}})})},e.prototype.bindLifeCycles=function(){var e=$.getConstructor(this.hostComponentInst),t=e.prototype.ngOnDestroy;$.bindLifeCycles(this.hostComponentInst,this.hooks,e,t)},e.prototype.bindMethods=function(){var t=this;this.methods&&Object.keys(this.methods).forEach(function(e){t.hostComponentInst[e]=t.methods[e].bind(t.hostComponentInst)})},e.prototype.notifyOnInputChanges=function(e,t){void 0===e&&(e={}),this.hostComponentInst.ngOnChanges&&(t&&(e=this.collectFirstChanges()),this.hostComponentInst.ngOnChanges(e),this.hostComponentInst.cd&&this.hostComponentInst.cd.detectChanges&&this.hostComponentInst.cd.detectChanges())},e.prototype.getExpressionInputs=function(t){if(t){var n={};return Object.keys(t).forEach(function(e){t[e]instanceof Function&&(n[e]=t[e])}),n}return undefined},e.prototype.updateInputsChanges=function(e){this.lastInputChanges=this.collectChangesFromDiffer(e)},e.prototype.collectFirstChanges=function(){var t={},n=this.inputs;return Object.keys(n).forEach(function(e){return t[e]=new h.SimpleChange(undefined,n[e],!0)}),t},e.prototype.collectChangesFromDiffer=function(e){var t={};return e.forEachAddedItem(Se(t)),e.forEachItem(we(t)),t},e.prototype.changesToAttrChanges=function(e){var t={set:{},remove:[]};return e.forEachAddedItem(function(e){return t.set[e.key]=e.currentValue}),e.forEachChangedItem(function(e){return t.set[e.key]=e.currentValue}),e.forEachRemovedItem(function(e){return t.remove.push(e.key)}),t},e.prototype.updateAttributes=function(t){var n=this;Object.keys(t.set).forEach(function(e){return n.setAttribute(e,t.set[e])}),t.remove.forEach(function(e){return n.removeAttribute(e)})},e.prototype.setAttribute=function(e,t,n){this.renderer.setAttribute(this.elementRef.nativeElement,e,t,n)},e.prototype.removeAttribute=function(e,t){this.renderer.removeAttribute(this.elementRef.nativeElement,e,t)},e.prototype.resolveProps=function(){var t=this;this.hostComponentInst&&b.CommonsUtils.isJson(this.props)&&(this.inputs={},this.outputs={},this.hostComponentInst._initProps&&(this.hostComponentInst.$props=b.CommonsUtils.merge({},this.props),this.hostComponentInst._initProps(),this.props=b.CommonsUtils.merge({},this.hostComponentInst.$props)),this.props.$id||(this.props.$id=b.IdUtils.getRandom()),this.props.methods&&(this.methods=this.props.methods,delete this.props.methods),this.props.hooks&&(this.hooks=this.props.hooks,delete this.props.hooks),this.hostComponentInst instanceof V?(this.props=b.CommonsUtils.get(this.props,"$ext",{}),this.props.hooks&&(this.hooks=this.props.hooks,delete this.props.hooks)):this.props=b.CommonsUtils.omit(this.props,"$ext"),Object.keys(this.props).forEach(function(e){t.hostComponentInst[e]instanceof h.EventEmitter?t.outputs[e]=t.props[e]:t.inputs[e]=t.props[e]}),0===Object.keys(this.inputs).length&&(this.inputs=undefined),0===Object.keys(this.outputs).length&&(this.outputs=undefined))},e.prototype.resolveAttrs=function(){this.hostComponentInst instanceof V?this.attrs=b.CommonsUtils.get(this.attrs,"$ext",{}):this.attrs=b.CommonsUtils.omit(this.attrs,"$ext")},e.decorators=[{type:h.Directive,args:[{selector:"[erPropsBind]"}]}],e.ctorParameters=function(){return[{type:h.KeyValueDiffers},{type:h.ElementRef},{type:h.Renderer2},{type:h.ViewContainerRef}]},e.propDecorators={props:[{type:h.Input}],context:[{type:h.Input}],attrs:[{type:h.Input}],autoBind:[{type:h.Input}]},e}(k),Ee=function(n){function e(e){var t=n.call(this)||this;return t.cd=e,t.CONTENT_TYPE=m.ContentType,t.parsedContent$=new o.BehaviorSubject(undefined),t}return I(e,n),e.prototype.ngOnChanges=function(e){this.parse()},e.prototype.refresh=function(){this.parse(),this.cd.markForCheck()},e.prototype.parse=function(){var t=this;if(b.CommonsUtils.isJson(this.content)){if(this.content.content&&(this.content.styleClass&&(this.styleClass=this.content.styleClass),this.content.style&&(this.style=this.content.style),this.content=this.content.content),this.content.data)return this.contentType=m.ContentType.DATA,this.parsedContent=[],void Object.keys(this.content.data).forEach(function(e){t.parsedContent.push({key:e,value:b.CommonsUtils.getText(t.content.data[e])})});if(this.content.type){this.contentType=m.ContentType.COMPONENT,this.dynaComponent=this.content;var e=this.dynaComponent.directives,n=[];return e&&(e=b.CommonsUtils.getArrayValue(e)).filter(function(e){return!!e.type}).forEach(function(e){n.push(v.dynamicDirectiveDef(e.type,e.inputs,e.outputs))}),(this.dynaComponent.props||this.context)&&n.push(v.dynamicDirectiveDef(Ie,Object.assign({},this.dynaComponent.props||{},this.context||{}))),void(this.dynaComponent.directives=n)}this.parsedContent=this.content.content,this.parsedContext=E({},this.content.context||{},this.context||{})}else this.parsedContent=this.content,this.parsedContext=this.context;if(b.CommonsUtils.isString(this.parsedContent))b.CommonsUtils.isTemplateStr(this.parsedContent)?(this.parsedContent=b.CommonsUtils.templateStr(this.parsedContent,this.context)||"<span></span>",this.contentType=m.ContentType.TEMPLATE_STR):this.contentType=m.ContentType.STRING;else if(this.parsedContent instanceof h.TemplateRef)this.contentType=m.ContentType.TEMPLATE;else if(b.CommonsUtils.isFunction(this.parsedContent)){this.parsedContextFn=this.parsedContent;var o=this.parsedContextFn(this.parsedContext);o instanceof l.Observable?o.subscribe(function(e){return t.parsedContent$.next(b.CommonsUtils.toString(e))}):this.parsedContent$.next(o),this.contentType=m.ContentType.FUNCTION}},e.decorators=[{type:h.Component,args:[{selector:"er-dyna-content",template:'\n    <ng-container [ngSwitch]="contentType">\n      <div *ngSwitchCase="CONTENT_TYPE.STRING" [ngClass]="styleClass" [ngStyle]="style" [innerHTML]="parsedContent|erSafeHtml"></div>\n      <div *ngSwitchCase="CONTENT_TYPE.DATA" class="d-flex" [ngClass]="styleClass" [ngStyle]="style">\n        <div *ngFor="let item of parsedContent" class="d-flex justify-content-center m-3">\n          <span class="mr-2 font-weight-bold">{{item.key}}</span>\n          <span [innerHTML]="item.value|erSafeHtml"></span>\n        </div>\n      </div>\n      <span *ngSwitchCase="CONTENT_TYPE.TEMPLATE_STR" [innerHTML]="parsedContent" [ngClass]="styleClass"\n            [ngStyle]="style"></span>\n      <ng-container *ngSwitchCase="CONTENT_TYPE.FUNCTION">\n        <ng-container *ngIf="parsedContent$|async as asyncContent">\n          <span [innerHTML]="asyncContent" [ngClass]="styleClass" [ngStyle]="style"></span>\n        </ng-container>\n      </ng-container>\n      <ng-container *ngSwitchCase="CONTENT_TYPE.TEMPLATE">\n        <ng-container *ngTemplateOutlet="parsedContent;context:parsedContext"></ng-container>\n      </ng-container>\n      <ng-container *ngSwitchCase="CONTENT_TYPE.COMPONENT">\n        <ndc-dynamic [ndcDynamicComponent]="dynaComponent.type"\n                     [ndcDynamicDirectives]="dynaComponent.directives"\n                     [ndcDynamicAttributes]="dynaComponent.attrs"\n        >\n        </ndc-dynamic>\n      </ng-container>\n    </ng-container>\n  ',changeDetection:h.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:h.ChangeDetectorRef}]},e.propDecorators={content:[{type:h.Input}],context:[{type:h.Input}],styleClass:[{type:h.Input}],style:[{type:h.Input}]},e}(D),Re=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loadingClass="loading-circle",e}return I(e,t),Object.defineProperty(e.prototype,"httpState$",{get:function(){return this.tag?Y(this.tag):Q},enumerable:!0,configurable:!0}),e.decorators=[{type:h.Component,args:[{selector:"er-http-status",template:'    \n      <ng-container *ngIf="httpState$|async">\n        <ng-container *ngTemplateOutlet="template(\'_\',default)"></ng-container>\n        <ng-template #default>\n          <div [ngClass]="loadingClass"></div>\n        </ng-template>\n      </ng-container>\n  ',changeDetection:h.ChangeDetectionStrategy.OnPush}]}],e.propDecorators={tag:[{type:h.Input}],loadingClass:[{type:h.Input}]},e}(D),Pe=function(){function e(){this.styleClass="container"}return e.decorators=[{type:h.Component,args:[{selector:"er-container",template:'\n    <div [ngClass]="styleClass">\n       <ng-content></ng-content>\n     </div>\n  ',changeDetection:h.ChangeDetectionStrategy.OnPush}]}],e.propDecorators={styleClass:[{type:h.Input}]},e}(),Te=function(){function e(){this.styleClass="container-fluid"}return e.decorators=[{type:h.Component,args:[{selector:"er-fluid-container",template:'\n    <div [ngClass]="styleClass">\n       <ng-content></ng-content>\n     </div>\n  ',changeDetection:h.ChangeDetectionStrategy.OnPush}]}],e.propDecorators={styleClass:[{type:h.Input}]},e}(),ke=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.leftStyleClass="col-3",e.rightStyleClass="col-9",e.switchable=!0,e.onLeftHide=new h.EventEmitter,e.templateNames={left:"left",right:"right"},e}return I(e,t),e.prototype.reLayout=function(e){this.hideLeft=e,this.onLeftHide.emit(e)},e.decorators=[{type:h.Component,args:[{selector:"er-left-right",template:'\n    <div class="d-flex">\n      <div *ngIf="!hideLeft" class="w-25 shadow-lg">\n        <ng-container *ngTemplateOutlet="template(templateNames.left)"></ng-container>\n      </div>\n      <div class="flex-grow-1">\n        <div *ngIf="switchable">\n          <i class="fa fa-2x  text-primary" [title]="hideLeft?\'展开左侧内容\':\'收起左侧内容\'"\n             [ngClass]="hideLeft?\'fa-arrow-circle-right\':\'fa-arrow-circle-left\'"\n             (click)="reLayout(!hideLeft)"></i>\n        </div>\n        <ng-container *ngTemplateOutlet="template(templateNames.right)"></ng-container>\n      </div>\n    </div>\n  ',changeDetection:h.ChangeDetectionStrategy.OnPush}]}],e.propDecorators={leftStyleClass:[{type:h.Input}],rightStyleClass:[{type:h.Input}],hideLeft:[{type:h.Input}],switchable:[{type:h.Input}],onLeftHide:[{type:h.Output}]},e}(D),Ue={iphoneX:"iphone-x",iphone8:"iphone8",iphone8plus:"iphone8plus",iphone5s:"iphone5s",nexus5:"nexus5",ipad:"ipad",note8:"note8",macbook:"macbook"},Oe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.MOBILE_TYPE=Ue,e.mobile=Ue.iphone8,e.isLandscape=!1,e.scale=1,e}return I(e,t),e.prototype.zoomIn=function(){.25<this.scale&&(this.scale=this.scale-.25)},e.prototype.zoomOut=function(){this.scale<2&&(this.scale=this.scale+.25)},e.decorators=[{type:h.Component,args:[{selector:"er-phone-preview",template:'\x3c!--http://marvelapp.github.io/devices.css/--\x3e\n\n<div [ngStyle]="{zoom:scale}">\n  <span style="display: block">\n    <i class="fa fa-search-minus pull-left" (click)="zoomIn()"></i>\n    <i class="fa fa-search-plus pull-right" (click)="zoomOut()"></i>\n  </span>\n\n  <ng-container *ngIf="mobile === MOBILE_TYPE.ipad">\n    <ng-container *ngTemplateOutlet="ipad"></ng-container>\n  </ng-container>\n\n  <ng-container *ngIf="mobile === MOBILE_TYPE.iphone8">\n    <ng-container *ngTemplateOutlet="iphone8"></ng-container>\n  </ng-container>\n</div>\n\n\n<ng-template #ipad>\n  <div class="mobile-face ipad {{color || \'silver\'}}" [ngClass]="{landscape: isLandscape}">\n    <div class="camera"></div>\n    <div class="screen">\n      <ng-content></ng-content>\n    </div>\n    <div class="home"></div>\n  </div>\n</ng-template>\n\n<ng-template #iphone8>\n  <div class="mobile-face iphone8 {{color || \'black\'}}" [ngClass]="{landscape: isLandscape}">\n    <div class="top-bar"></div>\n    <div class="sleep"></div>\n    <div class="volume"></div>\n    <div class="camera"></div>\n    <div class="sensor"></div>\n    <div class="speaker"></div>\n    <div class="screen">\n      <ng-content></ng-content>\n    </div>\n    <div class="home"></div>\n    <div class="bottom-bar"></div>\n  </div>\n</ng-template>',changeDetection:h.ChangeDetectionStrategy.OnPush,styles:[".mobile-face{display:inline-block;position:relative;box-sizing:content-box!important}.mobile-face .screen{width:100%;position:relative;height:100%;z-index:3;background:#fff;overflow-y:scroll;display:block;border-radius:1px;box-shadow:0 0 0 3px #111}.mobile-face .bottom-bar,.mobile-face .top-bar{height:3px;background:#000;width:100%;display:block}.mobile-face .middle-bar{width:3px;height:4px;top:0;left:90px;background:#000;position:absolute}.mobile-face.iphone8{width:375px;height:667px;padding:105px 24px;background:#d9dbdc;border-radius:56px;box-shadow:inset 0 0 3px 0 rgba(0,0,0,.2)}.mobile-face.iphone8:before{width:calc(100% - 12px);height:calc(100% - 12px);position:absolute;top:6px;content:'';left:6px;border-radius:50px;background:#f8f8f8;z-index:1}.mobile-face.iphone8:after{width:calc(100% - 16px);height:calc(100% - 16px);position:absolute;top:8px;content:'';left:8px;border-radius:48px;box-shadow:inset 0 0 3px 0 rgba(0,0,0,.1),inset 0 0 6px 3px #fff;z-index:2}.mobile-face.iphone8 .home{border-radius:100%;width:68px;height:68px;position:absolute;left:50%;margin-left:-34px;bottom:22px;z-index:3;background:#303233;background:linear-gradient(135deg,#303233 0,#b5b7b9 50%,#f0f2f2 69%,#303233 100%)}.mobile-face.iphone8 .home:before{background:#f8f8f8;position:absolute;content:'';border-radius:100%;width:calc(100% - 8px);height:calc(100% - 8px);top:4px;left:4px}.mobile-face.iphone8 .top-bar{height:14px;background:#bfbfc0;position:absolute;top:68px;left:0}.mobile-face.iphone8 .bottom-bar{height:14px;background:#bfbfc0;position:absolute;bottom:68px;left:0}.mobile-face.iphone8 .sleep{position:absolute;top:190px;right:-4px;width:4px;height:66px;border-radius:0 2px 2px 0;background:#d9dbdc}.mobile-face.iphone8 .volume{position:absolute;left:-4px;top:188px;z-index:0;height:66px;width:4px;border-radius:2px 0 0 2px;background:#d9dbdc}.mobile-face.iphone8 .volume:before{position:absolute;left:2px;top:-78px;height:40px;width:2px;border-radius:2px 0 0 2px;background:inherit;content:'';display:block}.mobile-face.iphone8 .volume:after{position:absolute;left:0;top:82px;height:66px;width:4px;border-radius:2px 0 0 2px;background:inherit;content:'';display:block}.mobile-face.iphone8 .camera{background:#3c3d3d;width:12px;height:12px;position:absolute;top:24px;left:50%;margin-left:-6px;border-radius:100%;z-index:3}.mobile-face.iphone8 .sensor{background:#3c3d3d;width:16px;height:16px;position:absolute;top:49px;left:134px;z-index:3;border-radius:100%}.mobile-face.iphone8 .speaker{background:#292728;width:70px;height:6px;position:absolute;top:54px;left:50%;margin-left:-35px;border-radius:6px;z-index:3}.mobile-face.iphone8.gold{background:#f9e7d3}.mobile-face.iphone8.gold .bottom-bar,.mobile-face.iphone8.gold .top-bar{background:#fff}.mobile-face.iphone8.gold .sleep,.mobile-face.iphone8.gold .volume{background:#f9e7d3}.mobile-face.iphone8.gold .home{background:#cebba9;background:linear-gradient(135deg,#cebba9 0,#f9e7d3 50%,#cebba9 100%)}.mobile-face.iphone8.black{background:#464646;box-shadow:inset 0 0 3px 0 rgba(0,0,0,.7)}.mobile-face.iphone8.black:before{background:#080808}.mobile-face.iphone8.black:after{box-shadow:inset 0 0 3px 0 rgba(0,0,0,.1),inset 0 0 6px 3px #212121}.mobile-face.iphone8.black .bottom-bar,.mobile-face.iphone8.black .top-bar{background:#212121}.mobile-face.iphone8.black .sleep,.mobile-face.iphone8.black .volume{background:#464646}.mobile-face.iphone8.black .camera{background:#080808}.mobile-face.iphone8.black .home{background:#080808;background:linear-gradient(135deg,#080808 0,#464646 50%,#080808 100%)}.mobile-face.iphone8.black .home:before{background:#080808}.mobile-face.iphone8.landscape{padding:24px 105px;height:375px;width:667px}.mobile-face.iphone8.landscape .sleep{top:100%;border-radius:0 0 2px 2px;right:190px;height:4px;width:66px}.mobile-face.iphone8.landscape .volume{width:66px;height:4px;top:-4px;left:calc(100% - 188px - 66px);border-radius:2px 2px 0 0}.mobile-face.iphone8.landscape .volume:before{width:40px;height:2px;top:2px;right:-78px;left:auto;border-radius:2px 2px 0 0}.mobile-face.iphone8.landscape .volume:after{left:-82px;width:66px;height:4px;top:0;border-radius:2px 2px 0 0}.mobile-face.iphone8.landscape .top-bar{width:14px;height:100%;left:calc(100% - 68px - 14px);top:0}.mobile-face.iphone8.landscape .bottom-bar{width:14px;height:100%;left:68px;top:0}.mobile-face.iphone8.landscape .home{top:50%;margin-top:-34px;margin-left:0;left:22px}.mobile-face.iphone8.landscape .sensor{top:134px;left:calc(100% - 49px - 16px)}.mobile-face.iphone8.landscape .speaker{height:70px;width:6px;left:calc(100% - 54px - 6px);top:50%;margin-left:0;margin-top:-35px}.mobile-face.iphone8.landscape .camera{left:calc(100% - 32px);top:50%;margin-left:0;margin-top:-5px}.mobile-face.iphone8plus{width:414px;height:736px;padding:112px 26px;background:#d9dbdc;border-radius:56px;box-shadow:inset 0 0 3px 0 rgba(0,0,0,.2)}.mobile-face.iphone8plus:before{width:calc(100% - 12px);height:calc(100% - 12px);position:absolute;top:6px;content:'';left:6px;border-radius:50px;background:#f8f8f8;z-index:1}.mobile-face.iphone8plus:after{width:calc(100% - 16px);height:calc(100% - 16px);position:absolute;top:8px;content:'';left:8px;border-radius:48px;box-shadow:inset 0 0 3px 0 rgba(0,0,0,.1),inset 0 0 6px 3px #fff;z-index:2}.mobile-face.iphone8plus .home{border-radius:100%;width:68px;height:68px;position:absolute;left:50%;margin-left:-34px;bottom:24px;z-index:3;background:#303233;background:linear-gradient(135deg,#303233 0,#b5b7b9 50%,#f0f2f2 69%,#303233 100%)}.mobile-face.iphone8plus .home:before{background:#f8f8f8;position:absolute;content:'';border-radius:100%;width:calc(100% - 8px);height:calc(100% - 8px);top:4px;left:4px}.mobile-face.iphone8plus .top-bar{height:14px;background:#bfbfc0;position:absolute;top:68px;left:0}.mobile-face.iphone8plus .bottom-bar{height:14px;background:#bfbfc0;position:absolute;bottom:68px;left:0}.mobile-face.iphone8plus .sleep{position:absolute;top:190px;right:-4px;width:4px;height:66px;border-radius:0 2px 2px 0;background:#d9dbdc}.mobile-face.iphone8plus .volume{position:absolute;left:-4px;top:188px;z-index:0;height:66px;width:4px;border-radius:2px 0 0 2px;background:#d9dbdc}.mobile-face.iphone8plus .volume:before{position:absolute;left:2px;top:-78px;height:40px;width:2px;border-radius:2px 0 0 2px;background:inherit;content:'';display:block}.mobile-face.iphone8plus .volume:after{position:absolute;left:0;top:82px;height:66px;width:4px;border-radius:2px 0 0 2px;background:inherit;content:'';display:block}.mobile-face.iphone8plus .camera{background:#3c3d3d;width:12px;height:12px;position:absolute;top:29px;left:50%;margin-left:-6px;border-radius:100%;z-index:3}.mobile-face.iphone8plus .sensor{background:#3c3d3d;width:16px;height:16px;position:absolute;top:54px;left:154px;z-index:3;border-radius:100%}.mobile-face.iphone8plus .speaker{background:#292728;width:70px;height:6px;position:absolute;top:59px;left:50%;margin-left:-35px;border-radius:6px;z-index:3}.mobile-face.iphone8plus.gold{background:#f9e7d3}.mobile-face.iphone8plus.gold .bottom-bar,.mobile-face.iphone8plus.gold .top-bar{background:#fff}.mobile-face.iphone8plus.gold .sleep,.mobile-face.iphone8plus.gold .volume{background:#f9e7d3}.mobile-face.iphone8plus.gold .home{background:#cebba9;background:linear-gradient(135deg,#cebba9 0,#f9e7d3 50%,#cebba9 100%)}.mobile-face.iphone8plus.black{background:#464646;box-shadow:inset 0 0 3px 0 rgba(0,0,0,.7)}.mobile-face.iphone8plus.black:before{background:#080808}.mobile-face.iphone8plus.black:after{box-shadow:inset 0 0 3px 0 rgba(0,0,0,.1),inset 0 0 6px 3px #212121}.mobile-face.iphone8plus.black .bottom-bar,.mobile-face.iphone8plus.black .top-bar{background:#212121}.mobile-face.iphone8plus.black .sleep,.mobile-face.iphone8plus.black .volume{background:#464646}.mobile-face.iphone8plus.black .camera{background:#080808}.mobile-face.iphone8plus.black .home{background:#080808;background:linear-gradient(135deg,#080808 0,#464646 50%,#080808 100%)}.mobile-face.iphone8plus.black .home:before{background:#080808}.mobile-face.iphone8plus.landscape{padding:26px 112px;height:414px;width:736px}.mobile-face.iphone8plus.landscape .sleep{top:100%;border-radius:0 0 2px 2px;right:190px;height:4px;width:66px}.mobile-face.iphone8plus.landscape .volume{width:66px;height:4px;top:-4px;left:calc(100% - 188px - 66px);border-radius:2px 2px 0 0}.mobile-face.iphone8plus.landscape .volume:before{width:40px;height:2px;top:2px;right:-78px;left:auto;border-radius:2px 2px 0 0}.mobile-face.iphone8plus.landscape .volume:after{left:-82px;width:66px;height:4px;top:0;border-radius:2px 2px 0 0}.mobile-face.iphone8plus.landscape .top-bar{width:14px;height:100%;left:calc(100% - 68px - 14px);top:0}.mobile-face.iphone8plus.landscape .bottom-bar{width:14px;height:100%;left:68px;top:0}.mobile-face.iphone8plus.landscape .home{top:50%;margin-top:-34px;margin-left:0;left:24px}.mobile-face.iphone8plus.landscape .sensor{top:154px;left:calc(100% - 54px - 16px)}.mobile-face.iphone8plus.landscape .speaker{height:70px;width:6px;left:calc(100% - 59px - 6px);top:50%;margin-left:0;margin-top:-35px}.mobile-face.iphone8plus.landscape .camera{left:calc(100% - 29px);top:50%;margin-left:0;margin-top:-5px}.mobile-face.iphone5s{padding:105px 22px;background:#2c2b2c;width:320px;height:568px;border-radius:50px}.mobile-face.iphone5s:before{width:calc(100% - 8px);height:calc(100% - 8px);position:absolute;top:4px;content:'';left:4px;border-radius:46px;background:#1e1e1e;z-index:1}.mobile-face.iphone5s .sleep{position:absolute;top:-4px;right:60px;width:60px;height:4px;border-radius:2px 2px 0 0;background:#282727}.mobile-face.iphone5s .volume{position:absolute;left:-4px;top:180px;z-index:0;height:27px;width:4px;border-radius:2px 0 0 2px;background:#282727}.mobile-face.iphone5s .volume:before{position:absolute;left:0;top:-75px;height:35px;width:4px;border-radius:2px 0 0 2px;background:inherit;content:'';display:block}.mobile-face.iphone5s .volume:after{position:absolute;left:0;bottom:-64px;height:27px;width:4px;border-radius:2px 0 0 2px;background:inherit;content:'';display:block}.mobile-face.iphone5s .camera{background:#3c3d3d;width:10px;height:10px;position:absolute;top:32px;left:50%;margin-left:-5px;border-radius:5px;z-index:3}.mobile-face.iphone5s .sensor{background:#3c3d3d;width:10px;height:10px;position:absolute;top:60px;left:160px;z-index:3;margin-left:-32px;border-radius:5px}.mobile-face.iphone5s .speaker{background:#292728;width:64px;height:10px;position:absolute;top:60px;left:50%;margin-left:-32px;border-radius:5px;z-index:3}.mobile-face.iphone5s .home{border-radius:36px;width:68px;box-shadow:inset 0 0 0 4px #2c2b2c;height:68px;position:absolute;left:50%;margin-left:-34px;bottom:19px;z-index:3}.mobile-face.iphone5s .top-bar{top:70px;position:absolute;left:0}.mobile-face.iphone5s .bottom-bar{bottom:70px;position:absolute;left:0}.mobile-face.iphone5s.landscape{padding:22px 105px;height:320px;width:568px}.mobile-face.iphone5s.landscape .sleep{right:-4px;top:calc(100% - 120px);height:60px;width:4px;border-radius:0 2px 2px 0}.mobile-face.iphone5s.landscape .volume{width:27px;height:4px;top:-4px;left:calc(100% - 180px);border-radius:2px 2px 0 0}.mobile-face.iphone5s.landscape .volume:before{width:35px;height:4px;top:0;right:-75px;left:auto;border-radius:2px 2px 0 0}.mobile-face.iphone5s.landscape .volume:after{bottom:0;left:-64px;z-index:999;height:4px;width:27px;border-radius:2px 2px 0 0}.mobile-face.iphone5s.landscape .sensor{top:160px;left:calc(100% - 60px);margin-left:0;margin-top:-32px}.mobile-face.iphone5s.landscape .speaker{height:64px;width:10px;left:calc(100% - 60px);top:50%;margin-left:0;margin-top:-32px}.mobile-face.iphone5s.landscape .camera{left:calc(100% - 32px);top:50%;margin-left:0;margin-top:-5px}.mobile-face.iphone5s.landscape .home{left:19px;bottom:50%;margin-bottom:-34px;margin-left:0}.mobile-face.iphone5s.landscape .top-bar{left:70px;top:0;width:3px;height:100%}.mobile-face.iphone5s.landscape .bottom-bar{right:70px;left:auto;bottom:0;width:3px;height:100%}.mobile-face.iphone5s.silver{background:#bcbcbc}.mobile-face.iphone5s.silver:before{background:#fcfcfc}.mobile-face.iphone5s.silver .sleep,.mobile-face.iphone5s.silver .volume{background:#d6d6d6}.mobile-face.iphone5s.silver .bottom-bar,.mobile-face.iphone5s.silver .top-bar{background:#eaebec}.mobile-face.iphone5s.silver .home{box-shadow:inset 0 0 0 4px #bcbcbc}.mobile-face.iphone5s.gold{background:#f9e7d3}.mobile-face.iphone5s.gold:before{background:#fcfcfc}.mobile-face.iphone5s.gold .sleep,.mobile-face.iphone5s.gold .volume{background:#f9e7d3}.mobile-face.iphone5s.gold .bottom-bar,.mobile-face.iphone5s.gold .top-bar{background:#fff}.mobile-face.iphone5s.gold .home{box-shadow:inset 0 0 0 4px #f9e7d3}.mobile-face.nexus5{padding:50px 15px;width:320px;height:568px;background:#1e1e1e;border-radius:20px}.mobile-face.nexus5:before{border-radius:600px/50px;background:inherit;content:'';position:absolute;height:103.1%;width:calc(100% - 26px);top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%)}.mobile-face.nexus5 .top-bar{width:calc(100% - 8px);height:calc(100% - 6px);position:absolute;top:3px;left:4px;border-radius:20px;background:#181818}.mobile-face.nexus5 .top-bar:before{border-radius:600px/50px;background:inherit;content:'';position:absolute;height:103%;width:calc(100% - 26px);top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%)}.mobile-face.nexus5 .bottom-bar{display:none}.mobile-face.nexus5 .sleep{width:3px;position:absolute;left:-3px;top:110px;height:100px;background:inherit;border-radius:2px 0 0 2px}.mobile-face.nexus5 .volume{width:3px;position:absolute;right:-3px;top:70px;height:45px;background:inherit;border-radius:0 2px 2px 0}.mobile-face.nexus5 .camera{background:#3c3d3d;width:10px;height:10px;position:absolute;top:18px;left:50%;z-index:3;margin-left:-5px;border-radius:100%}.mobile-face.nexus5 .camera:before{background:#3c3d3d;width:6px;height:6px;content:'';display:block;position:absolute;top:2px;left:-100px;z-index:3;border-radius:100%}.mobile-face.nexus5.landscape{padding:15px 50px;height:320px;width:568px}.mobile-face.nexus5.landscape:before{width:103.1%;height:calc(100% - 26px);border-radius:50px/600px}.mobile-face.nexus5.landscape .top-bar{left:3px;top:4px;height:calc(100% - 8px);width:calc(100% - 6px)}.mobile-face.nexus5.landscape .top-bar:before{width:103%;height:calc(100% - 26px);border-radius:50px/600px}.mobile-face.nexus5.landscape .sleep{height:3px;width:100px;left:calc(100% - 210px);top:-3px;border-radius:2px 2px 0 0}.mobile-face.nexus5.landscape .volume{height:3px;width:45px;right:70px;top:100%;border-radius:0 0 2px 2px}.mobile-face.nexus5.landscape .camera{top:50%;left:calc(100% - 18px);margin-left:0;margin-top:-5px}.mobile-face.nexus5.landscape .camera:before{top:-100px;left:2px}.mobile-face.ipad{width:576px;height:768px;padding:90px 25px;background:#242324;border-radius:44px}.mobile-face.ipad:before{width:calc(100% - 8px);height:calc(100% - 8px);position:absolute;content:'';display:block;top:4px;left:4px;border-radius:40px;background:#1e1e1e}.mobile-face.ipad .camera{background:#3c3d3d;width:10px;height:10px;position:absolute;top:44px;left:50%;margin-left:-5px;border-radius:100%}.mobile-face.ipad .bottom-bar,.mobile-face.ipad .top-bar{display:none}.mobile-face.ipad .home{background:#242324;border-radius:36px;width:50px;height:50px;position:absolute;left:50%;margin-left:-25px;bottom:22px}.mobile-face.ipad .home:after{width:15px;height:15px;margin-top:-8px;margin-left:-8px;border:1px solid rgba(255,255,255,.1);border-radius:4px;position:absolute;display:block;content:'';top:50%;left:50%}.mobile-face.ipad.landscape{height:576px;width:768px;padding:25px 90px}.mobile-face.ipad.landscape .camera{left:calc(100% - 44px);top:50%;margin-left:0;margin-top:-5px}.mobile-face.ipad.landscape .home{top:50%;left:22px;margin-left:0;margin-top:-25px}.mobile-face.ipad.silver{background:#bcbcbc}.mobile-face.ipad.silver:before{background:#fcfcfc}.mobile-face.ipad.silver .home{background:#fcfcfc;box-shadow:inset 0 0 0 1px #bcbcbc}.mobile-face.ipad.silver .home:after{border:1px solid rgba(0,0,0,.2)}.mobile-face.macbook{width:960px;height:600px;padding:44px 44px 76px;margin:0 auto;background:#bebebe;border-radius:34px}.mobile-face.macbook:before{width:calc(100% - 8px);height:calc(100% - 8px);position:absolute;content:'';display:block;top:4px;left:4px;border-radius:30px;background:#1e1e1e}.mobile-face.macbook .top-bar{width:calc(100% + 2 * 70px);height:40px;position:absolute;content:'';display:block;top:680px;left:-70px;border-bottom-left-radius:90px 18px;border-bottom-right-radius:90px 18px;background:#bebebe;box-shadow:inset 0 -4px 13px 3px rgba(34,34,34,.6)}.mobile-face.macbook .top-bar:before{width:100%;height:24px;content:'';display:block;top:0;left:0;background:#f0f0f0;border-bottom:2px solid #aaa;border-radius:5px;position:relative}.mobile-face.macbook .top-bar:after{width:16%;height:14px;content:'';display:block;top:0;background:#ddd;position:absolute;margin-left:auto;margin-right:auto;left:0;right:0;border-radius:0 0 20px 20px;box-shadow:inset 0 -3px 10px #999}.mobile-face.macbook .bottom-bar{background:0 0;width:calc(100% + 2 * 70px);height:26px;position:absolute;content:'';display:block;top:680px;left:-70px}.mobile-face.macbook .bottom-bar:after,.mobile-face.macbook .bottom-bar:before{height:calc(100% - 2px);width:80px;content:'';display:block;top:0;position:absolute}.mobile-face.macbook .bottom-bar:before{left:0;background:#f0f0f0;background:linear-gradient(to right,#747474 0,#c3c3c3 5%,#ebebeb 14%,#979797 41%,#f0f0f0 80%,#f0f0f0 100%,#f0f0f0 100%)}.mobile-face.macbook .bottom-bar:after{right:0;background:#f0f0f0;background:linear-gradient(to right,#f0f0f0 0,#f0f0f0 0,#f0f0f0 20%,#979797 59%,#ebebeb 86%,#c3c3c3 95%,#747474 100%)}.mobile-face.macbook .camera{background:#3c3d3d;width:10px;height:10px;position:absolute;top:20px;left:50%;margin-left:-5px;border-radius:100%}.mobile-face.macbook .home{display:none}.mobile-face.iphone-x{width:375px;height:812px;padding:26px;background:#fdfdfd;box-shadow:inset 0 0 11px 0 #000;border-radius:66px}.mobile-face.iphone-x .overflow{width:100%;height:100%;position:absolute;top:0;left:0;border-radius:66px;overflow:hidden}.mobile-face.iphone-x .shadow{border-radius:100%;width:90px;height:90px;position:absolute;background:radial-gradient(ellipse at center,rgba(0,0,0,.6) 0,rgba(255,255,255,0) 60%)}.mobile-face.iphone-x .shadow--tl{top:-20px;left:-20px}.mobile-face.iphone-x .shadow--tr{top:-20px;right:-20px}.mobile-face.iphone-x .shadow--bl{bottom:-20px;left:-20px}.mobile-face.iphone-x .shadow--br{bottom:-20px;right:-20px}.mobile-face.iphone-x:before{width:calc(100% - 10px);height:calc(100% - 10px);position:absolute;top:5px;content:'';left:5px;border-radius:61px;background:#000;z-index:1}.mobile-face.iphone-x .inner-shadow{width:calc(100% - 20px);height:calc(100% - 20px);position:absolute;top:10px;overflow:hidden;left:10px;border-radius:56px;box-shadow:inset 0 0 15px 0 rgba(255,255,255,.66);z-index:1}.mobile-face.iphone-x .inner-shadow:before{box-shadow:inset 0 0 20px 0 #fff;width:100%;height:116%;position:absolute;top:-8%;content:'';left:0;border-radius:200px/112px;z-index:2}.mobile-face.iphone-x .screen{border-radius:40px;box-shadow:none}.mobile-face.iphone-x .bottom-bar,.mobile-face.iphone-x .top-bar{width:100%;position:absolute;height:8px;background:rgba(0,0,0,.1);left:0}.mobile-face.iphone-x .top-bar{top:80px}.mobile-face.iphone-x .bottom-bar{bottom:80px}.mobile-face.iphone-x .sleep,.mobile-face.iphone-x .volume,.mobile-face.iphone-x .volume:after,.mobile-face.iphone-x .volume:before{width:3px;background:#b5b5b5;position:absolute}.mobile-face.iphone-x .volume{left:-3px;top:116px;height:32px}.mobile-face.iphone-x .volume:before{height:62px;top:62px;content:'';left:0}.mobile-face.iphone-x .volume:after{height:62px;top:140px;content:'';left:0}.mobile-face.iphone-x .sleep{height:96px;top:200px;right:-3px}.mobile-face.iphone-x .camera{width:6px;height:6px;top:9px;border-radius:100%;position:absolute;left:154px;background:#0d4d71}.mobile-face.iphone-x .speaker{height:6px;width:60px;left:50%;position:absolute;top:9px;margin-left:-30px;background:#171818;border-radius:6px}.mobile-face.iphone-x .notch{position:absolute;width:210px;height:30px;top:26px;left:108px;z-index:4;background:#000;border-bottom-left-radius:24px;border-bottom-right-radius:24px}.mobile-face.iphone-x .notch:after,.mobile-face.iphone-x .notch:before{content:'';height:8px;position:absolute;top:0;width:8px}.mobile-face.iphone-x .notch:after{background:radial-gradient(circle at bottom left,transparent 0,transparent 70%,#000 70%,#000 100%);left:-8px}.mobile-face.iphone-x .notch:before{background:radial-gradient(circle at bottom right,transparent 0,transparent 70%,#000 70%,#000 100%);right:-8px}.mobile-face.iphone-x.landscape{height:375px;width:812px}.mobile-face.iphone-x.landscape .bottom-bar,.mobile-face.iphone-x.landscape .top-bar{width:8px;height:100%;top:0}.mobile-face.iphone-x.landscape .top-bar{left:80px}.mobile-face.iphone-x.landscape .bottom-bar{right:80px;bottom:auto;left:auto}.mobile-face.iphone-x.landscape .sleep,.mobile-face.iphone-x.landscape .volume,.mobile-face.iphone-x.landscape .volume:after,.mobile-face.iphone-x.landscape .volume:before{height:3px}.mobile-face.iphone-x.landscape .inner-shadow:before{height:100%;width:116%;left:-8%;top:0;border-radius:112px/200px}.mobile-face.iphone-x.landscape .volume{bottom:-3px;top:auto;left:116px;width:32px}.mobile-face.iphone-x.landscape .volume:before{width:62px;left:62px;top:0}.mobile-face.iphone-x.landscape .volume:after{width:62px;left:140px;top:0}.mobile-face.iphone-x.landscape .sleep{width:96px;left:200px;top:-3px;right:auto}.mobile-face.iphone-x.landscape .camera{left:9px;bottom:154px;top:auto}.mobile-face.iphone-x.landscape .speaker{width:6px;height:60px;left:9px;top:50%;margin-top:-30px;margin-left:0}.mobile-face.iphone-x.landscape .notch{height:210px;width:30px;left:26px;bottom:108px;top:auto;border-top-right-radius:24px;border-bottom-right-radius:24px;border-bottom-left-radius:0}.mobile-face.iphone-x.landscape .notch:after,.mobile-face.iphone-x.landscape .notch:before{left:0}.mobile-face.iphone-x.landscape .notch:after{background:radial-gradient(circle at bottom right,transparent 0,transparent 70%,#000 70%,#000 100%);bottom:-8px;top:auto}.mobile-face.iphone-x.landscape .notch:before{background:radial-gradient(circle at top right,transparent 0,transparent 70%,#000 70%,#000 100%);top:-8px}.mobile-face.note8{width:400px;height:822px;background:#000;border-radius:34px;padding:45px 10px}.mobile-face.note8 .overflow{width:100%;height:100%;position:absolute;top:0;left:0;border-radius:34px;overflow:hidden}.mobile-face.note8 .speaker{height:8px;width:56px;left:50%;position:absolute;top:25px;margin-left:-28px;background:#171818;z-index:1;border-radius:8px}.mobile-face.note8 .camera{height:18px;width:18px;left:86px;position:absolute;top:18px;background:#212b36;z-index:1;border-radius:100%}.mobile-face.note8 .camera:before{content:'';height:8px;width:8px;left:-22px;position:absolute;top:5px;background:#212b36;z-index:1;border-radius:100%}.mobile-face.note8 .sensors{height:10px;width:10px;left:120px;position:absolute;top:22px;background:#1d233b;z-index:1;border-radius:100%}.mobile-face.note8 .sensors:before{content:'';height:10px;width:10px;left:18px;position:absolute;top:0;background:#1d233b;z-index:1;border-radius:100%}.mobile-face.note8 .more-sensors{height:16px;width:16px;left:285px;position:absolute;top:18px;background:#33244a;box-shadow:0 0 0 2px rgba(255,255,255,.1);z-index:1;border-radius:100%}.mobile-face.note8 .more-sensors:before{content:'';height:11px;width:11px;left:40px;position:absolute;top:4px;background:#214a61;z-index:1;border-radius:100%}.mobile-face.note8 .sleep{width:2px;height:56px;background:#000;position:absolute;top:288px;right:-2px}.mobile-face.note8 .volume{width:2px;height:120px;background:#000;position:absolute;top:168px;left:-2px}.mobile-face.note8 .volume:before{content:'';top:168px;width:2px;position:absolute;left:0;background:#000;height:56px}.mobile-face.note8 .inner{width:100%;height:calc(100% - 8px);position:absolute;top:2px;content:'';left:0;border-radius:34px;border-top:2px solid #9fa0a2;border-bottom:2px solid #9fa0a2;background:#000;z-index:1;box-shadow:inset 0 0 6px 0 rgba(255,255,255,.5)}.mobile-face.note8 .shadow{box-shadow:inset 0 0 60px 0 #fff,inset 0 0 30px 0 rgba(255,255,255,.5),0 0 20px 0 #fff,0 0 20px 0 rgba(255,255,255,.5);height:101%;position:absolute;top:-.5%;content:'';width:calc(100% - 20px);left:10px;border-radius:38px;z-index:5;pointer-events:none}.mobile-face.note8 .screen{border-radius:14px;box-shadow:none}.mobile-face.note8.landscape{height:400px;width:822px;padding:10px 45px}.mobile-face.note8.landscape .speaker{height:56px;width:8px;top:50%;margin-top:-28px;margin-left:0;right:25px;left:auto}.mobile-face.note8.landscape .camera{top:86px;right:18px;left:auto}.mobile-face.note8.landscape .camera:before{top:-22px;left:5px}.mobile-face.note8.landscape .sensors{top:120px;right:22px;left:auto}.mobile-face.note8.landscape .sensors:before{top:18px;left:0}.mobile-face.note8.landscape .more-sensors{top:285px;right:18px;left:auto}.mobile-face.note8.landscape .more-sensors:before{top:40px;left:4px}.mobile-face.note8.landscape .sleep{bottom:-2px;top:auto;right:288px;width:56px;height:2px}.mobile-face.note8.landscape .volume{width:120px;height:2px;top:-2px;right:168px;left:auto}.mobile-face.note8.landscape .volume:before{right:168px;left:auto;top:0;width:56px;height:2px}.mobile-face.note8.landscape .inner{height:100%;width:calc(100% - 8px);left:2px;top:0;border-top:0;border-bottom:0;border-left:2px solid #9fa0a2;border-right:2px solid #9fa0a2}.mobile-face.note8.landscape .shadow{width:101%;height:calc(100% - 20px);left:-.5%;top:10px}"]}]}],e.propDecorators={mobile:[{type:h.Input}],color:[{type:h.Input}],isLandscape:[{type:h.Input}],scale:[{type:h.Input}]},e}(D),De={condition:"AND",rules:[]},Ne={fields:[],styleClasses:{removeIcon:"fa fa-minus",addIcon:"fa fa-plus",button:"btn",buttonGroup:"btn-group",rightAlign:"order-12 ml-auto",switchRow:"d-flex px-2",switchGroup:"d-flex align-items-center",switchRadio:"custom-control-input",switchLabel:"custom-control-label",switchControl:"custom-control custom-radio custom-control-inline",row:"row p-2 m-1",connector:"q-connector",rule:"border",ruleSet:"border",invalidRuleSet:"alert alert-danger",emptyWarning:"text-danger mx-auto",operatorControl:"form-control",operatorControlSize:"col-auto pr-0",fieldControl:"form-control",fieldControlSize:"col-auto pr-0",entityControl:"form-control",entityControlSize:"col-auto pr-0",inputControl:"form-control",inputControlSize:"col-auto"},allowRuleSet:!0},Ae={provide:f.NG_VALUE_ACCESSOR,useExisting:h.forwardRef(function(){return je}),multi:!0},qe={provide:f.NG_VALIDATORS,useExisting:h.forwardRef(function(){return je}),multi:!0},je=function(n){function e(e){var t=n.call(this)||this;return t.changeDetectorRef=e,t.ruleSet={condition:"AND",rules:[]},t.defaultValue=De,t.templateNames={buttonGroup:"buttonGroup",switchGroup:"switchGroup",removeButton:"removeButton",entity:"entity",field:"field",operator:"operator",input:"input",empty:"empty"},t._config={},t}return I(e,n),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},set:function(e){b.CommonsUtils.defaults(this._config,e,Ne),_.debug(this,"查询构造器配置",this._config)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.ruleSet},set:function(e){this.ruleSet=e||{condition:"AND",rules:[]}},enumerable:!0,configurable:!0}),e.prototype.validate=function(e){var t={},n=[],o=!1;return!this.config.allowEmptyRuleSet&&this.checkEmptyRuleInRuleSet(this.value)&&(t.empty="查询定义不能为空.",o=!0),this.validateRulesInRuleSet(this.value,n),n.length&&(t.rules=n,o=!0),o?t:null},e.prototype.ruleSetStyle=function(n){void 0===n&&(n=0);var e=Object.keys(m.THEME_COLORS).filter(function(e,t){return t===n});return 0===e.length&&(e[0]="blue"),{"border-left-width":"5px","border-left-style":"solid","border-left-color":m.THEME_COLORS[e[0]]}},e.prototype.getOperators=function(t){var n=this;if(b.CommonsUtils.isFunction(this.config.operators))return this.config.operators(t);var o=[];return Object.keys(this.config.operators).forEach(function(e){e===t.key&&o.push(n.config.operators[e])}),o},e.prototype.getFields=function(t){return this.config.entities&&t?this.config.fields.filter(function(e){return e&&e.entityKey===t}):this.config.fields},e.prototype.getField=function(t){var e=this.getFields(t.entity);if(e){var n=e.filter(function(e){return e.key===t.field});if(n&&0<n.length)return n[0]}return undefined},e.prototype.getClassNames=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.config.styleClasses,o=e.map(function(e){return n[e]}).filter(function(e){return!!e});return o.length?o.join(" "):null},e.prototype.isInValidRule=function(e){return this.config.allowRuleSet&&e.rules&&0===e.rules.length},e.prototype.getRuleClassName=function(e){var t=this.getClassNames("row","connector","transition");return t+=" "+this.getClassNames(e.condition?"ruleSet":"rule")},e.prototype.getDefaultDataField=function(t){if(!t)return null;if(t.defaultField!==undefined)return this.getDefaultValue(t.defaultField);var e=this.config.fields.filter(function(e){return e&&e.entityKey===t.key});return e&&e.length?e[0]:void 0},e.prototype.getDefaultOperator=function(e){if(e&&e.defaultOperator!==undefined)return this.getDefaultValue(e.defaultOperator);var t=this.getOperators(e);t&&t.length},e.prototype.addRule=function(){var e=this.ruleSet;if(this.config.addRule)this.config.addRule(e);else{var t=this.config.fields[0];e.rules=P(e.rules,[{field:t.key,entity:t.entityKey,operator:this.getDefaultOperator(t),value:this.getDefaultValue(t.defaultValue)}])}},e.prototype.addRuleSet=function(){var e=this.ruleSet;this.config.addRuleSet?this.config.addRuleSet(e):e.rules=P(e.rules,[{condition:"AND",rules:[]}])},e.prototype.removeRule=function(t){var e=this.ruleSet;this.config.removeRule?this.config.removeRule(t,e):e.rules=e.rules.filter(function(e){return e!==t})},e.prototype.removeRuleSet=function(t){t=t||this.ruleSet;var e=this.parentRuleSet;this.config.removeRuleSet?this.config.removeRuleSet(t,e):e.rules=e.rules.filter(function(e){return e!==t})},e.prototype.changeCondition=function(e){this.ruleSet.condition=e},e.prototype.changeField=function(e,t){var n=this.config.fields[e];n&&n.defaultValue!==undefined?t.value=this.getDefaultValue(n.defaultValue):delete t.value,t.operator=this.getDefaultOperator(n)},e.prototype.changeEntity=function(e,t){this.disabled},e.prototype.getDefaultValue=function(e){switch(typeof e){case"function":return e();default:return e}},e.prototype.context=function(e){return E({qb:this},e)},e.prototype.checkEmptyRuleInRuleSet=function(e){var t=this;return!e||!e.rules||0===e.rules.length||e.rules.some(function(e){return!!e.rules&&t.checkEmptyRuleInRuleSet(e)})},e.prototype.validateRulesInRuleSet=function(o,i){var r=this;o&&o.rules&&0<o.rules.length&&o.rules.forEach(function(e){if(e.rules)return r.validateRulesInRuleSet(e,i);if(e.field){var t=r.config.fields[e.field];if(t&&t.validator&&t.validator.apply){var n=t.validator(e,o);null!=n&&i.push(n)}}})},e.decorators=[{type:h.Component,args:[{selector:"er-query-builder",template:'<div [ngStyle]="ruleSetStyle(index)" class="ruleSet">\n  <div [ngClass]="getClassNames(\'switchRow\')">\n    <ng-container *ngIf="templates[templateNames.buttonGroup] as customer; else defaultButtonGroup">\n      <div [ngClass]="getClassNames(\'buttonGroup\', \'rightAlign\')">\n        <ng-container *ngTemplateOutlet="customer; context: context()"></ng-container>\n      </div>\n    </ng-container>\n\n    <ng-container *ngIf="templates[templateNames.switchGroup] as customer; else defaultSwitchGroup">\n      <ng-container *ngTemplateOutlet="customer; context: context()"></ng-container>\n    </ng-container>\n  </div>\n  <ul [ngClass]="getClassNames(\'tree\')" *ngIf="ruleSet && ruleSet.rules">\n    <ng-container *ngFor="let rule of ruleSet.rules; let index = index">\n\n      <li [ngClass]="getRuleClassName(rule)">\n\n        <ng-container *ngIf="!rule[\'condition\']">\n          <er-query-builder-rule [rule]="rule" [ruleIndex]="index"></er-query-builder-rule>\n        </ng-container>\n\n        <ng-container *ngIf="rule[\'condition\']">\n          <er-query-builder [config]="config" [ruleSet]="rule" [parentRuleSet]="ruleSet" [index]="index">\n          </er-query-builder>\n        </ng-container>\n\n        <ng-container *ngIf="templates[templateNames.empty] as customer; else defaultEmptyWarning">\n          <ng-container *ngIf="isInValidRule(rule)">\n            <ng-container *ngTemplateOutlet="customer; context: context()"></ng-container>\n          </ng-container>\n        </ng-container>\n\n        <ng-template #defaultEmptyWarning>\n          <p [ngClass]="getClassNames(\'emptyWarning\')" *ngIf="isInValidRule(rule)"\n             [innerHTML]="config.emptyMessage|erSafeHtml">\n          </p>\n        </ng-template>\n\n      </li>\n    </ng-container>\n  </ul>\n</div>\n<ng-template #defaultButtonGroup>\n  <div [ngClass]="getClassNames(\'buttonGroup\', \'rightAlign\')">\n    <button (click)="addRule()" [ngClass]="getClassNames(\'button\')" [disabled]=disabled>\n      <i [ngClass]="getClassNames(\'addIcon\')"></i> 条件\n    </button>\n    <button (click)="addRuleSet()" [ngClass]="getClassNames(\'button\')" *ngIf="config.allowRuleSet"\n            [disabled]=disabled>\n      <i [ngClass]="getClassNames(\'addIcon\')"></i> 条件组\n    </button>\n    <ng-container *ngIf="!!parentRuleSet && config.allowRuleSet">\n      <button (click)="removeRuleSet()" [ngClass]="getClassNames(\'button\', \'removeButton\')"\n              [disabled]=disabled>\n        <i [ngClass]="getClassNames(\'removeIcon\')"></i>\n      </button>\n    </ng-container>\n  </div>\n</ng-template>\n\n<ng-template #defaultSwitchGroup>\n  <div [ngClass]="getClassNames(\'switchGroup\', \'transition\')" *ngIf="ruleSet">\n    <div [ngClass]="getClassNames(\'switchControl\')">\n      <input type="radio" [ngClass]="getClassNames(\'switchRadio\')" [(ngModel)]="ruleSet.condition"\n             [disabled]=disabled\n             value="and" #andOption/>\n      <label (click)="changeCondition(andOption.value)" [ngClass]="getClassNames(\'switchLabel\')">并且</label>\n    </div>\n    <div [ngClass]="getClassNames(\'switchControl\')">\n      <input type="radio" [ngClass]="getClassNames(\'switchRadio\')" [(ngModel)]="ruleSet.condition"\n             [disabled]=disabled\n             value="or" #orOption/>\n      <label (click)="changeCondition(orOption.value)" [ngClass]="getClassNames(\'switchLabel\')">或者</label>\n    </div>\n    <div [ngClass]="getClassNames(\'switchControl\')">\n      <input type="radio" [ngClass]="getClassNames(\'switchRadio\')" [(ngModel)]="ruleSet.condition"\n             [disabled]=disabled\n             value="not" #notOption/>\n      <label (click)="changeCondition(notOption.value)" [ngClass]="getClassNames(\'switchLabel\')">不是</label>\n    </div>\n  </div>\n</ng-template>\n\n\n',providers:[Ae,qe],changeDetection:h.ChangeDetectionStrategy.OnPush,styles:["@charset \"UTF-8\";:host::ng-deep{display:block;width:100%;font-size:.8em}:host::ng-deep .q-icon{font-style:normal;font-size:12px}:host::ng-deep .q-remove-icon::before{content:'❌'}:host::ng-deep .q-add-icon{color:#555}:host::ng-deep .q-add-icon::before{content:'➕'}:host::ng-deep .q-remove-button{color:#b3415d;width:31px}:host::ng-deep .q-button-group,:host::ng-deep .q-switch-group{overflow:hidden}:host::ng-deep .q-right-align{float:right}:host::ng-deep .q-button{margin-left:8px;padding:0 8px;background-color:#fff}:host::ng-deep .q-button:disabled{display:none}:host::ng-deep .q-control-size{display:inline-block;vertical-align:top;padding-right:10px}:host::ng-deep .q-entity-control,:host::ng-deep .q-field-control,:host::ng-deep .q-input-control,:host::ng-deep .q-operator-control{display:inline-block;padding:5px 8px;color:#555;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;box-sizing:border-box;width:auto}:host::ng-deep .q-entity-control:disabled,:host::ng-deep .q-field-control:disabled,:host::ng-deep .q-input-control:disabled,:host::ng-deep .q-operator-control:disabled{border-color:transparent}:host::ng-deep .q-entity-control,:host::ng-deep .q-field-control,:host::ng-deep .q-input-control:not([type=checkbox]),:host::ng-deep .q-operator-control{min-height:32px;-webkit-appearance:none}:host::ng-deep .q-button,:host::ng-deep .q-switch-label{float:left;margin-bottom:0;font-size:14px;line-height:30px;font-weight:400;text-align:center;text-shadow:none;border:1px solid rgba(0,0,0,.2);box-sizing:border-box}:host::ng-deep .q-button:hover,:host::ng-deep .q-switch-label:hover{cursor:pointer;background-color:#f0f0f0}:host::ng-deep .q-switch-label{background-color:#e4e4e4;padding:0 8px}:host::ng-deep .q-switch-radio{position:absolute;clip:rect(0,0,0,0);height:1px;width:1px;border:0;overflow:hidden}:host::ng-deep .q-switch-radio:checked+.q-switch-label{border:1px solid #619ed7;background:#fff;color:#3176b3}:host::ng-deep .q-switch-radio:disabled+.q-switch-label{display:none}:host::ng-deep .q-switch-radio:checked:disabled+.q-switch-label{display:initial;color:initial;cursor:default;border-color:transparent}:host::ng-deep .q-invalid-ruleset{border:1px solid rgba(179,65,93,.5)!important;background:rgba(179,65,93,.1)!important}:host::ng-deep .q-empty-warning{color:#8d252e;text-align:center}:host::ng-deep .q-ruleset{border:1px solid #ccc}:host::ng-deep .q-rule{border:1px solid #ccc;background:#fff}:host::ng-deep .q-transition{transition:.1s ease-in-out}:host::ng-deep .q-tree{list-style:none;margin:4px 0 2px}:host::ng-deep .q-row{padding:6px 8px;margin-top:6px}:host::ng-deep .q-connector{position:relative}:host::ng-deep .q-connector::before{top:-5px;border-width:0 0 2px 2px}:host::ng-deep .q-connector::after{border-width:0 0 0 2px;top:50%}:host::ng-deep .q-connector::after,:host::ng-deep .q-connector::before{content:'';left:-12px;border-color:#ccc;border-style:solid;width:9px;height:calc(50% + 6px);position:absolute}:host::ng-deep .q-connector:last-child::after{content:none}:host::ng-deep .q-inline-block-display{display:inline-block;vertical-align:top}"]}]}],e.ctorParameters=function(){return[{type:h.ChangeDetectorRef}]},e.propDecorators={ruleSet:[{type:h.Input}],index:[{type:h.Input}],parentRuleSet:[{type:h.Input}],config:[{type:h.Input}],value:[{type:h.Input}]},e}(F),Le=function(n){function e(e){var t=n.call(this)||this;return t.qb=e,t.ruleChange=new h.EventEmitter,t}return I(e,n),Object.defineProperty(e.prototype,"rule",{get:function(){return this._rule},set:function(e){this._rule=e,this.ruleChange.emit(this._rule)},enumerable:!0,configurable:!0}),e.decorators=[{type:h.Component,args:[{selector:"er-query-builder-rule",template:'<div class="d-flex justify-content-between align-items-center rule">\n\n  <div class="badge badge-info rounded-circle">{{ruleIndex+1}}</div>\n\n  <ng-container *ngIf="qb.templates[qb.templateNames.removeButton] as custumer; else defaultRemoveButton">\n    <div [ngClass]="qb.getClassNames(\'buttonGroup\', \'rightAlign\')">\n      <ng-container *ngTemplateOutlet="custumer; context: qb.context({$implicit:rule})"></ng-container>\n    </div>\n  </ng-container>\n\n  <div *ngIf="qb.config.entities?.length > 0" class="q-inline-block-display">\n    <ng-container *ngIf="qb.templates[qb.templateNames.entity] as customer; else defaultEntity">\n      <ng-container *ngTemplateOutlet="customer; context: qb.context({$implicit:rule})"></ng-container>\n    </ng-container>\n  </div>\n\n  <ng-container *ngIf="qb.templates[qb.templateNames.field] as customer; else defaultField">\n    <ng-container *ngTemplateOutlet="customer; context: qb.context({$implicit:rule})"></ng-container>\n  </ng-container>\n\n  <ng-container *ngIf="qb.templates[qb.templateNames.operator] as customer; else defaultOperator">\n    <ng-container *ngTemplateOutlet="customer; context: qb.context({$implicit:rule})"></ng-container>\n  </ng-container>\n\n  <div [ngClass]="qb.getClassNames(\'inputControlSize\')">\n    <ng-container\n      *ngTemplateOutlet="qb.templates[qb.templateNames.input]; context: qb.context({$implicit:rule})"></ng-container>\n  </div>\n\n</div>\n\n<ng-template #defaultRemoveButton>\n  <div [ngClass]="qb.getClassNames(\'removeButtonSize\', \'rightAlign\')">\n    <button [ngClass]="qb.getClassNames(\'button\', \'removeButton\')" (click)="qb.removeRule(rule)"\n            [disabled]=qb.disabled>\n      <i [ngClass]="qb.getClassNames(\'removeIcon\')"></i>\n    </button>\n  </div>\n</ng-template>\n\n<ng-template #defaultEntity>\n  <div [ngClass]="qb.getClassNames(\'entityControlSize\')">\n    <select [ngClass]="qb.getClassNames(\'entityControl\')" [(ngModel)]="rule.entity"\n            (change)="qb.changeEntity($event, rule)" [disabled]="qb.disabled">\n      <option *ngFor="let entity of qb.config.entities" [ngValue]="entity.key">\n        {{entity.label}}\n      </option>\n    </select>\n  </div>\n</ng-template>\n\n<ng-template #defaultField>\n  <div [ngClass]="qb.getClassNames(\'fieldControlSize\')">\n    <select [ngClass]="qb.getClassNames(\'fieldControl\')" [(ngModel)]="rule.field"\n            (change)="qb.changeField($event, rule)" [disabled]="qb.disabled">\n      <option *ngFor="let field of qb.getFields(rule.entity)" [value]="field.key">\n        {{field.label}}\n      </option>\n    </select>\n  </div>\n</ng-template>\n\n<ng-template #defaultOperator>\n  <div [ngClass]="qb.getClassNames(\'operatorControlSize\')">\n    <select [ngClass]="qb.getClassNames(\'operatorControl\')" [(ngModel)]="rule.operator"\n            [disabled]="qb.disabled">\n      <option *ngFor="let operator of qb.getOperators(rule.field)" [value]="operator.value">\n        {{operator.label}}\n      </option>\n    </select>\n  </div>\n</ng-template>\n',changeDetection:h.ChangeDetectionStrategy.OnPush,styles:[".rule:hover{background-color:green}"]}]}],e.ctorParameters=function(){return[{type:je}]},e.propDecorators={ruleIndex:[{type:h.Input}],ruleChange:[{type:h.Output}],rule:[{type:h.Input}]},e}(D),_e=function(n){function e(e){var t=n.call(this)||this;return t.cd=e,t}return I(e,n),e.prototype.ngOnInit=function(){var s=this;this.$subscriptions=H.getActiveRoute().data.subscribe(function(n){if(n.$component){for(var e=H.getActiveRoute(),o=E({},e.snapshot.params||{},e.snapshot.queryParams||{});e&&!e.snapshot.data.$props;)e=e.parent;var t=E({},e.snapshot.data,n);_.debug(s,"路由数据",t);var i=t.$resolvedProps||t.$props;t.$propsKey&&(i=b.CommonsUtils.get(i,t.$propsKey));var r=t.$component;Object.keys(n).forEach(function(e){if(b.CommonsUtils.isFunction(n[e]))n[e]=n[e](i,o,n);else if(b.CommonsUtils.isString(n[e])&&n[e].startsWith(":")){var t=n[e].substring(1);"USER_ID"===t||o[t]&&(i[e]=o[t])}else"$component"!==e&&"$propsKey"!==e&&(i[e]=n[e])}),s.type=r,s.props=i,s.inputs=i.inputs||i||{},s.outputs=i.outputs||{},i.hooks&&(s.hooks=i.hooks,delete i.hooks),i.inputs||i.outputs||(i.$props=b.CommonsUtils.copy(i)),s.cd.detectChanges()}else _.error(s,"没有定义组件类型",n)})},e.prototype.created=function(e){if(!b.CommonsUtils.isEmpty(this.hooks)){var t=$.getConstructor(e),n=t.prototype.ngOnDestroy;$.bindLifeCycles(e.instance,this.hooks,t,n)}},e.decorators=[{type:h.Component,args:[{selector:"er-route-bind",template:'\n    <ndc-dynamic [ndcDynamicComponent]="type"\n                 [ndcDynamicInputs]="inputs"\n                 [ndcDynamicOutputs]="outputs"\n                 (ndcDynamicCreated)="created($event)"\n    >\n    </ndc-dynamic>\n  ',changeDetection:h.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:h.ChangeDetectorRef}]},e}(D),$e=function(){function e(){this.height=300,this.width=300,this.baseUrl="https://open.weixin.qq.com/connect/qrconnect"}return Object.defineProperty(e.prototype,"qrCodeUrl",{get:function(){var e=b.ConfigUtils.getConfig().wechat,t=encodeURIComponent(e.redirect_uri),n=this.baseUrl+"?appid="+e.appid+"&redirect_uri="+t+"&scope="+e.scope+"&response_type=code";return n+=e.style?"&style="+e.style:"",n+=e.self_redirect?"&self_redirect="+e.self_redirect:"",n+=e.href?"&href="+e.href:""},enumerable:!0,configurable:!0}),e.decorators=[{type:h.Component,args:[{selector:"wechat-qrcode",template:'\n    <iframe [src]="qrCodeUrl|erSafeHtml:\'resource\'" [width]="width" [height]="height" scrolling="no" [attr.frameborder]="0"></iframe>\n  '}]}],e.propDecorators={height:[{type:h.Input}],width:[{type:h.Input}]},e}(),He=[ce,fe,Re,Ee,de,he,Pe,Te,ke,Oe,_e,je,Le,le,$e,be];function Me(t,n){return r.Observable.create(function(e){t.addEventListener("animationend",e),setTimeout(e,n)})}var Fe=function(o){function e(e,t){var n=o.call(this,e,t)||this;return n.viewContainer=e,n.animatedIfOnShow=new h.EventEmitter(!1),n.animatedIfOnHide=new h.EventEmitter(!1),n.visible=!1,n.destroyed$=new i.Subject,n}return I(e,o),Object.defineProperty(e.prototype,"erAnimatedIf",{set:function(e){this.visible&&!e?this.hide():!this.visible&&e&&this.show(),this.visible=e},enumerable:!0,configurable:!0}),e.prototype.getContainer=function(){return 0<this.viewContainer.length?this.viewContainer.get(0).rootNodes[0]:null},e.prototype.hide=function(){var e=this,t=this.getContainer();t&&(t.classList.remove("showing"),t.classList.add("hiding"),Me(t,1e3).pipe(C.takeUntil(this.destroyed$)).subscribe(function(){e.ngIf=e.visible,t.classList.remove("hiding")}),this.animatedIfOnHide.emit())},e.prototype.show=function(){this.ngIf=!0;var e=this.getContainer();e&&(e.classList.remove("hiding"),e.classList.add("showing"),Me(e,1e3).pipe(C.takeUntil(this.destroyed$)).subscribe(function(){e.classList.remove("showing")}),this.animatedIfOnShow.emit())},e.prototype.ngOnDestroy=function(){this.destroyed$.next(),this.destroyed$.complete()},e.decorators=[{type:h.Directive,args:[{selector:"[erAnimatedIf]"}]}],e.ctorParameters=function(){return[{type:h.ViewContainerRef},{type:h.TemplateRef}]},e.propDecorators={animatedIfOnShow:[{type:h.Output}],animatedIfOnHide:[{type:h.Output}],erAnimatedIf:[{type:h.Input}]},e}(c.NgIf),Ve=function(){function e(e){this.el=e,this._animations=["fadeIn","fadeInLeft","fadeInRight","fadeInUp","fadeInDown","zoomIn","zoomInLeft","zoomInRight","zoomInUp","slideInDown","slideInLeft","slideInRight","slideInUp"]}return e.prototype.ngOnInit=function(){var e="animated ";this.animation?e+=this.animation:e+=this._animations[b.CommonsUtils.getRandomNumber(this._animations.length-1)],b.DomUtils.addClasses(this.el.nativeElement,e)},e.decorators=[{type:h.Directive,args:[{selector:"[erAnimate]"}]}],e.ctorParameters=function(){return[{type:h.ElementRef}]},e.propDecorators={animation:[{type:h.Input,args:["erAnimate"]}]},e}(),Be=function(i){function e(e,t,n){var o=i.call(this)||this;return o.viewContainerRef=e,o.el=t,o.renderer=n,o}return I(e,i),e.prototype.ngOnInit=function(){if(b.CommonsUtils.isEmptyString(this.template)&&(this.template=this.el.nativeElement.innerHTML),!b.CommonsUtils.isEmptyString(this.template)){this.template=this.template.replace(/\[\[/g,"{{"),this.template=this.template.replace(/]]/g,"}}"),this.componentRef=me.createComponentByTemplate(this.viewContainerRef,this.template);var e=this.el.nativeElement.parentNode;this.renderer.removeChild(e,this.el.nativeElement)}},e.prototype.ngOnDestroy=function(){i.prototype.ngOnDestroy.call(this),this.componentRef&&(this.componentRef.destroy(),this.componentRef=null)},e.decorators=[{type:h.Directive,args:[{selector:"[erDynaTemplate]"}]}],e.ctorParameters=function(){return[{type:h.ViewContainerRef},{type:h.ElementRef},{type:h.Renderer2}]},e.propDecorators={template:[{type:h.Input,args:["erDynaTemplate"]}],context:[{type:h.Input}]},e}(k),Ke=function(n){function e(e){var t=n.call(this)||this;return t.el=e,t.defaultBgColor="yellow",t}return I(e,n),e.prototype.onMouseEnter=function(){this.highlight(this.bgColor||this.defaultBgColor)},e.prototype.onMouseLeave=function(){this.highlight(null)},e.prototype.highlight=function(e){this.el.nativeElement.style.backgroundColor=e},e.decorators=[{type:h.Directive,args:[{selector:"[erFocusHighlight]"}]}],e.ctorParameters=function(){return[{type:h.ElementRef}]},e.propDecorators={bgColor:[{type:h.Input}],onMouseEnter:[{type:h.HostListener,args:["mouseenter"]}],onMouseLeave:[{type:h.HostListener,args:["mouseleave"]}]},e}(k),ze=function(n){function e(e){var t=n.call(this)||this;return t.el=e,t.searchTerm=undefined,t.caseSensitive=!0,t.viewRendered=!1,t.WRAPPER_TOKEN="==--==##",t}return I(e,n),Object.defineProperty(e.prototype,"caseSensitivity",{get:function(){return this.caseSensitive?"":"i"},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){this.highlightSearchTerm()},e.prototype.ngAfterViewInit=function(){this.highlightSearchTerm()},e.prototype.ngAfterViewChecked=function(){this.viewRendered=!0},e.prototype.highlightSearchTerm=function(){this.searchTerm?this.el.nativeElement&&(this.removePreviouslyMarkedTextInNode(),this.markMatchedTextTokens(this.el.nativeElement)):this.viewRendered&&this.removePreviouslyMarkedTextInNode()},e.prototype.markMatchedTextTokens=function(t){var n=this,e=this.getSearchTerm(),o=new RegExp(e,"gmi"),i=this.getUniqueTokenWrappedSearchTerm(),r=new RegExp(i,"gmi");this.traverseHtmlElementsTree(t,function(e){n.traverseNodesInElement(t.childNodes,function(e){return n.wrapUniqueTokensAroundMatchedText(e,o)})}),this.markMatchedTextAndRemoveUniqueTokens(t,r)},e.prototype.markMatchedTextAndRemoveUniqueTokens=function(e,t){var n=this;if(e.innerHTML){var o=e.innerHTML.replace(t,function(e){var t=n.WRAPPER_TOKEN.length;return"<mark>"+e.substr(t,e.length-2*t)+"</mark>"});e.innerHTML=o}},e.prototype.traverseNodesInElement=function(e,t){for(var n=0;n<e.length;n++){var o=e[n];3===o.nodeType&&t(o)}},e.prototype.wrapUniqueTokensAroundMatchedText=function(e,t){var n=e.nodeValue.replace(t,this.WRAPPER_TOKEN+"$&"+this.WRAPPER_TOKEN);e.nodeValue=n},e.prototype.traverseHtmlElementsTree=function(e,t){e&&t(e);for(var n=0;n<e.children.length;n++){var o=e.children[n];this.markMatchedTextTokens(o)}},e.prototype.removePreviouslyMarkedTextInNode=function(){var e=this.el.nativeElement,t=new RegExp("<mark>|</mark>","g"),n=e.innerHTML.replace(t,"");e.innerHTML=n},e.prototype.getSearchTerm=function(){var e=""+this.escapeRegExp(this.searchTerm),t=new RegExp(" ","gm");return e=e.replace(t,"|")},e.prototype.getUniqueTokenWrappedSearchTerm=function(){var e=this.escapeRegExp(this.searchTerm),t=new RegExp(" ","gm");return e=e.replace(t,this.WRAPPER_TOKEN+"|"+this.WRAPPER_TOKEN),e=""+this.WRAPPER_TOKEN+e+this.WRAPPER_TOKEN},e.prototype.escapeRegExp=function(e){return e.replace("/[-[]/{}()*+?.\\^$|]/g","\\$&")},e.decorators=[{type:h.Directive,args:[{selector:"[erHighlight]"}]}],e.ctorParameters=function(){return[{type:h.ElementRef}]},e.propDecorators={searchTerm:[{type:h.Input,args:["erHighlight"]}],caseSensitive:[{type:h.Input}]},e}(k),We=function(){function o(){this.openChar="{",this.closeChar="}"}return o.diff=function(e,t){o.instance||(o.instance=new o);var n=o.instance.diffOwnProperties(e,t);return"<pre>"+o.instance.formatChangesToHtml(n)+"</pre>"},o.prototype.diff=function(e,t,n,o){if(e===t)return this.equalObj(e);var i={},r=!0;for(var s in e||(e={}),e)if(!o&&s in t||o&&t&&t.hasOwnProperty(s))if(e[s]===t[s])i[s]=this.equalObj(e[s]);else if(!n&&this.isValidAttr(e[s],t[s])){var a=this.diff(e[s],t[s],n,o);"equal"===a.changed?i[s]=this.equalObj(e[s]):(r=!1,i[s]=a)}else r=!1,i[s]={changed:"primitive change",removed:e[s],added:t[s]};else r=!1,i[s]={changed:"removed",value:e[s]};for(var s in t)(o||s in e)&&(!o||void 0===e||e.hasOwnProperty(s))||(r=!1,i[s]={changed:"added",value:t[s]});return r?this.equalObj(e):{changed:"object change",value:i}},o.prototype.diffOwnProperties=function(e,t,n){return this.diff(e,t,n,!0)},o.prototype.formatToJsonXMLString=function(e,t){var n=[],o=e.value;if("equal"===e.changed)return this.inspect(o,t);for(var i in o)n.push(this.formatChange(i,o[i],t));return"<span>"+this.openChar+'</span>\n<div class="diff-level">'+n.join("<span>,</span>\n")+"\n</div><span>"+this.closeChar+"</span>"},o.prototype.formatToJson=function(e,t){return this.inspect(e,t)},o.prototype.formatChangesToHtml=function(e,t){var n=[];if("equal"===e.changed)return"";var o=e.value;for(var i in o){"equal"!==o[i].changed&&n.push(this.formatChange(i,o[i],t,!0))}return"<span>"+this.openChar+'</span>\n<div class="diff-level">'+n.join("<span>,</span>\n")+"\n</div><span>"+this.closeChar+"</span>"},o.prototype.equalObj=function(e){return{changed:"equal",value:e}},o.prototype.isValidAttr=function(e,t){var n=typeof e,o=typeof t;return e&&t&&("object"===n||"function"===n)&&("object"===o||"function"===o)},o.prototype.formatChange=function(e,t,n,o){var i;switch(t.changed){case"equal":i=this.stringifyObjectKey(this.escapeHTML(e))+"<span>: </span>"+this.inspect(t.value);break;case"removed":i='<del class="diff">'+this.stringifyObjectKey(this.escapeHTML(e))+"<span>: </span>"+this.inspect(t.value)+"</del>";break;case"added":i='<ins class="diff">'+this.stringifyObjectKey(this.escapeHTML(e))+"<span>: </span>"+this.inspect(t.value)+"</ins>";break;case"primitive change":var r=this.stringifyObjectKey(this.escapeHTML(e))+"<span>: </span>";i='<del class="diff diff-key">'+r+this.inspect(t.removed)+'</del><span>,</span>\n<ins class="diff diff-key">'+r+this.inspect(t.added)+"</ins>";break;case"object change":i=n?"":this.stringifyObjectKey(e)+"<span>: </span>"+(o?this.formatChangesToHtml(t):this.formatToJsonXMLString(t))}return i},o.prototype.stringifyObjectKey=function(e){return/^[a-z0-9_$]*$/i.test(e)?e:JSON.stringify(e)},o.prototype.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},o.prototype.inspect=function(e,t){var a=this;return function p(e,t,n){switch(typeof t){case"object":if(!t){e+="null";break}if(n){e+="[object]";break}var o=Object.keys(t),i=o.length;if(0===i)e+="<span>"+a.openChar+a.closeChar+"</span>";else{e+="<span>"+a.openChar+'</span>\n<div class="diff-level">';for(var r=0;r<i;r++){var s=o[r];e=p(e+a.stringifyObjectKey(a.escapeHTML(s))+"<span>: </span>",t[s]),r<i-1&&(e+="<span>,</span>\n")}e+="\n</div><span>"+a.closeChar+"</span>"}break;case"string":e+=JSON.stringify(a.escapeHTML(t));break;case"undefined":e+="undefined";break;default:e+=a.escapeHTML(String(t))}return e}("",e,t)},o.instance=undefined,o}(),Je=function(o){function e(e,t){var n=o.call(this)||this;return n.el=e,n.cd=t,n.showCurrent=!0,n.openLevel=2,n.showDiff=!1,n}return I(e,o),e.prototype.ngOnChanges=function(n){var o=this;n.model&&(this.model=n.model.currentValue,this.model&&Object.keys(this.model).forEach(function(t){if(o.model[t]instanceof l.BehaviorSubject)o.model[t]=o.model[t].value;else if(o.model[t]instanceof l.Observable)o.model[t].pipe(C.takeUntil(o.destroyed$)).subscribe(function(e){return o.model[t]=e});else if(o.showDiff)try{o.diff=We.diff(n.model.previousValue,n.model.currentValue)}catch(e){}}),this.showJson())},e.prototype.showJson=function(){if(this.el.nativeElement.innerHTML="",this.showCurrent){var e=new s(this.model||{},this.openLevel,{hoverPreviewEnabled:!0});try{(t=e.render()).classList.add("json-viewer"),this.el.nativeElement.appendChild(t)}catch(n){}}var t;this.showDiff&&((t=document.createElement("div")).classList.add("diff-viewer"),t.innerHTML=this.diff,this.el.nativeElement.appendChild(t))},e.decorators=[{type:h.Directive,args:[{selector:"[erJsonViewer]"}]}],e.ctorParameters=function(){return[{type:h.ElementRef},{type:h.ChangeDetectorRef}]},e.propDecorators={model:[{type:h.Input,args:["erJsonViewer"]}],showCurrent:[{type:h.Input,args:["current"]}],openLevel:[{type:h.Input}],showDiff:[{type:h.Input,args:["diff"]}]},e}(k),Ge=function(){function e(e){this.element=e,this.movableEnabled=!1,this.isMoving=!1,this.isHandle=!0}return e.decorators=[{type:h.Directive,args:[{selector:"[movableHandle]"}]}],e.ctorParameters=function(){return[{type:h.ElementRef}]},e.propDecorators={movableEnabled:[{type:h.HostBinding,args:["class.movable-enabled"]}],isMoving:[{type:h.HostBinding,args:["class.movable-moving"]}],movableHandle:[{type:h.Input}],isHandle:[{type:h.HostBinding,args:["class.movable-handle"]}]},e}(),Qe=function(){function t(e){this.height=null,this.width=null,this.containsNumberProp(e,["top","left"])?(this.top=e.top,this.left=e.left,this.containsNumberProp(e,["height","width"])&&(this.height=e.height,this.width=e.width)):this.containsNumberProp(e,["clientY","clientX"])?(this.top=e.clientY,this.left=e.clientX):e.changedTouches&&0<e.changedTouches.length&&e.changedTouches[0]&&this.containsNumberProp(e.changedTouches[0],["clientY","clientX"])&&(this.top=e.changedTouches[0].clientY,this.left=e.changedTouches[0].clientX)}return Object.defineProperty(t.prototype,"bottom",{get:function(){return null===this.height?null:this.top+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return null===this.width?null:this.left+this.width},enumerable:!0,configurable:!0}),t.prototype.minus=function(e){return new t({top:this.top-e.top,left:this.left-e.left,height:this.height,width:this.width})},t.prototype.plus=function(e){return new t({top:this.top+e.top,left:this.left+e.left,height:this.height,width:this.width})},t.prototype.containsNumberProp=function(t,e){return e.every(function(e){return e in t&&"number"==typeof t[e]})},t}(),Ye=function(){function e(e,t){this.element=e,this.cd=t,this.movableConstrained=!0,this.isMoving=!1,this.isHandle=!1,this.isMovable=!0,this.handles=[],this._movableEnabled=!0}return Object.defineProperty(e.prototype,"movableEnabled",{get:function(){return this._movableEnabled},set:function(t){this._movableEnabled=t,0<this.handles.length&&this.handles.forEach(function(e){return e.movableEnabled=t})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movable",{set:function(e){this.movableName=e},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){"static"===this.getStyle(this.element.nativeElement,"position")&&(this.positionStyle="relative",this.cd.detectChanges())},e.prototype.ngAfterContentInit=function(){var t=this;this.allHandles.changes.subscribe(function(e){return t.updateQuery(e)}),this.updateQuery(this.allHandles)},e.prototype.updateQuery=function(e){var t=this;this.handles=e.filter(function(e){return e.movableHandle===t.movableName}),0===this.handles.length&&(this.isHandle=!0),0<this.handles.length&&this.handles.forEach(function(e){return e.movableEnabled=t.movableEnabled})},e.prototype.onMouseDown=function(e){this.startMoving(e)},e.prototype.onMouseUp=function(e){this.stopMoving()},e.prototype.onMouseMove=function(e){this.moveElement(e)},e.prototype.onTouchStart=function(e){this.startMoving(e)},e.prototype.onTouchEnd=function(e){this.stopMoving()},e.prototype.onTouchMove=function(e){this.moveElement(e)},e.prototype.startMoving=function(e){this.isEventInHandle(e)&&this.movableEnabled&&(this.startPosition=new Qe(e).minus(this.getRelativeRect(this.element.nativeElement)),this.isMoving=!0,0<this.handles.length&&this.handles.forEach(function(e){return e.isMoving=!0}),this.cd.detectChanges())},e.prototype.stopMoving=function(){this.isMoving=!1,0<this.handles.length&&this.handles.forEach(function(e){return e.isMoving=!1}),this.cd.detectChanges()},e.prototype.moveElement=function(e){if(this.isMoving){var t=!1,n=new Qe(e).minus(this.startPosition);if(this.movableConstrained){var o=this.element.nativeElement.ownerDocument.getElementById(this.movableConstraint),i=void 0;i=o?new Qe(o.getBoundingClientRect()):this.getViewPos(this.element.nativeElement);var r=new Qe(this.element.nativeElement.getBoundingClientRect()),s=r.minus(this.getRelativeRect(this.element.nativeElement)),a=s.plus(n);a.top>=i.top&&a.bottom<=i.bottom?(this.positionTop=n.top,t=!0):(a.top<i.top&&(this.positionTop=i.minus(s).top,t=!0),a.bottom>i.bottom&&(this.positionTop=i.minus(s).bottom-r.height,t=!0)),a.left>=i.left&&a.right<=i.right?(this.positionLeft=n.left,t=!0):(a.left<i.left&&(this.positionLeft=i.minus(s).left,t=!0),a.right>i.right&&(this.positionLeft=i.minus(s).right-r.width,t=!0))}else this.positionTop=n.top,this.positionLeft=n.left,t=!0;t&&(e.preventDefault(),e.stopPropagation(),this.cd.detectChanges())}},e.prototype.isEventInHandle=function(e){var t=e.target||e.srcElement;if(this.isHandle){for(;t instanceof HTMLElement&&t!==this.element.nativeElement&&t.parentElement;)t=t.parentElement;return this.element.nativeElement===t}return this.handles.some(function(e){for(;t instanceof HTMLElement&&t!==e.element.nativeElement&&t.parentElement;)t=t.parentElement;return e.element.nativeElement===t})},e.prototype.getRelativeRect=function(e){return new Qe({top:this.parseStyleInt(this.getStyle(e,"top"))||0,left:this.parseStyleInt(this.getStyle(e,"left"))||0,height:this.parseStyleInt(this.getStyle(e,"height"))||0,width:this.parseStyleInt(this.getStyle(e,"width"))||0})},e.prototype.parseStyleInt=function(e){return parseInt(e,10)},e.prototype.getStyle=function(e,t){return this.getView(e).getComputedStyle(e,null).getPropertyValue(t)},e.prototype.getView=function(e){var t=e.ownerDocument.defaultView;return t&&!t.opener||(t=window),t},e.prototype.getViewPos=function(e){var t=this.getView(e);return new Qe({top:0,left:0,height:t.innerHeight||e.ownerDocument.documentElement.clientHeight,width:t.innerWidth||e.ownerDocument.documentElement.clientWidth})},e.decorators=[{type:h.Directive,args:[{selector:"[movable]"}]}],e.ctorParameters=function(){return[{type:h.ElementRef},{type:h.ChangeDetectorRef}]},e.propDecorators={movableConstrained:[{type:h.Input}],movableConstraint:[{type:h.Input}],isMoving:[{type:h.HostBinding,args:["class.movable-moving"]}],isHandle:[{type:h.HostBinding,args:["class.movable-handle"]}],positionStyle:[{type:h.HostBinding,args:["style.position"]}],positionTop:[{type:h.HostBinding,args:["style.top.px"]}],positionLeft:[{type:h.HostBinding,args:["style.left.px"]}],isMovable:[{type:h.HostBinding,args:["class.movable"]}],allHandles:[{type:h.ContentChildren,args:[Ge,{descendants:!0}]}],_movableEnabled:[{type:h.HostBinding,args:["class.movable-enabled"]}],movableEnabled:[{type:h.Input}],movable:[{type:h.Input}],onMouseDown:[{type:h.HostListener,args:["mousedown",["$event"]]}],onMouseUp:[{type:h.HostListener,args:["document:mouseup",["$event"]]}],onMouseMove:[{type:h.HostListener,args:["document:mousemove",["$event"]]}],onTouchStart:[{type:h.HostListener,args:["touchstart",["$event"]]}],onTouchEnd:[{type:h.HostListener,args:["document:touchend",["$event"]]}],onTouchMove:[{type:h.HostListener,args:["document:touchmove",["$event"]]}]},e}(),Xe=function(){function e(e,t){this.el=e,this.render=t}return e.prototype.ngAfterViewInit=function(){this.render.addClass(this.el.nativeElement.parentNode,"d-flex"),this.render.addClass(this.el.nativeElement.parentNode,"align-items-center"),this.render.addClass(this.el.nativeElement.parentNode,"justify-content-center"),this.render.addClass(this.el.nativeElement,this.positionClass||"text-center")},e.decorators=[{type:h.Directive,args:[{selector:"[erPosition]"}]}],e.ctorParameters=function(){return[{type:h.ElementRef},{type:h.Renderer2}]},e.propDecorators={positionClass:[{type:h.Input,args:["erPosition"]}]},e}(),Ze=function(){function e(e){this.el=e}return e.prototype.ngOnInit=function(){var e=this.el.nativeElement,t=e.parentElement;for(this.parentContent?t.innerHTML=this.parentContent:this.parentContent=t.innerHTML;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)},e.decorators=[{type:h.Directive,args:[{selector:"[erInsideOut]"}]}],e.ctorParameters=function(){return[{type:h.ElementRef}]},e}(),et=function(n){function e(e){var t=n.call(this)||this;return t.viewContainerRef=e,t}return I(e,n),Object.defineProperty(e.prototype,"hostComponent",{get:function(){return this.viewContainerRef._data.componentView.component},enumerable:!0,configurable:!0}),e.decorators=[{type:h.Directive,args:[{selector:"[erSelector]"}]}],e.ctorParameters=function(){return[{type:h.ViewContainerRef}]},e.propDecorators={id:[{type:h.Input,args:["erSelector"]}]},e}(k),tt=function(o){function e(e,t){var n=o.call(this)||this;return n.el=e,n.renderer=t,n.position="right",n}return I(e,o),e.prototype.ngOnInit=function(){this.onInit()},e.prototype.ngAfterViewInit=function(){this.spinElement=this.createElement("span",["spinner",this.position,"d-none"]),this.spinnerClass||(this.spinnerClass=b.ConfigUtils.getConfig().onLoading||"fa fa-cog fa-spin fa-spin-2x");var e=this.createElement("i",this.spinnerClass.split(" "));this.renderer.appendChild(this.spinElement,e),this.placeSpin()},e.prototype.placeSpin=function(){var e=this.el.nativeElement;if(e instanceof HTMLDivElement)this.addSpin(e);else if(e instanceof HTMLButtonElement)this.appendChildSpin(e);else if(e instanceof HTMLImageElement)this.replaceWithWrapper();else if(e instanceof HTMLUListElement)this.replaceWithWrapper();else if(e instanceof HTMLInputElement)switch(e.type){case"text":case"file":this.replaceWithWrapper();break;case"checkbox":case"radio":case"button":this.replaceWithWrapper("span");break;default:this.replaceWithWrapper()}else this.replaceWithWrapper()},e.prototype.appendChildSpin=function(e){this.renderer.appendChild(e,this.spinElement)},e.prototype.addSpin=function(e){this.renderer.addClass(e,"spin-container"),this.renderer.removeClass(this.spinElement,this.position),this.renderer.addClass(this.spinElement,"fa-2x"),this.renderer.addClass(this.spinElement,"center"),this.appendChildSpin(e)},e.prototype.replaceWithWrapper=function(e){void 0===e&&(e="div"),this.containerElement=this.createElement(e,["spin-container"]);var t=this.el.nativeElement.parentNode;this.renderer.insertBefore(t,this.containerElement,this.el.nativeElement),this.renderer.removeChild(t,this.el.nativeElement),"div"!==e?(this.renderer.addClass(this.spinElement,"spin-inline"),"left"===this.position&&(this.renderer.appendChild(this.containerElement,this.spinElement),this.renderer.appendChild(this.containerElement,this.el.nativeElement))):(this.renderer.appendChild(this.containerElement,this.el.nativeElement),this.renderer.appendChild(this.containerElement,this.spinElement))},e.prototype.createElement=function(e,t){var n=this,o=this.renderer.createElement(e);return t&&t.forEach(function(e){return n.renderer.addClass(o,e)}),o},e.propDecorators={spinnerClass:[{type:h.Input}],position:[{type:h.Input}]},e}(k),nt=function(n){function e(e,t){return n.call(this,e,t)||this}return I(e,n),e.prototype.onInit=function(){var t=this;this.$subscriptions=b.StatesUtils.observe(m.StateNames.http,this.spinnerTag).subscribe(function(e){e&&e.start?(t.renderer.removeClass(t.spinElement,"d-none"),t.renderer.setAttribute(t.el.nativeElement,"disabled","true"),t.containerElement&&t.renderer.setStyle(t.el.nativeElement,"opacity",.5)):t.spinElement&&(t.renderer.addClass(t.spinElement,"d-none"),t.renderer.removeAttribute(t.el.nativeElement,"disabled"),t.containerElement&&t.renderer.setStyle(t.el.nativeElement,"opacity",1))})},e.decorators=[{type:h.Directive,args:[{selector:"[erHttpState]"}]}],e.ctorParameters=function(){return[{type:h.ElementRef},{type:h.Renderer2}]},e.propDecorators={spinnerTag:[{type:h.Input,args:["erHttpState"]}]},e}(tt),ot=function(n){function e(e,t){return n.call(this,e,t)||this}return I(e,n),e.prototype.onInit=function(){var t=this;this.$subscriptions=this.notifier.subscribe(function(e){e?t.renderer.removeClass(t.spinElement,"d-none"):t.renderer.addClass(t.spinElement,"d-none")})},e.decorators=[{type:h.Directive,args:[{selector:"[erNotifySpinner]"}]}],e.ctorParameters=function(){return[{type:h.ElementRef},{type:h.Renderer2}]},e.propDecorators={notifier:[{type:h.Input,args:["notifySpinner"]}]},e}(tt),it=function(o){function e(e,t){var n=o.call(this)||this;return n.el=e,n.render=t,n}return I(e,o),e.prototype.ngAfterViewInit=function(){b.CommonsUtils.isEmpty(this.color)||this.render.setStyle(this.el.nativeElement,"color",this.color),b.CommonsUtils.isEmpty(this.bg)||this.render.setStyle(this.el.nativeElement,"background-color",this.bg),b.CommonsUtils.isEmpty(this.color)&&b.CommonsUtils.isEmpty(this.bg)&&(this.text||(this.text=this.el.nativeElement.innerHTML),this.render.setStyle(this.el.nativeElement,"background",b.ColorUtils.getColor(this.text)),this.render.setStyle(this.el.nativeElement,"color","white")),this.render.addClass(this.el.nativeElement,"badge-pill"),this.render.addClass(this.el.nativeElement,"badge")},e.decorators=[{type:h.Directive,args:[{selector:"[erTag]"}]}],e.ctorParameters=function(){return[{type:h.ElementRef},{type:h.Renderer2}]},e.propDecorators={text:[{type:h.Input}],bg:[{type:h.Input}],color:[{type:h.Input}]},e}(k),rt=[Ve,Fe,W,O,Be,it,et,Xe,Ze,Ie,Ye,Ge,Je,nt,ot,ze,Ke],st=function(){function e(){this.customerInterceptors=b.ConfigUtils.getConfig().httpInterceptors}return e.prototype.intercept=function(e,t){return t.handle(e)},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[]},e}(),at=function(){function e(){}return e.prototype.intercept=function(e,t){var n=this;return t.handle(e).pipe(C.catchError(function(e){return e instanceof d.HttpErrorResponse?401===e.status?H.nav(b.ConfigUtils.getConfig().auth.loginRouter):403===e.status?b.StatesUtils.create(m.StateNames.notify,{message:"没有操作权限！",level:m.NotifyLevel.ERROR}):n.errorHandler(e):e instanceof l.TimeoutError&&b.StatesUtils.create(m.StateNames.notify,{message:"网络访问超时！",level:m.NotifyLevel.ERROR}),l.throwError(e)}))},e.prototype.errorHandler=function(e){var t="";t=e.error instanceof Error?e.error.message:0===e.status?"网络链接已断开":404===e.status?"请求地址不存在":500===e.status?"服务器程序错误":"数据请求错误",b.StatesUtils.create(m.StateNames.notify,{level:m.NotifyLevel.ERROR,message:t+",错误代码:【"+e.status+"】",title:"网络访问失败"})},e.decorators=[{type:h.Injectable}],e}(),pt=function(){function e(){this.headerName=b.ConfigUtils.getConfig().auth.headerName,this.authScheme=b.ConfigUtils.getConfig().auth.authScheme}return e.prototype.intercept=function(e,t){var n,o=te.getCurrentUser();return o&&o.jwtToken&&(e=e.clone({setHeaders:(n={},n[this.headerName]=""+this.authScheme+o.jwtToken,n)})),t.handle(e)},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[]},e}(),lt=function(){function n(){}return n.start=function(){var e=b.ConfigUtils.getConfig().api.servers.timer;e&&j.request({uri:e.uri,observe:"events"}).pipe(C.first()).subscribe(function(e){var t=e.headers&&e.headers.getAll("Date");t&&(_.info("DateSyncUtils","同步服务器时间",t),t&&0<t.length&&n.updateLocalDate(t[0]))})},n.updateLocalDate=function(e){var t=new Date(e);n.timeServer$.next(t),n.stopSyncSchedule(),n.startRefreshSchedule(),n.startSyncSchedule()},n.stopSyncSchedule=function(){n.interval&&clearInterval(n.interval)},n.startRefreshSchedule=function(){n.interval=setInterval(function(){var e=n.timeServer$.value;e.setSeconds(n.timeServer$.value.getSeconds()+1),n.timeServer$.next(e),b.StatesUtils.create(m.StateNames.serverTime,{date:e},!0)},1e3)},n.startSyncSchedule=function(){setInterval(function(){n.start()},9e5)},n.timeServer$=new l.BehaviorSubject(new Date),n.interval=undefined,n}(),ut=function(){function e(e){this.logService=e}return e.prototype.intercept=function(t,e){var n=this,o=Date.now();return e.handle(t).pipe(C.tap(function(e){if(e instanceof d.HttpResponse){var t=Date.now()-o;b.StatesUtils.set(m.StateNames.httpTimer,{elapsed:t});var n=e.headers.getAll("Date");n&&0<n.length&&lt.updateLocalDate(n[0])}}),C.catchError(function(e){return b.ConfigUtils.getConfig().isProduction||n.logService.debug(n,"网络请求失败！",t.url,e),l.throwError(e)}))},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:L}]},e}(),ct=function(){function e(){this.inProcess=0}return e.prototype.intercept=function(t,e){var n=this;return e.handle(t).pipe(C.tap(function(e){e.type===d.HttpEventType.Sent?b.StatesUtils.update(m.StateNames.rootHttp,{inProcess:++n.inProcess,request:t}):e instanceof d.HttpResponse&&b.StatesUtils.update(m.StateNames.rootHttp,{inProcess:--n.inProcess,request:t})}),C.catchError(function(e){return b.StatesUtils.update(m.StateNames.rootHttp,{inProcess:--n.inProcess,request:t}),l.throwError(e)}))},e.decorators=[{type:h.Injectable}],e}(),dt=function(){function e(){this.timeout=b.ConfigUtils.getConfig().httpTimeout||5e3}return e.prototype.intercept=function(e,t){var n=Number(e.headers.get("timeout"))||this.timeout;return t.handle(e).pipe(C.timeout(n))},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[]},e}();var ht=[{provide:d.HTTP_INTERCEPTORS,useClass:at,multi:!0},{provide:d.HTTP_INTERCEPTORS,useClass:ct,multi:!0},{provide:d.HTTP_INTERCEPTORS,useClass:ut,multi:!0},{provide:d.HTTP_INTERCEPTORS,useClass:dt,multi:!0},{provide:d.HTTP_INTERCEPTORS,useClass:pt,multi:!0},{provide:d.HTTP_INTERCEPTORS,useClass:st,multi:!0}],ft=function(){function e(){}return e.prototype.transform=function(t){var n=[];return Object.keys(t).map(function(e){n.push({key:e,value:t[e]})}),n},e.decorators=[{type:h.Pipe,args:[{name:"erKeyValue"}]}],e}(),gt=function(){function e(){}return e.prototype.transform=function(e){return decodeURIComponent(atob(e))},e.decorators=[{type:h.Pipe,args:[{name:"base64Decode"}]}],e}(),mt=function(){function e(){}return e.prototype.transform=function(e,t){for(var n=/(^[+-]?\d+)(\d{3})/,o=e.toString();n.test(o);)o=o.replace(n,"$1,$2");return o},e.decorators=[{type:h.Pipe,args:[{name:"erCommaSeparatedNumber"}]}],e}(),bt=function(){function e(){}return e.prototype.transform=function(e,t){return e?b.DataItemUtils.transItems(e,t||{}):e},e.decorators=[{type:h.Pipe,args:[{name:"erDataItems"}]}],e}(),yt=function(){function e(){}return e.prototype.transform=function(e,t){return e||t},e.decorators=[{type:h.Pipe,args:[{name:"erDefault"}]}],e}(),vt=[{patterns:[":)",":-)","=)"],unicode:"😃"},{patterns:[":D",":-D","=D"],unicode:"😀"},{patterns:[":(",":-(","=("],unicode:"🙁"},{patterns:[":|",":-|","=|"],unicode:"😐"},{patterns:[":*",":-*","=*"],unicode:"😙"},{patterns:["T_T","T.T"],unicode:"😭"},{patterns:[":O",":-O","=O",":o",":-o","=o"],unicode:"😮"},{patterns:[":P",":-P","=P",":p",":-p","=p"],unicode:"😋"},{patterns:[">.<"],unicode:"😣"},{patterns:["@.@"],unicode:"😵"},{patterns:["*.*"],unicode:"😍"},{patterns:["<3"],unicode:"❤️"},{patterns:["^.^"],unicode:"😊"},{patterns:[":+1"],unicode:"👍"},{patterns:[":-1"],unicode:"👎"}],xt=function(){function e(){}return e.prototype.transform=function(n,e){return void 0===e&&(e=!0),e&&n&&1<n.length&&vt.forEach(function(t){t.patterns.forEach(function(e){n=n.replace(e,t.unicode)})}),n},e.decorators=[{type:h.Pipe,args:[{name:"erEmojify"}]}],e}(),Ct=function(){function e(){}return e.prototype.transform=function(e,t,n){return t?e.filter(function(e){return b.CommonsUtils.isJson(e)?e[t.key]&&-1<e[t.key].toLowerCase().indexOf(t.value.toLowerCase()):e===t}):e},e.decorators=[{type:h.Pipe,args:[{name:"erFilter"}]}],e}(),St=function(){function e(){}return e.prototype.transform=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t&&0<e.length&&e.forEach(function(e){t=t.replace(new RegExp("("+e+")","gi"),'<span class="keyword">$1</span>')}),t},e.decorators=[{type:h.Pipe,args:[{name:"erHighLight"}]}],e}(),wt=function(){function e(){}return e.prototype.transform=function(e,t){var n=b.IdCardUtils.parse(e);return n&&0<Object.keys(n).length?t?n[t]:n:""},e.decorators=[{type:h.Pipe,args:[{name:"idCard"}]}],e}(),It=function(){function e(){}return e.prototype.transform=function(e,t){return b.CommonsUtils.join(e,t)},e.decorators=[{type:h.Pipe,args:[{name:"join"}]}],e}(),Et=function(){function e(){}return e.prototype.transform=function(e,t){return void 0===t&&(t=!0),t&&!b.CommonsUtils.isEmpty(e)?this.linkify(e):e},e.prototype.linkify=function(e,t){if(void 0===t&&(t=!0),t){var n,o,i;return n=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,o=/(^|[^\/])(www\.[\S]+(\b|$))/gim,i=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,e.replace(n,'<a href="$1" target=`${options.target|"_blank"}`>$1</a>').replace(o,'$1<a href="http://$2" target=`${options.target|"_blank"}`>$2</a>').replace(i,'<a href="mailto:$1">$1</a>')}return e},e.decorators=[{type:h.Pipe,args:[{name:"erLinkify",pure:!1}]}],e}(),Rt=function(){function e(){}return e.prototype.transform=function(e){return Object.keys(e)},e.decorators=[{type:h.Pipe,args:[{name:"erKeys"}]}],e}(),Pt=function(){function e(){this.numbers={0:"","00":"","000":"",1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine",10:"ten",11:"eleven",12:"twelve",13:"thirteen",14:"fourteen",15:"fifteen",16:"sixteen",17:"seventeen",18:"eighteen",19:"nineteen",20:"twenty",30:"thirty",40:"forty",50:"fifty",60:"sixty",70:"seventy",80:"eighty",90:"ninety"}}return e.prototype.transform=function(e){var t=[];if("string"!=typeof e&&(e=e.toString()),-1<e.indexOf(",")){var n=new RegExp(",","g");e=e.replace(n,"")}e.length;for(var o="",i=Math.ceil(e.length/3),r=[],s=0;s<i;s++)e=e.length%3==2?(r.push([e[0],e[1]]),e.substring(2)):e.length%3==1?(r.push([e[0]]),e.substring(1)):(r.push([e[0],e[1],e[2]]),e.substring(3));switch(i){case 2:t=["thousand"];break;case 3:t=["million","thousand"];break;case 4:t=["billion","million","thousand"];break;case 5:t=["trillion","billion","million","thousand"]}for(s=0;s<r.length;s++)if(0<t.length){switch(r[s].length){case 1:o+=this.numbers[r[s][0]]+" "+t[0];break;case 2:this.numbers[r[s][0].toString()+r[s][1].toString()]!==undefined?o+=this.numbers[r[s][0].toString()+r[s][1].toString()]+" "+t[0]:o+=this.numbers[r[s][0]+"0"]+" "+this.numbers[r[s][1]]+" "+t[0];break;case 3:if(this.numbers[r[s][0].toString()+r[s][1].toString()+r[s][2].toString()]!==undefined){o=o.substring(0,o.length-1);break}this.numbers[r[s][1].toString()+r[s][2].toString()]!==undefined?r[s][1].toString()+r[s][2].toString()==="00"?o+=this.numbers[r[s][0]]+" hundred "+t[0]:o+=this.numbers[r[s][0]]+" hundred "+this.numbers[r[s][1].toString()+r[s][2].toString()]+" "+t[0]:o+=this.numbers[r[s][0]]+" hundred "+this.numbers[r[s][1]+"0"]+" "+this.numbers[r[s][2]]+" "+t[0]}t.shift(),o+=" "}else switch(r[s].length){case 1:"0"===r[s][0]?o+="zero":o+=this.numbers[r[s][0]];break;case 2:this.numbers[r[s][0].toString()+r[s][1].toString()]!==undefined?o+=this.numbers[r[s][0].toString()+r[s][1].toString()]:o+=this.numbers[r[s][0]+"0"]+" "+this.numbers[r[s][1]];break;case 3:if(this.numbers[r[s][0].toString()+r[s][1].toString()+r[s][2].toString()]!==undefined){o=o.substring(0,o.length-1);break}this.numbers[r[s][1].toString()+r[s][2].toString()]!==undefined?o+=this.numbers[r[s][0]]+" hundred "+this.numbers[r[s][1].toString()+r[s][2].toString()]:o+=this.numbers[r[s][0]]+" hundred "+this.numbers[r[s][1]+"0"]+" "+this.numbers[r[s][2]]}return o},e.decorators=[{type:h.Pipe,args:[{name:"erNumberToText"}]}],e}(),Tt=function(){function e(){}return e.prototype.transform=function(e){return l.of(e)},e.decorators=[{type:h.Pipe,args:[{name:"observable",pure:!1}]}],e}(),kt=function(){function a(){}return a._orderByComparator=function(e,t){try{if(isNaN(parseFloat(e))||!isFinite(e)||isNaN(parseFloat(t))||!isFinite(t)){if(e.toLowerCase()<t.toLowerCase())return-1;if(e.toLowerCase()>t.toLowerCase())return 1}else{if(parseFloat(e)<parseFloat(t))return-1;if(parseFloat(e)>parseFloat(t))return 1}}catch(n){return 1}return 0},a._getDeepValue=function(e,t){var n=t.split("??");if(0<n.length){for(var o=0,i=!1,r="";!i;)(r=s(e,n[o]))!==undefined?i=!0:(o++,n.length===o&&(i=!0));return r}return s(e,t);function s(e,t){if(0<(t=t.split(".")).length){for(var n=0;n<t.length;n++){if(e[t[n]]===undefined){e=undefined;break}e=e[t[n]]}return e}return e[t]}},a.prototype.transform=function(e,t){var n=R(t,1)[0],s=void 0===n?"+":n;if(!Array.isArray(e))return e;if(!Array.isArray(s)||Array.isArray(s)&&1===s.length){var o=Array.isArray(s)?s[0]:s,i="-"===o.substr(0,1);if(o&&"-"!==o&&"+"!==o){var r="+"===o.substr(0,1)||"-"===o.substr(0,1)?o.substr(1):o;return e.sort(function(e,t){return i?-a._orderByComparator(a._getDeepValue(e,r),a._getDeepValue(t,r)):a._orderByComparator(a._getDeepValue(e,r),a._getDeepValue(t,r))})}return i?e.sort().reverse():e.sort()}return e.sort(function(e,t){for(var n=0;n<s.length;n++){var o="-"===s[n].substr(0,1),i="+"===s[n].substr(0,1)||"-"===s[n].substr(0,1)?s[n].substr(1):s[n],r=o?-a._orderByComparator(a._getDeepValue(e,i),a._getDeepValue(t,i)):a._orderByComparator(a._getDeepValue(e,i),a._getDeepValue(t,i));if(0!==r)return r}return 0})},a.decorators=[{type:h.Pipe,args:[{name:"orderBy",pure:!1}]}],a}(),Ut=function(){function e(){}return e.prototype.transform=function(e){return e&&b.CommonsUtils.isNumber(e)?100*e+"%":e},e.decorators=[{type:h.Pipe,args:[{name:"erPercent"}]}],e}(),Ot=function(){function e(e){this.sanitizer=e}return e.prototype.transform=function(e,t){if(!e)return"";switch(t){case"url":return this.sanitizer.bypassSecurityTrustUrl(e);case"resource":return this.sanitizer.bypassSecurityTrustResourceUrl(e);case"style":return this.sanitizer.bypassSecurityTrustStyle(e);case"script":return this.sanitizer.bypassSecurityTrustScript(e);default:return this.sanitizer.bypassSecurityTrustHtml(e)}},e.decorators=[{type:h.Pipe,args:[{name:"erSafeHtml"}]}],e.ctorParameters=function(){return[{type:a.DomSanitizer}]},e}(),Dt=function(){function e(){}return e.prototype.transform=function(e,t){return e?e.split(t||","):[]},e.decorators=[{type:h.Pipe,args:[{name:"split"}]}],e}(),Nt=function(){function e(){}return e.prototype.transform=function(e){return"string"==typeof e?e:JSON.stringify(e)},e.decorators=[{type:h.Pipe,args:[{name:"erStyle"}]}],e}(),At=function(){function e(){}return e.prototype.transform=function(e,t,n){if(e){var o=t||0,i=n;return b.CommonsUtils.isString(e)?(i||(i=e.length),e.substr(o,i)+"..."):b.CommonsUtils.isArray(e)?(i||(i=e.length),e.slice(o,i)):e}},e.decorators=[{type:h.Pipe,args:[{name:"erSub"}]}],e}(),qt=function(){function e(){}return e.prototype.transform=function(e){return b.CommonsUtils.getText(e)},e.decorators=[{type:h.Pipe,args:[{name:"erText"}]}],e}(),jt=function(){function e(){}return e.prototype.transform=function(e){return e||(e=new Date),l.timer(0,1e3).pipe(C.map(function(){return e.setSeconds(e.getSeconds()+1),new Date(e.getTime())}))},e.decorators=[{type:h.Pipe,args:[{name:"erTimer"}]}],e}(),Lt=function(){function e(e){this.cd=e,this.currentNumber=0,this.counter$=new l.BehaviorSubject(0)}return e.prototype.transform=function(e,t){var n=this;return void 0===t&&(t=20),this.currentNumber=e-b.CommonsUtils.getRandomNumber(t),this.counter$.next(this.currentNumber),this.counter$.pipe(C.switchMap(function(e){return l.timer(1e3,200).pipe(C.mapTo(n.positiveOrNegative(e,n.currentNumber)),C.startWith(n.currentNumber),C.scan(function(e,t){return e+t}),C.tap(function(e){return console.log(e)}))})).subscribe(function(){return n.cd.detectChanges()}),this.counter$},e.prototype.positiveOrNegative=function(e,t){return t<e?1:-1},e.prototype.takeUntil=function(t,e){return e<t?function(e){return e<=t}:function(e){return t<=e}},e.decorators=[{type:h.Pipe,args:[{name:"erTracker"}]}],e.ctorParameters=function(){return[{type:h.ChangeDetectorRef}]},e}(),_t=function(){function e(){}return e.prototype.transform=function(e,t){return e?b.TreeUtils.transNodes(e,t):e},e.decorators=[{type:h.Pipe,args:[{name:"erTreeNodes"}]}],e}(),$t=function(){function e(){}return e.prototype.transform=function(e,t){return e!==undefined&&null!==e?b.CommonsUtils.unique(e,t):e},e.decorators=[{type:h.Pipe,args:[{name:"unique"}]}],e}(),Ht=function(){function e(e){this.ele=e}return e.prototype.transform=function(e,t){if(!e)return null;var n,o;"string"==typeof e&&(e=parseFloat(e));for(var i=[{thresholds:1,suffix:""},{thresholds:1e3,suffix:"K"},{thresholds:1e6,suffix:"M"},{thresholds:1e9,suffix:"B"},{thresholds:1e12,suffix:"T"},{thresholds:1e15,suffix:"Q"}],r=i.length-1;0<=r;r--)if(e>=i[r].thresholds){n=e/i[r].thresholds,o=i[r].suffix;break}if(1e3<e)if(t){if(0!==t&&1!==t&&2!==t)throw new Error("must be integer 0, 1 or 2");n=n.toFixed(t)}else n=n<10?n.toFixed(1):n.toFixed(0);else n=0===t||1===t||2===t?n.toFixed(t):Math.round(n);return n+o},e.decorators=[{type:h.Pipe,args:[{name:"erUnitNumber"}]}],e.ctorParameters=function(){return[{type:h.ElementRef}]},e}(),Mt=function(){function e(e,t){this.cd=e,this.ngZone=t}return e.prototype.transform=function(e,t){var n=this,o=b.DateUtils.toDate(e);if(!o)return"";var i=b.DateUtils.getDateByNow(o,t);this.removeTimer();var r=Number.isNaN(i.seconds)?1e3:1e3*b.DateUtils.getUpdateSeconds(i.seconds);return this.timer=this.ngZone.runOutsideAngular(function(){return"undefined"!=typeof window?window.setTimeout(function(){n.ngZone.run(function(){return n.cd.detectChanges()})},r):null}),i.message},e.prototype.ngOnDestroy=function(){this.removeTimer()},e.prototype.removeTimer=function(){this.timer&&(window.clearTimeout(this.timer),this.timer=null)},e.decorators=[{type:h.Pipe,args:[{name:"erUpToNow",pure:!1}]}],e.ctorParameters=function(){return[{type:h.ChangeDetectorRef},{type:h.NgZone}]},e}(),Ft=function(){function e(){}return e.prototype.transform=function(e,t){return b.CommonsUtils.isJson(e)?t?b.CommonsUtils.get(e,t)||"":b.CommonsUtils.toString(e):b.CommonsUtils.toString(e)||""},e.decorators=[{type:h.Pipe,args:[{name:"erValue"}]}],e}(),Vt=[Mt,gt,mt,Et,Pt,Ht,At,xt,wt,Tt,Nt,Ot,St,Ct,Lt,ft,Rt,bt,_t,It,kt,Dt,$t,Nt,qt,Ft,yt,jt,Ut],Bt=function(){function e(){}return e.prototype.canActivate=function(e,t){var n=t.url;return te.checkLogin(n)},e.prototype.canActivateChild=function(e,t){return this.canActivate(e,t)},e.prototype.canLoad=function(e){var t="/"+e.path;return te.checkLogin(t)},e.decorators=[{type:h.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=h.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),Kt=function(){function e(){}return e.prototype.canDeactivate=function(e,t,n){return!e.canDeactivate||e.canDeactivate()},e.decorators=[{type:h.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=h.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),zt=function(){function e(e,t){this.injector=e,this.zone=t,this.logService=e.get(L),this.location=e.get(c.LocationStrategy)}return e.prototype.handleError=function(e){var t=e.message?e.message:e.toString(),n=this.location instanceof c.PathLocationStrategy?this.location.path():"";this.logService.error(this,t,n,b.DomUtils.resolveUserAgent())},e.decorators=[{type:h.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:h.Injector},{type:h.NgZone}]},e.ngInjectableDef=h.defineInjectable({factory:function(){return new e(h.inject(h.INJECTOR),h.inject(h.NgZone))},token:e,providedIn:"root"}),e}(),Wt=function(){function e(){this.preloadedModules=[]}return e.prototype.preload=function(e,t){return e.data&&e.data.preload?(this.preloadedModules.push(e.path),_.debug("Preloaded: ",e.path),t()):l.of(null)},e.decorators=[{type:h.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=h.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),Jt=function(){function e(){}return e.prototype.resolve=function(e,t){var n=e.data;if(n&&!b.CommonsUtils.isEmpty(n)){var o=e.url.map(function(e){return e.path});if(n.$props)return l.of(b.CommonsUtils.get(n.$props,o.join(".")))}return n.resource,l.EMPTY},e.decorators=[{type:h.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=h.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),Gt=function(){function e(){}return e.prototype.resolve=function(e,t){e.data&&e.data.props},e.decorators=[{type:h.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=h.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),Qt=function(){function e(e){var t=this;(this.router=e).events.subscribe(function(e){t.navigationInterceptor(e)})}return e.prototype.navigationInterceptor=function(e){var t=H.getActiveRoute();if(e instanceof g.NavigationStart&&b.StatesUtils.create(m.StateNames.nav,{start:!0,url:t.url,outlet:t.outlet,route:t}),e instanceof g.NavigationEnd){b.StatesUtils.update(m.StateNames.nav,{start:!1,status:"success",url:t.url,outlet:t.outlet,route:t}),b.StatesUtils.update(m.StateNames.currentRoute,{activeRoute:t});var n=t.data&&t.data.title;n&&b.StatesUtils.update(m.StateNames.appTitle,{title:n})}e instanceof g.NavigationCancel&&b.StatesUtils.update(m.StateNames.nav,{start:!1,status:"cancel",url:t.url,outlet:t.outlet,route:t}),e instanceof g.NavigationError&&b.StatesUtils.update(m.StateNames.nav,{start:!1,status:"error",url:t.url,outlet:t.outlet,route:t})},e.decorators=[{type:h.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:g.Router}]},e.ngInjectableDef=h.defineInjectable({factory:function(){return new e(h.inject(g.Router))},token:e,providedIn:"root"}),e}(),Yt=new h.InjectionToken("BACKGROUND_TASK_TOKEN"),Xt=function(){function e(t){void 0===t&&(t=[]);var n=this;this.subs=[],b.StatesUtils.create(m.StateNames.appTitle,b.ConfigUtils.getConfig().appTitle,!0),setTimeout(function(){n.cleanStates();var e=b.CommonsUtils.flatten(t);e&&0<e.length&&e.forEach(function(e){return n.startTask(e)})},2e3)}return e.prototype.updateTitle=function(){this.subs.push(b.StatesUtils.observe(m.StateNames.appTitle).pipe(C.filter(function(e){return e&&e.hasOwnProperty("title")}),C.map(function(e){return e.title}),C.distinctUntilChanged()).subscribe(function(e){q.get(a.Title).setTitle(e)}))},e.prototype.cleanStates=function(){this.subs.push(l.timer(3e4,3e4).subscribe(function(){var t=b.StatesUtils.getStore().value;Object.keys(t).forEach(function(e){t[e]&&!t[e].preserved&&t[e].state&&0===t[e].state.observers.length&&(t=b.CommonsUtils.omit(t,e))}),b.StatesUtils.getStore().next(t)}))},e.prototype.startTask=function(e){if(b.CommonsUtils.isFunction(e))e();else{var t=e,n=t.context;b.CommonsUtils.isFunction(t.context)&&(n=t.context()),t.interval?this.subs.push(l.timer(0,t.interval).subscribe(function(){t.run(n)})):t.run(n)}},e.prototype.ngOnDestroy=function(){this.subs.forEach(function(e){e.unsubscribe()})},e.decorators=[{type:h.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:Array,decorators:[{type:h.Optional},{type:h.Inject,args:[Yt]}]}]},e.ngInjectableDef=h.defineInjectable({factory:function(){return new e(h.inject(Yt,8))},token:e,providedIn:"root"}),e}(),Zt=[L,Gt,Xt,Qt,Bt,Kt,zt,Wt,Jt],en=function(){b.StatesUtils.observe(m.StateNames.appTitle).pipe(C.filter(function(e){return e&&e.hasOwnProperty("title")}),C.map(function(e){return e.title}),C.distinctUntilChanged()).subscribe(function(e){q.get(a.Title).setTitle(e)})},tn=[en],nn=function(){function t(){}return t.getFor=function(e){var t=Reflect.getOwnMetadata("design:type",e);if(!Array.isArray(t))throw Error("Annotations: Annotations not available for type '"+e.name+"'");return t[0]},t.getForDirective=function(e){return t.getFor(e)},t.getForComponent=function(e){return t.getFor(e)},t.getForPipe=function(e){return t.getFor(e)},t}(),on=function(){function o(){}return o.getNextValue=function(e){var t,r=b.CommonsUtils.defaults(e||{},o.DEFAULT_PROPS),n=b.CommonsUtils.getArrayValue(r.query)||[];return r.parent&&n.push(u.termQuery(r.parentKey,r.parent)),z.getByQuery(""+r.apiEntry,{query:n,sort:(t={},t[r.seqKey]=m.Order.DESC,t),size:1}).pipe(C.map(function(e){var t="0".repeat(r.seqLen),n=1;if(0!==e.total){var o=e.items[0];o[r.seqKey]?n=parseInt(o[r.seqKey].replace(/^0+/,""))+1:(b.DialogUtils.error("错误","无法生成新的序列号"),l.throwError("无法生成新的序列号"))}var i=(t+n).slice(-t.length);return r.withParent&&r.parent?r.parent+i:i}))},o.checkDistinct=function(t){return z.fetch(E({},t.apiProps,{size:2})).pipe(C.map(function(e){return!e.items||0===e.items.length||1===e.items.length&&e.items[0].id===t.id}),C.tap(function(e){e||b.DialogUtils.error("验证失败","数值【"+t.apiProps.queryValue+"】已经存在，请修改后再执行本操作！")}))},o.onNodeSelect=function(e,t){var n=e.$from.$props,o=b.CommonsUtils.get(n,"$ext.$container.table.$id");if(o){var i=t,r=e.node.data&&e.node.data.code;r&&b.CommonsUtils.isString(t)&&(i=u.prefixQuery(t,r)),b.StatesUtils.update(o,{query:r?i:u.matchAllQuery()})}},o.DEFAULT_ROOT_SEQ="001",o.DEFAULT_PROPS={parentKey:"parent.code",seqKey:"code",seqLen:3},o}(),rn=function(){function t(){}return t.getFieldDefaultProps=function(e){switch(e.dataAttr){case m.DataAttr.DATA_CODE:return t.getDataCodeFieldProps(e);case m.DataAttr.URL:e.dataType=m.DataType.STRING,e.pattern=m.RegPatterns.url;break;case m.DataAttr.PHONE:e.dataType=m.DataType.STRING,e.pattern=m.RegPatterns.phone;break;case m.DataAttr.ID_CARD:e.dataType=m.DataType.STRING;break;case m.DataAttr.EMAIL:e.dataType=m.DataType.STRING,e.pattern=m.RegPatterns.email;break;case m.DataAttr.CURRENCY:e.defaultValue=0,e.dataType=m.DataType.NUMBER,e.pattern=m.RegPatterns.pNumeric}return e},t.getDefaultFieldName=function(e){if(e)return e.defaultKey?e.defaultKey:e.key},t.getFieldDisplayContent=function(n,o){if(!n)return"";if(o&&b.CommonsUtils.isJson(n)){var e=void 0;if(o&&(e=t.getDefaultFieldName(o)),e)return b.CommonsUtils.get(n,e);var i={};Object.keys(n).forEach(function(e){var t=b.CommonsUtils.get(o,"fields."+e+".label")&&b.CommonsUtils.get(o,"refer.entity."+e+".label")&&b.CommonsUtils.get(o,"refer."+e+".label");t?i[t]=n[e]:i[e]=n[e]}),n=i}return b.CommonsUtils.isBoolean(n)?n?"是":"否":b.CommonsUtils.getText(n)},t.getDataCodeFieldProps=function(e){var t=b.ConfigUtils.getConfig().dataFieldProps.dataCode;if(e.catCode)return{dataType:m.DataType.JSON,sortKey:t.codeKey,aggKey:t.codeKey,defaultKey:t.nameKey,apiDataProps:{apiEntry:t.apiEntry,searchFields:[t.nameKey,t.codeKey,t.abbrKey],returnFields:[t.nameKey,t.codeKey],query:[u.termQuery(t.catKey+".code",e.catCode),t.inUseKey?u.boolQuery().mustNot(u.termQuery(t.inUseKey,!1)):undefined],sort:t.codeKey,size:10},dataItemProps:{labelKey:t.nameKey,valueKey:[t.nameKey,t.codeKey],idKey:t.codeKey,template:function(e){return"<span><b>"+e[t.nameKey]+'</b></span>  <span class="badge badge-info"> '+e[t.codeKey]+"</span> "}}};_.error("DataFieldUtils","dataCode字段没有定义【catCode】属性",e)},t}(),sn=function(){function e(){}return e.getChangeByDiff=function(e){if(!e)return{};var t={changed:[],added:[],deleted:[]};return e&&(e.forEachChangedItem(function(e){t.changed.push({key:e.key,value:e.currentValue,from:e.previousValue})}),e.forEachAddedItem(function(e){t.added.push({key:e.key,value:e.currentValue})}),e.forEachRemovedItem(function(e){t.deleted.push({key:e.key,value:e.previousValue})})),b.CommonsUtils.omitBy(t,b.CommonsUtils.lodash().isEmpty)},e}(),an=function(){function e(){}return e.getConfigs=function(e){var t,n="",o=e.path,i=E({},b.ConfigUtils.getConfig().resources,e);i.root?(o.startsWith("/")?o=o.substr(1):n=i.root,o.endsWith(".json")||(o+=".json")):n=i.uri,t=e.state?e.state:[e.module,e.key];var r=b.StatesUtils.get(t,!0);return!r.value||e.reload?(e.initial&&r.next(e.initial),j.request({uri:n+"/"+o,tag:t,onResponse:function(e){return e?b.CommonsUtils.restoreJsonFn(e):null}}).pipe(C.take(1),C.tap(function(e){return b.StatesUtils.create(t,e,i.reserve||i.state!==undefined)}))):r},e}(),pn=function(){function t(){}return t.parse=function(e){return t.serializer.parse(e.toLowerCase())},t.serialize=function(e){return t.serialize(e)},t.serializer=new g.DefaultUrlSerializer,t}(),ln=function(){function e(){this.storedRouteHandles=new Map,this.allowRetrieveCache={}}return e.prototype.shouldReuseRoute=function(e,t){return this.isInOutlet(e._routerState.url)||this.isInOutlet(t._routerState.url)?e.routeConfig===t.routeConfig:e.routeConfig===t.routeConfig&&!1!==(e.data&&e.data.$reuse)},e.prototype.retrieve=function(e){return this.storedRouteHandles.get(this.getPath(e))},e.prototype.shouldAttach=function(e){var t=this.getPath(e);return!!this.allowRetrieveCache[t]&&this.storedRouteHandles.has(this.getPath(e))},e.prototype.shouldDetach=function(e){var t=this.getPath(e);return!!this.allowRetrieveCache.hasOwnProperty(t)},e.prototype.store=function(e,t){this.storedRouteHandles.set(this.getPath(e),t)},e.prototype.isInOutlet=function(e){return/.*\(.*:.*\).*/.test(e)},e.prototype.getPath=function(e){return null!==e.routeConfig&&null!==e.routeConfig.path?e.routeConfig.path:""},e}(),un=new h.InjectionToken("APP_CONFIG"),cn=function(){function t(e){if(this.injector=e,!q.injector){(q.injector=e).get(Qt),e.get(Xt);try{var t=e.get(y.StompService);t&&b.ConfigUtils.getConfig().stomp.enabled&&t.state.pipe(C.distinctUntilChanged(),C.tap(function(e){b.StatesUtils.update(m.StateNames.socket,{state:m.StompStates[e]}),b.StatesUtils.update(m.StateNames.notify,{type:0===e?m.NotifyType.ANNOUNCE:m.NotifyType.ALERT,message:"消息服务器状态："+m.StompStates[e],level:0===e?m.NotifyLevel.ERROR:m.NotifyLevel.INFO})})).subscribe()}catch(n){}}}return t.forRoot=function(e){return{ngModule:t,providers:P([{provide:un,useValue:e}],ht,[e.stomp.enabled?y.StompService:[],e.stomp.enabled?{provide:y.StompConfig,useValue:e.stomp}:[],{provide:Yt,useValue:lt.start,multi:!0},{provide:Yt,useValue:tn,multi:!0},{provide:g.RouteReuseStrategy,useClass:ln}])}},t.decorators=[{type:h.NgModule,args:[{imports:[c.CommonModule,f.FormsModule,g.RouterModule,d.HttpClientModule,x.NgPipesModule,v.DynamicModule.withComponents(He)],declarations:P(He,rt,Vt),exports:P([c.CommonModule,g.RouterModule,d.HttpClientModule,x.NgPipesModule],He,rt,Vt)}]}],t.ctorParameters=function(){return[{type:h.Injector}]},t}();e.ErCoreModule=cn,e.BaseClass=S,e.Unsubscribe=T,e.BaseDirective=k,e.BaseService=U,e.BaseComponent=D,e.RouteBindComponent=M,e.ControlComponent=F,e.WrapperComponent=V,e.ControlWrapperComponent=B,e.DataAwareControlWrapperComponent=J,e.BaseFormComponent=G,e.AppConfigComponent=ne,e.ModuleConfigComponent=oe,e.AbstractLoginComponent=re,e.AbstractRegisterComponent=ae,e.AbstractChangePwdComponent=pe,e.AuthBaseComponent=ie,e.CoreComponents=He,e.BreadcrumbsComponent=ce,e.StateButtonComponent=de,e.StateButtonsComponent=he,e.DynaContentComponent=Ee,e.ContainerComponent=Pe,e.DataItemComponent=fe,e.HttpStatusComponent=Re,e.FluidContainerComponent=Te,e.LeftRightContainerComponent=ke,e.MobileType=Ue,e.PhonePreviewComponent=Oe,e.RouteDataPropsBindComponent=_e,e.QueryBuilderComponent=je,e.QueryBuilderRuleComponent=Le,e.AnimateNumberComponent=le,e.DynaCompComponent=be,e.JsonViewerDirective=Je,e.ObjectDiff=We,e.CoreDirectives=rt,e.AnimateDirective=Ve,e.ApiDataDirective=W,e.TypedTemplateDirective=O,e.DynaTemplateDirective=Be,e.PropsBindDirective=Ie,e.TagDirective=it,e.SelectorDirective=et,e.PositionDirective=Xe,e.RemoveMeDirective=Ze,e.HttpSpinnerDirective=nt,e.NotifySpinnerDirective=ot,e.HighlightDirective=ze,e.FocusHighlightDirective=Ke,e.MovableHandleDirective=Ge,e.Position=Qe,e.MovableDirective=Ye,e.HttpAppConfiguredInterceptor=st,e.HttpErrorHandlerInterceptor=at,e.HttpJwtAuthInterceptor=pt,e.HttpProgressInterceptor=ct,e.HttpLogInterceptor=ut,e.HttpTimeoutInterceptor=dt,e.CoreInterceptors=ht,e.esBoundInterceptor=function hn(i){return function(t){var n=[],e=b.CommonsUtils.get(t,"body.query");e&&(b.CommonsUtils.get(t,"body.query.bool")||n.push(e)),n=b.CommonsUtils.get(t,"body.query.bool.must",n),b.CommonsUtils.isArray(n)||(n=[n]);var o=i;return b.CommonsUtils.isArray(i)||(o=[i]),o.forEach(function(e){-1===n.indexOf(e)&&(e.toJSON?n.push(e.toJSON()):b.CommonsUtils.isFunction(e)?n.push(e(t)):b.CommonsUtils.isJson(e)&&n.push(e))}),b.CommonsUtils.set(t,"body.query.bool.must",n),console.log(n),t}},e.credentialHttpRequestInterceptor=function fn(){},e.FilterPipe=Ct,e.HighLightPipe=St,e.KeysPipe=Rt,e.SafeHtmlPipe=Ot,e.StylePipe=Nt,e.KeyValuePipe=ft,e.JoinPipe=It,e.ObservablePipe=Tt,e.OrderByPipe=kt,e.IdCardPipe=wt,e.SplitPipe=Dt,e.UniquePipe=$t,e.Base64DecodePipe=gt,e.CommaSeparatedNumberPipe=mt,e.LinkifyPipe=Et,e.NumberToTextPipe=Pt,e.UnitNumberPipe=Ht,e.DataItemsPipe=bt,e.TreeNodesPipe=_t,e.PercentPipe=Ut,e.SubPipe=At,e.TextPipe=qt,e.TimerPipe=jt,e.UpToNowPipe=Mt,e.ValuePipe=Ft,e.DefaultPipe=yt,e.TrackerPipe=Lt,e.EmojifyPipe=xt,e.CorePipes=Vt,e.GlobalErrorHandler=zt,e.AuthGuard=Bt,e.DeactivateGuard=Kt,e.ConfigurablePreloadingStrategy=Wt,e.TaskService=Xt,e.BACKGROUND_TASK_TOKEN=Yt,e.RouterStateService=Qt,e.ResourceResolver=Gt,e.LogService=L,e.PathPropsDataResolver=Jt,e.CoreServices=Zt,e.updateTitleTask=en,e.CORE_TASKS=tn,e.HTTP_STATE$=Q,e.HTTP_TAG_STATE$=Y,e.ROUTE_STATE$=X,e.ROUTE_OUTLET_STATE$=function(t){return b.StatesUtils.observe(m.StateNames.nav).pipe(C.distinctUntilChanged(),C.filter(function(e){return!!e}),C.map(function(e){return e&&e.start&&e.outlet===t}))},e.WEB_SOCKET_STATES=Z,e.AnnotationsUtils=nn,e.DEFAULT_API_REQUEST_OPTIONS=K,e.ApiUtils=z,e.anyRoleUser=function gn(e,t){return te.getCurrentUser().roles?te.getCurrentUser().roles:"NO_ROLE_USER"},e.AuthUtils=te,e.PermissionUtils=ee,e.DateSyncUtils=lt,e.DataUtils=on,e.DataFieldUtils=rn,e.ComponentUtils=$,e.ChangesUtils=sn,e.DiUtils=q,e.LogUtils=_,e.DynaComponentUtils=me,e.HttpUtils=j,e.RouteUtils=H,e.ResourceUtils=an,e.UrlUtils=pn,e.NgAsyncValidator=se,e.FormlyAsyncValidator=function(o){return function(e){var t=o;if(o.query&&b.CommonsUtils.isFunction(o.query)){var n=o.query(e.value);t=E({},t,{query:n})}return z.fetch(t).pipe(C.map(function(e){return!e})).toPromise()}},e.ɵb=$e,e.ɵc=Fe,e.ɵd=tt,e.ɵa=un,e.ɵe=ln,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=er-core.umd.min.js.map