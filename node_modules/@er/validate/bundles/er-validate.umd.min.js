!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@er/types"),require("rxjs"),require("rxjs/internal/BehaviorSubject"),require("@er/utils"),require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("ng2-validation")):"function"==typeof define&&define.amd?define("@er/validate",["exports","@er/types","rxjs","rxjs/internal/BehaviorSubject","@er/utils","@angular/common","@angular/core","@angular/forms","ng2-validation"],e):e((t.er=t.er||{},t.er.validate={}),t.types,t.rxjs,t.rxjs["internal/BehaviorSubject"],t.utils,t.ng.common,t.ng.core,t.ng.forms,t.ng2Validation)}(this,function(t,n,e,r,i,o,s,a,l){"use strict";var u=function(r){return function(t){var e=t.value;return i.DateUtils.isDate(e)?i.CommonsUtils.isAfter(e,r)?null:{dateAfter:{value:e,after:r}}:{dateAfter:{message:"错误的日期格式",value:e}}}},c=function(n,o){return function(t){var e=t.value;if(!e)return null;if(!i.DateUtils.isDate(e))return{age:{message:"错误的日期格式",value:e}};var r=i.CommonsUtils.getAge(e);return 0<n&&r<n||0<o&&o<r?null:{age:{min:n,max:o,value:e}}}},m=function(r){return function(t){var e=t.value;return i.DateUtils.isDate(e)?i.CommonsUtils.isBefore(t.value,r)?null:{dataBefore:{value:e,before:r}}:{dataBefore:{message:"错误的日期格式",value:e}}}},p=function(r,n){return function(t){var e=t.value;return i.DateUtils.isDate(e)?i.CommonsUtils.isBefore(e,r)&&i.CommonsUtils.isAfter(e,n)?null:{dataBetween:{value:e,before:r,after:n}}:{dataBetween:{message:"错误的日期格式",value:e}}}},f=function(e){return function(t){return e(t.value)?null:{condition:{condition:e,value:t.value}}}},g=function(r){void 0===r&&(r=n.RegPatterns.date_yyyymmdd);return function(t){var e=t.value;return!e||e.match(r)?null:{dateFormat:{value:e,format:r}}}},h=function(o){return function(t){for(var e,r=t.parent;r instanceof a.FormGroup&&!(e=i.FormUtils.getFormControl(r,o));)r=r.parent;if(e){var n=t.value;return n===e.value?null:{equalTo:{value:n,controlName:o}}}return null}},d=function(n,o){void 0===o&&(o="match");return function(t){var e,r=t.value;return i.CommonsUtils.isEmptyString(r)?null:i.RegUtils.test(r,n)?null:((e={})[o]={pattern:n,value:r},e)}},y=function(o){return function(t){for(var e,r=t.parent;r instanceof a.FormGroup&&!(e=i.FormUtils.getFormControl(r,o));)r=r.parent;if(e){var n=t.value;return n!==e.value?null:{notEqualTo:{value:n,controlName:o}}}return null}},v=function(t){t||(t={minLength:6,requireLetters:!0,requireNumbers:!0});var e=new C(t);return function(t){return e.validate(t.value)}},C=function(){function t(t){this.options=t,this.letterMatcher=/[a-zA-Z]/,this.lowerCaseLetterMatcher=/[a-z]/,this.upperCaseLetterMatcher=/[A-Z]/,this.numberMatcher=/[0-9]/,this.specialCharactersMatcher=/[-+=_.,:;~`!@#$%^&*(){}<>\[\]"'\/\\]/}return t.prototype.validate=function(t){if(!t)return null;var e={};return 0<this.options.minLength&&t.length<this.options.minLength&&(e.passwordMinLengthRequired={minLength:this.options.minLength}),0<=this.options.maxLength&&t.length>this.options.maxLength&&(e.passwordMaxLengthExceeded={maxLength:this.options.maxLength}),this.options.requireLetters&&!this.letterMatcher.test(t)&&(e.passwordLetterRequired=!0),this.options.requireLowerCaseLetters&&!this.lowerCaseLetterMatcher.test(t)&&(e.passwordLowerCaseLetterRequired=!0),this.options.requireUpperCaseLetters&&!this.upperCaseLetterMatcher.test(t)&&(e.passwordUpperCaseLetterRequired=!0),this.options.requireNumbers&&!this.numberMatcher.test(t)&&(e.passwordNumberRequired=!0),this.options.requireSpecialCharacters&&!this.specialCharactersMatcher.test(t)&&(e.passwordSpecialCharacterRequired=!0),0<Object.keys(e).length?{password:{errors:e,options:this.options}}:null},t}();function b(t){var e=t.options,r=[];return e.minLength&&r.push("最少"+e.minLength+"位"),e.maxLength&&r.push("最多"+e.maxLength+"位"),e.requireLetters&&r.push("包含字母"),e.requireLowerCaseLetters&&r.push("包含小写字母"),e.requireUpperCaseLetters&&r.push("包含大小字母"),e.requireNumbers&&r.push("包含数字"),e.requireSpecialCharacters&&r.push("包含非数字和字母"),"登录密码必须:<br>"+r.join("<br>")}var V=function(){function t(){}return t.letter=function(t){var e=t.value;return i.CommonsUtils.isEmptyString(e)?null:i.RegUtils.test(e,n.RegPatterns.letter)?null:{letter:!0}},t.character=function(t){var e=t.value;return i.CommonsUtils.isEmptyString(e)?null:i.RegUtils.test(e,n.RegPatterns.character)?null:{character:!0}},t.ascii=function(t){var e=t.value;return i.CommonsUtils.isEmptyString(e)?null:i.RegUtils.test(e,n.RegPatterns.ascii)?null:{ascii:!0}},t.chinese=function(t){var e=t.value;return i.CommonsUtils.isEmptyString(e)?null:i.RegUtils.test(e,n.RegPatterns.chinese)?null:{chinese:!0}},t.digit=function(t){var e=t.value;return i.CommonsUtils.isEmptyString(e)?null:i.RegUtils.test(e,n.RegPatterns.digit)?null:{digit:!0}},t.integer=function(t){var e=t.value;return i.CommonsUtils.isEmptyString(e)?null:i.RegUtils.test(e,n.RegPatterns.integer)?null:{integer:!0}},t.numeric=function(t){var e=t.value;return i.CommonsUtils.isEmptyString(e)?null:i.RegUtils.test(e,n.RegPatterns.numeric)?null:{numeric:!0}},t.phone=function(t){var e=t.value;return i.CommonsUtils.isEmptyString(e)?null:i.RegUtils.test(e,n.RegPatterns.phone)?null:{phone:!0}},t.idCard=function(t){var e=t.value;return i.CommonsUtils.isEmptyString(e)?null:i.IdCardUtils.test(e).status?null:{idCard:!0}},t.ip=function(t){var e=t.value;return i.CommonsUtils.isEmptyString(e)?null:i.RegUtils.test(e,n.RegPatterns.ip)?null:{ip:!0}},t.halfWidth=function(t){var e=t.value;return i.CommonsUtils.isEmptyString(e)?null:i.RegUtils.test(e,n.RegPatterns.halfWidth)?null:{halfWidth:!0}},t.fullWidth=function(t){var e=t.value;return i.CommonsUtils.isEmptyString(e)?null:i.RegUtils.test(e,n.RegPatterns.fullWidth)?null:{fullWidth:!0}},t.match=function(t){return d(t)},t.password=function(t){return v(t)},t.before=function(t){return m(t)},t.after=function(t){return u(t)},t.between=function(t,e){return p(t,e)},t.dateFormat=function(t){return g(t)},t.age=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),c(t,e)},t.condition=function(t){return f(t)},t.equalTo=function(t){return h(t)},t.notEqualTo=function(t){return y(t)},t.minLength=function(t){return a.Validators.minLength(t)},t.maxLength=function(t){return a.Validators.maxLength(t)},t.min=function(t){return a.Validators.min(t)},t.max=function(t){return a.Validators.max(t)},t.pattern=function(t){return a.Validators.pattern(t)},t.rangeLength=function(t,e){return l.CustomValidators.rangeLength([t,e])},t.range=function(t,e){return l.CustomValidators.range([t,e])},t.gt=function(t){return l.CustomValidators.gt(t)},t.gte=function(t){return l.CustomValidators.gte(t)},t.lt=function(t){return l.CustomValidators.lt(t)},t.lte=function(t){return l.CustomValidators.lte(t)},t.minDate=function(t){return l.CustomValidators.minDate(t)},t.maxDate=function(t){return l.CustomValidators.maxDate(t)},t.equal=function(t){return l.CustomValidators.equal(t)},t.notEqual=function(t){return l.CustomValidators.notEqual(t)},t.equalTo2=function(t){return l.CustomValidators.equalTo(t)},t.notEqualTo2=function(t){return l.CustomValidators.notEqualTo(t)},t.required=a.Validators.required,t.accept=a.Validators.requiredTrue,t.email=l.CustomValidators.email,t.url=l.CustomValidators.url,t.date=l.CustomValidators.date,t.json=l.CustomValidators.json,t.base64=l.CustomValidators.base64,t.creditCard=l.CustomValidators.creditCard,t}(),E=function(){function t(){}return t.maxlength=function(t){return"长度不能大于<strong>"+t.requiredLength+"</strong>个字"},t.minlength=function(t){return"长度不能少于<strong>"+t.requiredLength+"</strong>个字"},t.min=function(t){return"不能小于<strong>"+t.min+"</strong>"},t.max=function(t){return"不能大于<strong>"+t.max+"</strong>"},t.age=function(t){return"年龄必须介于 "+t.min+" "+t.max},t.password=function(t){return b(t)},t.dateBefore=function(t){return"日期必须在 "+t.before+"之前"},t.dateAfter=function(t){return"日期必须在 "+t.after+"之后"},t.dataBetween=function(t){return"日期必须在 "+t.before+"和"+t.after+"之间"},t.rangeLength=function(t){return"长度必须大于<strong>"+t.max+"</strong>"},t.gt=function(t){return"必须大于<strong>"+t.max+"</strong>"},t.lt=function(t){return"不能大于<strong>"+t.lt+"</strong>"},t.lte=function(t){return"不能大于<strong>"+t.lte+"</strong>"},t.range=function(t){return"不能大于<strong>"+t.lte+"</strong>"},t.minDate=function(t){return"日期不能小于<strong>"+t.minDate+"</strong>"},t.required="此项内容必须填写",t.pattern="格式不符合要求",t.letter="此项内容必须是英文字母",t.digit="此项内容必须是数字",t.character="此项内容必须是英文字母或数字",t.chinese="此项内容必须是简体中文",t.integer="此项内容必须是整数",t.number="此项内容必须是数值",t.fullWidth="此项内容必须是全角",t.halfWidth="此项内容必须是半角",t.phone="手机号码格式不符合要求",t.condition="输入不符合要求",t.email="无效的email地址",t.idCard="无效的身份证号",t.not_matching="密码不匹配",t.unique="该值已经存在",t.gte="输入不符合要求",t.url="地址格式不符合要求",t.date="日期格式不符合要求",t.maxDate="输入不符合要求",t.json="输入不符合要求",t.base64="输入不符合要求",t.equal="两次输入不一致",t.notEqual="两次输入不能一致",t.equalTo="两次输入不一致",t.notEqualTo="两次输入不能一致",t.duplicated="当前值已经存在，不能重复",t.exists="当前值已经存在，不能使用",t}(),F=function(){function s(){}return s.getFormErrors=function(e,r,n){var o={};if(e instanceof a.FormControl)return s.getControlErrors(e,r,n);if(e instanceof a.FormGroup)Object.keys(e.controls).map(function(t){return o[t]=s.getFormErrors(e.controls[t],r,n)});else if(e instanceof a.FormArray){var i=[];return e.controls[name].controls.forEach(function(t){return i.push(s.getFormErrors(t,r,n))}),i}return o},s.getControlErrors=function(t,e,r){return s.getErrorMessage(t.errors,e,r)},s.getErrorMessage=function(r,n,o){var i=this;if(!r)return{};var s={};return Object.keys(r).forEach(function(t){var e;o&&(o.validators&&o.validators[t]&&o.validators[t].message?e=o.validators[t].message:o.asyncValidators&&o.asyncValidators[t]&&o.asyncValidators[t].message&&(e=o.asyncValidators[t].message)),e||(e=n&&n.hasOwnProperty(t)?n[t]:E.hasOwnProperty(t)?E[t]:t),"string"==typeof e?s[t]=e:"function"==typeof e&&(s[t]=e.apply(i,[r[t],o]))}),s},s.dynaValidationMessageFn=function(e,t){var r=[];if(i.CommonsUtils.isJson(e)&&t.errorProps)Array.isArray(t.errorProps)?t.errorProps.forEach(function(t){return r.push(e[t])}):r.push(e[t.errorProps]);else{var n=i.CommonsUtils.get(t,"validation.dyna",[]),o=i.CommonsUtils.find(n,{key:t.errorKey});o&&(r=o.args||[])}return i.CommonsUtils.templateStr(t.format,r)},s}(),R=function(){function t(t){this.controlContainer=t,this.errors$=new e.Subject}return t.prototype.checkFormValidate=function(){this.form.invalid?(alert(),this.errors$.next(F.getFormErrors(this.form,this.messages,this.fields))):this.errors$.next(undefined)},t.prototype.ngOnInit=function(){var t=this;!this.form&&this.controlContainer&&(this.form=this.controlContainer.formDirective?this.controlContainer.formDirective.form:null),this.form&&(this.subscription=this.form.statusChanges.subscribe(function(){t.checkFormValidate()}))},t.prototype.errorKeys=function(t){return Object.keys(t)},t.prototype.errorMsg=function(t){return i.CommonsUtils.getText(t)},t.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},t.decorators=[{type:s.Component,args:[{selector:"er-form-validate-messages",template:'<div *ngIf="errors$|async as errors">\n  <ng-container *ngTemplateOutlet="errorMsgTpl?errorMsgTpl:defaultTpl;context:{$implicit:errors}"></ng-container>\n</div>\n\n<ng-template #defaultTpl let-errors>\n  <div class="text-danger" [ngClass]="styleClass">\n    <ul *ngFor="let key of errorKeys(errors)" class="d-flex flex-column justify-content-start">\n     <li class="my-2">{{key}}</li>\n    </ul>\n  </div>\n</ng-template>',changeDetection:s.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:a.ControlContainer,decorators:[{type:s.Optional}]}]},t.propDecorators={form:[{type:s.Input}],messages:[{type:s.Input}],fields:[{type:s.Input}],styleClass:[{type:s.Input}],errorMsgTpl:[{type:s.ContentChild,args:[s.TemplateRef]}]},t}();function U(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(o)throw o.error}}return s}function q(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(U(arguments[e]));return t}var w=function(){function t(t,e){this.controlContainer=t,this.cd=e,this.showAllErrors=!0,this.errors$=new r.BehaviorSubject(undefined)}return t.prototype.getErrorMessages=function(){if(!this.control.dirty||!this.control.invalid)return this.errors$.next([]);var t=F.getErrorMessage(this.control.errors),e=this.showAllErrors?t:this.getFirstError(t);this.errors$.next(this.getErrors(e))},t.prototype.getFirstError=function(t){return 0<Object.keys(t).length?t[Object.keys(t)[0]]:"校验失败"},t.prototype.getErrors=function(e){var r=this,n=[];return e&&Object.keys(e).map(function(t){n.push({key:t,value:r.messages&&r.messages[t]||e[t]})}),n},t.prototype.ngOnInit=function(){var t=this;if(!this.control&&(this.formlyField&&(this.control=this.formlyField.formControl),!this.control&&this.controlContainer)){var e=this.controlContainer.formDirective?this.controlContainer.formDirective.form:null;e&&(this.control=i.FormUtils.getFormControl.apply(i.FormUtils,q([e],this.controlContainer.path,[this.controlName])))}this.control&&(this.subscription=this.control.statusChanges.subscribe(function(){t.getErrorMessages()}))},t.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},t.decorators=[{type:s.Component,args:[{selector:"er-validate-messages",template:'\n    <div *ngIf="errors$|async as errors">\n      <ng-container *ngTemplateOutlet="errorMsgTpl?errorMsgTpl:defaultTpl;context:{$implicit:errors}"></ng-container>\n    </div>\n    <ng-template #defaultTpl let-errors>\n      <div class="text-danger" [ngClass]="styleClass">\n        <ul *ngFor="let error of errors " class="d-flex flex-column justify-content-start">\n          <li [innerHTML]="error.value" class="my-1" style="font-size: 0.8em"></li>\n        </ul>\n      </div>\n    </ng-template>\n  ',changeDetection:s.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:a.ControlContainer,decorators:[{type:s.Optional}]},{type:s.ChangeDetectorRef}]},t.propDecorators={control:[{type:s.Input}],controlName:[{type:s.Input}],formlyField:[{type:s.Input}],force:[{type:s.Input}],styleClass:[{type:s.Input}],showAllErrors:[{type:s.Input}],messages:[{type:s.Input}],errorMsgTpl:[{type:s.ContentChild,args:[s.TemplateRef]}]},t}(),x=function(){function t(t){this.model=t}return Object.defineProperty(t.prototype,"control",{get:function(){return this.model&&this.model.control?this.model.control:undefined},enumerable:!0,configurable:!0}),t.prototype.onFocus=function(){this.control&&(this.validators=this.control.validator,this.asyncValidators=this.control.asyncValidator,this.control.clearAsyncValidators(),this.control.clearValidators())},t.prototype.onBlur=function(){this.control&&(this.control.setAsyncValidators(this.asyncValidators),this.control.setValidators(this.validators),this.control.updateValueAndValidity())},t.decorators=[{type:s.Directive,args:[{selector:"[erValidateOnBlur]"}]}],t.ctorParameters=function(){return[{type:a.NgControl,decorators:[{type:s.Optional}]}]},t.propDecorators={onFocus:[{type:s.HostListener,args:["focus"]}],onBlur:[{type:s.HostListener,args:["blur"]}]},t}(),L=function(){function t(t,e,r){this.componentFactoryResolver=t,this.viewContainerRef=e,this.ngControl=r,this.showError=!0,this.enableValidation=!0}return Object.defineProperty(t.prototype,"control",{get:function(){return this.ngControl&&this.ngControl.control?this.ngControl.control:undefined},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isValid",{get:function(){return!(!this.showError||!this.ngControl&&null==this.ngControl.control)&&(this.ngControl&&this.ngControl.control&&this.ngControl.control.valid)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isInvalid",{get:function(){return!(!this.showError||!this.ngControl&&null==this.ngControl.control)&&(this.ngControl&&this.ngControl.control&&this.ngControl.control.invalid)},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){if(this.ngControl&&this.enableValidation){var t=this.viewContainerRef.element.nativeElement.attributes;if(t){var e=!!t.getNamedItem("noerror");if(this.showError&&e)return void(this.showError=!1)}this.componentFactory=i.CacheUtils.get("$componentFactory","ValidateMessagesComponentFactory"),this.componentFactory||(this.componentFactory=this.componentFactoryResolver.resolveComponentFactory(w),i.CacheUtils.put("$componentFactory","validationMessagesComponentFactory",this.componentFactory)),this.viewContainerRef.element.nativeElement.parentElement.className.indexOf("input-group"),this.componentRef=this.viewContainerRef.createComponent(this.componentFactory),this.componentRef.instance.messages=this.messages,this.componentRef.instance.control=this.control}},t.decorators=[{type:s.Directive,args:[{selector:"[erValidate]"}]}],t.ctorParameters=function(){return[{type:s.ComponentFactoryResolver},{type:s.ViewContainerRef},{type:a.NgControl,decorators:[{type:s.Optional}]}]},t.propDecorators={messages:[{type:s.Input}],showError:[{type:s.Input}],enableValidation:[{type:s.Input}],isValid:[{type:s.HostBinding,args:["class.er-valid"]}],isInvalid:[{type:s.HostBinding,args:["class.er-invalid"]}]},t}(),M=function(){function t(t,e,r){this.componentFactoryResolver=t,this.viewContainerRef=e,this.ngControl=r,this.showError=!0,this.enableValidation=!0}return Object.defineProperty(t.prototype,"control",{get:function(){return this.ngControl&&this.ngControl.control?this.ngControl.control:undefined},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isValid",{get:function(){return!(!this.showError||!this.ngControl&&null==this.ngControl.control)&&(this.ngControl&&this.ngControl.control&&this.ngControl.control.valid)},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){if(this.ngControl&&this.enableValidation){var t=this.viewContainerRef.element.nativeElement.attributes;if(t){var e=!!t.getNamedItem("noerror");if(this.showError&&e)return void(this.showError=!1)}}},t.decorators=[{type:s.Directive,args:[{selector:"[formControlName],[formControl],[ngModel]"}]}],t.ctorParameters=function(){return[{type:s.ComponentFactoryResolver},{type:s.ViewContainerRef},{type:a.NgControl,decorators:[{type:s.Optional}]}]},t.propDecorators={messages:[{type:s.Input}],showError:[{type:s.Input}],enableValidation:[{type:s.Input}],isValid:[{type:s.HostBinding,args:["class.er-valid"]}]},t}(),D=[L,M,x],j=function(){function t(){}return t.decorators=[{type:s.NgModule,args:[{imports:[o.CommonModule,a.FormsModule,a.ReactiveFormsModule,l.CustomFormsModule],declarations:q([w,R],D),exports:q([a.FormsModule,a.ReactiveFormsModule,w,R],D),entryComponents:[w]}]}],t}();t.ErValidateModule=j,t.NgValidators=V,t.NgValidateMessages=E,t.FormValidateMessagesComponent=R,t.ValidateMessagesComponent=w,t.ValidateUtils=F,t.ValidationMessageDirective=L,t.ValidateStateDirective=M,t.ValidateOnBlurMessageDirective=x,t.directives=D,t.ɵl=w,t.ɵm=R,t.ɵe=u,t.ɵh=c,t.ɵd=m,t.ɵf=p,t.ɵi=f,t.ɵg=g,t.ɵj=h,t.ɵc=d,t.ɵk=y,t.ɵb=b,t.ɵa=v,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=er-validate.umd.min.js.map