!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("@angular/forms"),require("@angular/core"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("@ngx-formly/core",["exports","rxjs","@angular/forms","@angular/core","rxjs/operators","@angular/common"],t):t((e["ngx-formly"]=e["ngx-formly"]||{},e["ngx-formly"].core={}),e.rxjs,e.ng.forms,e.ng.core,e.rxjs.operators,e.ng.common)}(this,function(e,p,a,l,f,o){"use strict";var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function n(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}var u=function(){return(u=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function i(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var r,n,i=o.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)s.push(r.value)}catch(a){n={error:a}}finally{try{r&&!r.done&&(o=i["return"])&&o.call(i)}finally{if(n)throw n.error}}return s}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e}function d(e){var t,o;if(!e._formlyKeyPath||e._formlyKeyPath.key!==e.key){var r=[];if(e.key){var n="string"==typeof e.key?e.key.split("."):e.key;try{for(var i=function l(e){var t="function"==typeof Symbol&&e[Symbol.iterator],o=0;return t?t.call(e):{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}}}(n),s=i.next();!s.done;s=i.next()){"string"==typeof(p=s.value)?(p=p.replace(/\[(\w+)\]/g,".$1"),r=r.concat(p.split("."))):r.push(p)}}catch(f){t={error:f}}finally{try{s&&!s.done&&(o=i["return"])&&o.call(i)}finally{if(t)throw t.error}}for(var a=0;a<r.length;a++){var p;"string"==typeof(p=r[a])&&/^\d+$/.test(p)&&(r[a]=parseInt(p))}}e._formlyKeyPath={key:e.key,path:r}}return e._formlyKeyPath.path.slice(0)}var m=["required","pattern","minLength","maxLength","min","max"];function s(e,t,o){if("string"==typeof t&&(t=d({key:t})),1<t.length){var r=t.shift();e[r]&&C(e[r])||(e[r]="string"==typeof t[0]?{}:[]),s(e[r],t,o)}else e[t[0]]=o}function y(e){for(var t=d(e),o=e.parent.model;o&&0<t.length;){o=o[t.shift()]}return o}function h(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return e.forEach(function(e){for(var t in e)g(n[t])||""===n[t]?b(e[t])?n[t]=e[t]:n[t]=F(e[t]):(o=n[t],r=e[t],C(o)&&C(r)&&Object.getPrototypeOf(o)===Object.getPrototypeOf(r)&&!Array.isArray(o)&&!Array.isArray(r)&&h(n[t],e[t]));var o,r}),n}function g(e){return e===undefined||null===e}function v(e){return e===undefined}function b(e){return"function"==typeof e}function C(e){return null!=e&&"object"==typeof e}function F(t){return!C(t)||t instanceof RegExp||t instanceof p.Observable||t.changingThisBreaksApplicationSecurity?t:t instanceof a.AbstractControl?null:"[object Date]"===Object.prototype.toString.call(t)?new Date(t.getTime()):Array.isArray(t)?t.slice(0).map(function(e){return F(e)}):(t=Object.assign({},t),Object.keys(t).forEach(function(e){return t[e]=F(t[e])}),t)}function x(e,t){e instanceof a.FormArray?e.removeAt(t):e instanceof a.FormGroup&&e.removeControl(""+t)}function O(e,t,o){Object.defineProperty(e,t,{enumerable:!1,writable:!0,configurable:!0}),e[t]=o}var k=new l.InjectionToken("FORMLY_CONFIG"),_=function(){function e(){this.types={},this.validators={},this.wrappers={},this.messages={},this.templateManipulators={preWrapper:[],postWrapper:[]},this.extras={fieldTransform:undefined,showError:function(e){return e.formControl&&e.formControl.invalid&&(e.formControl.touched||e.options.parentForm&&e.options.parentForm.submitted||e.field.validation&&e.field.validation.show)}},this.extensions={}}return e.prototype.addConfig=function(e){var t=this;e.types&&e.types.forEach(function(e){return t.setType(e)}),e.validators&&e.validators.forEach(function(e){return t.setValidator(e)}),e.wrappers&&e.wrappers.forEach(function(e){return t.setWrapper(e)}),e.manipulators&&e.manipulators.forEach(function(e){return t.setManipulator(e)}),e.validationMessages&&e.validationMessages.forEach(function(e){return t.addValidatorMessage(e.name,e.message)}),e.extensions&&e.extensions.forEach(function(e){return t.extensions[e.name]=e.extension}),e.extras&&(this.extras=u({},this.extras,e.extras))},e.prototype.setType=function(t){var o=this;Array.isArray(t)?t.forEach(function(e){return o.setType(e)}):(this.types[t.name]||(this.types[t.name]={}),this.types[t.name].component=t.component,this.types[t.name].name=t.name,this.types[t.name]["extends"]=t["extends"],this.types[t.name].defaultOptions=t.defaultOptions,t.wrappers&&t.wrappers.forEach(function(e){return o.setTypeWrapper(t.name,e)}))},e.prototype.getType=function(e){if(!this.types[e])throw new Error('[Formly Error] There is no type by the name of "'+e+'"');return this.mergeExtendedType(e),this.types[e]},e.prototype.getMergedField=function(o){var r=this;void 0===o&&(o={});var e=this.getType(o.type);e.defaultOptions&&h(o,e.defaultOptions);var t=e["extends"]&&this.getType(e["extends"]).defaultOptions;t&&h(o,t),o&&o.optionsTypes&&o.optionsTypes.forEach(function(e){var t=r.getType(e).defaultOptions;t&&h(o,t)}),this.createComponentInstance(o);var n=o._componentFactory.componentRef;n&&n.instance&&n.instance.defaultOptions&&h(o,n.instance.defaultOptions),!o.wrappers&&e.wrappers&&(o.wrappers=c(e.wrappers))},e.prototype.createComponentInstance=function(e){if(void 0===e&&(e={}),e.type&&(!e._componentFactory||e.type!==e._componentFactory.type)){var t=this.getType(e.type),o=e.parent.options._componentFactoryResolver;O(e,"_componentFactory",{type:e.type,component:t.component,componentRef:o?o.resolveComponentFactory(t.component).create(o._ngModule.injector):null})}},e.prototype.setWrapper=function(t){var o=this;(this.wrappers[t.name]=t).types&&t.types.forEach(function(e){o.setTypeWrapper(e,t.name)})},e.prototype.getWrapper=function(e){if(!this.wrappers[e])throw new Error('[Formly Error] There is no wrapper by the name of "'+e+'"');return this.wrappers[e]},e.prototype.setTypeWrapper=function(e,t){this.types[e]||(this.types[e]={}),this.types[e].wrappers||(this.types[e].wrappers=[]),-1===this.types[e].wrappers.indexOf(t)&&this.types[e].wrappers.push(t)},e.prototype.setValidator=function(e){this.validators[e.name]=e},e.prototype.getValidator=function(e){if(!this.validators[e])throw new Error('[Formly Error] There is no validator by the name of "'+e+'"');return this.validators[e]},e.prototype.addValidatorMessage=function(e,t){this.messages[e]=t},e.prototype.getValidatorMessage=function(e){return this.messages[e]},e.prototype.setManipulator=function(e){(new e["class"])[e.method](this)},e.prototype.mergeExtendedType=function(e){if(this.types[e]["extends"]){var t=this.getType(this.types[e]["extends"]);this.types[e].component||(this.types[e].component=t.component),this.types[e].wrappers||(this.types[e].wrappers=t.wrappers)}},e.decorators=[{type:l.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=l.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),w=function(){function e(e){this.formlyConfig=e}return e.prototype.buildForm=function(e,t,o,r){void 0===t&&(t=[]),this._buildForm({fieldGroup:t,model:o,formControl:e,options:r})},e.prototype._buildForm=function(t){var o=this;this.getExtensions().forEach(function(e){return e.prePopulate&&e.prePopulate(t)}),this.getExtensions().forEach(function(e){return e.onPopulate&&e.onPopulate(t)}),t.fieldGroup&&t.fieldGroup.forEach(function(e){return o._buildForm(e)}),this.getExtensions().forEach(function(e){return e.postPopulate&&e.postPopulate(t)})},e.prototype.getExtensions=function(){var t=this;return Object.keys(this.formlyConfig.extensions).map(function(e){return t.formlyConfig.extensions[e]})},e.decorators=[{type:l.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:_}]},e.ngInjectableDef=l.defineInjectable({factory:function(){return new e(l.inject(_))},token:e,providedIn:"root"}),e}(),E=function(){function e(e,t,o,r,n,i){var s=this;this.formlyBuilder=e,this.formlyConfig=t,this.componentFactoryResolver=o,this.parentForm=r,this.parentFormGroup=n,this.parentFormlyForm=i,this.model={},this.form=new a.FormGroup({}),this.fields=[],this.modelChange=new l.EventEmitter,this.isRoot=!0,this.modelChangeSubs=[],this.enableCheckExprDebounce=!1,this.checkExpressionChange$=this.modelChange.pipe(f.debounceTime(this.enableCheckExprDebounce?100:0),f.tap(function(){s.enableCheckExprDebounce=!0,s.checkExpressionChange(),s.enableCheckExprDebounce=!1})).subscribe()}return e.prototype.ngDoCheck=function(){this.checkExpressionChange()},e.prototype.ngOnChanges=function(e){this.fields&&0!==this.fields.length&&this.isRoot&&(e.fields||e.form||e.model)&&(this.model=this.model||{},this.form=this.form||new a.FormGroup({}),this.setOptions(),this.clearModelSubscriptions(),this.formlyBuilder.buildForm(this.form,this.fields,this.model,this.options),this.trackModelChanges(this.fields),this.options.updateInitialValue())},e.prototype.ngOnDestroy=function(){this.clearModelSubscriptions(),this.checkExpressionChange$.unsubscribe()},e.prototype.changeModel=function(e){s(this.model,e.key,e.value),this.modelChange.emit(this.model)},e.prototype.setOptions=function(){var t=this;if(this.options=this.options||{},this.options.formState=this.options.formState||{},this.options.showError||(this.options.showError=this.formlyConfig.extras.showError),this.options.fieldChanges||(this.options.fieldChanges=new p.Subject),this.options.resetModel||(this.options.resetModel=function(e){e=g(e)?t.initialModel:e,t.model&&(Object.keys(t.model).forEach(function(e){return delete t.model[e]}),Object.assign(t.model,e||{})),t.options._buildForm(),!t.parentFormlyForm&&t.options.parentForm&&t.options.parentForm.control===t.form?t.options.parentForm.resetForm(e):t.form.reset(e)}),this.options.parentForm||(this.options.parentForm=this.parentFormGroup||this.parentForm),this.options.parentForm){var o=this.options.parentForm.submitted;Object.defineProperty(this.options.parentForm,"submitted",{get:function(){return o},set:function(e){o=e,t.options._markForCheck({fieldGroup:t.fields,model:t.model,formControl:t.form,options:t.options})}})}this.options.updateInitialValue||(this.options.updateInitialValue=function(){return t.initialModel=h({},t.model)}),this.options._buildForm||(this.options._buildForm=function(){t.clearModelSubscriptions(),t.formlyBuilder.buildForm(t.form,t.fields,t.model,t.options),t.trackModelChanges(t.fields)}),this.options._markForCheck||(this.options._markForCheck=function(e){e._componentRefs&&e._componentRefs.forEach(function(e){return e.changeDetectorRef.markForCheck()}),e.fieldGroup&&e.fieldGroup.forEach(function(e){return t.options._markForCheck(e)})}),this.options._componentFactoryResolver||(this.options._componentFactoryResolver=this.componentFactoryResolver)},e.prototype.checkExpressionChange=function(){this.isRoot&&this.options._checkField&&this.options._checkField({fieldGroup:this.fields,model:this.model,formControl:this.form,options:this.options})},e.prototype.trackModelChanges=function(e,t){var r=this;void 0===t&&(t=[]),e.forEach(function(o){if(o.key&&o.type&&!o.fieldGroup){var e=o.formControl.valueChanges.pipe(o.modelOptions.debounce&&o.modelOptions.debounce["default"]?f.debounceTime(o.modelOptions.debounce["default"]):f.tap(function(){}),f.map(function(t){return o.parsers&&0<o.parsers.length&&o.parsers.forEach(function(e){return t=e(t)}),t}),f.tap(function(e){return r.changeModel({key:c(t,[o.key]).join("."),value:e})}));r.modelChangeSubs.push(e.subscribe())}o.fieldGroup&&0<o.fieldGroup.length&&r.trackModelChanges(o.fieldGroup,o.key?c(t,[o.key]):t)})},e.prototype.clearModelSubscriptions=function(){this.modelChangeSubs.forEach(function(e){return e.unsubscribe()}),this.modelChangeSubs=[]},e.decorators=[{type:l.Component,args:[{selector:"formly-form",template:'\n    <formly-field *ngFor="let field of fields"\n      hide-deprecation\n      [form]="field.form"\n      [options]="field.options"\n      [model]="field.model"\n      [field]="field">\n    </formly-field>\n    <ng-content></ng-content>\n  '}]}],e.ctorParameters=function(){return[{type:w},{type:_},{type:l.ComponentFactoryResolver},{type:a.NgForm,decorators:[{type:l.Optional}]},{type:a.FormGroupDirective,decorators:[{type:l.Optional}]},{type:e,decorators:[{type:l.Optional},{type:l.SkipSelf}]}]},e.propDecorators={model:[{type:l.Input}],form:[{type:l.Input}],fields:[{type:l.Input}],options:[{type:l.Input}],modelChange:[{type:l.Output}],isRoot:[{type:l.Input}]},e}(),P=function(){function e(e,t,o){this.formlyConfig=e,this.componentFactoryResolver=t,this.className="",this.warnDeprecation=!1,this.modelChange=new l.EventEmitter,this.warnDeprecation=null===o}return Object.defineProperty(e.prototype,"model",{set:function(e){this.warnDeprecation&&console.warn("NgxFormly: passing 'model' input to '"+this.constructor.name+"' component is not required anymore, you may remove it!")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"form",{set:function(e){this.warnDeprecation&&console.warn("NgxFormly: passing 'form' input to '"+this.constructor.name+"' component is not required anymore, you may remove it!")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{set:function(e){this.warnDeprecation&&console.warn("NgxFormly: passing 'options' input to '"+this.constructor.name+"' component is not required anymore, you may remove it!")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentRefs",{get:function(){return this.field._componentRefs||O(this.field,"_componentRefs",[]),this.field._componentRefs},set:function(e){this.field._componentRefs=e},enumerable:!0,configurable:!0}),e.prototype.ngAfterContentInit=function(){this.triggerHook("afterContentInit")},e.prototype.ngAfterContentChecked=function(){this.triggerHook("afterContentChecked")},e.prototype.ngAfterViewInit=function(){this.triggerHook("afterViewInit")},e.prototype.ngAfterViewChecked=function(){this.triggerHook("afterViewChecked")},e.prototype.ngDoCheck=function(){this.triggerHook("doCheck")},e.prototype.ngOnInit=function(){this.triggerHook("onInit")},e.prototype.ngOnChanges=function(e){var t=this;e.field&&this.renderField(this.field,this.containerRef),this.triggerHook("onChanges",e),this.componentRefs.forEach(function(e){Object.assign(e.instance,{field:t.field})})},e.prototype.ngOnDestroy=function(){this.triggerHook("onDestroy"),this.componentRefs.forEach(function(e){return e.destroy()}),this.componentRefs=[]},e.prototype.renderField=function(n,i){var s=this;this.componentRefs.forEach(function(e){return e.destroy()}),this.componentRefs=[],c((n.wrappers||[]).map(function(e){return s.formlyConfig.getWrapper(e)}),[u({},this.formlyConfig.getType(n.type),{componentFactory:n._componentFactory})]).forEach(function(e){var t=e.component,o=e.componentRef,r=o||i.createComponent(s.componentFactoryResolver.resolveComponentFactory(t));Object.assign(r.instance,{field:n}),s.componentRefs.push(r),i=r.instance.fieldComponent})},e.prototype.triggerHook=function(e,t){this.field.hooks&&this.field.hooks[e]&&(t&&!t.field||this.field.hooks[e](this.field)),this.field.lifecycle&&this.field.lifecycle[e]&&this.field.lifecycle[e](this.field.form,this.field,this.field.model,this.field.options)},e.decorators=[{type:l.Component,args:[{selector:"formly-field",template:"<ng-template #container></ng-template>",host:{"[style.display]":'field.hide ? "none":""',"[class]":"field.className? field.className : className"}}]}],e.ctorParameters=function(){return[{type:_},{type:l.ComponentFactoryResolver},{type:undefined,decorators:[{type:l.Attribute,args:["hide-deprecation"]}]}]},e.propDecorators={field:[{type:l.Input}],className:[{type:l.Input,args:["class"]}],model:[{type:l.Input}],form:[{type:l.Input}],options:[{type:l.Input}],modelChange:[{type:l.Output}],containerRef:[{type:l.ViewChild,args:["container",{read:l.ViewContainerRef}]}]},e}(),V=function(){function e(e,t){this.renderer=e,this.elementRef=t}return e.prototype.onFocus=function(e){this.field.focus=!0,this.to.focus&&this.to.focus(this.field,e)},e.prototype.onBlur=function(e){this.field.focus=!1,this.to.blur&&this.to.blur(this.field,e)},Object.defineProperty(e.prototype,"to",{get:function(){return this.field.templateOptions||{}},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){var t=this;if(e.field){var o=e.field;this.renderer.setAttribute(this.elementRef.nativeElement,"id",this.field.id),this.to&&this.to.attributes&&(this.setAttributes(this.to.attributes),Object.defineProperty(this.to,"attributes",{get:function(){return t.to.__attributes__},set:function(e){return t.setAttributes(e)},enumerable:!0,configurable:!0})),(o.previousValue||{}).focus!==(o.currentValue||{}).focus&&this.elementRef.nativeElement.focus&&this.elementRef.nativeElement[this.field.focus?"focus":"blur"]()}},e.prototype.setAttributes=function(t){var o=this;this.to.__attributes__&&this.to.__attributes__!==t&&Object.keys(this.to.__attributes__).forEach(function(e){return o.renderer.removeAttribute(o.elementRef.nativeElement,e)}),this.to.__attributes__=t,Object.keys(t).forEach(function(e){return o.renderer.setAttribute(o.elementRef.nativeElement,e,t[e])})},e.decorators=[{type:l.Directive,args:[{selector:"[formlyAttributes]",host:{"[attr.name]":"field.name","[attr.placeholder]":"to.placeholder","[attr.tabindex]":"to.tabindex || 0","[attr.readonly]":"to.readonly","[attr.step]":"to.step","(keyup)":"to.keyup && to.keyup(field, $event)","(keydown)":"to.keydown && to.keydown(field, $event)","(click)":"to.click && to.click(field, $event)","(change)":"to.change && to.change(field, $event)","(keypress)":"to.keypress && to.keypress(field, $event)"}}]}],e.ctorParameters=function(){return[{type:l.Renderer2},{type:l.ElementRef}]},e.propDecorators={field:[{type:l.Input,args:["formlyAttributes"]}],onFocus:[{type:l.HostListener,args:["focus",["$event"]]}],onBlur:[{type:l.HostListener,args:["blur",["$event"]]}]},e}(),t=function(){function e(){}return Object.defineProperty(e.prototype,"model",{get:function(){return this.field.model},set:function(e){console.warn("NgxFormly: passing 'model' input to '"+this.constructor.name+"' component is not required anymore, you may remove it!")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"form",{get:function(){return this.field.parent.formControl},set:function(e){console.warn("NgxFormly: passing 'form' input to '"+this.constructor.name+"' component is not required anymore, you may remove it!")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.field.options},set:function(e){console.warn("NgxFormly: passing 'options' input to '"+this.constructor.name+"' component is not required anymore, you may remove it!")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.field.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formControl",{get:function(){return this.field.formControl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"to",{get:function(){return this.field.templateOptions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showError",{get:function(){return this.options.showError(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.field.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formState",{get:function(){return this.options.formState||{}},enumerable:!0,configurable:!0}),e.propDecorators={field:[{type:l.Input}],model:[{type:l.Input}],form:[{type:l.Input}],options:[{type:l.Input}]},e}(),j=function(t){function e(){var e=t.call(this)||this;return console.warn("NgxFormly: 'Field' has been renamed to 'FieldType', extend 'FieldType' instead."),e}return n(e,t),e}(t),A=function(t){function e(e){return t.call(this)||this}return n(e,t),e.prototype.add=function(e,t){e=g(e)?this.field.fieldGroup.length:e,this.model.splice(e,0,t?F(t):undefined),this.options._buildForm()},e.prototype.remove=function(e){this.model.splice(e,1),this.options._buildForm()},e}(t),R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(t),I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.decorators=[{type:l.Component,args:[{selector:"formly-group",template:'\n    <formly-form\n      [fields]="field.fieldGroup"\n      [isRoot]="false"\n      [model]="field.model"\n      [form]="field.formControl"\n      [options]="options"\n      [ngClass]="field.fieldGroupClassName">\n      <ng-content></ng-content>\n    </formly-form>\n  '}]}],t}(t),G=function(){function e(e){this.formlyConfig=e}return Object.defineProperty(e.prototype,"errorMessage",{get:function(){var e=this.field.formControl;for(var t in e.errors)if(e.errors.hasOwnProperty(t)){var o=this.formlyConfig.getValidatorMessage(t);if(C(e.errors[t])){if(e.errors[t].errorPath)return;e.errors[t].message&&(o=e.errors[t].message)}return this.field.validation&&this.field.validation.messages&&this.field.validation.messages[t]&&(o=this.field.validation.messages[t]),this.field.validators&&this.field.validators[t]&&this.field.validators[t].message&&(o=this.field.validators[t].message),this.field.asyncValidators&&this.field.asyncValidators[t]&&this.field.asyncValidators[t].message&&(o=this.field.asyncValidators[t].message),"function"==typeof o?o(e.errors[t],this.field):o}},enumerable:!0,configurable:!0}),e.decorators=[{type:l.Component,args:[{selector:"formly-validation-message",template:"{{ errorMessage }}"}]}],e.ctorParameters=function(){return[{type:_}]},e.propDecorators={field:[{type:l.Input}]},e}(),M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.decorators=[{type:l.Component,args:[{selector:"formly-template",template:'<div [innerHtml]="field.template"></div>'}]}],t}(t);function T(e,t,o){return e instanceof Function?e.apply(t,o):!!e}var N=function(){function e(){}return e.prototype.prePopulate=function(e){var o=this;e.parent||e.options._checkField||(e.options._checkField=function(e,t){return o._checkField(e,t)})},e.prototype.onPopulate=function(s){if(s.parent&&!s._expressionProperties){if(O(s,"_expressionProperties",{}),s.expressionProperties){var e=function(e){var t=s.expressionProperties[e],o=function i(e,t){try{return Function.apply(void 0,c(t,[e+" = expressionValue;"]))}catch(o){console.error(o)}}("field."+e,["expressionValue","model","field"]);if("string"==typeof t||b(t))s._expressionProperties[e]={expression:a._evalExpression(t,s.parent.expressionProperties&&s.parent.expressionProperties.hasOwnProperty("templateOptions.disabled")?function(){return s.parent.templateOptions.disabled}:undefined),expressionValueSetter:o},"templateOptions.disabled"===e&&Object.defineProperty(s._expressionProperties[e],"expressionValue",{get:function(){return s.templateOptions.disabled},set:function(){},enumerable:!0,configurable:!0});else if(t instanceof p.Observable){var r=t.pipe(f.tap(function(e){return T(o,{field:s},[e,s.model,s])})).subscribe(),n=s.hooks.onDestroy;s.hooks.onDestroy=function(e){n&&n(e),r.unsubscribe()}}},a=this;for(var t in s.expressionProperties)e(t)}(s.hideExpression||s.parent.hideExpression)&&(delete s.hide,s.hideExpression=this._evalExpression(s.hideExpression,s.parent&&s.parent.hideExpression?function(){return s.parent.hide}:undefined))}},e.prototype.postPopulate=function(e){e.parent||e.options._checkField(e,!0)},e.prototype._evalExpression=function(o,r){return"string"==typeof(o=o||function(){return!1})&&(o=function n(e,t){try{return Function.apply(void 0,c(t,["return "+e+";"]))}catch(o){console.error(o)}}(o,["model","formState"])),r?function(e,t){return r()||o(e,t)}:o},e.prototype._checkField=function(e,t){var o=this;void 0===t&&(t=!1);var r=!1;e.fieldGroup.forEach(function(e){o.checkFieldExpressionChange(e,t)&&(r=!0),o.checkFieldVisibilityChange(e,t)&&(r=!0),e.fieldGroup&&0<e.fieldGroup.length&&o._checkField(e,t)}),r&&e.options&&e.options._markForCheck&&e.options._markForCheck(e)},e.prototype.checkFieldExpressionChange=function(e,t){if(!e||!e._expressionProperties)return!1;var o=!1,r=e._expressionProperties,n=m.map(function(e){return"templateOptions."+e});for(var i in r){var s=T(r[i].expression,{field:e},[e.model,e.options.formState]);if("templateOptions.disabled"===i&&(s=!!s),t||r[i].expressionValue!==s&&(!C(s)||JSON.stringify(s)!==JSON.stringify(r[i].expressionValue))){if(o=!0,r[i].expressionValue=s,T(r[i].expressionValueSetter,{field:e},[s,e.model,e]),0===i.indexOf("model.")){var a=i.replace(/^model\./,""),p=e.key&&i===a?e.formControl:e.parent.formControl.get(a);!p||g(p.value)&&g(s)||p.value===s||p.patchValue(s)}-1!==n.indexOf(i)&&e.formControl&&e.formControl.updateValueAndValidity({emitEvent:!1})}}return o},e.prototype.checkFieldVisibilityChange=function(e,t){if(!e||g(e.hideExpression))return!1;var o=!!T(e.hideExpression,{field:e},[e.model,e.options.formState]),r=!1;if(o!==e.hide||t){if(r=!0,e.hide=o,e.templateOptions.hidden=o,e.formControl&&e.key){var n=this.fieldParentFormControl(e);if(n){var i=n.get(""+this.fieldKey(e));!0===o&&i?x(n,this.fieldKey(e)):!1!==o||i||this.addFieldControl(n,e)}}e.options.fieldChanges&&e.options.fieldChanges.next({field:e,type:"hidden",value:o})}return r},e.prototype.addFieldControl=function(e,t){var o=y(t);g(t.formControl.value)&&g(o)||t.formControl.value===o||t.formControl.patchValue(o,{emitEvent:!1}),e instanceof a.FormArray?e.push(t.formControl):e instanceof a.FormGroup&&e.addControl(""+this.fieldKey(t),t.formControl)},e.prototype.fieldParentFormControl=function(e){var t=d(e);return t.pop(),0<t.length?e.parent.formControl.get(t):e.parent.formControl},e.prototype.fieldKey=function(e){return d(e).pop()},e}(),S=function(){function e(e){this.formlyConfig=e}return e.prototype.onPopulate=function(e){this.initFieldValidation(e),this.initFieldAsyncValidation(e)},e.prototype.initFieldValidation=function(l){var t=this;if(!l._validators&&(O(l,"_validators",[]),this.initPredefinedFieldValidation(l),l.validators)){var e=function(i){if("validation"!==i){var s,a,p=l.validators[i];C(p)&&(s=p.errorPath,a=p.message,p=p.expression),l._validators.push(function(e){var t,o,r=p(e,l);if(s&&l.formControl&&l.formControl.get(s))if(r){var n=l.formControl.get(s).errors||{};delete n[i],l.formControl.get(s).setErrors(0===Object.keys(n).length?null:n)}else l.formControl.get(s).setErrors(u({},l.formControl.get(s).errors||{},((t={})[i]={message:a},t)));return r?null:((o={})[i]=!s||{errorPath:s},o)})}else Array.isArray(l.validators.validation)||(l.validators.validation=[l.validators.validation]),l.validators.validation.forEach(function(e){return l._validators.push(t.wrapNgValidatorFn(l,e))})};for(var o in l.validators)e(o)}},e.prototype.initFieldAsyncValidation=function(n){var o=this;if(!n._asyncValidators&&(O(n,"_asyncValidators",[]),n.asyncValidators)){var e=function(r){if("validation"!==r){var t=n.asyncValidators[r];C(t)&&(t=t.expression),n._asyncValidators.push(function(e){return new Promise(function(o){return t(e,n).then(function(e){var t;o(e?null:((t={})[r]=!0,t))})})})}else Array.isArray(n.asyncValidators.validation)||(n.asyncValidators.validation=[n.asyncValidators.validation]),n.asyncValidators.validation.forEach(function(e){return n._asyncValidators.push(o.wrapNgValidatorFn(n,e))})};for(var t in n.asyncValidators)e(t)}},e.prototype.initPredefinedFieldValidation=function(r){m.filter(function(e){return r.templateOptions&&r.templateOptions.hasOwnProperty(e)||r.expressionProperties&&r.expressionProperties["templateOptions."+e]}).forEach(function(o){r._validators.push(function(e){var t=r.templateOptions[o];if(!1===t)return null;switch(o){case"required":return a.Validators.required(e);case"pattern":return a.Validators.pattern(t)(e);case"minLength":return a.Validators.minLength(t)(e);case"maxLength":return a.Validators.maxLength(t)(e);case"min":return a.Validators.min(t)(e);case"max":return a.Validators.max(t)(e)}})})},e.prototype.wrapNgValidatorFn=function(t,o){return o="string"==typeof o?this.formlyConfig.getValidator(o).validation:o,function(e){return o(e,t)}},e}(),D=function(){function e(){}return e.prototype.onPopulate=function(r){var e,n=this;if(r.key&&r.type){var i=d({key:r.key}),s=r.parent.formControl,a=r.fieldGroup?((e={})[i[0]]=r.model,e):r.model;i.forEach(function(e,t){var o=e.toString();t===i.length-1?n.addFormControl(s,r,a,o):(a[e]||(a[e]="string"==typeof e?{}:[]),n.addFormControl(s,{key:o,fieldGroup:[],modelOptions:{},templateOptions:{}},a,o),s=s.get(o),a=a[e])})}r.fieldGroup&&!r.formControl&&(r.formControl=r.parent.formControl)},e.prototype.addFormControl=function(e,t,o,r){var n,i={validators:t._validators,asyncValidators:t._asyncValidators,updateOn:t.modelOptions.updateOn};if(t.formControl instanceof a.AbstractControl||e.get(r))g((n=t.formControl||e.get(r)).value)&&g(o[r])||n.value===o[r]||!(n instanceof a.FormControl)||n.patchValue(o[r]),(i.validators||i.asyncValidators)&&(i.validators&&n.setValidators(i.validators),i.asyncValidators&&n.setAsyncValidators(i.asyncValidators),n.updateValueAndValidity());else if(t._componentFactory&&t._componentFactory.component&&t._componentFactory.component.createControl){var s=t._componentFactory.component;console.warn("NgxFormly: '"+s.name+"::createControl' is deprecated since v5.0, use 'prePopulate' hook instead."),n=s.createControl(o[r],t)}else n=t.fieldGroup&&!t.fieldArray?new a.FormGroup({},i):t.fieldArray?new a.FormArray([],i):new a.FormControl(o[r],i);t.templateOptions.disabled&&n.disable(),delete t.templateOptions.disabled&&Object.defineProperty(t.templateOptions,"disabled",{get:function(){return!t.formControl.enabled},set:function(e){return e?t.formControl.disable():t.formControl.enable()},enumerable:!0,configurable:!0}),t&&(t.formControl=n),e instanceof a.FormArray?e.at(r)!==n&&e.setControl(r,n):e.get(r)!==n&&e.setControl(r,n)},e}(),W=function(){function e(e){this.formlyConfig=e,this.formId=0}return e.prototype.prePopulate=function(t){if(this.formlyConfig.createComponentInstance(t),this.getFieldComponentInstance(t).prePopulate(),!t.parent){var e=t.options&&t.options.fieldTransform||this.formlyConfig.extras.fieldTransform;(Array.isArray(e)?e:[e]).forEach(function(e){if(e&&(console.warn("NgxFormly: fieldTransform is deprecated since v5.0, use custom extension instead."),!e(t.fieldGroup,t.model,t.formControl,t.options)))throw new Error("fieldTransform must return an array of fields")})}},e.prototype.onPopulate=function(o){var r=this;this.initFieldOptions(o),this.getFieldComponentInstance(o).onPopulate(),o.fieldGroup&&o.fieldGroup.forEach(function(e,t){Object.defineProperty(e,"parent",{get:function(){return o},configurable:!0}),Object.defineProperty(e,"index",{get:function(){return t},configurable:!0}),r.formId++})},e.prototype.postPopulate=function(e){this.getFieldComponentInstance(e).postPopulate()},e.prototype.initFieldOptions=function(e){var t=e.parent;t&&(Object.defineProperty(e,"form",{get:function(){return t.formControl},configurable:!0}),Object.defineProperty(e,"options",{get:function(){return t.options},configurable:!0}),Object.defineProperty(e,"model",{get:function(){return e.key&&e.fieldGroup?y(e):t.model},configurable:!0}),e.id=function n(e,t,o){if(t.id)return t.id;var r=t.type;return!r&&t.template&&(r="template"),[e,r,t.key,o].join("_")}("formly_"+this.formId,e,e.index),e.templateOptions=e.templateOptions||{},e.modelOptions=e.modelOptions||{},e.hooks=e.hooks||{},e.lifecycle&&console.warn("NgxFormly: 'lifecycle' is deprecated since v5.0, use 'hooks' instead."),e.type&&e.key&&(e.templateOptions=Object.assign({label:"",placeholder:"",focus:!1},e.templateOptions)),e.template&&"formly-template"!==e.type&&(e.type&&console.warn("NgxFormly: passing 'type' property is not allowed when 'template' is set."),e.type="formly-template"),e.type&&this.formlyConfig.getMergedField(e),e.key&&v(e.defaultValue)&&(e.fieldGroup||e.fieldArray)&&(e.defaultValue=e.fieldArray?[]:{}),!v(e.defaultValue)&&v(y(e))&&s(t.model,e.key,e.defaultValue),this.initFieldWrappers(e),e.fieldArray&&this.initFieldArray(e),!e.type&&e.fieldGroup&&(e.type="formly-group"))},e.prototype.initFieldArray=function(e){if(e.fieldGroup=e.fieldGroup||[],e.fieldGroup.length>e.model.length)for(var t=e.fieldGroup.length;t>=e.model.length;--t)x(e.formControl,t),e.fieldGroup.splice(t,1);for(t=e.fieldGroup.length;t<e.model.length;t++){var o=u({},F(e.fieldArray),{key:""+t});e.fieldGroup.push(o)}},e.prototype.initFieldWrappers=function(t){t.wrappers=t.wrappers||[];var e=u({preWrapper:[],postWrapper:[]},t.templateOptions.templateManipulators||{});t.wrappers=c(this.formlyConfig.templateManipulators.preWrapper.map(function(e){return e(t)}),e.preWrapper.map(function(e){return e(t)}),t.wrappers,this.formlyConfig.templateManipulators.postWrapper.map(function(e){return e(t)}),e.postWrapper.map(function(e){return e(t)})).filter(function(e,t,o){return e&&t===o.indexOf(e)})},e.prototype.getFieldComponentInstance=function(e){var t={};return e._componentFactory&&e._componentFactory.componentRef&&(t=e._componentFactory.componentRef.instance),{prePopulate:function(){return t.prePopulate&&t.prePopulate(e)},onPopulate:function(){return t.onPopulate&&t.onPopulate(e)},postPopulate:function(){return t.postPopulate&&t.postPopulate(e)}}},e}();function q(e){return{types:[{name:"formly-group",component:I},{name:"formly-template",component:M}],extensions:[{name:"core",extension:new W(e)},{name:"field-validation",extension:new S(e)},{name:"field-form",extension:new D},{name:"field-expression",extension:new N}]}}var H=function(){function t(t,e){void 0===e&&(e=[]),e&&e.forEach(function(e){return t.addConfig(e)})}return t.forRoot=function(e){return void 0===e&&(e={}),{ngModule:t,providers:[{provide:k,multi:!0,useFactory:q,deps:[_]},{provide:k,useValue:e,multi:!0},{provide:l.ANALYZE_FOR_ENTRY_COMPONENTS,useValue:e,multi:!0},_,w]}},t.forChild=function(e){return void 0===e&&(e={}),{ngModule:t,providers:[{provide:k,useValue:e,multi:!0},{provide:l.ANALYZE_FOR_ENTRY_COMPONENTS,useValue:e,multi:!0}]}},t.decorators=[{type:l.NgModule,args:[{declarations:[E,P,V,I,G,M],entryComponents:[I,M],exports:[E,P,V,I,G],imports:[o.CommonModule]}]}],t.ctorParameters=function(){return[{type:_},{type:Array,decorators:[{type:l.Optional},{type:l.Inject,args:[k]}]}]},t}();e.FormlyForm=E,e.FormlyField=P,e.FormlyAttributes=V,e.FormlyConfig=_,e.FormlyFormBuilder=w,e.FieldType=t,e.Field=j,e.FieldArrayType=A,e.FieldWrapper=R,e.FormlyModule=H,e.ɵdefineHiddenProp=O,e.ɵc=I,e.ɵb=q,e.ɵf=W,e.ɵi=N,e.ɵh=D,e.ɵg=S,e.ɵa=k,e.ɵe=M,e.ɵd=G,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-formly-core.umd.min.js.map